"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3511],{76543:(se,D,s)=>{s.r(D),s.d(D,{default:()=>As});var e=s(74848),a=s(96540),m=s(32264),n=s(32196),u=s(24180),x=s(41053),d=s(10940),M=s(76885),g=s(66602),v=s(40845),l=s(55852),f=s(83277),j=s(31678),R=s(25027),L=s(19073),U=s(9518),F=s(14285),y=s(61410),$=s(23770),H=s(55740),A=s(57220),Y=s(37959),fe=s(45058),he=s(75648),P=s(67381),B=s(64853),T=s(55127),G=s.n(T),oe=s(94753),J=s(39558),le=s(62930),W=s(19384),K=s(15054),Q=s(98439),Ce=s(22620),De=s(88467),as=s(13544),Ye=s(67061),te=s(14578),Je=s(56034),Qe=s(39938),ns=s(96374),S=s(11167),X=s(83903),Te=s(41520),Le=s(56361),pe=s(23662),N=s(64047),Fe=s(82437),Ee=s(79938),Ie=s(16293),ie=s(76648),Pe=s(84029);function Be({folder:t,onClose:r}){const[o,c]=(0,a.useState)("yaml");return(0,e.jsx)(ie.m,{title:`Export ${t.title} rules`,activeTab:o,onTabChange:c,onClose:r,formatProviders:Object.values(Pe.sl),children:(0,e.jsx)(Xe,{folder:t,exportFormat:o,onClose:r})})}function Xe({folder:t,exportFormat:r,onClose:o}){const{currentData:c="",isFetching:i}=Ee.hK.endpoints.exportRules.useQuery({folderUid:t.uid,format:r});if(i)return(0,e.jsx)(J._,{text:"Loading...."});const h=`${t.title}-${t.uid}`;return(0,e.jsx)(Ie.J,{format:r,textDefinition:c,downloadFileName:h,onClose:o})}function Ze({folderUid:t,groupName:r,onClose:o}){const[c,i]=(0,a.useState)("yaml");return(0,e.jsx)(ie.m,{title:`Export ${r} rules`,activeTab:c,onTabChange:i,onClose:o,formatProviders:Object.values(Pe.sl),children:(0,e.jsx)(We,{folderUid:t,groupName:r,exportFormat:c,onClose:o})})}function We({folderUid:t,groupName:r,exportFormat:o,onClose:c}){const{currentData:i="",isFetching:h}=Ee.hK.endpoints.exportRules.useQuery({folderUid:t,group:r,format:o});return h?(0,e.jsx)(J._,{text:"Loading...."}):(0,e.jsx)(Ie.J,{format:o,textDefinition:i,downloadFileName:r,onClose:c})}var Ke=s(99106),ce=s(72275),Ne=s(22040),Ue=s(91076),b=s(46942),Z=s.n(b),ye=s(2543),ge=s(37390),w=s(99140),k=s(18461),$e=s(30423);const we=t=>{const{group:r,namespace:o,onClose:c,folderUid:i}=t,q=(0,U.dy)().find(E=>E.rulesSource===o.rulesSource&&E.name===o.name)?.groups.find(E=>E.name===r.name),[ae,ue]=(0,a.useState)(!1),[ee,Me]=(0,a.useState)(q?.rules||[]),ne=(0,v.of)(C),ve=(0,a.useCallback)(E=>{if(!E.destination||E.destination.index===E.source.index)return;const z=be(ee,E.source.index,E.destination.index);Me(z);const je=(0,A.EV)(o.rulesSource),Se=(0,ye.compact)(z.map(Oe=>Oe.rulerRule));ue(!0),(0,w.JD)((0,$.DN)({namespaceName:o.name,groupName:r.name,rulesSourceName:je,newRules:Se,folderUid:i||o.name})).unwrap().finally(()=>{ue(!1)})},[r.name,o.name,o.rulesSource,ee,i]),re=ee.map(E=>({...E,uid:String((0,k.Ns)(E.rulerRule))}));return(0,e.jsx)(ge.a,{className:ne.modal,isOpen:!0,title:(0,e.jsx)(ke,{namespace:o,group:r}),onDismiss:c,onClickBackdrop:c,children:(0,e.jsx)(Ue.JY,{onDragEnd:ve,children:(0,e.jsx)(Ue.gL,{droppableId:"alert-list",mode:"standard",renderClone:(E,O,z)=>(0,e.jsx)(Ge,{provided:E,rule:re[z.source.index],isClone:!0}),children:E=>(0,e.jsxs)("div",{ref:E.innerRef,className:Z()(ne.listContainer,ae&&ne.disabled),...E.droppableProps,children:[re.map((O,z)=>(0,e.jsx)(Ue.sx,{draggableId:O.uid,index:z,isDragDisabled:ae,children:je=>(0,e.jsx)(Ge,{provided:je,rule:O},O.uid)},O.uid)),E.placeholder]})})})})},Ge=({provided:t,rule:r,isClone:o=!1,isDragging:c=!1})=>{const i=(0,v.of)(C);return(0,e.jsxs)("div",{"data-testid":"reorder-alert-rule",className:Z()(i.listItem,o&&"isClone",c&&"isDragging"),ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,children:[(0,pe.Z8)(r.promRule)&&(0,e.jsx)($e.C,{state:r.promRule.state}),(0,pe.KB)(r.promRule)&&(0,e.jsx)(Qe.E,{text:"Recording",color:"blue"}),(0,e.jsx)("div",{className:i.listItemName,children:r.name}),(0,e.jsx)(te.I,{name:"draggabledots"})]})},ke=({namespace:t,group:r})=>{const o=(0,v.of)(C);return(0,e.jsxs)("div",{className:o.header,children:[(0,e.jsx)(te.I,{name:"folder"}),(0,A.Eb)(t.rulesSource)&&(0,e.jsx)(Je.m,{content:t.rulesSource.name,placement:"top",children:(0,e.jsx)("img",{alt:t.rulesSource.meta.name,className:o.dataSourceIcon,src:t.rulesSource.meta.info.logos.small})}),(0,e.jsx)("span",{children:t.name}),(0,e.jsx)(te.I,{name:"angle-right"}),(0,e.jsx)("span",{children:r.name})]})},C=t=>({modal:(0,n.css)({maxWidth:"640px",maxHeight:"80%",overflow:"hidden"}),listItem:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"center",gap:t.spacing(),background:t.colors.background.primary,color:t.colors.text.secondary,borderBottom:`solid 1px ${t.colors.border.medium}`,padding:`${t.spacing(1)} ${t.spacing(2)}`,"&:last-child":{borderBottom:"none"},"&.isClone":{border:`solid 1px ${t.colors.primary.shade}`}}),listContainer:(0,n.css)({userSelect:"none",border:`solid 1px ${t.colors.border.medium}`}),disabled:(0,n.css)({opacity:"0.5",pointerEvents:"none"}),listItemName:(0,n.css)({flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),header:(0,n.css)({display:"flex",alignItems:"center",gap:t.spacing(1)}),dataSourceIcon:(0,n.css)({width:t.spacing(2),height:t.spacing(2)})});function be(t,r,o){const c=Array.from(t),[i]=c.splice(r,1);return c.splice(o,0,i),c}var ze=s(92467),Ae=s(80215);const ss=a.memo(({group:t,namespace:r,expandAll:o,viewMode:c})=>{const{rulesSource:i}=r,h=(0,j.useDispatch)(),p=(0,v.of)(_),[q,ae]=(0,a.useState)(!1),[ue,ee]=(0,a.useState)(!1),[Me,ne]=(0,a.useState)(!1),[ve,re]=(0,a.useState)(void 0),[E,O]=(0,a.useState)(!o),{canEditRules:z}=(0,Te.V)();(0,a.useEffect)(()=>{O(!o)},[o]);const{hasRuler:je,rulerRulesLoaded:Se}=(0,X.y)(),Oe=t.rules[0]?.rulerRule,me=Oe&&(0,pe.lT)(Oe)&&Oe.grafana_alert.namespace_uid||void 0,{folder:V}=(0,S.a)(me),He=je(i)&&Se(i)&&!t.rules.find(Re=>!!Re.rulerRule),_e=(0,pe.YN)(t),Ve=t.rules.some(Re=>(0,pe.lT)(Re.rulerRule)&&Re.rulerRule.grafana_alert.provenance),qe=c==="list",es=c==="grouped",xe=()=>{h((0,$.g6)(r,t)),ee(!1)},I=[];if(He)I.push((0,e.jsxs)(Ye.B,{children:[(0,e.jsx)(le.y,{}),"deleting"]},"is-deleting"));else if(i===A.hY){if(me){const Re=(0,Le.NH)(me);V?.canSave&&(es&&!Ve&&(I.push((0,e.jsx)(ce.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>ae(!0)},"edit")),I.push((0,e.jsx)(ce.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:p.rotate90,onClick:()=>ne(!0)},"reorder"))),qe&&(I.push((0,e.jsx)(ce.M,{"aria-label":"go to folder",icon:"folder-open",tooltip:"go to folder",to:Re,target:"__blank"},"goto")),V?.canAdmin&&I.push((0,e.jsx)(ce.M,{"aria-label":"manage permissions",icon:"lock",tooltip:"manage permissions",to:Re+"/permissions",target:"__blank"},"manage-perms")))),V&&(qe?I.push((0,e.jsx)(ce.M,{"aria-label":"export rule folder","data-testid":"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>re("folder")},"export-folder")):es&&I.push((0,e.jsx)(ce.M,{"aria-label":"export rule group","data-testid":"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>re("group")},"export-group")))}}else z(i.name)&&je(i)&&(_e||(I.push((0,e.jsx)(ce.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>ae(!0)},"edit")),I.push((0,e.jsx)(ce.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:p.rotate90,onClick:()=>ne(!0)},"reorder"))),I.push((0,e.jsx)(ce.M,{"aria-label":"delete rule group","data-testid":"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>ee(!0)},"delete-group")));const is=qe?(0,e.jsx)(Fe.c,{namespace:(0,Ke.EL)(r).name}):(0,e.jsx)(Fe.c,{namespace:(0,Ke.EL)(r).name,group:t.name}),cs=(Re=!1)=>{Re||(0,R.fH)(R.le.leavingRuleGroupEdit),ae(!1)};return(0,e.jsxs)("div",{className:p.wrapper,"data-testid":"rule-group",children:[(0,e.jsxs)("div",{className:p.header,"data-testid":"rule-group-header",children:[(0,e.jsx)(N.e,{size:"sm",className:p.collapseToggle,isCollapsed:E,onToggle:O,"data-testid":as.Tp.components.AlertRules.groupToggle}),(0,e.jsx)(te.I,{name:E?"folder":"folder-open"}),(0,A.Eb)(i)&&(0,e.jsx)(Je.m,{content:i.name,placement:"top",children:(0,e.jsx)("img",{alt:i.meta.name,className:p.dataSourceIcon,src:i.meta.info.logos.small})}),(0,e.jsxs)("div",{className:p.groupName,onClick:()=>O(!E),children:[_e&&(0,e.jsx)(Qe.E,{color:"purple",text:"Federated"})," ",is]}),(0,e.jsx)("div",{className:p.spacer}),(0,e.jsx)("div",{className:p.headerStats,children:(0,e.jsx)(ze.j7,{group:t})}),Ve&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:p.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:p.actionIcons,children:(0,e.jsx)(Qe.E,{color:"purple",text:"Provisioned"})})]}),!!I.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:p.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:p.actionIcons,children:(0,e.jsx)(Ye.B,{gap:.5,children:I})})]})]}),!E&&(0,e.jsx)(Ae.s,{showSummaryColumn:!0,className:p.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!t.interval,rules:t.rules}),q&&(0,e.jsx)(Ne.u5,{namespace:r,group:t,onClose:()=>cs(),folderUrl:V?.canEdit?(0,Le.qN)(V.uid):void 0,folderUid:me}),Me&&(0,e.jsx)(we,{group:t,folderUid:me,namespace:r,onClose:()=>ne(!1)}),(0,e.jsx)(ns.u,{isOpen:ue,title:"Delete group",body:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:['Deleting "',(0,e.jsx)("strong",{children:t.name}),'" will permanently remove the group and'," ",t.rules.length," alert ",G()("rule",t.rules.length)," belonging to it."]}),(0,e.jsx)("p",{children:"Are you sure you want to delete this group?"})]}),onConfirm:xe,onDismiss:()=>ee(!1),confirmText:"Delete"}),V&&ve==="folder"&&(0,e.jsx)(Be,{folder:V,onClose:()=>re(void 0)}),V&&ve==="group"&&(0,e.jsx)(Ze,{folderUid:V.uid,groupName:t.name,onClose:()=>re(void 0)})]})});ss.displayName="RulesGroup";const _=t=>({wrapper:(0,n.css)({}),header:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${t.colors.border.weak}`,"&:hover":{backgroundColor:t.components.table.rowHoverBackground}}),headerStats:(0,n.css)({flexShrink:0,span:{verticalAlign:"middle"},[t.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:t.spacing(1)}}),groupName:(0,n.css)({marginLeft:t.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,n.css)({flex:1}),collapseToggle:(0,n.css)({background:"none",border:"none",marginTop:`-${t.spacing(1)}`,marginBottom:`-${t.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,n.css)({width:t.spacing(2),height:t.spacing(2),marginLeft:t.spacing(2)}),dataSourceOrigin:(0,n.css)({marginRight:"1em",color:t.colors.text.disabled}),actionsSeparator:(0,n.css)({margin:`0 ${t.spacing(2)}`}),actionIcons:(0,n.css)({width:"80px",alignItems:"center",flexShrink:0}),rulesTable:(0,n.css)({margin:t.spacing(2,0)}),rotate90:(0,n.css)({transform:"rotate(90deg)"})});function os(t){return(0,a.useMemo)(()=>t.flatMap(r=>r.groups.map(o=>({namespace:r,group:o}))),[t])}const ds=({namespaces:t,expandAll:r})=>{const o=(0,v.of)(us),c=(0,y.$)(O=>O.dataSources),i=(0,y.$)(O=>O.promRules),h=(0,a.useMemo)(A.qi,[]),p=os(t),q=(0,a.useMemo)(()=>h.filter(O=>(0,De.ML)(i[O.name])||(0,De.ML)(c[O.name])),[i,c,h]),ae=h.some(O=>!!i[O.name]?.result?.length),ue=h.length>0,ee=q.length>0,Me=t.length>0,{numberOfPages:ne,onPageChange:ve,page:re,pageItems:E}=(0,Q.W)(p,1,K.FG);return(0,e.jsxs)("section",{className:o.wrapper,children:[(0,e.jsx)("div",{className:o.sectionHeader,children:(0,e.jsxs)("div",{className:o.headerRow,children:[(0,e.jsx)(oe.E,{element:"h2",variant:"h5",children:"Mimir / Cortex / Loki"}),q.length?(0,e.jsx)(J._,{className:o.loader,text:`Loading rules from ${q.length} ${G()("source",q.length)}`}):(0,e.jsx)("div",{}),(0,e.jsx)(gs,{})]})}),E.map(({group:O,namespace:z})=>(0,e.jsx)(ss,{group:O,namespace:z,expandAll:r,viewMode:"grouped"},`${(0,A.v0)(z.rulesSource)}-${z.name}-${O.name}`)),!ue&&(0,e.jsx)("p",{children:"There are no Prometheus or Loki data sources configured."}),ue&&!ee&&!Me&&(0,e.jsx)("p",{children:"No rules found."}),!ae&&ee&&(0,e.jsx)(le.y,{size:"xl",className:o.spinner}),(0,e.jsx)(W.d,{className:o.pagination,currentPage:re,numberOfPages:ne,onNavigate:ve,hideWhenSinglePage:!0})]})},us=t=>({loader:(0,n.css)({marginBottom:0}),sectionHeader:(0,n.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,n.css)({marginBottom:t.spacing(4)}),spinner:(0,n.css)({textAlign:"center",padding:t.spacing(2)}),pagination:(0,Ce.H)(t),headerRow:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:t.spacing(1)})});function gs(){const[t,r]=(0,L.Ej)(L.RY.CreateExternalAlertRule),o=(0,u.zy)();return t&&r?(0,e.jsx)(l.z9,{href:M.kM.renderUrl("alerting/new/recording",{returnTo:o.pathname+o.search}),tooltip:"Create new Data source-managed recording rule",icon:"plus",variant:"secondary",children:"New recording rule"},"new-recording-rule"):null}var ms=s(42941),ts=s(8484),xs=s(3704);function fs({onClose:t}){const[r,o]=(0,a.useState)("yaml");return(0,e.jsx)(ie.m,{activeTab:r,onTabChange:o,onClose:t,formatProviders:Object.values(Pe.sl),children:(0,e.jsx)(hs,{exportFormat:r,onClose:t})})}function hs({exportFormat:t,onClose:r}){const{currentData:o="",isFetching:c}=Ee.hK.endpoints.exportRules.useQuery({format:t}),i=`alert-rules-${new Date().getTime()}`;return c?(0,e.jsx)(J._,{text:"Loading...."}):(0,e.jsx)(Ie.J,{format:t,textDefinition:o,downloadFileName:i,onClose:r})}const ps=({namespaces:t,expandAll:r})=>{const o=(0,v.of)(vs),[c]=(0,f.s)(),{prom:i,ruler:h}=(0,y.$)(V=>({prom:V.promRules[A.hY]||De.jA,ruler:V.rulerRules[A.hY]||De.jA})),p=i.loading||h.loading,q=!!i.result||!!h.result,ae=c.view==="list",ue=ae?(0,U.Jr)(t):t,ee=os(ue),{numberOfPages:Me,onPageChange:ne,page:ve,pageItems:re}=(0,Q.W)(ee,1,K.FG),[E,O]=(0,L.Ej)(L.RY.ExportGrafanaManagedRules),z=E&&O,[je,Se]=(0,ms.A)(!1),Oe=t.length>0,me=m.$.featureToggles.grafanaManagedRecordingRules;return(0,e.jsxs)("section",{className:o.wrapper,children:[(0,e.jsx)("div",{className:o.sectionHeader,children:(0,e.jsxs)("div",{className:o.headerRow,children:[(0,e.jsx)(oe.E,{element:"h2",variant:"h5",children:(0,e.jsx)(ts.x6,{i18nKey:"alerting.grafana-rules.title",children:"Grafana"})}),p?(0,e.jsx)(J._,{className:o.loader,text:(0,ts.t)("alerting.grafana-rules.loading","Loading...")}):(0,e.jsx)("div",{}),(0,e.jsxs)(Ye.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[Oe&&z&&(0,e.jsx)(l.$n,{"aria-label":"export all grafana rules","data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:"Export all Grafana-managed rules",onClick:Se,variant:"secondary",children:(0,e.jsx)(ts.x6,{i18nKey:"alerting.grafana-rules.export-rules",children:"Export rules"})}),me&&(0,e.jsx)(l.z9,{href:(0,xs.G)("/alerting/new/grafana-recording",{returnTo:"/alerting/list"+location.search}),icon:"plus",variant:"secondary",tooltip:"Create new Grafana-managed recording rule",onClick:()=>(0,R.fH)(R.le.grafanaRecording),children:(0,e.jsx)(ts.x6,{i18nKey:"alerting.grafana-rules.new-recording-rule",children:"New recording rule"})})]})]})}),re.map(({group:V,namespace:He})=>(0,e.jsx)(ss,{group:V,namespace:He,expandAll:r,viewMode:ae?"list":"grouped"},`${He.name}-${V.name}`)),q&&ue?.length===0&&(0,e.jsx)("p",{children:"No rules found."}),!q&&p&&(0,e.jsx)(le.y,{size:"xl",className:o.spinner}),(0,e.jsx)(W.d,{className:o.pagination,currentPage:ve,numberOfPages:Me,onNavigate:ne,hideWhenSinglePage:!0}),z&&je&&(0,e.jsx)(fs,{onClose:Se})]})},vs=t=>({loader:(0,n.css)({marginBottom:0}),sectionHeader:(0,n.css)({display:"flex",justifyContent:"space-between",marginBottom:t.spacing(1)}),wrapper:(0,n.css)({marginBottom:t.spacing(4)}),spinner:(0,n.css)({textAlign:"center",padding:t.spacing(2)}),pagination:(0,Ce.H)(t),headerRow:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),Es=({namespaces:t,expandAll:r})=>{const[o,c]=(0,a.useMemo)(()=>{const i=t.map(h=>({...h,groups:h.groups.sort((p,q)=>p.name.localeCompare(q.name))})).sort((h,p)=>h.name.localeCompare(p.name));return[i.filter(h=>(0,A.z2)(h.rulesSource)),i.filter(h=>(0,A.Eb)(h.rulesSource))]},[t]);return(0,a.useEffect)(()=>{(0,R.fH)(R.le.loadedList)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B._,{actions:[L.RY.ViewAlertRule],children:(0,e.jsx)(ps,{namespaces:o,expandAll:r})}),(0,e.jsx)(B._,{actions:[L.RY.ViewExternalAlertRule],children:(0,e.jsx)(ds,{namespaces:c,expandAll:r})})]})};var de=s(94822);const rs=({rules:t,state:r,defaultCollapsed:o=!1})=>{const[c,i]=(0,a.useState)(o),h=(0,v.of)(js);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("h4",{className:h.header,children:[(0,e.jsx)(N.e,{className:h.collapseToggle,size:"xxl",isCollapsed:c,onToggle:()=>i(!c)}),(0,pe.XI)(r)," (",t.length,")"]}),!c&&(0,e.jsx)(Ae.s,{className:h.rulesTable,rules:t,showGroupColumn:!0})]})},js=t=>({collapseToggle:(0,n.css)({verticalAlign:"middle"}),header:(0,n.css)({marginTop:t.spacing(2)}),rulesTable:(0,n.css)({marginTop:t.spacing(3)})}),Rs=({namespaces:t})=>{const r=(0,Le.Ht)((0,f.s)()[0]),o=(0,a.useMemo)(()=>{const c={[de.cF.Firing]:[],[de.cF.Inactive]:[],[de.cF.Pending]:[]};return t.forEach(i=>i.groups.forEach(h=>h.rules.forEach(p=>{p.promRule&&(0,pe.Z8)(p.promRule)&&c[p.promRule.state].push(p)}))),Object.values(c).forEach(i=>i.sort((h,p)=>h.name.localeCompare(p.name))),c},[t]);return(0,e.jsxs)(e.Fragment,{children:[(!r.alertState||r.alertState===de.cF.Firing)&&(0,e.jsx)(rs,{state:de.cF.Firing,rules:o[de.cF.Firing]}),(!r.alertState||r.alertState===de.cF.Pending)&&(0,e.jsx)(rs,{state:de.cF.Pending,rules:o[de.cF.Pending]}),(!r.alertState||r.alertState===de.cF.Inactive)&&(0,e.jsx)(rs,{defaultCollapsed:r.alertState!==de.cF.Inactive,state:de.cF.Inactive,rules:o[de.cF.Inactive]})]})};var Cs=s(84866);const ls={groups:Es,state:Rs},Ds=he.Ys+1,Ps=(0,g.Xc)(()=>{const t=(0,j.useDispatch)(),r=(0,v.of)(ys),o=(0,a.useMemo)(A.gR,[]),[c,i]=(0,a.useState)(!1),h=(0,a.useCallback)(()=>i(!1),[]),[p]=(0,f.s)(),{filterState:q,hasActiveFilters:ae}=(0,F.dI)(),ue=p.view,ee=ls[ue]?ue:"groups",Me=ls[ee],ne=(0,y.$)(xe=>xe.promRules),ve=(0,y.$)(xe=>xe.rulerRules),re=o.some(xe=>ne[xe]?.loading||ve[xe]?.loading),E=Object.entries(ne),O=Object.entries(ve),z=E.every(([xe,I])=>I.dispatched&&(I?.result!==void 0||I?.error!==void 0)),je=O.every(([xe,I])=>I.dispatched&&(I?.result!==void 0||I?.error!==void 0)),Se=E.every(([xe,I])=>I.dispatched&&I?.result?.length===0),Oe=O.every(([xe,I])=>Object.entries(I?.result??{}).every(([Re,Ss])=>Ss?.length===0)&&I.dispatched),me=ae?void 0:Ds,[V,He]=(0,x.A)(async()=>{re||await t((0,$.yo)(!1,{limitAlerts:me}))},[re,me,t]);(0,a.useEffect)(()=>{(0,R.Sq)().catch(()=>{})},[]),(0,a.useEffect)(()=>{t((0,$.yo)(!1,{limitAlerts:me}))},[t,me]),(0,d.A)(He,H.HH);const _e=z&&Se&&E.length>0&&Oe&&je,Ve=!_e,qe=(0,U.dy)(),es=(0,F.i7)(qe,q);return(0,e.jsxs)(Y.d,{navId:"alert-list",isLoading:!1,actions:Ve&&(0,e.jsx)(Os,{}),children:[(0,e.jsx)(P.o,{}),(0,e.jsx)(Cs.A,{onFilterCleared:h}),Ve&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.break}),(0,e.jsx)("div",{className:r.buttonsContainer,children:(0,e.jsxs)("div",{className:r.statsContainer,children:[ee==="groups"&&ae&&(0,e.jsx)(l.$n,{className:r.expandAllButton,icon:c?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>i(!c),children:c?"Collapse all":"Expand all"}),(0,e.jsx)(ze.M_,{namespaces:es})]})})]}),_e&&(0,e.jsx)(fe.w,{}),Ve&&(0,e.jsx)(Me,{expandAll:c,namespaces:es})]})},{style:"page"}),ys=t=>({break:(0,n.css)({width:"100%",height:0,marginBottom:t.spacing(2),borderBottom:`solid 1px ${t.colors.border.medium}`}),buttonsContainer:(0,n.css)({marginBottom:t.spacing(2),display:"flex",justifyContent:"space-between"}),statsContainer:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"center"}),expandAllButton:(0,n.css)({marginRight:t.spacing(1)})}),Ms=Ps;function Os(){const[t,r]=(0,L.Ej)(L.RY.CreateAlertRule),[o,c]=(0,L.Ej)(L.RY.CreateExternalAlertRule),i=(0,u.zy)();return t&&r||o&&c?(0,e.jsx)(l.z9,{href:M.kM.renderUrl("alerting/new/alerting",{returnTo:i.pathname+i.search}),icon:"plus",onClick:()=>(0,R.fH)(R.le.alertRuleFromScratch),children:"New alert rule"}):null}const Is=(0,a.lazy)(()=>s.e(2042).then(s.bind(s,82042))),As=()=>{const t=m.$.featureToggles.alertingListViewV2;return(0,e.jsx)(a.Suspense,{children:t?(0,e.jsx)(Is,{}):(0,e.jsx)(Ms,{})})}},64853:(se,D,s)=>{s.d(D,{_:()=>u});var e=s(74848),a=s(2543),m=s.n(a),n=s(19073);const u=({actions:l,children:f})=>{const j=(0,a.filter)(l,g),R=(0,a.filter)(l,v);return j.length?(0,e.jsx)(x,{actions:j,children:f}):R.length?(0,e.jsx)(d,{actions:R,children:f}):null},x=({actions:l,children:f})=>{const j=(0,n.iI)();return M(j,l)?(0,e.jsx)(e.Fragment,{children:f}):null},d=({actions:l,children:f})=>{const j=(0,n.e2)();return M(j,l)?(0,e.jsx)(e.Fragment,{children:f}):null};function M(l,f){return(0,a.chain)(l).pick(f).values().value().some(([j,R])=>R===!0)}function g(l){return Object.values(n.QI).includes(l)}function v(l){return Object.values(n.RY).includes(l)}},64047:(se,D,s)=>{s.d(D,{e:()=>m});var e=s(74848),a=s(55852);const m=({isCollapsed:n,onToggle:u,idControlled:x,className:d,text:M,size:g="xl",...v})=>(0,e.jsx)(a.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!n,"aria-controls":x,className:d,icon:n?"angle-right":"angle-down",onClick:()=>u(!n),...v,children:M})},16293:(se,D,s)=>{s.d(D,{J:()=>R});var e=s(74848),a=s(32196),m=s(4213),n=s.n(m),u=s(96540),x=s(70713),d=s(40845),M=s(32372),g=s(55852),v=s(10534),l=s(72109),f=s(42418),j=s(84029);function R({format:F,textDefinition:y,downloadFileName:$,onClose:H}){const A=(0,d.of)(L),Y=j.sl[F],fe=(0,u.useCallback)(()=>{const P=new Blob([y],{type:`application/${F};charset=utf-8`});n()(P,`${$}.${F}`)},[y,$,F]),he=(0,u.useMemo)(()=>Y.formatter?Y.formatter(y):y,[Y,y]);return(0,e.jsxs)("div",{className:A.container,children:[(0,e.jsx)(U,{exportProvider:Y}),(0,e.jsx)("div",{className:A.content,children:(0,e.jsx)(x.Ay,{disableWidth:!0,children:({height:P})=>(0,e.jsx)(M.B,{width:"100%",height:P,language:F,value:he,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}})})}),(0,e.jsxs)("div",{className:A.actions,children:[(0,e.jsx)(g.$n,{variant:"secondary",onClick:H,children:"Cancel"}),(0,e.jsx)(v.b,{icon:"copy",getText:()=>y,children:"Copy code"}),(0,e.jsx)(g.$n,{icon:"download-alt",onClick:fe,children:"Download"})]})]})}const L=F=>({container:(0,a.css)({display:"flex",flexDirection:"column",height:"100%",gap:F.spacing(2)}),content:(0,a.css)({flex:"1 1 100%"}),actions:(0,a.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:F.spacing(1)})});function U({exportProvider:F}){const{name:y,type:$}=F,H={file:{title:"File-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[y," format is only valid for File Provisioning."," ",(0,e.jsx)(l.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/",external:!0,children:"Read more in the docs."})]})},api:{title:"API-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[y," format is only valid for API Provisioning."," ",(0,e.jsx)(l.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/http-api-provisioning/",external:!0,children:"Read more in the docs."})]})},terraform:{title:"Terraform-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[y," format is only valid for Terraform Provisioning."," ",(0,e.jsx)(l.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/terraform-provisioning/",external:!0,children:"Read more in the docs."})]})}},{title:A,component:Y}=H[$];return(0,e.jsx)(f.F,{title:A,severity:"info",bottomSpacing:0,topSpacing:0,children:Y})}},76648:(se,D,s)=>{s.d(D,{m:()=>n});var e=s(74848),a=s(87978),m=s(73716);function n({activeTab:u,onTabChange:x,children:d,onClose:M,formatProviders:g,title:v="Export"}){const l=Object.values(g).map(f=>({label:f.name,value:f.exportFormat}));return(0,e.jsx)(a._,{title:v,subtitle:"Select the format and download the file or copy the contents to clipboard",tabs:(0,e.jsx)(m.sb,{tabs:l,setActiveTab:x,activeTab:u}),onClose:M,size:"md",children:d})}},84029:(se,D,s)=>{s.d(D,{sl:()=>n});const e={name:"JSON",exportFormat:"json",type:"file",formatter:x=>{try{return JSON.stringify(JSON.parse(x),null,4)}catch{return x}}},a={name:"YAML",exportFormat:"yaml",type:"file"},m={name:"Terraform (HCL)",exportFormat:"hcl",type:"terraform"},n={[e.exportFormat]:e,[a.exportFormat]:a,[m.exportFormat]:m},u=[e,a]},19338:(se,D,s)=>{s.d(D,{G:()=>M});var e=s(74848),a=s(32196),m=s(40845),n=s(60782),u=s(67061),x=s(14578),d=s(94753);function M({contentText:v,externalLink:l,linkText:f,title:j="Need help?"}){const R=(0,m.of)(g);return(0,e.jsx)(n.G,{content:(0,e.jsx)("div",{className:R.mutedText,children:v}),title:(0,e.jsxs)(u.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,e.jsx)(x.I,{name:"question-circle"}),j]}),footer:l?(0,e.jsx)("a",{href:l,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(u.B,{direction:"row",gap:.5,alignItems:"center",children:(0,e.jsxs)(d.E,{color:"link",children:[f," ",(0,e.jsx)(x.I,{size:"sm",name:"external-link-alt"})]})})}):void 0,closeButton:!0,placement:"bottom-start",children:(0,e.jsx)("div",{className:R.helpInfo,children:(0,e.jsxs)(u.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(x.I,{name:"question-circle",size:"sm"}),(0,e.jsx)(d.E,{variant:"bodySmall",color:"primary",children:"Need help?"})]})})})}const g=v=>({mutedText:(0,a.css)({color:v.colors.text.secondary,fontSize:v.typography.size.sm}),helpInfo:(0,a.css)({cursor:"pointer",textDecoration:"underline"})})},271:(se,D,s)=>{s.d(D,{P:()=>d});var e=s(74848),a=s(32196),m=s(40845),n=s(84167),u=s(94753),x=s(67061);const d=({title:g,stepNo:v,children:l,fullWidth:f=!1,description:j})=>{const R=(0,m.of)(M);return(0,e.jsx)("div",{className:R.parent,children:(0,e.jsx)(n.n,{className:(0,a.cx)(f&&R.fullWidth),label:(0,e.jsxs)(u.E,{variant:"h3",children:[v,". ",g]}),children:(0,e.jsxs)(x.B,{direction:"column",children:[j&&(0,e.jsx)("div",{className:R.description,children:j}),l]})})})},M=g=>({parent:(0,a.css)({display:"flex",flexDirection:"row",border:`solid 1px ${g.colors.border.weak}`,borderRadius:g.shape.radius.default,padding:`${g.spacing(2)} ${g.spacing(3)}`}),description:(0,a.css)({marginTop:`-${g.spacing(2)}`}),fullWidth:(0,a.css)({width:"100%"})})},73716:(se,D,s)=>{s.d(D,{G_:()=>y,sb:()=>$});var e=s(74848),a=s(32196),m=s(20382),n=s(96540),u=s(49785),x=s(70713),d=s(40845),M=s(87978),g=s(63021),v=s(40675),l=s(55852),f=s(56034),j=s(14578),R=s(32372),L=s(63066),U=s(23662);const F=[{label:"Yaml",value:"yaml"}],y=({onClose:P})=>{const[B,T]=(0,n.useState)("yaml"),{setValue:G}=(0,u.xW)(),oe=(0,d.of)(he),J=le=>{for(const W in le)G(W,le[W]);P()};return(0,e.jsx)(M._,{title:"Inspect Alert rule",subtitle:(0,e.jsx)("div",{className:oe.subtitle,children:(0,e.jsx)($,{tabs:F,setActiveTab:T,activeTab:B})}),onClose:P,children:B==="yaml"&&(0,e.jsx)(H,{onSubmit:J})})};function $({tabs:P,activeTab:B,setActiveTab:T}){return(0,e.jsx)(g.U,{children:P.map((G,oe)=>(0,e.jsx)(v.o,{label:G.label,value:G.value,onChangeTab:()=>T(G.value),active:B===G.value},`${G.value}-${oe}`))})}const H=({onSubmit:P})=>{const B=(0,d.of)(fe),{getValues:T}=(0,u.xW)(),G=(0,L.l1)(T()),[oe,J]=(0,n.useState)((0,m.Bh)(G)),le=()=>{const W=(0,m.Hh)(oe),K=T(),Q=Y(W);P({...K,...Q})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:B.applyButton,children:[(0,e.jsx)(l.$n,{type:"button",onClick:le,children:"Apply"}),(0,e.jsx)(f.m,{content:(0,e.jsx)(A,{}),theme:"info",placement:"left-start",interactive:!0,children:(0,e.jsx)(j.I,{name:"exclamation-triangle",size:"xl"})})]}),(0,e.jsx)("div",{className:B.content,children:(0,e.jsx)(x.Ay,{disableWidth:!0,children:({height:W})=>(0,e.jsx)(R.B,{width:"100%",height:W,language:"yaml",value:oe,onBlur:J,monacoOptions:{minimap:{enabled:!1}}})})})]})};function A(){return(0,e.jsxs)("div",{children:["The YAML content in the editor only contains alert rule configuration ",(0,e.jsx)("br",{}),"To configure Prometheus, you need to provide the rest of the"," ",(0,e.jsx)("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer",children:"configuration file content."})]})}function Y(P){return(0,U.$y)(P)?(0,L.Qk)(P):(0,U.i7)(P)?(0,L.XI)(P):{}}const fe=P=>({content:(0,a.css)({flexGrow:1,height:"100%",paddingBottom:"16px",marginBottom:P.spacing(2)}),applyButton:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexGrow:0,marginBottom:P.spacing(2)})}),he=()=>({subtitle:(0,a.css)({display:"flex",alignItems:"center",justifyContent:"space-between"})})},72275:(se,D,s)=>{s.d(D,{M:()=>n});var e=s(74848),a=s(56034),m=s(55852);const n=({tooltip:u,icon:x,to:d,target:M,onClick:g,className:v,tooltipPlacement:l="top",...f})=>{const j=typeof u=="string"?u:void 0;return(0,e.jsx)(a.m,{content:u,placement:l,children:d?(0,e.jsx)(m.z9,{variant:"secondary",fill:"text",icon:x,href:d,size:"sm",target:M,...f,"aria-label":j}):(0,e.jsx)(m.$n,{className:v,variant:"secondary",fill:"text",size:"sm",icon:x,type:"button",onClick:g,...f,"aria-label":j})})}},45058:(se,D,s)=>{s.d(D,{w:()=>g});var e=s(74848),a=s(32196),m=s(40845),n=s(67061),u=s(76442),x=s(7521),d=s(25027),M=s(41520);const g=()=>{const{canCreateGrafanaRules:l,canCreateCloudRules:f}=(0,M.V)(),j=(0,m.of)(v);return l||f?(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"You haven't created any alert rules yet"}),(0,e.jsxs)(n.B,{gap:1,children:[(0,e.jsx)("div",{className:j.newRuleCard,children:(0,e.jsx)(x.A,{title:"",buttonIcon:"bell",buttonLink:"alerting/new/alerting",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,d.fH)(d.le.alertRuleFromScratch)})}),(0,e.jsx)("div",{className:j.newRuleCard,children:(0,e.jsx)(x.A,{title:"",buttonIcon:"plus",buttonLink:"alerting/new/recording",buttonTitle:"New recording rule",onClick:()=>(0,d.fH)(d.le.recordingRuleFromScratch)})})]})]}):(0,e.jsx)(u.c,{message:"No rules exist yet.",callToActionElement:(0,e.jsx)("div",{})})},v=l=>({newRuleCard:(0,a.css)({width:`calc(50% - ${l.spacing(1)})`,"> div":{height:"100%"}})})},67381:(se,D,s)=>{s.d(D,{o:()=>L});var e=s(74848),a=s(32196),m=s(55127),n=s.n(m),u=s(96540),x=s(78685),d=s(40845),M=s(42418),g=s(55852),v=s(56034),l=s(61410),f=s(57220),j=s(56361),R=s(23662);function L(){const[y,$]=(0,u.useState)(!1),[H,A]=(0,x.A)("grafana.unifiedalerting.hideErrors",!1),Y=(0,l.$)(T=>T.dataSources),fe=(0,l.$)(T=>T.promRules),he=(0,l.$)(T=>T.rulerRules),P=(0,d.of)(F),B=(0,u.useMemo)(()=>{const[T,G,oe]=[Y,fe,he].map(K=>(0,f.qi)().reduce((Q,Ce)=>{const De=K[Ce.name]?.error;return K[Ce.name]&&De&&!(0,R.$7)(K[Ce.name])?[...Q,{dataSource:Ce,error:De}]:Q},[])),J=fe[f.hY]?.error,le=he[f.hY]?.error,W=[];return J&&W.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules state: ",J.message||"Unknown error."]})),le&&W.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules config: ",le.message||"Unknown error."]})),T.forEach(({dataSource:K,error:Q})=>{W.push((0,e.jsxs)(e.Fragment,{children:["Failed to load the data source configuration for"," ",(0,e.jsx)("a",{href:(0,j.GD)(K.uid),className:P.dsLink,children:K.name}),": ",Q.message||"Unknown error."]}))}),G.forEach(({dataSource:K,error:Q})=>W.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules state from"," ",(0,e.jsx)("a",{href:(0,j.GD)(K.uid),className:P.dsLink,children:K.name}),": ",Q.message||"Unknown error."]}))),oe.forEach(({dataSource:K,error:Q})=>W.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules config from"," ",(0,e.jsx)("a",{href:(0,j.GD)(K.uid),className:P.dsLink,children:K.name}),": ",Q.message||"Unknown error."]}))),W},[Y,fe,he,P.dsLink]);return(0,e.jsxs)(e.Fragment,{children:[!!B.length&&H&&(0,e.jsx)(U,{count:B.length,onClick:()=>A(T=>!T)}),!!B.length&&!H&&(0,e.jsxs)(M.F,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>A(!0),children:[y&&B.map((T,G)=>(0,e.jsx)("div",{children:T},G)),!y&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:B[0]}),B.length>=2&&(0,e.jsxs)(g.$n,{className:P.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>$(!0),children:[B.length-1," more ",n()("error",B.length-1)]})]})]})]})}const U=({count:y,onClick:$})=>{const H=(0,d.of)(F);return(0,e.jsx)("div",{className:H.floatRight,children:(0,e.jsx)(v.m,{content:"Show all errors",placement:"bottom",children:(0,e.jsx)(g.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:$,children:y>1?(0,e.jsxs)(e.Fragment,{children:[y," errors"]}):(0,e.jsx)(e.Fragment,{children:"1 error"})})})})},F=y=>({moreButton:(0,a.css)({padding:0}),floatRight:(0,a.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,a.css)({fontWeight:y.typography.fontWeightBold})})},84866:(se,D,s)=>{s.d(D,{A:()=>ns});var e=s(74848),a=s(32196),m=s(96540),n=s(49785),u=s(40845),x=s(14578),d=s(67061),M=s(88575),g=s(60029),v=s(56034),l=s(94354),f=s(10354),j=s(55852),R=s(59429),L=s(94822),U=s(25027),F=s(14285),y=s(39964),$=s(86171),H=s(28475),A=s(23662),Y=s(35108),fe=s(22391),he=s(51527),P=s(13544),B=s(19347),T=s(26657),G=s(90182),oe=s(98624),J=s(57220);const le=S=>{const X=(0,B.l)(),[Te,Le]=(0,m.useState)(),pe=(b,Z)=>{if(Z.action==="clear"&&S.onClear){S.onClear();return}const ye=b[b.length-1];let ge,w;Z.action==="pop-value"||Z.action==="remove-value"?(ge=Z.removedValue?.value,w="remove"):(ge=ye.value,w="add");const k=X.getInstanceSettings(ge);k&&(S.onChange(k,w),Le({error:void 0}))},N=()=>{const{current:b,hideTextValue:Z,noDefault:ye}=S;if(!(!b&&ye))return b?.map(ge=>{const w=X.getInstanceSettings(ge);if(w)return{label:w.name.slice(0,37),value:w.name,imgUrl:w.meta.info.logos.small,hideText:Z,meta:w.meta};const k=(0,fe.Iz)(ge);return k===T.dR.uid||k===T.dR.name?{label:k,value:k,hideText:Z}:{label:(k??"no name")+" - not found",value:k??void 0,imgUrl:"",hideText:Z}})},Fe=()=>{const{alerting:b,tracing:Z,metrics:ye,mixed:ge,dashboard:w,variables:k,annotations:$e,pluginId:we,type:Ge,filter:ke,logs:C}=S,be=X.getList({alerting:b,tracing:Z,metrics:ye,logs:C,dashboard:w,mixed:ge,variables:k,annotations:$e,pluginId:we,filter:ke,type:Ge}),ze=be.filter(J.hP).map(_=>({value:_.name,label:`${_.name}${_.isDefault?" (default)":""}`,imgUrl:_.meta.info.logos.small,meta:_.meta})),Ae=be.filter(_=>!(0,J.hP)(_)).map(_=>({value:_.name,label:`${_.name}${_.isDefault?" (default)":""}`,imgUrl:_.meta.info.logos.small,meta:_.meta}));return[{label:"Data sources with configured alert rules",options:ze,expanded:!0},{label:"Other data sources",options:Ae,expanded:!0}]},{autoFocus:Ee,onBlur:Ie,onClear:ie,openMenuOnFocus:Pe,placeholder:Be,width:Xe,inputId:Ze,disabled:We=!1,isLoading:Ke=!1}=S,ce=Fe(),Ne=N(),Ue=typeof ie=="function";return(0,e.jsx)("div",{"data-testid":P.Tp.components.DataSourcePicker.container,children:(0,e.jsx)(G.KF,{isLoading:Ke,disabled:We,"data-testid":P.Tp.components.DataSourcePicker.inputV2,inputId:Ze||"data-source-picker",className:"ds-picker select-container",isClearable:Ue,backspaceRemovesValue:!0,onChange:pe,options:ce,autoFocus:Ee,onBlur:Ie,width:Xe,openMenuOnFocus:Pe,maxMenuHeight:500,placeholder:Be,noOptionsMessage:"No datasources found",value:Ne??[],invalid:!!Te?.error||!!S.invalid,getOptionLabel:b=>b.meta&&(0,he.x)(b.meta.signature)&&b!==Ne?(0,e.jsxs)(d.B,{alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)("span",{children:b.label})," ",(0,e.jsx)(oe.B,{status:b.meta.signature})]}):b.label||""})})},W=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],K=[{label:"Alert ",value:L.JS.Alerting},{label:"Recording ",value:L.JS.Recording}],Q=[{label:"Ok",value:H.Jc.Ok},{label:"No Data",value:H.Jc.NoData},{label:"Error",value:H.Jc.Error}],Ce=Object.entries(L.cF).map(([S,X])=>({label:(0,A.XI)(X),value:X})),De=({onFilterCleared:S=()=>{}})=>{const X=(0,u.of)(as),[Te,Le]=(0,y.l)(),{pluginsFilterEnabled:pe}=Qe(),{filterState:N,hasActiveFilters:Fe,searchQuery:Ee,setSearchQuery:Ie,updateFilters:ie}=(0,F.dI)(),[Pe,Be]=(0,m.useState)(Math.floor(Math.random()*100)),Xe=`dataSource-${Pe}`,Ze=`queryString-${Pe}`,We=(0,m.useRef)(null),{handleSubmit:Ke,register:ce,setValue:Ne}=(0,n.mN)({defaultValues:{searchQuery:Ee}}),{ref:Ue,...b}=ce("searchQuery");(0,m.useEffect)(()=>{Ne("searchQuery",Ee)},[Ee,Ne]);const Z=(C,be)=>{const ze=be==="add"?[...N.dataSourceNames].concat([C.name]):N.dataSourceNames.filter(Ae=>Ae!==C.name);ie({...N,dataSourceNames:ze}),Be(Ae=>Ae+1),(0,U.Sn)("dataSourceNames")},ye=C=>{ie({...N,dashboardUid:C}),(0,U.Sn)("dashboardUid")},ge=()=>{ie({...N,dataSourceNames:[]}),Be(C=>C+1)},w=C=>{(0,U.fH)(U.le.clickingAlertStateFilters),ie({...N,ruleState:C}),(0,U.Sn)("ruleState")},k=C=>{ie({...N,ruleType:C}),(0,U.Sn)("ruleType")},$e=C=>{ie({...N,ruleHealth:C}),(0,U.Sn)("ruleHealth")},we=()=>{Ie(void 0),S(),setTimeout(()=>Be(Pe+1),100)},Ge=C=>{Le({view:C}),(0,U.aL)({view:C})},ke=(0,e.jsx)(x.I,{name:"search"});return(0,e.jsx)("div",{className:X.container,children:(0,e.jsxs)(d.B,{direction:"column",gap:1,children:[(0,e.jsxs)(d.B,{direction:"row",gap:1,wrap:"wrap",children:[(0,e.jsx)(M.D,{className:X.dsPickerContainer,label:(0,e.jsx)(g.J,{htmlFor:"data-source-picker",children:(0,e.jsxs)(d.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search by data sources"}),(0,e.jsx)(v.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."}),(0,e.jsx)("p",{children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})]}),children:(0,e.jsx)(x.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:"Search by data sources help"})})]})}),children:(0,e.jsx)(le,{alerting:!0,noDefault:!0,placeholder:"All data sources",current:N.dataSourceNames,onChange:Z,onClear:ge},Xe)}),(0,e.jsx)(M.D,{className:X.dashboardPickerContainer,label:(0,e.jsx)(g.J,{htmlFor:"filters-dashboard-picker",children:"Dashboard"}),children:(0,e.jsx)(R.b,{inputId:"filters-dashboard-picker",value:N.dashboardUid,onChange:C=>ye(C?.uid),isClearable:!0,cacheOptions:!0},N.dashboardUid?"dashboard-defined":"dashboard-not-defined")}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"State"}),(0,e.jsx)(l.z,{options:Ce,value:N.ruleState,onChange:w})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"Rule type"}),(0,e.jsx)(l.z,{options:K,value:N.ruleType,onChange:k})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"Health"}),(0,e.jsx)(l.z,{options:Q,value:N.ruleHealth,onChange:$e})]}),pe&&(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"Plugin rules"}),(0,e.jsx)(l.z,{options:[{label:"Show",value:void 0},{label:"Hide",value:"hide"}],value:N.plugins,onChange:C=>ie({...N,plugins:C})})]})]}),(0,e.jsxs)(d.B,{direction:"column",gap:1,children:[(0,e.jsxs)(d.B,{direction:"row",gap:1,children:[(0,e.jsxs)("form",{className:X.searchInput,onSubmit:Ke(C=>{Ie(C.searchQuery),We.current?.blur(),(0,U.zs)({oldQuery:Ee,newQuery:C.searchQuery})}),children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(g.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(d.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search"}),(0,e.jsx)(Y.j,{content:(0,e.jsx)(Ye,{}),children:(0,e.jsx)(x.I,{name:"info-circle",size:"sm",tabIndex:0,title:"Search help"})})]})}),children:(0,e.jsx)(f.p,{id:"rulesSearchInput",prefix:ke,ref:C=>{Ue(C),We.current=C},...b,placeholder:"Search","data-testid":"search-query-input"},Ze)}),(0,e.jsx)("input",{type:"submit",hidden:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"View as"}),(0,e.jsx)(l.z,{options:W,value:Te.get("view")??W[0].value,onChange:Ge})]})]}),Fe&&(0,e.jsx)("div",{children:(0,e.jsx)(j.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:we,children:"Clear filters"})})]})]})})},as=S=>({container:(0,a.css)({marginBottom:S.spacing(1)}),dsPickerContainer:(0,a.css)({width:S.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,a.css)({minWidth:S.spacing(50)}),searchInput:(0,a.css)({flex:1,margin:0})});function Ye(){const S=(0,u.of)(Je);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Search syntax allows to query alert rules by the parameters defined below."}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:S.grid,children:[(0,e.jsx)("div",{children:"Filter type"}),(0,e.jsx)("div",{children:"Expression"}),(0,e.jsx)(te,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(te,{title:"Folder/Namespace",expr:"namespace:global"}),(0,e.jsx)(te,{title:"Group",expr:"group:cpu-usage"}),(0,e.jsx)(te,{title:"Rule",expr:'rule:"cpu 80%"'}),(0,e.jsx)(te,{title:"Labels",expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(te,{title:"State",expr:"state:firing|normal|pending"}),(0,e.jsx)(te,{title:"Type",expr:"type:alerting|recording"}),(0,e.jsx)(te,{title:"Health",expr:"health:ok|nodata|error"}),(0,e.jsx)(te,{title:"Dashboard UID",expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"})]})]})}function te({title:S,expr:X}){const Te=(0,u.of)(Je);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:S}),(0,e.jsx)("code",{className:Te.code,children:X})]})}const Je=S=>({grid:(0,a.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:S.spacing(1),alignItems:"center"}),code:(0,a.css)({display:"block",textAlign:"center"})});function Qe(){const{extensions:S}=(0,$.u)();return{pluginsFilterEnabled:S.length>0}}const ns=De},86171:(se,D,s)=>{s.d(D,{u:()=>m});var e=s(74135),a=s(3197);function m(){return(0,a.kr)({extensionPointId:e.S.AlertingHomePage,limitPerPlugin:1})}},10940:(se,D,s)=>{s.d(D,{A:()=>m});var e=s(96540),a=function(n,u){var x=(0,e.useRef)(function(){});(0,e.useEffect)(function(){x.current=n}),(0,e.useEffect)(function(){if(u!==null){var d=setInterval(function(){return x.current()},u||0);return function(){return clearInterval(d)}}},[u])};const m=a}}]);

//# sourceMappingURL=AlertRuleListIndex.1a9b40d08cf548951d13.js.map