"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2212],{31084:(Y,I,e)=>{e.d(I,{Y:()=>D});var t=e(74848),M=e(96540),u=e(41053),x=e(10096),P=e(31678),E=e(37425),A=e(85927);const D=({teamId:g,roleOptions:o,disabled:l,roles:i,onApplyRoles:T,pendingRoles:O,apply:C=!1,maxWidth:_,width:B,isLoading:V})=>{const[{loading:f,value:y=i||[]},R]=(0,u.A)(async()=>{try{if(i)return i;if(C&&O?.length)return O;if(x.contextSrv.hasPermission(P.AccessControlAction.ActionTeamsRolesList)&&g>0)return await(0,A.xN)(g)}catch(S){console.error("Error loading options",S)}return[]},[g,O,i]);(0,M.useEffect)(()=>{R()},[R]);const N=async S=>{C?T&&T(S):(await(0,A.G3)(S,g),await R())},z=x.contextSrv.hasPermission(P.AccessControlAction.ActionTeamsRolesAdd)&&x.contextSrv.hasPermission(P.AccessControlAction.ActionTeamsRolesRemove);return(0,t.jsx)(E.n,{apply:C,onRolesChange:N,roleOptions:o,appliedRoles:y,isLoading:f||V,disabled:l,basicRoleDisabled:!0,canUpdateRoles:z,maxWidth:_,width:B})}},54939:(Y,I,e)=>{e.d(I,{o:()=>E});var t=e(96540),M=e(24705),u=e(10096),x=e(31678),P=e(85927);const E=A=>{const[D,g]=(0,t.useState)(A),{value:o=[]}=(0,M.A)(async()=>u.contextSrv.licensedAccessControlEnabled()&&u.contextSrv.hasPermission(x.AccessControlAction.ActionRolesList)?(0,P.RL)(D):Promise.resolve([]),[D]);return[{roleOptions:o},g]}},39745:(Y,I,e)=>{e.d(I,{A:()=>a,u:()=>S});var t=e(74848),M=e(32196),u=e(96540),x=e(97594),P=e(41987),E=e(13544),A=e(14110),D=e(32264),g=e(84167),o=e(88575),l=e(90182),i=e(60029),T=e(20333),O=e(15648),C=e(29678),_=e(55852),B=e(3911),V=e(59429),f=e(8484),y=e(74513),R=e(65615),N=e(2769);function z(){const m=y.Yj.map(r=>({value:r.code,label:r.name})).sort((r,K)=>r.value===y.wi?1:K.value===y.wi?-1:r.label.localeCompare(K.label));return[{value:"",label:(0,f.t)("common.locale.default","Default")},...m]}class S extends u.PureComponent{constructor(p){super(p),this.onSubmitForm=async r=>{if(r.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:L,theme:G,timezone:$,weekStart:U,language:j,queryHistory:Q,navbar:W}=this.state;await this.service.update({homeDashboardUID:L,theme:G,timezone:$,weekStart:U,language:j,queryHistory:Q,navbar:W}),window.location.reload()}},this.onThemeChanged=r=>{this.setState({theme:r.value}),r.value&&(0,N.K)(r.value,!0)},this.onTimeZoneChanged=r=>{typeof r=="string"&&this.setState({timezone:r})},this.onWeekStartChanged=r=>{this.setState({weekStart:r})},this.onHomeDashboardChanged=r=>{this.setState({homeDashboardUID:r})},this.onLanguageChanged=r=>{this.setState({language:r}),(0,A.rR)("grafana_preferences_language_changed",{toLanguage:r,preferenceType:this.props.preferenceType})},this.service=new R.W(p.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""},navbar:{bookmarkUrls:[]}},this.themeOptions=(0,x.k)(D.$.featureToggles.extraThemes).map(r=>({value:r.id,label:d(r)})),this.themeOptions.unshift({value:"",label:(0,f.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const p=await this.service.load();this.setState({homeDashboardUID:p.homeDashboardUID,theme:p.theme,timezone:p.timezone,weekStart:p.weekStart,language:p.language,queryHistory:p.queryHistory,navbar:p.navbar})}render(){const{theme:p,timezone:r,weekStart:K,homeDashboardUID:L,language:G}=this.state,{disabled:$}=this.props,U=s(),j=z(),Q=this.themeOptions.find(W=>W.value===p)??this.themeOptions[0];return(0,t.jsxs)("form",{onSubmit:this.onSubmitForm,className:U.form,children:[(0,t.jsxs)(g.n,{label:(0,t.jsx)(f.x6,{i18nKey:"shared-preferences.title",children:"Preferences"}),disabled:$,children:[(0,t.jsx)(o.D,{label:(0,f.t)("shared-preferences.fields.theme-label","Interface theme"),children:(0,t.jsx)(l.l6,{options:this.themeOptions,value:Q,onChange:this.onThemeChanged,inputId:"shared-preferences-theme-select"})}),(0,t.jsx)(o.D,{label:(0,t.jsx)(i.J,{htmlFor:"home-dashboard-select",children:(0,t.jsx)("span",{className:U.labelText,children:(0,t.jsx)(f.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label",children:"Home Dashboard"})})}),"data-testid":"User preferences home dashboard drop down",children:(0,t.jsx)(V.b,{value:L,onChange:W=>this.onHomeDashboardChanged(W?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,f.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})}),(0,t.jsx)(o.D,{label:(0,f.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":E.Tp.components.TimeZonePicker.containerV2,children:(0,t.jsx)(T.U,{includeInternal:!0,value:r,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,t.jsx)(o.D,{label:(0,f.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":E.Tp.components.WeekStartPicker.containerV2,children:(0,t.jsx)(O.l,{value:K||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,t.jsx)(o.D,{label:(0,t.jsxs)(i.J,{htmlFor:"locale-select",children:[(0,t.jsx)("span",{className:U.labelText,children:(0,t.jsx)(f.x6,{i18nKey:"shared-preferences.fields.locale-label",children:"Language"})}),(0,t.jsx)(C.y,{featureState:P.Ay.beta})]}),"data-testid":"User preferences language drop down",children:(0,t.jsx)(l.l6,{value:j.find(W=>W.value===G),onChange:W=>this.onLanguageChanged(W.value??""),options:j,placeholder:(0,f.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"})})]}),(0,t.jsx)(_.$n,{type:"submit",variant:"primary","data-testid":E.Tp.components.UserProfile.preferencesSaveButton,children:(0,t.jsx)(f.x6,{i18nKey:"common.save",children:"Save"})})]})}}const a=S,s=(0,B.N)(()=>({labelText:(0,M.css)({marginRight:"6px"}),form:(0,M.css)({width:"100%",maxWidth:"600px"})}));function d(m){switch(m.id){case"dark":return(0,f.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,f.t)("shared.preferences.theme.light-label","Light");case"system":return(0,f.t)("shared.preferences.theme.system-label","System preference");default:return m.name}}},82508:(Y,I,e)=>{e.r(I),e.d(I,{default:()=>fe});var t=e(74848),M=e(25508),u=e(96540),x=e(24180),P=e(16817),E=e(33378),A=e(69444),D=e(77454),g=e(2913),o=e(17422),l=e(16233),i=e(31678),T=e(32196),O=e(71468),C=e(55852),_=e(14578),B=e(56034),V=e(39268),f=e(14186),y=e(10354),R=e(40845),N=e(9025),z=e(25469),S=e(7521),a=e(35538),s=e(33667);const d=n=>n.groups,m=(n,c)=>n.team.id===parseInt(c,10)?n.team:null;function p(n){return{groups:d(n.team)}}const r={loadTeamGroups:s.aK,addTeamGroup:s.It,removeTeamGroup:s.nC},K=(0,O.connect)(p,r),L="Sync LDAP, OAuth or SAML groups with your Grafana teams.";class G extends u.PureComponent{constructor(c){super(c),this.onToggleAdding=()=>{this.setState({isAdding:!this.state.isAdding})},this.onNewGroupIdChanged=h=>{this.setState({newGroupId:h.target.value})},this.onAddGroup=h=>{h.preventDefault(),this.props.addTeamGroup(this.state.newGroupId),this.setState({isAdding:!1,newGroupId:""})},this.onRemoveGroup=h=>{this.props.removeTeamGroup(h.groupId)},this.state={isAdding:!1,newGroupId:""}}componentDidMount(){this.fetchTeamGroups()}async fetchTeamGroups(){await this.props.loadTeamGroups()}isNewGroupValid(){return this.state.newGroupId.length>1}renderGroup(c){const{isReadOnly:h}=this.props;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:c.groupId}),(0,t.jsx)("td",{style:{width:"1%"},children:(0,t.jsx)(C.$n,{size:"sm",variant:"destructive",onClick:()=>this.onRemoveGroup(c),disabled:h,"aria-label":`Remove group ${c.groupId}`,children:(0,t.jsx)(_.I,{name:"times"})})})]},c.groupId)}render(){const{isAdding:c,newGroupId:h}=this.state,{groups:v,isReadOnly:b}=this.props,F=j();return(0,t.jsxs)("div",{children:[(0,a.z5)()&&(0,t.jsx)(D.Iz,{featureId:"team-sync",eventVariant:"trial",featureName:"team sync",text:"Add a group to enable team sync for free during your trial of Grafana Pro."}),(0,t.jsxs)("div",{className:"page-action-bar",children:[(!(0,a.z5)()||v.length>0)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"page-sub-heading",children:"External group sync"}),(0,t.jsx)(B.m,{placement:"auto",content:L,children:(0,t.jsx)(_.I,{className:(0,T.cx)(F.icon,"page-sub-heading-icon"),name:"question-circle"})})]}),(0,t.jsx)("div",{className:"page-action-bar__spacer"}),v.length>0&&(0,t.jsxs)(C.$n,{onClick:this.onToggleAdding,disabled:b,children:[(0,t.jsx)(_.I,{name:"plus"})," Add group"]})]}),(0,t.jsx)(N.a,{in:c,children:(0,t.jsxs)("div",{className:"cta-form",children:[(0,t.jsx)(z.J,{onClick:this.onToggleAdding}),(0,t.jsx)("form",{onSubmit:this.onAddGroup,children:(0,t.jsxs)(V.C,{children:[(0,t.jsx)(f.I,{label:"Add External Group",tooltip:"LDAP Group Example: cn=users,ou=groups,dc=grafana,dc=org.",children:(0,t.jsx)(y.p,{type:"text",id:"add-external-group",placeholder:"",value:h,onChange:this.onNewGroupIdChanged,disabled:b})}),(0,t.jsx)(C.$n,{type:"submit",disabled:b||!this.isNewGroupValid(),style:{marginLeft:4},children:"Add group"})]})})]})}),v.length===0&&!c&&((0,a.z5)()?(0,t.jsx)($,{action:{onClick:this.onToggleAdding,text:"Add group"}}):(0,t.jsx)(S.A,{onClick:this.onToggleAdding,buttonIcon:"users-alt",title:"There are no external groups to sync with",buttonTitle:"Add group",proTip:L,proTipLinkTitle:"Learn more",proTipLink:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/",proTipTarget:"_blank",buttonDisabled:b})),v.length>0&&(0,t.jsx)("div",{className:"admin-list-table",children:(0,t.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"External Group ID"}),(0,t.jsx)("th",{style:{width:"1%"}})]})}),(0,t.jsx)("tbody",{children:v.map(J=>this.renderGroup(J))})]})})]})}}const $=({action:n})=>{const c=(0,R.$j)();return(0,t.jsx)(D.El,{action:n,listItems:["Stop managing user access in two places - assign users to groups in SAML, LDAP or Oauth, and manage access at a Team level in Grafana","Update users\u2019 permissions immediately when you add or remove them from an LDAP group, with no need for them to sign out and back in"],image:`team-sync-${c.isLight?"light":"dark"}.png`,featureName:"team sync",featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/team-sync",description:"Team Sync makes it easier for you to manage users\u2019 access in Grafana, by immediately updating each user\u2019s Grafana teams and permissions based on their single sign-on group membership, instead of when users sign in."})},U=(0,O.connect)(p,r)(G),j=()=>({icon:(0,T.css)({opacity:.7,"&:hover":{opacity:1}})});var Q=e(52487);const ae=n=>{const c=l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsWrite,n.team);return(0,t.jsx)(Q.x,{title:"",addPermissionTitle:"Add member",buttonLabel:"Add member",emptyLabel:"There are no members in this team or you do not have the permissions to list the current members.",resource:"teams",resourceId:n.team.id,canSetPermissions:c})};var ne=e(49785),oe=e(67061),re=e(84167),Z=e(88575),ie=e(31084),ce=e(54939),le=e(39745);const de={updateTeam:s.n7},me=(0,O.connect)(null,de)(({team:n,updateTeam:c})=>{const h=l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsWrite,n),v=l.TP.user.orgId,[{roleOptions:b}]=(0,ce.o)(v),{handleSubmit:F,register:J,formState:{errors:w}}=(0,ne.mN)({defaultValues:n}),k=l.TP.hasPermission(i.AccessControlAction.ActionTeamsRolesAdd)&&l.TP.hasPermission(i.AccessControlAction.ActionTeamsRolesRemove),q=l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsRolesList,n)&&l.TP.hasPermission(i.AccessControlAction.ActionRolesList),H=async X=>{c(X.name,X.email||"")};return(0,t.jsxs)(oe.B,{direction:"column",gap:3,children:[(0,t.jsx)("form",{onSubmit:F(H),style:{maxWidth:"600px"},children:(0,t.jsxs)(re.n,{label:"Team details",children:[(0,t.jsx)(Z.D,{label:"Name",disabled:!h,required:!0,invalid:!!w.name,error:"Name is required",children:(0,t.jsx)(y.p,{...J("name",{required:!0}),id:"name-input"})}),l.TP.licensedAccessControlEnabled()&&q&&(0,t.jsx)(Z.D,{label:"Role",children:(0,t.jsx)(ie.Y,{teamId:n.id,roleOptions:b,disabled:!k,maxWidth:"100%"})}),(0,t.jsx)(Z.D,{label:"Email",description:"This is optional and is primarily used to set the team profile avatar (via gravatar service).",disabled:!h,children:(0,t.jsx)(y.p,{...J("email"),placeholder:"team@email.com",type:"email",id:"email-input"})}),(0,t.jsx)(C.$n,{type:"submit",disabled:!h,children:"Update"})]})}),(0,t.jsx)(le.u,{resourceUri:`teams/${n.id}`,disabled:!h,preferenceType:"team"})]})});var he=e(78319),ue=(n=>(n.Members="members",n.Settings="settings",n.GroupSync="groupsync",n))(ue||{});const ee=["members","settings","groupsync"],ge=(0,M.Mz)([n=>n.team,(n,c)=>c],(n,c)=>m(n,c)),pe=(0,M.Mz)([n=>n.navIndex,(n,c)=>c,(n,c,h)=>h],(n,c,h)=>{const v=(0,he.X)(c);return(0,o.tc)(n,`team-${c}-${h}`,v).main}),te=(0,u.memo)(()=>{const n=(0,u.useRef)((0,E.a)("teamsync")),c=(0,x.g)(),h=(0,u.useMemo)(()=>parseInt(c.id,10),[c]),v=(0,i.useSelector)(H=>ge(H,h));let b="members";(!v||!l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsRead,v))&&(b="settings");const F=c.page??b,J=(0,i.useSelector)(H=>pe(H,F,h)),w=(0,i.useDispatch)(),{loading:k}=(0,P.A)(async()=>w((0,s.eo)(h)),[h]),q=()=>{const H=ee.includes(F)?F:ee[0],X=l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsRead,v),se=l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsRead,v),ve=l.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsWrite,v);switch(H){case"members":if(se)return(0,t.jsx)(ae,{team:v});case"settings":return X&&(0,t.jsx)(me,{team:v});case"groupsync":if(n.current){if(se)return(0,t.jsx)(U,{isReadOnly:!ve})}else if(g.Ay.featureToggles.featureHighlights)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.Iz,{featureName:"team sync",featureId:"team-sync"}),(0,t.jsx)($,{})]})}return null};return(0,t.jsx)(A.Y,{navId:"teams",pageNav:J,children:(0,t.jsx)(A.Y.Contents,{isLoading:k,children:v&&Object.keys(v).length!==0&&q()})})});te.displayName="TeamPages";const fe=te},33667:(Y,I,e)=>{e.d(I,{Bu:()=>o,It:()=>N,To:()=>T,Vk:()=>_,aK:()=>R,eo:()=>i,n7:()=>y,nC:()=>z,nM:()=>O,yd:()=>C});var t=e(2543),M=e.n(t),u=e(17172),x=e(82467),P=e(10096),E=e(80714),A=e(31678),D=e(78319),g=e(34655);function o(a=!1){return async(s,d)=>{const{query:m,page:p,perPage:r,sort:K}=d().teams;if(!P.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRead)){s((0,g.Q9)({teams:[],totalCount:0,page:1,perPage:r,noTeams:!0}));return}const L=await(0,u.AI)().get("/api/teams/search",(0,E.F)({query:m,page:p,perpage:r,sort:K}));let G=!1;if(a&&(G=L.teams.length===0),P.contextSrv.licensedAccessControlEnabled()&&P.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRolesList)){s((0,g.dJ)());const $=L?.teams.map(j=>j.id),U=await(0,u.AI)().post("/api/access-control/teams/roles/search",{teamIds:$});L.teams.forEach(j=>{j.roles=U?U[j.id]||[]:[]}),s((0,g.jE)())}s((0,g.Q9)({noTeams:G,...L}))}}const l=(0,t.debounce)(a=>a(o()),500);function i(a){return async s=>{const d=await(0,u.AI)().get(`/api/teams/${a}`,(0,E.F)());s((0,g.$T)(d)),s((0,x.Vz)((0,D.R)(d)))}}function T(a){return async s=>{await(0,u.AI)().delete(`/api/teams/${a}`),await P.contextSrv.fetchUserPermissions(),s(o())}}function O(a){return async s=>{s((0,g.L5)(a)),l(s)}}function C(a){return async s=>{s((0,g.EC)(a)),s(o())}}function _({sortBy:a}){const s=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async d=>{d((0,g.$u)(s)),d(o())}}function B(){return async(a,s)=>{const d=s().team.team,m=await getBackendSrv().get(`/api/teams/${d.id}/members`);a(teamMembersLoaded(m))}}function V(a){return async(s,d)=>{const m=d().team.team;await getBackendSrv().post(`/api/teams/${m.id}/members`,{userId:a}),s(B())}}function f(a){return async(s,d)=>{const m=d().team.team;await getBackendSrv().delete(`/api/teams/${m.id}/members/${a}`),s(B())}}function y(a,s){return async(d,m)=>{const p=m().team.team;await(0,u.AI)().put(`/api/teams/${p.id}`,{name:a,email:s}),d(i(p.id))}}function R(){return async(a,s)=>{const d=s().team.team,m=await(0,u.AI)().get(`/api/teams/${d.id}/groups`);a((0,g.tC)(m))}}function N(a){return async(s,d)=>{const m=d().team.team;await(0,u.AI)().post(`/api/teams/${m.id}/groups`,{groupId:a}),s(R())}}function z(a){return async(s,d)=>{const m=d().team.team;await(0,u.AI)().delete(`/api/teams/${m.id}/groups?groupId=${encodeURIComponent(a)}`),s(R())}}function S(a){return async s=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),s(B())}}},78319:(Y,I,e)=>{e.d(I,{R:()=>D,X:()=>g});var t=e(33378),M=e(76323),u=e(2913),x=e(16233),P=e(35538),E=e(31678);const A={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:E.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function D(o){const l={img:o.avatarUrl,id:"team-"+o.id,subTitle:"Manage members and settings",url:"",text:o.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${o.id}`,text:"Settings",url:`org/teams/edit/${o.id}/settings`}]};(o===A||x.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsPermissionsRead,o))&&l.children.unshift({active:!1,icon:"users-alt",id:`team-members-${o.id}`,text:"Members",url:`org/teams/edit/${o.id}/members`});const i={active:!1,icon:"sync",id:`team-groupsync-${o.id}`,text:"External group sync",url:`org/teams/edit/${o.id}/groupsync`},T=o===A;return(0,P.z5)()&&(i.tabSuffix=()=>(0,M.J)({experimentId:T?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,t.a)("teamsync")?(T||x.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsPermissionsRead,o))&&l.children.push(i):u.Ay.featureToggles.featureHighlights&&l.children.push({...i,tabSuffix:()=>(0,M.J)({experimentId:T?"":"feature-highlights-team-sync-badge"})}),l}function g(o){const l=D(A);let i;for(const T of l.children)if(T.id.indexOf(o)>0){T.active=!0,i=T;break}return{main:l,node:i}}}}]);

//# sourceMappingURL=TeamPages.b0ac8a0cb2332221b25e.js.map