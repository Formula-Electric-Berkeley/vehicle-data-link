"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6299],{10421:(Y,_,e)=>{e.r(_),e.d(_,{default:()=>q});var a=e(74848),P=e(32196),c=e(96540),S=e(70713),M=e(40845),g=e(67647),n=e(69444),r=e(8484),y=e(19519),I=e(24439),l=e(31678),i=e(53477),R=e(39788);class T extends R.lC{setStateAndDoSearch(d){const C=d.sort||this.state.sort||localStorage.getItem(i.w7)||void 0,u=d.query??this.state.query,U=d.tag??this.state.tag,A=u.length===0&&U.length===0;this.setState({sort:C,result:A?void 0:this.state.result,...d}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}}let p;function x(){return p||(p=new T({...R.ue,includePanels:!1,deleted:!0})),p}function s(){const h=x();return[h.useState(),h]}var m=e(14110),t=e(67061),o=e(55852),f=e(28138),E=e(28444),D=e(55314),O=e(37690),b=e(96374),K=e(94753);const W=({onConfirm:h,onDismiss:d,selectedDashboards:C,isLoading:u,...U})=>{const A=C.length,B=async()=>{(0,m.rR)("grafana_delete_permanently_confirm_clicked",{item_counts:{dashboard:A}}),await h(),d()};return(0,a.jsx)(b.u,{body:(0,a.jsx)(K.E,{element:"p",children:(0,a.jsxs)(r.x6,{i18nKey:"recently-deleted.permanently-delete-modal.text",count:A,children:["This action will delete ",{numberOfDashboards:A}," dashboards."]})}),title:(0,r.t)("recently-deleted.permanently-delete-modal.title","Permanently Delete Dashboards"),confirmationText:(0,r.t)("recently-deleted.permanently-delete-modal.confirm-text","Delete"),confirmText:u?(0,r.t)("recently-deleted.permanently-delete-modal.delete-loading","Deleting..."):(0,r.t)("recently-deleted.permanently-delete-modal.delete-button","Delete"),confirmButtonVariant:"destructive",onConfirm:B,onDismiss:d,...U})},N=({onConfirm:h,onDismiss:d,selectedDashboards:C,isLoading:u,...U})=>{const A=C.length,B=async()=>{(0,m.rR)("grafana_restore_confirm_clicked",{item_counts:{dashboard:A}}),await h(),d()};return(0,a.jsx)(b.u,{body:(0,a.jsx)(K.E,{element:"p",children:(0,a.jsxs)(r.x6,{i18nKey:"recently-deleted.restore-modal.text",count:A,children:["This action will restore ",{numberOfDashboards:A}," dashboards."]})}),confirmText:u?(0,r.t)("recently-deleted.restore-modal.restore-loading","Restoring..."):(0,r.t)("recently-deleted.restore-modal.restore-button","Restore"),confirmButtonVariant:"primary",onDismiss:d,onConfirm:B,title:(0,r.t)("recently-deleted.restore-modal.title","Restore Dashboards"),...U})};function V(){const h=(0,l.useDispatch)(),d=(0,O.xK)(),[,C]=s(),[u,{isLoading:U}]=(0,D.vR)(),[A,{isLoading:B}]=(0,D.D$)(),j=(0,c.useMemo)(()=>Object.entries(d.dashboard).filter(([F,z])=>z).map(([F])=>F),[d.dashboard]),G=()=>{h((0,O.cT)({isSelected:!1,folderUID:void 0})),C.doSearchWithDebounce()},H=async()=>{const F=C.state.result?.view.toArray();if(!F)return;const z=j.map(Z=>u({dashboardUID:Z}));await Promise.all(z);const w=new Set;for(const Z of j){const J=F.find(ne=>ne.uid===Z);if(!J)continue;const se=J.location===i.TF?void 0:J.location;w.add(se)}h((0,O.xN)(Array.from(w))),G()},ee=async()=>{const F=j.map(z=>A({dashboardUID:z}));await Promise.all(F),G()},te=()=>{(0,m.rR)("grafana_restore_clicked",{item_counts:{dashboard:j.length}}),f.A.publish(new E.S8({component:N,props:{selectedDashboards:j,onConfirm:H,isLoading:U}}))},ae=()=>{(0,m.rR)("grafana_delete_permanently_clicked",{item_counts:{dashboard:j.length}}),f.A.publish(new E.S8({component:W,props:{selectedDashboards:j,onConfirm:ee,isLoading:B}}))};return(0,a.jsxs)(t.B,{gap:1,children:[(0,a.jsx)(o.$n,{onClick:te,variant:"secondary",children:(0,a.jsx)(r.x6,{i18nKey:"recently-deleted.buttons.restore",children:"Restore"})}),(0,a.jsx)(o.$n,{onClick:ae,variant:"destructive",children:(0,a.jsx)(r.x6,{i18nKey:"recently-deleted.buttons.delete",children:"Delete permanently"})})]})}var Q=e(69529);const v=({searchState:h})=>{const d=!!(h.query||h.tag.length);return(0,a.jsx)(Q.p,{message:d?(0,r.t)("recently-deleted.page.no-search-result","No results found for your query"):(0,r.t)("recently-deleted.page.no-deleted-dashboards","You haven't deleted any dashboards recently."),variant:d?"not-found":"completed",role:"alert",children:(0,a.jsx)(r.x6,{i18nKey:"recently-deleted.page.no-deleted-dashboards-text",children:"When you delete a dashboard, it will appear here for 30 days before being permanently deleted. Your organization administrator can restore recently-deleted dashboards."})})};var L=e(2960),$=e(49904);const X=(0,c.memo)(()=>{const h=(0,l.useDispatch)(),d=(0,M.of)(k),[C,u]=s(),U=(0,O.QE)(),{canEditFolders:A,canEditDashboards:B}=(0,$.N)(),j=A||B;return(0,c.useEffect)(()=>{u.initStateFromUrl(void 0),h((0,O.cT)({isSelected:!1,folderUID:void 0}))},[h,u]),(0,a.jsx)(n.Y,{navId:"dashboards/recently-deleted",children:(0,a.jsxs)(n.Y.Contents,{className:d.pageContents,children:[(0,a.jsx)("div",{children:(0,a.jsx)(g.Z,{placeholder:(0,r.t)("recentlyDeleted.filter.placeholder","Search for dashboards"),value:C.query,escapeRegex:!1,onChange:u.onQueryChange})}),U?(0,a.jsx)(V,{}):(0,a.jsx)("div",{className:d.filters,children:(0,a.jsx)(y.bj,{state:C,getTagOptions:u.getTagOptions,getSortOptions:(0,I.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,I.getGrafanaSearcher)().sortPlaceholder,onLayoutChange:u.onLayoutChange,onSortChange:u.onSortChange,onTagFilterChange:u.onTagFilterChange,onDatasourceChange:u.onDatasourceChange,onPanelTypeChange:u.onPanelTypeChange,onSetIncludePanels:u.onSetIncludePanels})}),(0,a.jsx)("div",{className:d.subView,children:(0,a.jsx)(S.Ay,{children:({width:G,height:H})=>(0,a.jsx)(L.Q,{canSelect:j,width:G,height:H,searchStateManager:u,searchState:C,emptyState:(0,a.jsx)(v,{searchState:C})})})})]})})}),k=h=>({pageContents:(0,P.css)({display:"flex",flexDirection:"column",gap:h.spacing(1),height:"100%"}),subView:(0,P.css)({height:"100%"}),filters:(0,P.css)({display:"none",[h.breakpoints.up("md")]:{display:"block"}})});X.displayName="RecentlyDeletedPage";const q=X},2960:(Y,_,e)=>{e.d(_,{Q:()=>T});var a=e(74848),P=e(96540),c=e(78368),S=e(14236),M=e(69529),g=e(55852),n=e(8484),r=e(97427),y=e(66359),I=e(31678),l=e(37690);const i=25,R={view:new c.R((0,S.Vc)({fields:[{name:"uid",display:!0,values:Array(i).fill(null)},{name:"kind",display:!0,values:Array(i).fill("dashboard")},{name:"name",display:!0,values:Array(i).fill("")},{name:"location",display:!0,values:Array(i).fill("")},{name:"tags",display:!0,values:Array(i).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:i};function T({width:x,height:s,canSelect:m,searchState:t,searchStateManager:o,emptyState:f}){const E=(0,I.useDispatch)(),D=(0,I.useSelector)(v=>v.browseDashboards.selectedItems),O=(0,l.QE)(),{keyboardEvents:b}=(0,r.d)(),K=t.result??R,W=(0,P.useCallback)((v,L)=>v?v==="*"&&L==="*"?O:v==="*"?!1:D[p(v)][L]??!1:!1,[D,O]),N=(0,P.useCallback)(()=>{E((0,l.cT)({isSelected:!1,folderUID:void 0}))},[E]),V=(0,P.useCallback)((v,L)=>{const $=!W(v,L);E((0,l.t$)({item:{kind:p(v),uid:L},isSelected:$}))},[W,E]);if(K.totalRows===0){const v=f??(0,a.jsx)(M.p,{button:(0,a.jsx)(g.$n,{variant:"secondary",onClick:o.onClearSearchAndFilters,children:(0,a.jsx)(n.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,n.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,a.jsx)("div",{style:{width:x},children:v})}const Q={response:K,selection:m?W:void 0,selectionToggle:m?V:void 0,clearSelection:N,width:x,height:s,onTagSelected:o.onAddTag,keyboardEvents:b,onDatasourceChange:t.datasource?o.onDatasourceChange:void 0,onClickItem:o.onSearchItemClicked};return(0,a.jsx)(y.P,{...Q})}function p(x){switch(x){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+x)}},49904:(Y,_,e)=>{e.d(_,{N:()=>g});var a=e(32264),P=e(10096),c=e(31678);function S(n,r){return r?P.contextSrv.hasPermissionInMetadata(n,r):P.contextSrv.hasPermission(n)}function M(n){return n&&!a.$.featureToggles.nestedFolders?!1:a.$.featureToggles.accessActionSets?S(c.AccessControlAction.FoldersCreate,n):S(c.AccessControlAction.FoldersCreate)&&S(c.AccessControlAction.FoldersWrite,n)}function g(n){const r=S(c.AccessControlAction.DashboardsCreate,n),y=M(n),I=S(c.AccessControlAction.FoldersDelete,n),l=S(c.AccessControlAction.DashboardsWrite,n),i=S(c.AccessControlAction.FoldersWrite,n),R=S(c.AccessControlAction.FoldersPermissionsWrite,n),T=S(c.AccessControlAction.FoldersPermissionsRead,n);return{canCreateDashboards:r,canCreateFolders:y,canDeleteFolders:I,canEditDashboards:l,canEditFolders:i,canSetPermissions:R,canViewPermissions:T}}},19519:(Y,_,e)=>{e.d(_,{bj:()=>p});var a=e(74848),P=e(32196),c=e(32264),S=e(40845),M=e(67061),g=e(10880),n=e(55852),r=e(94354),y=e(73725),I=e(99818),l=e(8484),i=e(64161);function R(){return[{value:i.P.Folders,icon:"folder",description:(0,l.t)("search.actions.view-as-folders","View by folders")},{value:i.P.List,icon:"list-ul",description:(0,l.t)("search.actions.view-as-list","View as list")}]}function T(s){const m=s.layout??i.P.Folders;return m===i.P.Folders&&(s.query||s.sort||s.starred||s.tag.length>0)?i.P.List:m}const p=({state:s,showStarredFilter:m,showLayout:t,sortPlaceholder:o,onLayoutChange:f,onSortChange:E,onStarredFilterChange:D=()=>{},onTagFilterChange:O,getTagOptions:b,getSortOptions:K,onDatasourceChange:W,onPanelTypeChange:N,onSetIncludePanels:V})=>{const Q=(0,S.of)(x),v=T(s),L=s.tag.length||s.starred||s.query||s.datasource||s.panel_type?[i.P.Folders]:[];return(0,a.jsxs)(M.B,{justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(M.B,{gap:2,alignItems:"center",children:[(0,a.jsx)(I.$,{isClearable:!1,tags:s.tag,tagOptions:b,onChange:O}),c.$.featureToggles.panelTitleSearch&&(0,a.jsx)(g.S,{"data-testid":"include-panels",disabled:v===i.P.Folders,value:s.includePanels,onChange:()=>V(!s.includePanels),label:(0,l.t)("search.actions.include-panels","Include panels")}),m&&(0,a.jsx)("div",{className:Q.checkboxWrapper,children:(0,a.jsx)(g.S,{label:(0,l.t)("search.actions.starred","Starred"),onChange:D,value:s.starred})}),s.datasource&&(0,a.jsx)(n.$n,{icon:"times",variant:"secondary",onClick:()=>W(void 0),children:(0,a.jsxs)(l.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:s.datasource}]})}),s.panel_type&&(0,a.jsxs)(n.$n,{icon:"times",variant:"secondary",onClick:()=>N(void 0),children:["Panel: ",s.panel_type]})]}),(0,a.jsxs)(M.B,{gap:2,children:[t&&(0,a.jsx)(r.z,{options:R(),disabledOptions:L,onChange:f,value:v}),(0,a.jsx)(y.r,{onChange:$=>E($?.value),value:s.sort,getSortOptions:K,placeholder:o||(0,l.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};p.displayName="ActionRow";const x=s=>({checkboxWrapper:(0,P.css)({label:{lineHeight:"1.2"}})})},39788:(Y,_,e)=>{e.d(_,{ET:()=>s,lC:()=>T,ue:()=>l});var a=e(2543),P=e.n(a),c=e(39601),S=e(2619),M=e(33390),g=e(53477),n=e(6204),r=e(24439),y=e(64161),I=e(16757);const l={query:"",tag:[],starred:!1,layout:y.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},i={sort:null,starred:null,query:null,tag:null,layout:null},R=()=>localStorage.getItem(g.YU)===y.P.List?y.P.List:y.P.Folders;class T extends S.Q{constructor(){super(...arguments),this.updateLocation=(0,a.debounce)(t=>c.Ny.partial(t,!0),300),this.doSearchWithDebounce=(0,a.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...i})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=t=>{this.setStateAndDoSearch({query:t})},this.onRemoveTag=t=>{this.setStateAndDoSearch({tag:this.state.tag.filter(o=>o!==t)})},this.onTagFilterChange=t=>{this.setStateAndDoSearch({tag:t})},this.onAddTag=t=>{this.state.tag&&this.state.tag.includes(t)||this.setStateAndDoSearch({tag:[...this.state.tag,t]})},this.onDatasourceChange=t=>{this.setStateAndDoSearch({datasource:t})},this.onPanelTypeChange=t=>{this.setStateAndDoSearch({panel_type:t})},this.onStarredFilterChange=t=>{const o=t.currentTarget.checked;this.setStateAndDoSearch({starred:o})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=t=>{t!==this.state.starred&&this.setStateAndDoSearch({starred:t})},this.onSortChange=t=>{t?localStorage.setItem(g.w7,t):localStorage.removeItem(g.w7),this.state.layout===y.P.Folders?this.setStateAndDoSearch({sort:t,layout:y.P.List}):this.setStateAndDoSearch({sort:t})},this.onLayoutChange=t=>{localStorage.setItem(g.YU,t),this.state.sort&&t===y.P.Folders?this.setStateAndDoSearch({layout:t,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:t,sort:this.state.prevSort})},this.onSetIncludePanels=t=>{this.setStateAndDoSearch({includePanels:t}),M.A.set(g.d7,t)},this.getTagOptions=()=>{const t=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,r.getGrafanaSearcher)().tags(t)},this.onSearchItemClicked=t=>{(0,n.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,n.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(t,o=!0){const f=(0,I.N1)(c.Ny.getSearchObject());(f.query||f.datasource||f.panel_type)&&(f.layout=y.P.List);const E=R(),D=localStorage.getItem(g.w7)??void 0,O=E===y.P.List?f.sort||D:null;this.setState({...l,...f,layout:E,sort:O??l.sort,prevSort:D,folderUid:t,eventTrackingNamespace:t?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),o&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(t){const o=t.sort||this.state.sort||localStorage.getItem(g.w7)||void 0;this.setState({sort:o,...t}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===y.P.List)}getSearchQuery(){const t={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return t.sort?.length&&!t.sort.includes("name")&&(t.kind=["dashboard","folder"]),t.query?.length||(t.query="*",t.location||(t.kind=["dashboard","folder"])),!this.state.includePanels&&!t.kind&&(t.kind=["dashboard","folder"]),t.panel_type?.length&&(t.kind=["panel"]),t}doSearch(){const t={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,n.J$)(this.state.eventTrackingNamespace,t),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const o=(0,r.getGrafanaSearcher)(),f=Date.now();(this.state.starred?o.starred(this.lastQuery):o.search(this.lastQuery)).then(D=>{f>this.lastSearchTimestamp&&(this.setState({result:D,loading:!1}),this.lastSearchTimestamp=f)}).catch(D=>{(0,n.KZ)(this.state.eventTrackingNamespace,{...t,error:D?.message}),this.setState({loading:!1})})}}let p;function x(){if(!p){const t=localStorage.getItem(g.YU)??l.layout;let o=M.A.getBool(g.d7,!0);o&&(o=!1),p=new T({...l,layout:t,includePanels:o})}return p}function s(){const m=x();return[m.useState(),m]}}}]);

//# sourceMappingURL=RecentlyDeletedPage.c97703ea017e463d9214.js.map