"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4333],{30027:(y,O,a)=>{a.r(O),a.d(O,{BrowseFolderAlertingPage:()=>Y,default:()=>X});var s=a(74848),c=a(96540),r=a(69444),l=a(71101),f=a(31678),h=a(32196),t=a(2543),n=a(40996),b=a(40845),d=a(67061),x=a(67647),B=a(90182),D=a(14578),i=a(10860),A=a(64149),j=a(19384),u=a(15054),F=a(21969),I=a(9518),L=a(98439),g=a(39964),_=a(23770),W=a(98164),K=a(57220),p=a(32642),z=a(56361),V=(e=>(e.Ascending="alpha-asc",e.Descending="alpha-desc",e))(V||{});const G=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],S=({folder:e})=>{const m=(0,b.of)(J),o=(0,f.useDispatch)(),E=M=>{const k=(0,W.EU)(P,M);U(k)};(0,c.useEffect)(()=>{o((0,_.mB)({rulesSourceName:K.hY})),o((0,_.eB)({rulesSourceName:K.hY}))},[o]);const C=(0,I.dy)(K.hY),{nameFilter:T,labelFilter:P,sortOrder:v,setNameFilter:R,setLabelFilter:U,setSortOrder:w}=H(),q=C.find(M=>M.uid===e.uid)?.groups.flatMap(M=>M.rules)??[],aa=$(q,T,P,v??"alpha-asc"),sa=q.length===0||aa.length===0,{page:ea,numberOfPages:ta,onPageChange:na,pageItems:oa}=(0,L.W)(aa,1,u.FG);return(0,s.jsx)("div",{className:m.container,children:(0,s.jsxs)(d.B,{direction:"column",gap:3,children:[(0,s.jsx)(x.Z,{value:T,onChange:R,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,s.jsxs)(d.B,{direction:"row",children:[(0,s.jsx)(B.l6,{value:v,onChange:({value:M})=>M&&w(M),options:G,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,s.jsx)(D.I,{name:v==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),(0,s.jsx)(x.Z,{value:P,onChange:U,placeholder:"Search alerts by labels",className:m.filterLabelsInput,"data-testid":"label-filter"})]}),(0,s.jsx)(d.B,{direction:"column",gap:1,children:oa.map(M=>(0,s.jsxs)(i.Z,{href:(0,z.w$)("grafana",M,""),className:m.card,"data-testid":"alert-card-row",children:[(0,s.jsx)(i.Z.Heading,{children:M.name}),(0,s.jsx)(i.Z.Tags,{children:(0,s.jsx)(A.L,{onClick:E,tags:Object.entries(M.labels).map(([k,ra])=>`${k}=${ra}`)})}),(0,s.jsx)(i.Z.Meta,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(D.I,{name:"folder"})," ",e.title]})})]},M.name))}),sa&&(0,s.jsx)("div",{className:m.noResults,children:"No alert rules found"}),(0,s.jsx)("div",{className:m.pagination,children:(0,s.jsx)(j.d,{currentPage:ea,numberOfPages:ta,onNavigate:na,hideWhenSinglePage:!0})})]})})};var N=(e=>(e.nameFilter="nameFilter",e.labelFilter="labelFilter",e.sortOrder="sort",e))(N||{});function H(){const[e,m]=(0,g.l)(),[o,E]=(0,c.useState)(e.get("nameFilter")??""),[C,T]=(0,c.useState)(e.get("labelFilter")??""),P=e.get("sort"),[v,R]=(0,c.useState)(P==="alpha-asc"?"alpha-asc":P==="alpha-desc"?"alpha-desc":void 0);return(0,n.A)(()=>m({nameFilter:(0,F.fE)(o),labelFilter:(0,F.fE)(C),sort:(0,F.fE)(v)},!0),400,[o,C,v]),{nameFilter:o,labelFilter:C,sortOrder:v,setNameFilter:E,setLabelFilter:T,setSortOrder:R}}function $(e,m,o,E){const C=(0,p.Zc)(o),T=e.filter(P=>P.name.toLowerCase().includes(m.toLowerCase())&&(0,W.Av)(P.labels,C));return(0,t.orderBy)(T,P=>P.name.toLowerCase(),[E==="alpha-asc"?"asc":"desc"])}const J=e=>({container:(0,h.css)({padding:e.spacing(1)}),card:(0,h.css)({gridTemplateColumns:"auto 1fr 2fr",margin:0}),pagination:(0,h.css)({alignSelf:"center"}),filterLabelsInput:(0,h.css)({flex:1,width:"auto",minWidth:"240px"}),noResults:(0,h.css)({padding:e.spacing(2),backgroundColor:e.colors.background.secondary,fontStyle:"italic"})});var Z=a(55314),Q=a(9134);function Y({match:e}){const{uid:m}=e.params,{data:o}=(0,Z.kH)(m),E=(0,f.useSelector)(v=>v.folder),[C]=(0,Z.iB)(),T=(0,c.useMemo)(()=>{if(!o)return;const v=(0,l.R4)(o),R=(0,l.Fk)(o.uid),U=v.children?.find(w=>w.id===R);return U&&(U.active=!0),v},[o]),P=m?async v=>{if(o){const R=await C({...o,title:v});if("error"in R)throw R.error}}:void 0;return(0,s.jsx)(r.Y,{navId:"dashboards/browse",pageNav:T,onEditTitle:P,actions:(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(Q.m,{folder:o})}),children:(0,s.jsx)(r.Y.Contents,{children:(0,s.jsx)(S,{folder:E})})})}const X=Y},18241:(y,O,a)=>{a.d(O,{T:()=>x});var s=a(74848),c=a(96540),r=a(32264),l=a(96374),f=a(94753),h=a(68402),t=a(42418),n=a(8484),b=a(55314),d=a(43907);const x=({onConfirm:B,onDismiss:D,selectedItems:i,...A})=>{const{data:j}=(0,b.G2)(i),u=!!(j&&(j.alertRule||j.libraryPanel)),[F,I]=(0,c.useState)(!1),L=async()=>{I(!0);try{await B(),I(!1),D()}catch{I(!1)}};return(0,s.jsx)(l.u,{body:(0,s.jsxs)(s.Fragment,{children:[r.$.featureToggles.dashboardRestore&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.E,{element:"p",children:(0,s.jsx)(n.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,s.jsx)(h.$,{v:2})]}),(0,s.jsx)(f.E,{element:"p",children:(0,s.jsx)(n.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(d.x,{selectedItems:i}),(0,s.jsx)(h.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:u?(0,s.jsx)(t.F,{severity:"warning",title:(0,n.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(n.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,n.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:F?(0,n.t)("browse-dashboards.action.deleting","Deleting..."):(0,n.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:D,onConfirm:L,title:(0,n.t)("browse-dashboards.action.delete-modal-title","Delete"),...A,disabled:u})}},51887:(y,O,a)=>{a.d(O,{J:()=>B});var s=a(74848),c=a(96540),r=a(37390),l=a(42418),f=a(94753),h=a(68402),t=a(88575),n=a(55852),b=a(36607),d=a(8484),x=a(43907);const B=({onConfirm:D,onDismiss:i,selectedItems:A,...j})=>{const[u,F]=(0,c.useState)(),[I,L]=(0,c.useState)(!1),g=Object.keys(A.folder).filter(W=>A.folder[W]),_=async()=>{if(u!==void 0){L(!0);try{await D(u),L(!1),i()}catch{L(!1)}}};return(0,s.jsxs)(r.a,{title:(0,d.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:i,...j,children:[g.length>0&&(0,s.jsx)(l.F,{severity:"info",title:(0,d.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(f.E,{element:"p",children:(0,s.jsx)(d.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(x.x,{selectedItems:A}),(0,s.jsx)(h.$,{v:3}),(0,s.jsx)(t.D,{label:(0,d.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(b.d,{value:u,excludeUIDs:g,onChange:F})}),(0,s.jsxs)(r.a.ButtonRow,{children:[(0,s.jsx)(n.$n,{onClick:i,variant:"secondary",fill:"outline",children:(0,s.jsx)(d.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(n.$n,{disabled:u===void 0||I,onClick:_,variant:"primary",children:I?(0,d.t)("browse-dashboards.action.moving","Moving..."):(0,d.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(y,O,a)=>{a.d(O,{m:()=>L});var s=a(74848),c=a(96540),r=a(32264),l=a(14110),f=a(39601),h=a(38138),t=a(64539),n=a(83122),b=a(55852),d=a(14578),x=a(87978),B=a(52487),D=a(10096),i=a(8484),A=a(28444),j=a(55314),u=a(49904),F=a(18241),I=a(51887);function L({folder:g}){const[_,W]=(0,c.useState)(!1),[K,p]=(0,c.useState)(!1),[z]=(0,j.aF)(),[V]=(0,j.Ko)(),{canEditFolders:G,canDeleteFolders:S,canViewPermissions:N,canSetPermissions:H}=(0,u.N)(g),$=r.$.featureToggles.nestedFolders&&G,J=async E=>{await z({folder:g,destinationUID:E}),(0,l.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Z=async()=>{await V(g),(0,l.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:E}=g,C=E&&E.length?E[E.length-1].url:"/dashboards";f.Ny.push(C)},Q=()=>{D.lE.publish(new A.S8({component:I.J,props:{selectedItems:{folder:{[g.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:J}}))},Y=()=>{D.lE.publish(new A.S8({component:F.T,props:{selectedItems:{folder:{[g.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Z}}))},X=(0,i.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),e=(0,i.t)("browse-dashboards.folder-actions-button.move","Move"),m=(0,i.t)("browse-dashboards.folder-actions-button.delete","Delete"),o=(0,s.jsxs)(h.W,{children:[N&&(0,s.jsx)(t.D,{onClick:()=>p(!0),label:X}),$&&(0,s.jsx)(t.D,{onClick:Q,label:e}),S&&(0,s.jsx)(t.D,{destructive:!0,onClick:Y,label:m})]});return!N&&!$&&!S?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.m,{overlay:o,onVisibleChange:W,children:(0,s.jsxs)(b.$n,{variant:"secondary",children:[(0,s.jsx)(i.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(d.I,{name:_?"angle-up":"angle-down"})]})}),K&&(0,s.jsx)(x._,{title:(0,i.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:g.title,onClose:()=>p(!1),size:"md",children:(0,s.jsx)(B.x,{resource:"folders",resourceId:g.uid,canSetPermissions:H})})]})}},49904:(y,O,a)=>{a.d(O,{N:()=>h});var s=a(32264),c=a(10096),r=a(31678);function l(t,n){return n?c.contextSrv.hasPermissionInMetadata(t,n):c.contextSrv.hasPermission(t)}function f(t){return t&&!s.$.featureToggles.nestedFolders?!1:s.$.featureToggles.accessActionSets?l(r.AccessControlAction.FoldersCreate,t):l(r.AccessControlAction.FoldersCreate)&&l(r.AccessControlAction.FoldersWrite,t)}function h(t){const n=l(r.AccessControlAction.DashboardsCreate,t),b=f(t),d=l(r.AccessControlAction.FoldersDelete,t),x=l(r.AccessControlAction.DashboardsWrite,t),B=l(r.AccessControlAction.FoldersWrite,t),D=l(r.AccessControlAction.FoldersPermissionsWrite,t),i=l(r.AccessControlAction.FoldersPermissionsRead,t);return{canCreateDashboards:n,canCreateFolders:b,canDeleteFolders:d,canEditDashboards:x,canEditFolders:B,canSetPermissions:D,canViewPermissions:i}}}}]);

//# sourceMappingURL=FolderAlerting.2f2040c1c27a322929e8.js.map