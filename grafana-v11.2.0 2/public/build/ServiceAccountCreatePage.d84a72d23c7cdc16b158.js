"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4176],{63606:(W,E,n)=>{n.r(E),n.d(E,{ServiceAccountCreatePage:()=>O,default:()=>f});var o=n(74848),r=n(96540),P=n(17172),R=n(39601),C=n(84167),v=n(88575),m=n(10354),I=n(55852),M=n(72235),A=n(69444),p=n(89062),u=n(85927),s=n(10096),c=n(31678),h=n(5133);const x=async i=>{const l=await(0,P.AI)().post("/api/serviceaccounts/",i);return await s.contextSrv.fetchUserPermissions(),l},U=async(i,l)=>(0,P.AI)().patch(`/api/serviceaccounts/${i}`,l),O=({})=>{const[i,l]=(0,r.useState)([]),[d,S]=(0,r.useState)([]),g=s.contextSrv.user.orgId,[a,L]=(0,r.useState)({id:0,orgId:s.contextSrv.user.orgId,role:s.contextSrv.licensedAccessControlEnabled()?c.OrgRole.None:c.OrgRole.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]});(0,r.useEffect)(()=>{async function t(){try{if(s.contextSrv.hasPermission(c.AccessControlAction.ActionRolesList)){let e=await(0,u.RL)(g);l(e)}}catch(e){console.error("Error loading options",e)}}s.contextSrv.licensedAccessControlEnabled()&&t()},[g]);const B=(0,r.useCallback)(async t=>{t.role=a.role;const e=await x(t);try{const _={avatarUrl:e.avatarUrl,id:e.id,isDisabled:e.isDisabled,login:e.login,name:e.name,orgId:e.orgId,role:e.role,tokens:e.tokens};await U(e.id,t),s.contextSrv.licensedAccessControlEnabled()&&s.contextSrv.hasPermission(c.AccessControlAction.ActionUserRolesAdd)&&s.contextSrv.hasPermission(c.AccessControlAction.ActionUserRolesRemove)&&await(0,u.eA)(d,_.id,_.orgId)}catch(_){console.error(_)}R.Ny.push(`/org/serviceaccounts/${e.id}`)},[a.role,d]),D=t=>{L({...a,role:t})},T=(t,e,_)=>{S(t)};return(0,o.jsx)(A.Y,{navId:"serviceaccounts",pageNav:{text:"Create service account"},children:(0,o.jsx)(A.Y.Contents,{children:(0,o.jsx)(M.l,{onSubmit:B,validateOn:"onSubmit",children:({register:t,errors:e})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(C.n,{children:[(0,o.jsx)(v.D,{label:"Display name",required:!0,invalid:!!e.name,error:e.name?"Display name is required":void 0,children:(0,o.jsx)(m.p,{id:"display-name-input",...t("name",{required:!0}),autoFocus:!0})}),(0,o.jsx)(v.D,{label:"Role",children:s.contextSrv.licensedAccessControlEnabled()?(0,o.jsx)(p.y,{apply:!0,userId:a.id||0,orgId:a.orgId,basicRole:a.role,onBasicRoleChange:D,roleOptions:i,onApplyRoles:T,pendingRoles:d,maxWidth:"100%"}):(0,o.jsx)(h.r,{"aria-label":"Role",value:a.role,onChange:D})})]}),(0,o.jsx)(I.$n,{type:"submit",children:"Create"})]})})})})},f=O}}]);

//# sourceMappingURL=ServiceAccountCreatePage.d84a72d23c7cdc16b158.js.map