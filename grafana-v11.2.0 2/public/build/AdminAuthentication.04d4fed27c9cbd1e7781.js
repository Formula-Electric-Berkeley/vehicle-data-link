"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5592],{51332:(se,S,a)=>{a.r(S),a.d(S,{AuthConfigPageUnconnected:()=>Y,default:()=>pe});var e=a(74848),u=a(96540),w=a(71468),g=a(61268),W=a(14110),Z=a(72109),ie=a(27746),X=a(71259),N=a(69444),ve=a(2913),U=a(32196),F=a(40845),oe=a(87978),D=a(94753),M=a(15292),re=a(55852),be=a(3169),Q=a(60610);const V=r=>({allowInsecureEmail:r.authConfig.settings?.auth?.oauth_allow_insecure_email_lookup.toLowerCase()==="true"}),xe={loadSettings:Q.M5,saveSettings:Q.DZ},le=(0,w.connect)(V,xe)(({allowInsecureEmail:r,loadSettings:v,onClose:C,saveSettings:p})=>{const I=(0,be._2)(),O=async()=>{try{await p({updates:{auth:{oauth_allow_insecure_email_lookup:""+!r}}}),await v(!1),I.success("Settings saved")}catch{I.error("Failed to save settings")}},G=async()=>{try{await p({removals:{auth:["oauth_allow_insecure_email_lookup"]}}),await v(!1),I.success("Settings saved")}catch{I.error("Failed to save settings")}},R=(0,e.jsxs)(e.Fragment,{children:["Configure auth settings. Find out more in our"," ",(0,e.jsx)(Z.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication/#settings",children:"documentation"}),"."]}),K=(0,F.of)(de);return(0,e.jsxs)(oe._,{title:"Auth Settings",subtitle:R,size:"md",onClose:C,children:[(0,e.jsxs)("div",{className:K.advancedAuth,children:[(0,e.jsx)(D.E,{variant:"h4",children:"Advanced Auth"}),(0,e.jsx)(D.E,{variant:"h5",children:"Enable insecure email lookup"}),(0,e.jsx)(D.E,{variant:"body",color:"secondary",children:"Allow users to use the same email address to log into Grafana with different identity providers."}),(0,e.jsx)(M.d,{value:r,onChange:O})]}),(0,e.jsx)(re.$n,{size:"md",variant:"secondary",className:K.button,onClick:G,tooltip:"This action will disregard any saved changes and load the configuration from the configuration file.",children:"Reset"})]})}),de=r=>({advancedAuth:(0,U.css)({display:"flex",flexDirection:"column",gap:r.spacing(1)}),button:(0,U.css)({marginTop:r.spacing(2)})});var ue=a(67061),ce=a(14578);const Ae=()=>{const r=(0,F.of)(Se);return(0,e.jsxs)("div",{className:r.container,children:[(0,e.jsxs)(ue.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(ce.I,{name:"cog"}),(0,e.jsx)(D.E,{children:"Configuration required"})]}),(0,e.jsx)(D.E,{variant:"bodySmall",color:"secondary",children:"You have no authentication configuration created at the moment."}),(0,e.jsx)(Z.Y,{href:"https://grafana.com/docs/grafana/latest/auth/overview/",external:!0,children:"Refer to the documentation on how to configure authentication"})]})},Se=r=>({container:(0,U.css)({display:"flex",flexDirection:"column",gap:r.spacing(2),backgroundColor:r.colors.background.secondary,borderRadius:r.shape.radius.default,padding:r.spacing(3),width:"max-content",margin:r.spacing(3,"auto")})}),Ce=Ae;var Ie=a(8887),z=a(10860),Pe=a(39938),he=a(7250),q=a(5328);function fe({providerId:r,enabled:v,configPath:C,authType:p,onClick:I}){const O=(0,q.h)({configPath:C,id:r}),[G,R]=he.L[r]||["lock",r.toUpperCase()];return(0,e.jsxs)(z.Z,{href:O,onClick:I,children:[(0,e.jsx)(z.Z.Heading,{children:R}),(0,e.jsx)(z.Z.Meta,{children:p}),(0,Ie.n6)(G)&&(0,e.jsx)(z.Z.Figure,{children:(0,e.jsx)(ce.I,{name:G,size:"xxxl"})}),(0,e.jsx)(z.Z.Actions,{children:(0,e.jsx)(Pe.E,{text:v?"Enabled":"Not enabled",color:v?"green":"blue"})})]})}var me=a(73399);function B(r){const{isLoading:v,providerStatuses:C,providers:p}=r.authConfig;return{isLoading:v,providerStatuses:C,providers:p}}const H={loadSettings:Q.M5},ge=(0,w.connect)(B,H),Y=({providerStatuses:r,isLoading:v,loadSettings:C,providers:p})=>{(0,u.useEffect)(()=>{C()},[C]);const[I,O]=(0,u.useState)(!1),R=(0,me.getRegisteredAuthProviders)().filter(d=>!r[d.id]?.hide),K=(d,E)=>{(0,W.rR)("authentication_ui_provider_clicked",{provider:d,enabled:E})};p=p.filter(d=>d.provider!=="saml"),p=p.filter(d=>d.provider!=="ldap");const P=R.length?[...R.map(d=>({provider:d.id,settings:{...r[d.id],configPath:d.configPath,type:d.type}})),...p]:p;return(0,e.jsx)(N.Y,{navId:"authentication",subTitle:(0,e.jsxs)(e.Fragment,{children:["Manage your auth settings and configure single sign-on. Find out more in our"," ",(0,e.jsx)(Z.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication",children:"documentation"}),"."]}),actions:ve.config.buildInfo.edition!==g.r.OpenSource&&(0,e.jsx)(ie.I,{icon:"cog",variant:"canvas",onClick:()=>O(!0),children:"Auth settings"}),children:(0,e.jsx)(N.Y.Contents,{isLoading:v,children:P.length?(0,e.jsxs)(X.x,{gap:3,minColumnWidth:34,children:[P.filter(({provider:d})=>!["grafana_com"].includes(d)).map(({provider:d,settings:E})=>(0,e.jsx)(fe,{authType:E.type||"OAuth",providerId:d,enabled:E.enabled,onClick:()=>K(d,E.enabled),configPath:E.configPath},d)),I&&(0,e.jsx)(le,{onClose:()=>O(!1)})]}):(0,e.jsx)(Ce,{})})})},pe=ge(Y)},22468:(se,S,a)=>{a.r(S),a.d(S,{ProviderConfigPage:()=>Oe,default:()=>Fe});var e=a(74848),u=a(96540),w=a(71468),g=a(67061),W=a(94753),Z=a(39938),ie=a(69444),X=a(49785),N=a(26272),ve=a(3591),U=a(17172),F=a(14110),oe=a(39601),D=a(38138),M=a(88575),re=a(15292),be=a(57418),Q=a(90613),V=a(55852),xe=a(83122),Ue=a(29158),De=a(96374),le=a(32196),de=a(24180),ue=a(37390);const ce=({confirmRedirect:n,onDiscard:t,onLocationChange:s})=>{const[o,c]=(0,u.useState)(!1),[h,f]=(0,u.useState)(null),[y,J]=(0,u.useState)(!1);(0,u.useEffect)(()=>{const i=b=>{n&&(b.preventDefault(),b.returnValue="")};return window.addEventListener("beforeunload",i),()=>{window.removeEventListener("beforeunload",i)}},[n]);const _=i=>{const b=window.location.pathname,l=i.pathname;if(b===l)return!0;const $=s?.(i);let x=n&&!y;return $!==void 0&&(x=x&&$),x?(c(!0),f(i),!1):($&&t(),!0)},ee=()=>{c(!1),f(null)},j=()=>{c(!1),J(!0),t()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(de.XG,{when:!0,message:_}),h&&y&&(0,e.jsx)(de.rd,{to:h}),(0,e.jsx)(Ae,{isOpen:o,onDiscard:j,onBackToForm:ee})]})},Ae=({onDiscard:n,onBackToForm:t,isOpen:s})=>(0,e.jsxs)(ue.a,{isOpen:s,title:"Leave page?",onDismiss:t,icon:"exclamation-triangle",className:(0,le.css)({width:"500px"}),children:[(0,e.jsx)("h5",{children:"Changes that you made may not be saved."}),(0,e.jsxs)(ue.a.ButtonRow,{children:[(0,e.jsx)(V.$n,{variant:"secondary",onClick:t,fill:"outline",children:"Continue editing"}),(0,e.jsx)(V.$n,{variant:"destructive",onClick:n,children:"Discard unsaved changes"})]})]});var Se=a(40845),Ce=a(10354),Ie=a(9226),z=a(90182),Pe=a(10880),he=a(8227),q=a(32264),fe=a(72109),me=a(10096);function B(n){return Array.isArray(n)&&n.every(t=>typeof t=="object"&&t!==null&&"value"in t)}var H=a(5328);const ge={azuread:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","allowedGroups","forceUseGraphApi","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],generic_oauth:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","authStyle","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["nameAttributePath","loginAttributePath","emailAttributeName","emailAttributePath","idTokenAttributeName","roleAttributePath","roleAttributeStrict","orgMapping","orgAttributePath","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","defineAllowedGroups",{name:"allowedGroups",dependsOn:"defineAllowedGroups"},{name:"groupsAttributePath",dependsOn:"defineAllowedGroups"},"defineAllowedTeamsIds",{name:"teamIds",dependsOn:"defineAllowedTeamsIds"},{name:"teamsUrl",dependsOn:"defineAllowedTeamsIds"},{name:"teamIdsAttributePath",dependsOn:"defineAllowedTeamsIds"},"usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],google:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["validateHd","hostedDomain","allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],github:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","teamIds","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],gitlab:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],okta:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","orgAttributePath","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}]};function Y(n){return{clientId:{label:"Client Id",type:"text",description:"The client Id of your OAuth2 app.",validation:{required:!0,message:"This field is required"}},clientSecret:{label:"Client secret",type:"secret",description:"The client secret of your OAuth2 app."},allowedOrganizations:{label:"Allowed organizations",type:"select",description:`List of comma- or space-separated organizations. The user should be a member 
of at least one organization to log in.`,multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter organizations (my-team, myteam...) and press Enter to add"},allowedDomains:{label:"Allowed domains",type:"select",description:`List of comma- or space-separated domains. The user should belong to at least 
one domain to log in.`,multi:!0,allowCustomValue:!0,options:[]},authUrl:{label:"Auth URL",type:"text",description:"The authorization endpoint of your OAuth2 provider.",validation:{required:!0,validate:t=>(0,H.K)(t),message:"This field is required and must be a valid URL."}},authStyle:{label:"Auth style",type:"select",description:"It determines how client_id and client_secret are sent to Oauth2 provider. Default is AutoDetect.",multi:!1,options:[{value:"AutoDetect",label:"AutoDetect"},{value:"InParams",label:"InParams"},{value:"InHeader",label:"InHeader"}],defaultValue:{value:"AutoDetect",label:"AutoDetect"}},tokenUrl:{label:"Token URL",type:"text",description:"The token endpoint of your OAuth2 provider.",validation:{required:!0,validate:t=>(0,H.K)(t),message:"This field is required and must be a valid URL."}},scopes:{label:"Scopes",type:"select",description:"List of comma- or space-separated OAuth2 scopes.",multi:!0,allowCustomValue:!0,options:[]},allowedGroups:{label:"Allowed groups",type:"select",description:(0,e.jsxs)(e.Fragment,{children:["List of comma- or space-separated groups. The user should be a member of at least one group to log in."," ",n==="generic_oauth"&&"If you configure allowed_groups, you must also configure groups_attribute_path."]}),multi:!0,allowCustomValue:!0,options:[],validation:n==="azuread"?{validate:t=>typeof t=="string"?(0,he.A)(t):B(t)?t.every(s=>s?.value&&(0,he.A)(s.value)):!0,message:"Allowed groups must be Object Ids."}:void 0},apiUrl:{label:"API URL",type:"text",description:(0,e.jsxs)(e.Fragment,{children:["The user information endpoint of your OAuth2 provider. Information returned by this endpoint must be compatible with"," ",(0,e.jsx)(fe.Y,{href:"https://connect2id.com/products/server/docs/api/userinfo",external:!0,variant:"bodySmall",children:"OpenID UserInfo"}),"."]}),validation:{required:!1,validate:t=>typeof t!="string"?!1:t.length?(0,H.K)(t):!0,message:"This field must be a valid URL if set."}},roleAttributePath:{label:"Role attribute path",description:"JMESPath expression to use for Grafana role lookup.",type:"text",validation:{required:!1}},name:{label:"Display name",description:'Will be displayed on the login page as "Sign in with ...". Helpful if you use more than one identity providers or SSO protocols.',type:"text"},allowSignUp:{label:"Allow sign up",description:"If not enabled, only existing Grafana users can log in using OAuth.",type:"switch"},autoLogin:{label:"Auto login",description:"Log in automatically, skipping the login screen.",type:"switch"},signoutRedirectUrl:{label:"Sign out redirect URL",description:"The URL to redirect the user to after signing out from Grafana.",type:"text",validation:{required:!1}},emailAttributeName:{label:"Email attribute name",description:"Name of the key to use for user email lookup within the attributes map of OAuth2 ID token.",type:"text"},emailAttributePath:{label:"Email attribute path",description:"JMESPath expression to use for user email lookup from the user information.",type:"text"},nameAttributePath:{label:"Name attribute path",description:`JMESPath expression to use for user name lookup from the user ID token. 
This name will be used as the user\u2019s display name.`,type:"text"},loginAttributePath:{label:"Login attribute path",description:"JMESPath expression to use for user login lookup from the user ID token.",type:"text"},idTokenAttributeName:{label:"ID token attribute name",description:"The name of the key used to extract the ID token from the returned OAuth2 token.",type:"text"},roleAttributeStrict:{label:"Role attribute strict mode",description:"If enabled, denies user login if the Grafana role cannot be extracted using Role attribute path.",type:"switch"},allowAssignGrafanaAdmin:{label:"Allow assign Grafana admin",description:"If enabled, it will automatically sync the Grafana server administrator role.",type:"switch",hidden:!me.contextSrv.isGrafanaAdmin},skipOrgRoleSync:{label:"Skip organization role sync",description:"Prevent synchronizing users\u2019 organization roles from your IdP.",type:"switch"},orgMapping:{label:"Organization mapping",description:r(n),type:"select",hidden:!me.contextSrv.isGrafanaAdmin,multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter mappings (my-team:1:Viewer...) and press Enter to add"},orgAttributePath:{label:"Organization attribute path",description:"JMESPath expression to use for organization lookup.",type:"text",hidden:!["generic_oauth","okta"].includes(n)},defineAllowedGroups:{label:"Define allowed groups",type:"switch"},defineAllowedTeamsIds:{label:"Define allowed teams ids",type:"switch"},forceUseGraphApi:{label:"Force use Graph API",description:"If enabled, Grafana will fetch the users' groups using the Microsoft Graph API.",type:"checkbox"},usePkce:{label:"Use PKCE",description:(0,e.jsxs)(e.Fragment,{children:["If enabled, Grafana will use"," ",(0,e.jsx)(fe.Y,{external:!0,variant:"bodySmall",href:"https://datatracker.ietf.org/doc/html/rfc7636",children:"Proof Key for Code Exchange (PKCE)"})," ","with the OAuth2 Authorization Code Grant."]}),type:"checkbox"},useRefreshToken:{label:"Use refresh token",description:"If enabled, Grafana will fetch a new access token using the refresh token provided by the OAuth2 provider.",type:"checkbox"},tlsClientCa:{label:"TLS client ca",description:"The file path to the trusted certificate authority list. Is not applicable on Grafana Cloud.",type:"text",hidden:!q.$.localFileSystemAvailable},tlsClientCert:{label:"TLS client cert",description:"The file path to the certificate. Is not applicable on Grafana Cloud.",type:"text",hidden:!q.$.localFileSystemAvailable},tlsClientKey:{label:"TLS client key",description:"The file path to the key. Is not applicable on Grafana Cloud.",type:"text",hidden:!q.$.localFileSystemAvailable},tlsSkipVerifyInsecure:{label:"TLS skip verify",description:`If enabled, the client accepts any certificate presented by the server and any host 
name in that certificate. You should only use this for testing, because this mode leaves 
SSL/TLS susceptible to man-in-the-middle attacks.`,type:"switch"},groupsAttributePath:{label:"Groups attribute path",description:`JMESPath expression to use for user group lookup. If you configure allowed_groups, 
you must also configure groups_attribute_path.`,type:"text"},teamsUrl:{label:"Teams URL",description:(0,e.jsxs)(e.Fragment,{children:["The URL used to query for Team Ids. If not set, the default value is /teams."," ",n==="generic_oauth"&&"If you configure teams_url, you must also configure team_ids_attribute_path."]}),type:"text",validation:{validate:(t,s)=>{let o=!0;return s.teamIds.length&&(o=!!t),typeof t=="string"&&t.length&&(o=(0,H.K)(t)),o},message:"This field must be set if Team Ids are configured and must be a valid URL."}},teamIdsAttributePath:{label:"Team Ids attribute path",description:"The JMESPath expression to use for Grafana Team Id lookup within the results returned by the teams_url endpoint.",type:"text",validation:{validate:(t,s)=>s.teamIds.length?!!t:!0,message:"This field must be set if Team Ids are configured."}},teamIds:{label:"Team Ids",type:"select",description:(0,e.jsxs)(e.Fragment,{children:[n==="github"?"Integer":"String"," list of Team Ids. If set, the user must be a member of one of the given teams to log in."," ",n==="generic_oauth"&&"If you configure team_ids, you must also configure teams_url and team_ids_attribute_path."]}),multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter Team Ids and press Enter to add",validation:n==="github"?{validate:t=>typeof t=="string"?pe(t):B(t)?t.every(s=>s?.value&&pe(s.value)):!0,message:"Team Ids must be numbers."}:void 0},hostedDomain:{label:"Hosted domain",description:"The domain under which Grafana is hosted and accessible.",type:"text"},validateHd:{label:"Validate hosted domain",description:"If enabled, Grafana will match the Hosted Domain retrieved from the Google ID Token against the Allowed Domains list specified by the user.",type:"checkbox"}}}function pe(n){return/^-?\d+$/.test(n)}function r(n){switch(n){case"azuread":return'List of "<GroupID>:<OrgIdOrName>:<Role>" mappings.';case"github":return'List of "<GitHubTeamName>:<OrgIdOrName>:<Role>" mappings.';case"gitlab":return'List of "<GitlabGroupName>:<OrgIdOrName>:<Role>';case"google":return'List of "<GoogleGroupName>:<OrgIdOrName>:<Role>';default:return'List of "<ExternalName>:<OrgIdOrName>:<Role>" mappings.'}}const v=({field:n,register:t,errors:s,watch:o,setValue:c,control:h,unregister:f,secretConfigured:y,provider:J})=>{const[_,ee]=(0,u.useState)(y),j=typeof n!="string",i=j?n.name:n,b=j?o(n.dependsOn):null,l=Y(J)[i],$=(0,Se.$j)();if((0,u.useEffect)(()=>{j&&(b||f(i))},[f,i,b,j]),!n)return console.log("missing field:",i),null;if(l.hidden||j&&!o(n.dependsOn))return null;const x={label:l.label,required:!!l.validation?.required,invalid:!!s[i],error:l.validation?.message,description:l.description,defaultValue:l.defaultValue?.value};switch(l.type){case"text":return(0,e.jsx)(M.D,{...x,children:(0,e.jsx)(Ce.p,{...t(i,l.validation),type:l.type,id:i,autoComplete:"off"})},i);case"secret":return(0,e.jsx)(M.D,{...x,htmlFor:i,children:(0,e.jsx)(X.xI,{name:i,control:h,rules:l.validation,render:({field:{ref:je,value:T,...ne}})=>(0,e.jsx)(Ie.L4,{...ne,autoComplete:"off",id:i,value:typeof T=="string"?T:"",isConfigured:_,onReset:()=>{ee(!1),c(i,"")}})})},i);case"select":const te=o(i);let ae=l.options;return l.options?.length||(ae=B(te)?te:[]),(0,e.jsx)(M.D,{...x,htmlFor:i,children:(0,e.jsx)(X.xI,{rules:l.validation,name:i,control:h,render:({field:{ref:je,onChange:T,...ne},fieldState:{invalid:Te}})=>(0,e.jsx)(z.l6,{...ne,placeholder:l.placeholder,isMulti:l.multi,invalid:Te,inputId:i,options:ae,allowCustomValue:!!l.allowCustomValue,defaultValue:l.defaultValue,onChange:T,onCreateOption:ye=>{const L={value:ye,label:ye};T([...ae||[],L])}})})},i);case"switch":return(0,e.jsx)(M.D,{...x,children:(0,e.jsx)(re.d,{...t(i),id:i})},i);case"checkbox":return(0,e.jsx)(Pe.S,{...t(i),id:i,...x,className:(0,le.css)({marginBottom:$.spacing(2)})},i);default:return console.error(`Unknown field type: ${l.type}`),null}},C={allowAssignGrafanaAdmin:!1,allowSignUp:!1,allowedDomains:[],allowedGroups:[],allowedOrganizations:[],apiUrl:"",authStyle:"",authUrl:"",autoLogin:!1,clientId:"",clientSecret:"",emailAttributeName:"",emailAttributePath:"",emptyScopes:!1,enabled:!1,extra:{},groupsAttributePath:"",hostedDomain:"",icon:"shield",name:"",roleAttributePath:"",roleAttributeStrict:!1,scopes:[],signoutRedirectUrl:"",skipOrgRoleSync:!1,teamIds:[],teamIdsAttributePath:"",teamsUrl:"",tlsClientCa:"",tlsClientCert:"",tlsClientKey:"",tlsSkipVerify:!1,tokenUrl:"",type:"",usePkce:!1,useRefreshToken:!1},p=n=>n?.length?Array.isArray(n)?n.map(t=>({label:t,value:t})):n.startsWith("[")&&n.endsWith("]")?JSON.parse(n).map(t=>({label:t,value:t})):n.split(/[\s,]/).map(t=>({label:t,value:t})):[];function I(n){if(!n)return C;const t=G(n.provider),s=K(Y(n.provider),t),o={...n.settings};for(const c of s)o[c]=p(o[c]);return o}const O=n=>n.length<=1?n.map(({value:t})=>t).join(","):JSON.stringify(n.map(({value:t})=>t)),G=n=>{const t=ge[n],s=["enabled"];return Object.values(t).reduce((o,c)=>[...o,...c.fields.map(h=>typeof h=="string"?h:h.name)],s)};function R(n,t){let s=n;const o=G(t),c=K(Y(t),o),h=Object.keys(s).filter(f=>o.includes(f)).reduce((f,y)=>({...f,[y]:s[y]}),{});for(const f of c){const y=s[f];y&&(B(y)?h[f]=O(y):B([y])&&(h[f]=y.value))}return h}function K(n,t){return Object.entries(n).filter(([s,o])=>t.includes(s)&&o.type==="select").map(([s])=>s)}const P=(0,ve.J7)(),d=({config:n,provider:t,isLoading:s})=>{const{register:o,handleSubmit:c,control:h,reset:f,watch:y,setValue:J,unregister:_,formState:{errors:ee,dirtyFields:j,isSubmitted:i}}=(0,X.mN)({defaultValues:I(n),mode:"onSubmit",reValidateMode:"onChange"}),[b,l]=(0,u.useState)(!1),[$,x]=(0,u.useState)(!1),te=i&&!$,ae=ge[t],[je,T]=(0,u.useState)(!1),ne=(0,e.jsx)(D.W,{children:(0,e.jsx)(D.W.Item,{label:"Reset to default values",icon:"history-alt",onClick:()=>{T(!0)}})}),Te=async m=>{l(!0),x(!1);const k=R(m,t);try{await(0,U.AI)().put(`/api/v1/sso-settings/${t}`,{id:n?.id,provider:n?.provider,settings:{...k}},{showErrorAlert:!1}),(0,F.rR)("grafana_authentication_ssosettings_saved",{provider:t,enabled:k.enabled}),P.publish({type:N.r1.alertSuccess.name,payload:["Settings saved"]}),f(m),setTimeout(()=>{oe.Ny.push("/admin/authentication")},300)}catch(A){let we="";(0,U.NF)(A)?we=A.data.message:A instanceof Error&&(we=A.message),P.publish({type:N.r1.alertError.name,payload:[we]}),x(!0),l(!1)}},ye=async()=>{try{await(0,U.AI)().delete(`/api/v1/sso-settings/${t}`,void 0,{showSuccessAlert:!1}),(0,F.rR)("grafana_authentication_ssosettings_removed",{provider:t}),P.publish({type:N.r1.alertSuccess.name,payload:["Settings reset to defaults"]}),setTimeout(()=>{oe.Ny.push("/admin/authentication")})}catch(m){let k="";(0,U.NF)(m)?k=m.data.message:m instanceof Error&&(k=m.message),P.publish({type:N.r1.alertError.name,payload:[k]})}},L=n?.settings.enabled,Ge=m=>{(0,F.rR)("grafana_authentication_ssosettings_save_attempt",{provider:t,enabled:m?!L:L}),m&&J("enabled",!L)};return(0,e.jsxs)(ie.Y.Contents,{isLoading:s,children:[(0,e.jsxs)("form",{onSubmit:c(Te),style:{maxWidth:"600px"},children:[(0,e.jsx)(ce,{confirmRedirect:!!Object.keys(j).length&&!te,onDiscard:()=>{(0,F.rR)("grafana_authentication_ssosettings_abandoned",{provider:t}),f()}}),(0,e.jsx)(M.D,{label:"Enabled",hidden:!0,children:(0,e.jsx)(re.d,{...o("enabled"),id:"enabled",label:"Enabled"})}),(0,e.jsx)(g.B,{gap:2,direction:"column",children:ae.filter(m=>!m.hidden).map((m,k)=>(0,e.jsx)(be.M,{label:m.name,isOpen:k===0,children:m.fields.filter(A=>typeof A!="string"?!A.hidden:!0).map(A=>(0,e.jsx)(v,{field:A,control:h,errors:ee,setValue:J,register:o,watch:y,unregister:_,provider:t,secretConfigured:!!n?.settings.clientSecret},typeof A=="string"?A:A.name))},m.name))}),(0,e.jsx)(Q.a,{display:"flex",gap:2,marginTop:5,children:(0,e.jsxs)(g.B,{alignItems:"center",gap:2,children:[(0,e.jsx)(V.$n,{type:"submit",disabled:b,onClick:()=>Ge(!0),variant:L?"secondary":void 0,children:b?L?"Disabling...":"Saving...":L?"Disable":"Save and enable"}),(0,e.jsx)(V.$n,{type:"submit",disabled:b,variant:"secondary",onClick:()=>Ge(!1),children:b?"Saving...":"Save"}),(0,e.jsx)(V.z9,{href:"/admin/authentication",variant:"secondary",children:"Discard"}),(0,e.jsx)(xe.m,{overlay:ne,placement:"bottom-start",children:(0,e.jsx)(Ue.K,{tooltip:"More actions",title:"More actions",tooltipPlacement:"top",size:"md",variant:"secondary",name:"ellipsis-v",hidden:n?.source==="system"})})]})})]}),je&&(0,e.jsx)(De.u,{isOpen:!0,icon:"trash-alt",title:"Reset",body:(0,e.jsxs)(g.B,{direction:"column",gap:3,children:[(0,e.jsx)("span",{children:"Are you sure you want to reset this configuration?"}),(0,e.jsx)("small",{children:"After resetting these settings Grafana will use the provider configuration from the system (config file/environment variables) if any."})]}),confirmText:"Reset",onDismiss:()=>T(!1),onConfirm:async()=>{await ye(),T(!1)}})]})};var E=a(7250),Re=a(60610);const Ee=n=>{if(!n)return{text:"Authentication",subTitle:"Configure authentication providers",icon:"shield",id:"authentication"};const t=E.L[n.provider][1]||n.provider.toUpperCase();return{text:t||"",subTitle:`To configure ${t} OAuth2 you must register your application with ${t}. The provider will generate a Client ID and Client Secret for you to use.`,icon:n.settings.icon||"shield",id:n.provider}};function Le(n,t){const{isLoading:s,providers:o}=n.authConfig,{provider:c}=t.match.params;return{config:o.find(f=>f.provider===c),isLoading:s,provider:c}}const ke={loadProviders:Re.TD},Ne=(0,w.connect)(Le,ke),Oe=({config:n,loadProviders:t,isLoading:s,provider:o})=>{const c=Ee(n);return(0,u.useEffect)(()=>{t(o)},[t,o]),n?(0,e.jsx)(ie.Y,{navId:"authentication",pageNav:c,renderTitle:h=>(0,e.jsxs)(g.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(W.E,{variant:"h1",children:h}),(0,e.jsx)(Z.E,{text:n.settings.enabled?"Enabled":"Not enabled",color:n.settings.enabled?"green":"blue",icon:n.settings.enabled?"check":void 0})]}),children:(0,e.jsx)(d,{config:n,isLoading:s,provider:o})}):null},Fe=Ne(Oe)},7250:(se,S,a)=>{a.d(S,{L:()=>u,o:()=>e});const e="admin/authentication/",u={github:["github","GitHub"],gitlab:["gitlab","GitLab"],google:["google","Google"],generic_oauth:["lock","Generic OAuth"],grafana_com:["grafana","Grafana.com"],azuread:["microsoft","Azure AD"],okta:["okta","Okta"]}},5328:(se,S,a)=>{a.d(S,{K:()=>w,h:()=>u});var e=a(7250);function u(g){return e.o+(g.configPath||g.id)}const w=g=>{if(typeof g!="string")return!1;try{return new URL(g).protocol.includes("http")}catch{return!1}}},8227:(se,S,a)=>{a.d(S,{A:()=>w});const e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function u(g){return typeof g=="string"&&e.test(g)}const w=u}}]);

//# sourceMappingURL=AdminAuthentication.04d4fed27c9cbd1e7781.js.map