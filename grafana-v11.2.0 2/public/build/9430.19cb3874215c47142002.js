(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9430],{35931:(qe,De,c)=>{"use strict";c.d(De,{H:()=>o});var R=c(32196),Pe=c(96540),I=c(40845);function o(ne){const{description:i,suffix:ue,feature:j}=ne,ee=`Learn more about ${j}`,de=(0,I.of)(h);return Pe.createElement("span",{className:de.container},i,Pe.createElement("a",{"aria-label":ee,href:`https://grafana.com/docs/grafana/next/datasources/${ue}`,rel:"noreferrer",target:"_blank"},ee))}const h=ne=>({container:(0,R.css)({color:ne.colors.text.secondary,a:(0,R.css)({color:ne.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},6191:(qe,De,c)=>{"use strict";c.d(De,{X:()=>o});var R=c(32196),Pe=c(96540),I=c(40845);const o=({children:ne})=>{const i=(0,I.of)(h);return Pe.createElement("div",{className:i.root},ne)},h=ne=>({root:(0,R.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:ne.spacing(3),minHeight:ne.spacing(4)})})},31347:(qe,De,c)=>{"use strict";c.d(De,{Z:()=>Pe});var R=c(96540);const Pe=({grow:I,shrink:o})=>R.createElement("div",{style:{display:"block",flexGrow:I,flexShrink:o}})},42952:(qe,De,c)=>{"use strict";c.d(De,{T:()=>Pe,f:()=>R});var R=(I=>(I.Code="code",I.Builder="builder",I))(R||{});const Pe="Binary operations"},60016:(qe,De,c)=>{"use strict";c.d(De,{BI:()=>w,TO:()=>we,iB:()=>pe,kl:()=>je,wU:()=>be});var R=c(74848),Pe=c(2543),I=c.n(Pe),o=c(96540),h=c(32264),ne=c(67061),i=c(38894),ue=c(94354),j=c(14186),ee=c(10354),de=c(90182),$=c(56587),ve=c(13137);const we=[{value:ve.U3.Range,label:"Range",description:"Run query over a range of time."},{value:ve.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}],w=[{value:ve.ti.Backward,label:"Backward",description:"Search in backward direction."},{value:ve.ti.Forward,label:"Forward",description:"Search in forward direction."}];h.$.featureToggles.lokiExperimentalStreaming&&we.push({value:ve.U3.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const pe=[{value:1,label:"1/1"}].concat((0,Pe.map)([2,3,4,5,10],ce=>({value:ce,label:"1/"+ce})));function je(ce){const{lineLimitValue:he,resolution:oe,onRunQuery:xe,runOnBlur:ye,onChange:V}=ce,$e=ce.query??{},Fe=(0,$.Io)($e);function Ve(Q){const F={...$e,maxLines:be(Q)};V(F)}function A(Q){const{instant:F,range:_,...B}=$e;V({...B,queryType:Q})}function N(Q){$e.maxLines!==be(Q.currentTarget.value)&&Ve(Q.currentTarget.value)}function te(Q){Q.key==="Enter"&&xe()}function se(Q){const F={...$e,resolution:Q.value};V(F)}return(0,R.jsxs)(ne.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field",children:[(0,R.jsxs)(ne.B,{wrap:"nowrap",gap:0,"data-testid":"queryTypeField","aria-label":"Query type field",children:[(0,R.jsx)(i.I,{width:"auto",children:"Query type"}),(0,R.jsx)(ue.z,{options:we,value:Fe,onChange:Q=>{A(Q),ye&&xe()}})]}),(0,R.jsxs)(ne.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field",children:[(0,R.jsx)(j.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query.",children:(0,R.jsx)(ee.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:N,onKeyDown:te,value:he,onBlur:()=>{ye&&xe()}})}),(0,R.jsx)(j.I,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels.",children:(0,R.jsx)(de.l6,{isSearchable:!1,onChange:se,options:pe,value:oe,"aria-label":"Select resolution"})})]})]})}var Oe=(0,o.memo)(je);function be(ce){const he=parseInt(ce,10);if(!(isNaN(he)||he<0))return he}},95881:(qe,De,c)=>{"use strict";c.d(De,{W:()=>i});var R=c(74848),Pe=c(96540),I=c(97535);const o=(0,Pe.lazy)(()=>c.e(1952).then(c.bind(c,51639))),h=ue=>(0,R.jsx)(Pe.Suspense,{fallback:null,children:(0,R.jsx)(o,{...ue})}),ne=ue=>{const j=(0,Pe.useRef)(null),{onRunQuery:ee,onChange:de,...$}=ue,ve=w=>{j.current=w,de(w),ee()},we=w=>{de(w)};return(0,R.jsx)(h,{onRunQuery:ve,onBlur:we,onChange:de,...$})};class i extends Pe.PureComponent{constructor(j){super(j),this._isMounted=!1,this.onChangeQuery=(ee,de)=>{const{query:$,onChange:ve,onRunQuery:we}=this.props;if(ve){const w={...$,expr:ee};ve(w),de&&we&&we()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(j){const{range:ee,datasource:{languageProvider:de}}=this.props;(0,I.WV)(ee,j.range)&&de.fetchLabels({timeRange:ee})}render(){const{ExtraFieldElement:j,query:ee,datasource:de,history:$,onRunQuery:ve,range:we}=this.props,w=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"],children:(0,R.jsx)("div",{className:"gf-form--grow flex-shrink-1 min-width-15",children:(0,R.jsx)(ne,{datasource:de,history:$??[],onChange:this.onChangeQuery,onRunQuery:ve,initialValue:ee.expr??"",placeholder:w,timeRange:we})})}),j]})}}},20065:(qe,De,c)=>{"use strict";c.d(De,{B:()=>Pe,a:()=>ne});var R=c(56245);function Pe(i,ue,j,ee){if(!i)return!1;const de=I(ue,ee);if(!de.length)return!1;let $=de;if(i!==ue){const ve=I(i,ee);$=de.flatMap(we=>ve.filter(w=>we.text===w.text)||we)}return $.map(ve=>o(i,j,ve)).filter(h)}function I(i,ue){const j=[];return ue.parse(i).iterate({enter:de=>{if(de.type.id===R.Ql){const $=de.node;j.push({node:$,text:i.substring($.from,$.to)})}}}),j}function o(i,ue,j){if(ue.length===1){const $=j.node.from===j.node.to,ve=$&&j.node.parent?j.node.parent:j.node,we=$?i.substring(ve.from,ve.to):j.text;return{startLineNumber:1,startColumn:ve.from+1,endLineNumber:1,endColumn:ve.to+1,error:we}}let ee=0,de=0;for(let $=0;$<ue.length;$++){if(de=ee+ue[$].length,j.node.from>de){ee+=ue[$].length+1;continue}return{startLineNumber:$+1,startColumn:j.node.from-ee+1,endLineNumber:$+1,endColumn:j.node.to-ee+1,error:j.text}}return null}function h(i){return i!==null}const ne={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},27724:(qe,De,c)=>{"use strict";c.d(De,{we:()=>pt,VQ:()=>Ya,lb:()=>Zt,Gf:()=>Ur,M1:()=>Br,ow:()=>La,mL:()=>Pa,In:()=>br});var R=c(2543),Pe=c(13288),I=c(44240),o=c(62467),h=c(75505),ne=c(81160),i=c(66847),ue=c(59099),j=c(63720),ee=c(65879),de=c(39070),$=c(9557),ve=c(76885),we=c(41987),w=c(78368),Le=c(43659),pe=c(36195),je=c(26657),Oe=c(72574),be=c(32264);const ce=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,he=new Set,oe=typeof process=="object"&&process?process:{},xe=(v,a,r,s)=>{typeof oe.emitWarning=="function"?oe.emitWarning(v,a,r,s):console.error(`[${r}] ${a}: ${v}`)};let ye=globalThis.AbortController,V=globalThis.AbortSignal;if(typeof ye>"u"){V=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,l){this._onabort.push(l)}},ye=class{constructor(){a()}signal=new V;abort(s){if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const l of this.signal._onabort)l(s);this.signal.onabort?.(s)}}};let v=oe.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const a=()=>{v&&(v=!1,xe("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",a))}}const $e=v=>!he.has(v),Fe=Symbol("type"),Ve=v=>v&&v===Math.floor(v)&&v>0&&isFinite(v),A=v=>Ve(v)?v<=Math.pow(2,8)?Uint8Array:v<=Math.pow(2,16)?Uint16Array:v<=Math.pow(2,32)?Uint32Array:v<=Number.MAX_SAFE_INTEGER?N:null:null;class N extends Array{constructor(a){super(a),this.fill(0)}}class te{heap;length;static#l=!1;static create(a){const r=A(a);if(!r)return[];te.#l=!0;const s=new te(a,r);return te.#l=!1,s}constructor(a,r){if(!te.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new r(a),this.length=0}push(a){this.heap[this.length++]=a}pop(){return this.heap[--this.length]}}class se{#l;#d;#g;#m;#w;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#v;#a;#r;#e;#c;#f;#o;#s;#O;#i;#y;#b;#p;#x;#S;#u;static unsafeExposeInternals(a){return{starts:a.#b,ttls:a.#p,sizes:a.#y,keyMap:a.#a,keyList:a.#r,valList:a.#e,next:a.#c,prev:a.#f,get head(){return a.#o},get tail(){return a.#s},free:a.#O,isBackgroundFetch:r=>a.#t(r),backgroundFetch:(r,s,l,d)=>a.#C(r,s,l,d),moveToTail:r=>a.#R(r),indexes:r=>a.#E(r),rindexes:r=>a.#P(r),isStale:r=>a.#h(r)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#v}get size(){return this.#n}get fetchMethod(){return this.#w}get dispose(){return this.#g}get disposeAfter(){return this.#m}constructor(a){const{max:r=0,ttl:s,ttlResolution:l=1,ttlAutopurge:d,updateAgeOnGet:m,updateAgeOnHas:x,allowStale:P,dispose:M,disposeAfter:H,noDisposeOnSet:K,noUpdateTTL:J,maxSize:q=0,maxEntrySize:Te=0,sizeCalculation:Se,fetchMethod:We,noDeleteOnFetchRejection:Qe,noDeleteOnStaleGet:ze,allowStaleOnFetchRejection:Ke,allowStaleOnFetchAbort:ke,ignoreFetchAbort:et}=a;if(r!==0&&!Ve(r))throw new TypeError("max option must be a nonnegative integer");const $t=r?A(r):Array;if(!$t)throw new Error("invalid max value: "+r);if(this.#l=r,this.#d=q,this.maxEntrySize=Te||this.#d,this.sizeCalculation=Se,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(We!==void 0&&typeof We!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#w=We,this.#S=!!We,this.#a=new Map,this.#r=new Array(r).fill(void 0),this.#e=new Array(r).fill(void 0),this.#c=new $t(r),this.#f=new $t(r),this.#o=0,this.#s=0,this.#O=te.create(r),this.#n=0,this.#v=0,typeof M=="function"&&(this.#g=M),typeof H=="function"?(this.#m=H,this.#i=[]):(this.#m=void 0,this.#i=void 0),this.#x=!!this.#g,this.#u=!!this.#m,this.noDisposeOnSet=!!K,this.noUpdateTTL=!!J,this.noDeleteOnFetchRejection=!!Qe,this.allowStaleOnFetchRejection=!!Ke,this.allowStaleOnFetchAbort=!!ke,this.ignoreFetchAbort=!!et,this.maxEntrySize!==0){if(this.#d!==0&&!Ve(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!Ve(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#N()}if(this.allowStale=!!P,this.noDeleteOnStaleGet=!!ze,this.updateAgeOnGet=!!m,this.updateAgeOnHas=!!x,this.ttlResolution=Ve(l)||l===0?l:1,this.ttlAutopurge=!!d,this.ttl=s||0,this.ttl){if(!Ve(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#A()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const Qt="LRU_CACHE_UNBOUNDED";$e(Qt)&&(he.add(Qt),xe("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Qt,se))}}getRemainingTTL(a){return this.#a.has(a)?1/0:0}#A(){const a=new N(this.#l),r=new N(this.#l);this.#p=a,this.#b=r,this.#D=(d,m,x=ce.now())=>{if(r[d]=m!==0?x:0,a[d]=m,m!==0&&this.ttlAutopurge){const P=setTimeout(()=>{this.#h(d)&&this.delete(this.#r[d])},m+1);P.unref&&P.unref()}},this.#$=d=>{r[d]=a[d]!==0?ce.now():0},this.#L=(d,m)=>{if(a[m]){const x=a[m],P=r[m];if(!x||!P)return;d.ttl=x,d.start=P,d.now=s||l();const M=d.now-P;d.remainingTTL=x-M}};let s=0;const l=()=>{const d=ce.now();if(this.ttlResolution>0){s=d;const m=setTimeout(()=>s=0,this.ttlResolution);m.unref&&m.unref()}return d};this.getRemainingTTL=d=>{const m=this.#a.get(d);if(m===void 0)return 0;const x=a[m],P=r[m];if(!x||!P)return 1/0;const M=(s||l())-P;return x-M},this.#h=d=>{const m=r[d],x=a[d];return!!x&&!!m&&(s||l())-m>x}}#$=()=>{};#L=()=>{};#D=()=>{};#h=()=>!1;#N(){const a=new N(this.#l);this.#v=0,this.#y=a,this.#Q=r=>{this.#v-=a[r],a[r]=0},this.#j=(r,s,l,d)=>{if(this.#t(s))return 0;if(!Ve(l))if(d){if(typeof d!="function")throw new TypeError("sizeCalculation must be a function");if(l=d(s,r),!Ve(l))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return l},this.#T=(r,s,l)=>{if(a[r]=s,this.#d){const d=this.#d-a[r];for(;this.#v>d;)this.#F(!0)}this.#v+=a[r],l&&(l.entrySize=s,l.totalCalculatedSize=this.#v)}}#Q=a=>{};#T=(a,r,s)=>{};#j=(a,r,s,l)=>{if(s||l)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#E({allowStale:a=this.allowStale}={}){if(this.#n)for(let r=this.#s;!(!this.#M(r)||((a||!this.#h(r))&&(yield r),r===this.#o));)r=this.#f[r]}*#P({allowStale:a=this.allowStale}={}){if(this.#n)for(let r=this.#o;!(!this.#M(r)||((a||!this.#h(r))&&(yield r),r===this.#s));)r=this.#c[r]}#M(a){return a!==void 0&&this.#a.get(this.#r[a])===a}*entries(){for(const a of this.#E())this.#e[a]!==void 0&&this.#r[a]!==void 0&&!this.#t(this.#e[a])&&(yield[this.#r[a],this.#e[a]])}*rentries(){for(const a of this.#P())this.#e[a]!==void 0&&this.#r[a]!==void 0&&!this.#t(this.#e[a])&&(yield[this.#r[a],this.#e[a]])}*keys(){for(const a of this.#E()){const r=this.#r[a];r!==void 0&&!this.#t(this.#e[a])&&(yield r)}}*rkeys(){for(const a of this.#P()){const r=this.#r[a];r!==void 0&&!this.#t(this.#e[a])&&(yield r)}}*values(){for(const a of this.#E())this.#e[a]!==void 0&&!this.#t(this.#e[a])&&(yield this.#e[a])}*rvalues(){for(const a of this.#P())this.#e[a]!==void 0&&!this.#t(this.#e[a])&&(yield this.#e[a])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(a,r={}){for(const s of this.#E()){const l=this.#e[s],d=this.#t(l)?l.__staleWhileFetching:l;if(d!==void 0&&a(d,this.#r[s],this))return this.get(this.#r[s],r)}}forEach(a,r=this){for(const s of this.#E()){const l=this.#e[s],d=this.#t(l)?l.__staleWhileFetching:l;d!==void 0&&a.call(r,d,this.#r[s],this)}}rforEach(a,r=this){for(const s of this.#P()){const l=this.#e[s],d=this.#t(l)?l.__staleWhileFetching:l;d!==void 0&&a.call(r,d,this.#r[s],this)}}purgeStale(){let a=!1;for(const r of this.#P({allowStale:!0}))this.#h(r)&&(this.delete(this.#r[r]),a=!0);return a}info(a){const r=this.#a.get(a);if(r===void 0)return;const s=this.#e[r],l=this.#t(s)?s.__staleWhileFetching:s;if(l===void 0)return;const d={value:l};if(this.#p&&this.#b){const m=this.#p[r],x=this.#b[r];if(m&&x){const P=m-(ce.now()-x);d.ttl=P,d.start=Date.now()}}return this.#y&&(d.size=this.#y[r]),d}dump(){const a=[];for(const r of this.#E({allowStale:!0})){const s=this.#r[r],l=this.#e[r],d=this.#t(l)?l.__staleWhileFetching:l;if(d===void 0||s===void 0)continue;const m={value:d};if(this.#p&&this.#b){m.ttl=this.#p[r];const x=ce.now()-this.#b[r];m.start=Math.floor(Date.now()-x)}this.#y&&(m.size=this.#y[r]),a.unshift([s,m])}return a}load(a){this.clear();for(const[r,s]of a){if(s.start){const l=Date.now()-s.start;s.start=ce.now()-l}this.set(r,s.value,s)}}set(a,r,s={}){if(r===void 0)return this.delete(a),this;const{ttl:l=this.ttl,start:d,noDisposeOnSet:m=this.noDisposeOnSet,sizeCalculation:x=this.sizeCalculation,status:P}=s;let{noUpdateTTL:M=this.noUpdateTTL}=s;const H=this.#j(a,r,s.size||0,x);if(this.maxEntrySize&&H>this.maxEntrySize)return P&&(P.set="miss",P.maxEntrySizeExceeded=!0),this.delete(a),this;let K=this.#n===0?void 0:this.#a.get(a);if(K===void 0)K=this.#n===0?this.#s:this.#O.length!==0?this.#O.pop():this.#n===this.#l?this.#F(!1):this.#n,this.#r[K]=a,this.#e[K]=r,this.#a.set(a,K),this.#c[this.#s]=K,this.#f[K]=this.#s,this.#s=K,this.#n++,this.#T(K,H,P),P&&(P.set="add"),M=!1;else{this.#R(K);const J=this.#e[K];if(r!==J){if(this.#S&&this.#t(J)){J.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:q}=J;q!==void 0&&!m&&(this.#x&&this.#g?.(q,a,"set"),this.#u&&this.#i?.push([q,a,"set"]))}else m||(this.#x&&this.#g?.(J,a,"set"),this.#u&&this.#i?.push([J,a,"set"]));if(this.#Q(K),this.#T(K,H,P),this.#e[K]=r,P){P.set="replace";const q=J&&this.#t(J)?J.__staleWhileFetching:J;q!==void 0&&(P.oldValue=q)}}else P&&(P.set="update")}if(l!==0&&!this.#p&&this.#A(),this.#p&&(M||this.#D(K,l,d),P&&this.#L(P,K)),!m&&this.#u&&this.#i){const J=this.#i;let q;for(;q=J?.shift();)this.#m?.(...q)}return this}pop(){try{for(;this.#n;){const a=this.#e[this.#o];if(this.#F(!0),this.#t(a)){if(a.__staleWhileFetching)return a.__staleWhileFetching}else if(a!==void 0)return a}}finally{if(this.#u&&this.#i){const a=this.#i;let r;for(;r=a?.shift();)this.#m?.(...r)}}}#F(a){const r=this.#o,s=this.#r[r],l=this.#e[r];return this.#S&&this.#t(l)?l.__abortController.abort(new Error("evicted")):(this.#x||this.#u)&&(this.#x&&this.#g?.(l,s,"evict"),this.#u&&this.#i?.push([l,s,"evict"])),this.#Q(r),a&&(this.#r[r]=void 0,this.#e[r]=void 0,this.#O.push(r)),this.#n===1?(this.#o=this.#s=0,this.#O.length=0):this.#o=this.#c[r],this.#a.delete(s),this.#n--,r}has(a,r={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:l}=r,d=this.#a.get(a);if(d!==void 0){const m=this.#e[d];if(this.#t(m)&&m.__staleWhileFetching===void 0)return!1;if(this.#h(d))l&&(l.has="stale",this.#L(l,d));else return s&&this.#$(d),l&&(l.has="hit",this.#L(l,d)),!0}else l&&(l.has="miss");return!1}peek(a,r={}){const{allowStale:s=this.allowStale}=r,l=this.#a.get(a);if(l===void 0||!s&&this.#h(l))return;const d=this.#e[l];return this.#t(d)?d.__staleWhileFetching:d}#C(a,r,s,l){const d=r===void 0?void 0:this.#e[r];if(this.#t(d))return d;const m=new ye,{signal:x}=s;x?.addEventListener("abort",()=>m.abort(x.reason),{signal:m.signal});const P={signal:m.signal,options:s,context:l},M=(Se,We=!1)=>{const{aborted:Qe}=m.signal,ze=s.ignoreFetchAbort&&Se!==void 0;if(s.status&&(Qe&&!We?(s.status.fetchAborted=!0,s.status.fetchError=m.signal.reason,ze&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),Qe&&!ze&&!We)return K(m.signal.reason);const Ke=q;return this.#e[r]===q&&(Se===void 0?Ke.__staleWhileFetching?this.#e[r]=Ke.__staleWhileFetching:this.delete(a):(s.status&&(s.status.fetchUpdated=!0),this.set(a,Se,P.options))),Se},H=Se=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=Se),K(Se)),K=Se=>{const{aborted:We}=m.signal,Qe=We&&s.allowStaleOnFetchAbort,ze=Qe||s.allowStaleOnFetchRejection,Ke=ze||s.noDeleteOnFetchRejection,ke=q;if(this.#e[r]===q&&(!Ke||ke.__staleWhileFetching===void 0?this.delete(a):Qe||(this.#e[r]=ke.__staleWhileFetching)),ze)return s.status&&ke.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),ke.__staleWhileFetching;if(ke.__returned===ke)throw Se},J=(Se,We)=>{const Qe=this.#w?.(a,d,P);Qe&&Qe instanceof Promise&&Qe.then(ze=>Se(ze===void 0?void 0:ze),We),m.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(Se(void 0),s.allowStaleOnFetchAbort&&(Se=ze=>M(ze,!0)))})};s.status&&(s.status.fetchDispatched=!0);const q=new Promise(J).then(M,H),Te=Object.assign(q,{__abortController:m,__staleWhileFetching:d,__returned:void 0});return r===void 0?(this.set(a,Te,{...P.options,status:void 0}),r=this.#a.get(a)):this.#e[r]=Te,Te}#t(a){if(!this.#S)return!1;const r=a;return!!r&&r instanceof Promise&&r.hasOwnProperty("__staleWhileFetching")&&r.__abortController instanceof ye}async fetch(a,r={}){const{allowStale:s=this.allowStale,updateAgeOnGet:l=this.updateAgeOnGet,noDeleteOnStaleGet:d=this.noDeleteOnStaleGet,ttl:m=this.ttl,noDisposeOnSet:x=this.noDisposeOnSet,size:P=0,sizeCalculation:M=this.sizeCalculation,noUpdateTTL:H=this.noUpdateTTL,noDeleteOnFetchRejection:K=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:J=this.allowStaleOnFetchRejection,ignoreFetchAbort:q=this.ignoreFetchAbort,allowStaleOnFetchAbort:Te=this.allowStaleOnFetchAbort,context:Se,forceRefresh:We=!1,status:Qe,signal:ze}=r;if(!this.#S)return Qe&&(Qe.fetch="get"),this.get(a,{allowStale:s,updateAgeOnGet:l,noDeleteOnStaleGet:d,status:Qe});const Ke={allowStale:s,updateAgeOnGet:l,noDeleteOnStaleGet:d,ttl:m,noDisposeOnSet:x,size:P,sizeCalculation:M,noUpdateTTL:H,noDeleteOnFetchRejection:K,allowStaleOnFetchRejection:J,allowStaleOnFetchAbort:Te,ignoreFetchAbort:q,status:Qe,signal:ze};let ke=this.#a.get(a);if(ke===void 0){Qe&&(Qe.fetch="miss");const et=this.#C(a,ke,Ke,Se);return et.__returned=et}else{const et=this.#e[ke];if(this.#t(et)){const lr=s&&et.__staleWhileFetching!==void 0;return Qe&&(Qe.fetch="inflight",lr&&(Qe.returnedStale=!0)),lr?et.__staleWhileFetching:et.__returned=et}const $t=this.#h(ke);if(!We&&!$t)return Qe&&(Qe.fetch="hit"),this.#R(ke),l&&this.#$(ke),Qe&&this.#L(Qe,ke),et;const Qt=this.#C(a,ke,Ke,Se),Bt=Qt.__staleWhileFetching!==void 0&&s;return Qe&&(Qe.fetch=$t?"stale":"refresh",Bt&&$t&&(Qe.returnedStale=!0)),Bt?Qt.__staleWhileFetching:Qt.__returned=Qt}}get(a,r={}){const{allowStale:s=this.allowStale,updateAgeOnGet:l=this.updateAgeOnGet,noDeleteOnStaleGet:d=this.noDeleteOnStaleGet,status:m}=r,x=this.#a.get(a);if(x!==void 0){const P=this.#e[x],M=this.#t(P);return m&&this.#L(m,x),this.#h(x)?(m&&(m.get="stale"),M?(m&&s&&P.__staleWhileFetching!==void 0&&(m.returnedStale=!0),s?P.__staleWhileFetching:void 0):(d||this.delete(a),m&&s&&(m.returnedStale=!0),s?P:void 0)):(m&&(m.get="hit"),M?P.__staleWhileFetching:(this.#R(x),l&&this.#$(x),P))}else m&&(m.get="miss")}#I(a,r){this.#f[r]=a,this.#c[a]=r}#R(a){a!==this.#s&&(a===this.#o?this.#o=this.#c[a]:this.#I(this.#f[a],this.#c[a]),this.#I(this.#s,a),this.#s=a)}delete(a){let r=!1;if(this.#n!==0){const s=this.#a.get(a);if(s!==void 0)if(r=!0,this.#n===1)this.clear();else{this.#Q(s);const l=this.#e[s];if(this.#t(l)?l.__abortController.abort(new Error("deleted")):(this.#x||this.#u)&&(this.#x&&this.#g?.(l,a,"delete"),this.#u&&this.#i?.push([l,a,"delete"])),this.#a.delete(a),this.#r[s]=void 0,this.#e[s]=void 0,s===this.#s)this.#s=this.#f[s];else if(s===this.#o)this.#o=this.#c[s];else{const d=this.#f[s];this.#c[d]=this.#c[s];const m=this.#c[s];this.#f[m]=this.#f[s]}this.#n--,this.#O.push(s)}}if(this.#u&&this.#i?.length){const s=this.#i;let l;for(;l=s?.shift();)this.#m?.(...l)}return r}clear(){for(const a of this.#P({allowStale:!0})){const r=this.#e[a];if(this.#t(r))r.__abortController.abort(new Error("deleted"));else{const s=this.#r[a];this.#x&&this.#g?.(r,s,"delete"),this.#u&&this.#i?.push([r,s,"delete"])}}if(this.#a.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#p&&this.#b&&(this.#p.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#o=0,this.#s=0,this.#O.length=0,this.#v=0,this.#n=0,this.#u&&this.#i){const a=this.#i;let r;for(;r=a?.shift();)this.#m?.(...r)}}}var Q=c(40187),F=c(43127),_=c(97535),B=c(56587),Me=c(60706),g=c(75723),b=c(13137);const S=1e6,T="{}";class U extends Q.Is{constructor(a,r){super(),this.started=!1,this.seriesCache=new se({max:10}),this.labelsCache=new se({max:10}),this.request=async(s,l)=>{try{return await this.datasource.metadataRequest(s,l)}catch(d){console.error(d)}},this.start=s=>{const l=s??this.getDefaultTimeRange();return(!this.startTask||this.startedTimeRange?.from.isSame(l.from)===!1||this.startedTimeRange?.to.isSame(l.to)===!1)&&(this.startedTimeRange=l,this.startTask=this.fetchLabels({timeRange:l}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(s,l)=>{const d=this.datasource.interpolateString(s),m="series",x=l?.timeRange??this.getDefaultTimeRange(),{start:P,end:M}=this.datasource.getTimeRangeParams(x),H=this.generateCacheKey(m,P,M,d);let K=this.seriesCache.get(H);if(!K){const J={"match[]":d,start:P,end:M},q=await this.request(m,J);if(!Array.isArray(q))return{};const{values:Te}=(0,_.P7)(q);K=Te,this.seriesCache.set(H,K)}return K},this.fetchSeries=async(s,l)=>{const d="series",m=l?.timeRange??this.getDefaultTimeRange(),{start:x,end:P}=this.datasource.getTimeRangeParams(m),M={"match[]":s,start:x,end:P};return await this.request(d,M)},this.datasource=a,this.labelKeys=[],Object.assign(this,r)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(a){return{refId:a.refId,expr:(0,_.tt)(a),queryType:b.U3.Range}}exportToAbstractQuery(a){if(!a.expr||a.expr.length===0)return{refId:a.refId,labelMatchers:[]};const s=(0,B.pk)(a.expr).map(l=>(0,Me.u_)(l).query.labels.map(x=>({name:x.label,value:x.value,operator:_.sM[x.op]})));return{refId:a.refId,labelMatchers:(0,R.flatten)(s)}}async fetchLabels(a){if(!a||!a.streamSelector)return this.fetchLabelsByLabelsEndpoint(a);{const r=await this.fetchSeriesLabels(a.streamSelector,{timeRange:a.timeRange});return Object.keys(r??{})}}async fetchLabelsByLabelsEndpoint(a){const r="labels",s=a?.timeRange??this.getDefaultTimeRange(),l=this.datasource.getTimeRangeParams(s),d=await this.request(r,l);if(Array.isArray(d)){const m=d.slice().sort().filter(x=>x!=="__name__");return this.labelKeys=m,this.labelKeys}return[]}generateCacheKey(a,r,s,l){return[a,this.roundTime(r),this.roundTime(s),l].join()}roundTime(a){return a?Math.floor(a/S/1e3/60/5):0}async fetchLabelValues(a,r){const s=encodeURIComponent(this.datasource.interpolateString(a)),l=r?.streamSelector&&r.streamSelector!==T?this.datasource.interpolateString(r.streamSelector):void 0,d=`label/${s}/values`,m=r?.timeRange??this.getDefaultTimeRange(),x=this.datasource.getTimeRangeParams(m),{start:P,end:M}=x,H={start:P,end:M};let K=s;l&&(H.query=l,K+=l);const J=this.generateCacheKey(d,P,M,K);let q=this.labelsCache.get(J);if(!q){this.labelsCache.set(J,[]);const Te=await this.request(d,H);Array.isArray(Te)&&(q=Te.slice().sort(),this.labelsCache.set(J,q))}return q??[]}async getParserAndLabelKeys(a,r){const s={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};if(!be.$.featureToggles.lokiQueryHints)return s;const l=await this.datasource.getDataSamples({expr:a,refId:"data-samples",maxLines:r?.maxLines||pt},r?.timeRange??this.getDefaultTimeRange());if(!l.length)return s;const{hasLogfmt:d,hasJSON:m,hasPack:x}=(0,g.YB)(l[0]);return{extractedLabelKeys:[...(0,g.fV)(l[0],b.HD.Indexed),...(0,g.fV)(l[0],b.HD.Parsed)],structuredMetadataKeys:(0,g.fV)(l[0],b.HD.StructuredMetadata),unwrapLabelKeys:(0,g.aN)(l[0]),hasJSON:m,hasPack:x,hasLogfmt:d}}getDefaultTimeRange(){return(0,F.E2)()}}var G=c(39697),fe=c(37748),ae=c(69862),Ie=c(69850),Ue=c(31635),tt=c(13752),Ot=c(75508),mt=c(88483),qt=c(64423),Rt=c(39741),dr={url:"",deserializer:function(v){return JSON.parse(v.data)},serializer:function(v){return JSON.stringify(v)}},Dt="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",$r=function(v){(0,Ue.__extends)(a,v);function a(r,s){var l=v.call(this)||this;if(l._socket=null,r instanceof mt.c)l.destination=s,l.source=r;else{var d=l._config=(0,Ue.__assign)({},dr);if(l._output=new tt.B,typeof r=="string")d.url=r;else for(var m in r)r.hasOwnProperty(m)&&(d[m]=r[m]);if(!d.WebSocketCtor&&WebSocket)d.WebSocketCtor=WebSocket;else if(!d.WebSocketCtor)throw new Error("no WebSocket constructor can be found");l.destination=new Rt.m}return l}return a.prototype.lift=function(r){var s=new a(this._config,this.destination);return s.operator=r,s.source=this,s},a.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Rt.m),this._output=new tt.B},a.prototype.multiplex=function(r,s,l){var d=this;return new mt.c(function(m){try{d.next(r())}catch(P){m.error(P)}var x=d.subscribe({next:function(P){try{l(P)&&m.next(P)}catch(M){m.error(M)}},error:function(P){return m.error(P)},complete:function(){return m.complete()}});return function(){try{d.next(s())}catch(P){m.error(P)}x.unsubscribe()}})},a.prototype._connectSocket=function(){var r=this,s=this._config,l=s.WebSocketCtor,d=s.protocol,m=s.url,x=s.binaryType,P=this._output,M=null;try{M=d?new l(m,d):new l(m),this._socket=M,x&&(this._socket.binaryType=x)}catch(K){P.error(K);return}var H=new qt.yU(function(){r._socket=null,M&&M.readyState===1&&M.close()});M.onopen=function(K){var J=r._socket;if(!J){M.close(),r._resetState();return}var q=r._config.openObserver;q&&q.next(K);var Te=r.destination;r.destination=Ot.vU.create(function(Se){if(M.readyState===1)try{var We=r._config.serializer;M.send(We(Se))}catch(Qe){r.destination.error(Qe)}},function(Se){var We=r._config.closingObserver;We&&We.next(void 0),Se&&Se.code?M.close(Se.code,Se.reason):P.error(new TypeError(Dt)),r._resetState()},function(){var Se=r._config.closingObserver;Se&&Se.next(void 0),M.close(),r._resetState()}),Te&&Te instanceof Rt.m&&H.add(Te.subscribe(r.destination))},M.onerror=function(K){r._resetState(),P.error(K)},M.onclose=function(K){M===r._socket&&r._resetState();var J=r._config.closeObserver;J&&J.next(K),K.wasClean?P.complete():P.error(K)},M.onmessage=function(K){try{var J=r._config.deserializer;P.next(J(K))}catch(q){P.error(q)}}},a.prototype._subscribe=function(r){var s=this,l=this.source;return l?l.subscribe(r):(this._socket||this._connectSocket(),this._output.subscribe(r),r.add(function(){var d=s._socket;s._output.observers.length===0&&(d&&(d.readyState===1||d.readyState===0)&&d.close(),s._resetState())}),r)},a.prototype.unsubscribe=function(){var r=this._socket;r&&(r.readyState===1||r.readyState===0)&&r.close(),this._resetState(),v.prototype.unsubscribe.call(this)},a}(tt.k);function Qr(v){return new $r(v)}var $a=c(33526),rt=c(11261),wt=c(38823),Qa=c(8227);function Gr(v){if(!(0,Qa.A)(v))throw TypeError("Invalid UUID");let a;const r=new Uint8Array(16);return r[0]=(a=parseInt(v.slice(0,8),16))>>>24,r[1]=a>>>16&255,r[2]=a>>>8&255,r[3]=a&255,r[4]=(a=parseInt(v.slice(9,13),16))>>>8,r[5]=a&255,r[6]=(a=parseInt(v.slice(14,18),16))>>>8,r[7]=a&255,r[8]=(a=parseInt(v.slice(19,23),16))>>>8,r[9]=a&255,r[10]=(a=parseInt(v.slice(24,36),16))/1099511627776&255,r[11]=a/4294967296&255,r[12]=a>>>24&255,r[13]=a>>>16&255,r[14]=a>>>8&255,r[15]=a&255,r}const Zr=Gr;function Yr(v){v=unescape(encodeURIComponent(v));const a=[];for(let r=0;r<v.length;++r)a.push(v.charCodeAt(r));return a}const Jr="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Ra="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function wa(v,a,r){function s(l,d,m,x){var P;if(typeof l=="string"&&(l=Yr(l)),typeof d=="string"&&(d=Zr(d)),((P=d)===null||P===void 0?void 0:P.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let M=new Uint8Array(16+l.length);if(M.set(d),M.set(l,d.length),M=r(M),M[6]=M[6]&15|a,M[8]=M[8]&63|128,m){x=x||0;for(let H=0;H<16;++H)m[x+H]=M[H];return m}return(0,wt.k)(M)}try{s.name=v}catch{}return s.DNS=Jr,s.URL=Ra,s}function ct(v,a,r,s){switch(v){case 0:return a&r^~a&s;case 1:return a^r^s;case 2:return a&r^a&s^r&s;case 3:return a^r^s}}function Pt(v,a){return v<<a|v>>>32-a}function Ta(v){const a=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof v=="string"){const m=unescape(encodeURIComponent(v));v=[];for(let x=0;x<m.length;++x)v.push(m.charCodeAt(x))}else Array.isArray(v)||(v=Array.prototype.slice.call(v));v.push(128);const s=v.length/4+2,l=Math.ceil(s/16),d=new Array(l);for(let m=0;m<l;++m){const x=new Uint32Array(16);for(let P=0;P<16;++P)x[P]=v[m*64+P*4]<<24|v[m*64+P*4+1]<<16|v[m*64+P*4+2]<<8|v[m*64+P*4+3];d[m]=x}d[l-1][14]=(v.length-1)*8/Math.pow(2,32),d[l-1][14]=Math.floor(d[l-1][14]),d[l-1][15]=(v.length-1)*8&4294967295;for(let m=0;m<l;++m){const x=new Uint32Array(80);for(let q=0;q<16;++q)x[q]=d[m][q];for(let q=16;q<80;++q)x[q]=Pt(x[q-3]^x[q-8]^x[q-14]^x[q-16],1);let P=r[0],M=r[1],H=r[2],K=r[3],J=r[4];for(let q=0;q<80;++q){const Te=Math.floor(q/20),Se=Pt(P,5)+ct(Te,M,H,K)+J+a[Te]+x[q]>>>0;J=K,K=H,H=Pt(M,30)>>>0,M=P,P=Se}r[0]=r[0]+P>>>0,r[1]=r[1]+M>>>0,r[2]=r[2]+H>>>0,r[3]=r[3]+K>>>0,r[4]=r[4]+J>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}const ea=wa("v5",80,Ta),Fa="6ec946da-0f49-47a8-983a-1d76d17e7c92";function ta(v,a){const r=v.streams;if(!r||!r.length)return;const s=a.fields[0],l=a.fields[1],d=a.fields[2],m={};for(const x of r){const P=Object.entries(x.stream).map(([M,H])=>`${M}="${H}"`).sort().join("");for(const[M,H]of x.values)s.values.push(new Date(parseInt(M.slice(0,-6),10)).toISOString()),l.values.push(H),d.values.push(Mt(M,P,H,m,a.refId))}}function Mt(v,a,r,s,l){let d=ea(`${v}_${a}_${r}`,Fa);if(d in s){const m=s[d]+1;s[d]=m,d=`${d}_${m}`}else s[d]=0;return l?`${l}_${d}`:d}class It{constructor(){this.streams={}}getStream(a,r=5e3){let s=this.streams[a.url];if(s)return s;const l=new $a.x({capacity:a.size});return l.addField({name:"Time",type:rt.PU.time,config:{}}),l.addField({name:"Line",type:rt.PU.string}),l.addField({name:"id",type:rt.PU.string}),l.meta={...l.meta,preferredVisualisationType:"logs"},l.refId=a.refId,s=Qr(a.url).pipe((0,ne.T)(d=>(ta(d,l),[l])),(0,fe.l)(d=>d.pipe((0,ae.Z)((m,x)=>{const P=x+1;return m.code===1006&&P<30?(P>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${m.reason}`),(0,G.O)(r)):(0,Pe.$)(m)}))),(0,Ie.j)(()=>{delete this.streams[a.url]})),this.streams[a.url]=s,s}}var Je=c(47232),ra=c(85404),Ce=c(74848),ut=c(32196),Ye=c(96540),aa=c(16817),Rr=c(36663),na=c(92762),Lt=c(14110),wr=c(40845),er=c(42418),Wt=c(56034),Ca=c(55852),sa=c(82762),Tr=c(14578),ia=c(62930),Fr=c(60029),tr=c(90182),rr=c(39268),Nt=c(14186),Aa=c(44522),ar=c(15292),oa=c(71713);function fr(v){return{labels:(0,ut.css)`
      display: flex;
      gap: ${v.spacing(.5)};
    `,wrapper:(0,ut.css)`
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: ${v.spacing(.5)};
      position: relative;
    `,textWrapper:(0,ut.css)`
      display: flex;
      align-items: center;
    `,hidden:(0,ut.css)`
      visibility: hidden;
    `,label:(0,ut.css)`
      max-width: 100%;
      &:first-of-type {
        margin-bottom: ${v.spacing(2)};
      }
      &:not(:first-of-type) {
        margin: ${v.spacing(2)} 0;
      }
    `,rawQueryContainer:(0,ut.css)`
      text-align: start;
      line-break: anywhere;
      margin-top: -${v.spacing(.25)};
      margin-right: ${v.spacing(6)};
      min-height: ${v.spacing(4)};
    `,ui:(0,ut.css)`
      background-color: ${v.colors.background.secondary};
      padding: ${v.spacing(2)};
    `,notification:(0,ut.css)({position:"absolute",zIndex:v.zIndex.portal,top:0,right:0}),rawQuery:(0,ut.css)`
      display: inline;
    `,queryDescription:(0,ut.css)`
      margin-left: ${v.spacing(.5)};
    `,iconButton:(0,ut.css)`
      position: absolute;
      top: ${v.spacing(1)};
      right: ${v.spacing(1)};
      z-index: ${v.zIndex.navbarFixed};
    `,operationsToggle:(0,ut.css)`
      margin: ${v.spacing(1)} 0 ${v.spacing(-1)} 0;
      & > div {
        margin: 0;
        & > label {
          padding: 0;
        }
      }
    `}}const Cr="isLogContextQueryUiOpen";function Da(v){const{row:a,logContextProvider:r,updateFilter:s,onClose:l,origQuery:d,runContextQuery:m}=v,x=(0,wr.of)(fr),[P,M]=(0,Ye.useState)([]),[H,K]=(0,Ye.useState)(!1),[J,q]=(0,Ye.useState)(!1),[Te,Se]=(0,Ye.useState)(!1),[We,Qe]=(0,Ye.useState)(window.localStorage.getItem(Cr)==="true"),[ze,Ke]=(0,Ye.useState)(window.localStorage.getItem(yt)==="true"),ke=(0,Ye.useRef)(),et=(0,Ye.useRef)(!1),$t=(0,Ye.useRef)([]),Qt=(0,Ye.useMemo)(()=>!(J&&P.some(Xe=>Xe.nonIndexed===Xe.enabled)||ze&&r.queryContainsValidPipelineStages(d)),[P,ze,J,r,d]);(0,Ye.useEffect)(()=>{if(J){if(!et.current){et.current=J;return}if(P.filter(({enabled:Xe,nonIndexed:ht})=>Xe&&!ht).length===0){M($t.current);return}return $t.current=structuredClone(P),ke.current&&clearTimeout(ke.current),Se(!0),ke.current=window.setTimeout(()=>{s(P.filter(({enabled:ht})=>ht));const Xe={removedLabels:[],selectedExtractedLabels:[]};P.forEach(({enabled:ht,nonIndexed:at,label:Yt})=>{!ht&&!at&&Xe.removedLabels.push(Yt),ht&&at&&Xe.selectedExtractedLabels.push(Yt)}),window.localStorage.setItem(nt,JSON.stringify(Xe)),Se(!1)},1500),()=>{clearTimeout(ke.current)}}},[P,J]),(0,Ye.useEffect)(()=>()=>{clearTimeout(ke.current),l()},[l]),(0,aa.A)(async()=>{Se(!0);const Xe=await r.getInitContextFilters(a,d,{from:(0,Je.KQ)(a.timeEpochMs),to:(0,Je.KQ)(a.timeEpochMs),raw:{from:(0,Je.KQ)(a.timeEpochMs),to:(0,Je.KQ)(a.timeEpochMs)}});M(Xe.contextFilters),K(Xe.preservedFiltersApplied),q(!0),Se(!1)}),(0,Ye.useEffect)(()=>{H&&setTimeout(()=>{K(!1)},2e3)},[H]),(0,Ye.useEffect)(()=>((0,Lt.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:a.uid,type:"load"}),()=>{(0,Lt.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:a.uid,type:"unload"})}),[a.uid]);const Vr=P.filter(({nonIndexed:Xe})=>!Xe),Bt=Vr.filter(({enabled:Xe})=>Xe),lr=P.filter(({nonIndexed:Xe})=>Xe),ln=lr.filter(({enabled:Xe})=>Xe),_r=(0,Ye.useCallback)(Xe=>({label:`${Xe.label}="${(0,_.Bb)(Xe.value)}"`,value:Xe.label}),[]),cn=lr.length>0;let un=r.prepareExpression(P.filter(({enabled:Xe})=>Xe),d);return(0,Ce.jsxs)("div",{className:x.wrapper,children:[H&&(0,Ce.jsx)(er.F,{className:x.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),(0,Ce.jsx)(Wt.m,{content:"Revert to initial log context query.",children:(0,Ce.jsx)("div",{className:x.iconButton,children:(0,Ce.jsx)(Ca.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:Qt,onClick:Xe=>{(0,Lt.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:a.uid}),M(ht=>ht.map(at=>({...at,enabled:!at.nonIndexed}))),window.localStorage.removeItem(nt),window.localStorage.removeItem(yt),Ke(!1)}})})}),(0,Ce.jsx)(sa.S,{collapsible:!0,isOpen:We,onToggle:()=>{window.localStorage.setItem(Cr,(!We).toString()),Qe(Xe=>!Xe),(0,Lt.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:a.uid,action:We?"close":"open"})},label:(0,Ce.jsx)("div",{className:x.rawQueryContainer,children:J?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(na.Z,{language:{grammar:oa.vB,name:"loki"},query:un,className:x.rawQuery}),(0,Ce.jsx)(Wt.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query.",children:(0,Ce.jsx)(Tr.I,{name:"info-circle",size:"sm",className:x.queryDescription})})]}):(0,Ce.jsx)(ia.y,{})}),children:(0,Ce.jsxs)("div",{className:x.ui,children:[(0,Ce.jsx)(Fr.J,{className:x.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters.",children:"Widen the search"}),(0,Ce.jsx)(tr.KF,{isLoading:Te,options:Vr.map(_r),value:Bt.map(_r),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(Xe,ht)=>(ht.action==="select-option"&&(0,Lt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"label",action:"select"}),ht.action==="remove-value"&&(0,Lt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"label",action:"remove"}),M(P.map(at=>(at.nonIndexed||(at.enabled=Xe.some(Yt=>Yt.value===at.label)),at))))}),cn&&(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(Fr.J,{className:x.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line.",children:"Refine the search"}),(0,Ce.jsx)(tr.KF,{isLoading:Te,options:lr.map(_r),value:ln.map(_r),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(Xe,ht)=>{ht.action==="select-option"&&(0,Lt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"parsed_label",action:"select"}),ht.action==="remove-value"&&(0,Lt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"parsed_label",action:"remove"}),M(P.map(at=>(at.nonIndexed&&(at.enabled=Xe.some(Yt=>Yt.value===at.label)),at)))}})]}),r.queryContainsValidPipelineStages(d)&&(0,Ce.jsx)(rr.C,{className:x.operationsToggle,children:(0,Ce.jsx)(Nt.I,{label:"Include LogQL pipeline operations",tooltip:(0,Ce.jsx)(Aa.I,{content:(0,Rr.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")}),children:(0,Ce.jsx)(ar.K,{value:ze,showLabel:!0,transparent:!0,onChange:Xe=>{(0,Lt.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:a.uid,action:Xe.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem(yt,Xe.currentTarget.checked.toString()),Ke(Xe.currentTarget.checked),m&&m()}})})})]})})]})}var _e=c(12798),pr=(v=>(v[v.Ascending=0]="Ascending",v[v.Descending=1]="Descending",v))(pr||{});function la(v,a){const r=v.values,{nanos:s}=v,l=Array(r.length);for(let m=0;m<l.length;m++)l[m]=m;const d=a===0;return l.sort((m,x)=>{const P=r[m],M=r[x];if(P<M)return d?-1:1;if(P>M)return d?1:-1;if(s===void 0)return 0;const H=s[m],K=s[x];return H<K?d?-1:1:H>K?d?1:-1:0}),l}function Tt(v,a){const{fields:r,...s}=v,l=r.find(m=>m.type===rt.PU.time);if(l===void 0)throw new Error("missing timestamp field. should never happen");const d=la(l,a);return{...s,fields:r.map(m=>({...m,values:Ar(m.values,d),nanos:m.nanos===void 0?void 0:Ar(m.nanos,d)}))}}function Ar(v,a){return v.map((r,s)=>v[a[s]])}const nt="lokiLogContextPreservedLabels",yt="lokiLogContextShouldIncludePipelineOperations";class dt{constructor(a){this.getLogRowContextQuery=async(r,s,l,d=!0)=>{const{query:m}=await this.getQueryAndRange(r,s,l,d);return d||(this.cachedContextFilters=[]),m},this.getLogRowContext=async(r,s,l)=>{const d=s&&s.direction||$.ZF.Backward,{query:m,range:x}=await this.getQueryAndRange(r,s,l),P=H=>{const J=H.data.map(q=>Tt(q,pr.Descending));return{...H,data:J}},M=we.Jk.Explore;return(0,h.s)(this.datasource.query(br(m,x,M,`${Br}${d}`)).pipe((0,i.W)(H=>{throw{message:"Error during context query. Please check JS console logs.",status:H.status,statusText:H.statusText}}),(0,j.n)(H=>(0,o.of)(P(H)))))},this.processContextFiltersToExpr=(r,s)=>{let d=`{${r.map(m=>!m.nonIndexed&&m.enabled?`${m.label}="${(0,_.Qn)(m.value)}"`:"").filter(m=>!!m).join(",")}}`;if(s){let m=!1;if((0,B.MX)(s.expr).parserCount===1){m=!0;const P=(0,B.aw)(s.expr);P&&(d=(0,_e.aH)(d,P))}const x=r.filter(P=>P.nonIndexed&&P.enabled);for(const P of x)P.enabled&&(d=(0,_e.tE)(d,P.label,"=",P.value,m?b.HD.Parsed:b.HD.StructuredMetadata))}return d},this.processPipelineStagesToExpr=(r,s)=>{let l=r;const d=s?.expr??"";if((0,B.MX)(d).parserCount>1)return l;const m=(0,B.TQ)(d,[pe.t3,pe.iT,pe.c$,pe.LM,pe.CX,pe.bY]),x=m.filter(M=>M.type?.id===pe.t3),P=m.filter(M=>M.type?.id!==pe.t3);for(const M of x)P.some(H=>M.contains(H))||(l+=` ${M.getExpression(d)}`);return l},this.queryContainsValidPipelineStages=r=>{const s=r?.expr??"",l=(0,B.TQ)(s,[pe.t3,pe.iT,pe.CX,pe.bY]),d=l.filter(x=>x.type?.id===pe.t3),m=l.filter(x=>x.type?.id!==pe.t3);return d.some(x=>m.every(P=>x.contains(P)===!1))},this.getInitContextFilters=async(r,s,l)=>{let d=!1;if(!s||(0,R.isEmpty)(r.labels))return{contextFilters:[],preservedFiltersApplied:d};const m=r.labels;let x=[];if(!(0,B.MX)(s.expr).queryWithParser)await this.datasource.languageProvider.start(l),x=this.datasource.languageProvider.getLabelKeys();else{const K=(0,B.pk)(s.expr);x=await this.datasource.languageProvider.fetchLabels({streamSelector:K[0],timeRange:l})}const P=[];Object.entries(m).forEach(([K,J])=>{const q=(0,_.Ed)(K,r.dataFrame,r.rowIndex),Te={label:K,value:J,enabled:x.includes(K),nonIndexed:q!==null&&q!==b.HD.Indexed};P.push(Te)});let M;const H=window.localStorage.getItem(nt);if(H)try{M=JSON.parse(H)}catch{}if(M){let K=!1;const J=P.map(Te=>M.removedLabels.includes(Te.label)?(K=!0,{...Te,enabled:!1}):M.selectedExtractedLabels.includes(Te.label)?(K=!0,{...Te,enabled:!0}):{...Te});return J.some(({enabled:Te,nonIndexed:Se})=>Te&&!Se)?(K&&(d=!0),{contextFilters:J,preservedFiltersApplied:d}):{contextFilters:P,preservedFiltersApplied:d}}else return{contextFilters:P,preservedFiltersApplied:d}},this.datasource=a,this.cachedContextFilters=[]}async getQueryAndRange(a,r,s,l=!0){const d=r&&r.direction||$.ZF.Backward,m=r&&r.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!l){const x=(await this.getInitContextFilters(a,s,{from:(0,Je.KQ)(a.timeEpochMs),to:(0,Je.KQ)(a.timeEpochMs),raw:{from:(0,Je.KQ)(a.timeEpochMs),to:(0,Je.KQ)(a.timeEpochMs)}})).contextFilters.filter(P=>P.enabled);this.cachedContextFilters=x}return await this.prepareLogRowContextQueryTarget(a,m,d,s)}async prepareLogRowContextQueryTarget(a,r,s,l){const d=this.prepareExpression(this.cachedContextFilters,l),m=2*60*60*1e3,x=s===$.ZF.Forward?b.ti.Forward:b.ti.Backward,P={expr:d,queryType:b.U3.Range,refId:`${Br}_${Math.random().toString()}`,maxLines:r,direction:x,datasource:{uid:this.datasource.uid,type:this.datasource.type}},H=new ra.L(a.dataFrame).getFirstFieldOfType(rt.PU.time);if(H===void 0)throw new Error("loki: data frame missing time-field, should never happen");const K=H.values[a.rowIndex],J=(0,Je.yT)(K),q=x===b.ti.Forward?{from:J,to:(0,Je.yT)(a.timeEpochMs+m)}:{from:(0,Je.yT)(a.timeEpochMs-m),to:J};return{query:P,range:{from:q.from,to:q.to,raw:q}}}getLogRowContextUi(a,r,s){const l=d=>{this.cachedContextFilters=d,r&&r()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),Da({row:a,origQuery:s,updateFilter:l,onClose:this.onContextClose,logContextProvider:this,runContextQuery:r})}prepareExpression(a,r){let s=this.processContextFiltersToExpr(a,r);return window.localStorage.getItem(yt)==="true"&&(s=this.processPipelineStagesToExpr(s,r)),s}}var hr=c(65474),Ft=c(29505),nr=c(84596),St=c(10354);const gr=/^label_names\(\)\s*$/,mr=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function Vt(v){if(typeof v!="string")return v;const a={refId:"LokiVariableQueryEditor-VariableQuery",type:b.ie.LabelNames};if(v.match(gr))return{...a,type:b.ie.LabelNames};const s=v.match(mr);return s?{...a,type:b.ie.LabelValues,label:s[2]?s[2]:s[1],stream:s[2]?s[1]:void 0}:a}const Dr=[{label:"Label names",value:b.ie.LabelNames},{label:"Label values",value:b.ie.LabelValues}],ja="LokiVariableQueryEditor-VariableQuery",Ma=({onChange:v,query:a,datasource:r,range:s})=>{const[l,d]=(0,Ye.useState)(void 0),[m,x]=(0,Ye.useState)(""),[P,M]=(0,Ye.useState)([]),[H,K]=(0,Ye.useState)(""),J=(0,nr.A)(l);(0,Ye.useEffect)(()=>{if(!a)return;const Qe=typeof a=="string"?Vt(a):a;d(Qe.type),x(Qe.label||""),K(Qe.stream||"")},[a]),(0,Ye.useEffect)(()=>{l!==b.ie.LabelValues||J===l||r.languageProvider.fetchLabels({timeRange:s}).then(Qe=>{M(Qe.map(ze=>({label:ze,value:ze})))})},[r,l,s,J]);const q=Qe=>{d(Qe.value),Qe.value!==void 0&&v({type:Qe.value,label:m,stream:H,refId:ja})},Te=Qe=>{x(Qe.value||"")},Se=Qe=>{K(Qe.currentTarget.value)},We=()=>{l!==void 0&&v({type:l,label:m,stream:H,refId:"LokiVariableQueryEditor-VariableQuery"})};return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsxs)(rr.C,{children:[(0,Ce.jsx)(Nt.I,{label:"Query type",labelWidth:20,children:(0,Ce.jsx)(tr.l6,{"aria-label":"Query type",onChange:q,onBlur:We,value:l,options:Dr,width:16})}),l===b.ie.LabelValues&&(0,Ce.jsx)(Ce.Fragment,{children:(0,Ce.jsx)(Nt.I,{label:"Label",labelWidth:20,children:(0,Ce.jsx)(tr.l6,{"aria-label":"Label",onChange:Te,onBlur:We,value:{label:m,value:m},options:P,width:16,allowCustomValue:!0})})})]}),l===b.ie.LabelValues&&(0,Ce.jsx)(rr.C,{children:(0,Ce.jsx)(Nt.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:(0,Ce.jsx)("div",{children:'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}'}),children:(0,Ce.jsx)(St.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:H,onChange:Se,onBlur:We})})})]})};class bt extends Ft.f5{constructor(a){super(),this.datasource=a,this.editor=Ma}async execute(a,r,s){return this.datasource.metricFindQuery(a,{scopedVars:r,range:s})}query(a){const r=this.execute(a.targets[0],a.scopedVars,a.range);return(0,hr.H)(r).pipe((0,ne.T)(s=>({data:s})))}}var Ct=c(14236),jr=c(19347);function xt(v,a){if(!a.length)return[];const r=(0,R.groupBy)(a,"name"),s=Object.values(r).map(vr),l=v.fields.find(m=>m.type===rt.PU.string);if(l===void 0)throw new Error("invalid logs-dataframe, string-field missing");const d=v.fields.find(m=>m.type===rt.PU.other&&m.name==="labels");for(let m=0;m<l.values.length;m++)for(const x of s)if(r[x.name][0].matcherType==="label"&&d){const P=d.values[m];if(P){const M=Object.keys(P).find(H=>r[x.name][0].matcherRegex===H);if(M){x.values.push(P[M]);continue}}x.values.push(null)}else if(r[x.name][0].matcherType==="regex"||r[x.name][0].matcherType===void 0){const M=l.values[m].match(r[x.name][0].matcherRegex);if(M&&M[1]){x.values.push(M[1]);continue}x.values.push(null)}else x.values.push(null);return s}function vr(v){const a=(0,jr.l)(),r=v.reduce((s,l)=>{if(l.datasourceUid){const d=a.getInstanceSettings(l.datasourceUid),m=x=>{switch(x){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};s.push({title:l.urlDisplayLabel||"",url:"",internal:{query:{query:l.url,queryType:m(d?.type)},datasourceUid:l.datasourceUid,datasourceName:d?.name??"Data source not found"}})}else l.url&&s.push({title:l.urlDisplayLabel||"",url:l.url});return s},[]);return{name:v[0].name,type:rt.PU.string,config:{links:r},values:[]}}function Ia(v){const a=v.filter(s=>s.refId!==void 0),r=(0,R.groupBy)(a,s=>s.refId);return Object.entries(r).map(([s,l])=>Na(l,s))}function Na(v,a){const r={name:"Time",config:{},values:[],type:rt.PU.time},s={name:`Value #${a}`,config:{},values:[],type:rt.PU.number},l=new Set(v.map(x=>x.fields.map(P=>Object.keys(P.labels??{})).flat()).flat()),m=Array.from(l).sort().map(x=>({name:x,config:{filterable:!0},values:[],type:rt.PU.string}));return v.forEach(x=>{const P=x.fields.find(q=>q.type===rt.PU.time),M=x.fields.find(q=>q.type===rt.PU.number);if(P==null||M==null)return;const H=P.values,K=M.values;for(let q of H)r.values.push(q);for(let q of K)s.values.push(q);const J=M.labels??{};for(let q of m){const Te=J[q.name]??"";for(let Se=0;Se<K.length;Se++)q.values.push(Te)}}),{fields:[r,...m,s],refId:a,meta:{preferredVisualisationType:"table"},length:r.values.length}}function Or(v){return v.fields.every(a=>a.type===rt.PU.time||a.type===rt.PU.number)}function _t(v,a){const{meta:r,...s}=v,l={...r,...a};return{...s,meta:l}}function ca(v,a,r){const s={...v.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,g.nE)(v)&&(s.error="Error when parsing some of the logs");const l={preferredVisualisationType:"logs",limit:a?.maxLines,searchWords:a!==void 0?(0,B.H0)(a.expr):void 0,custom:s},d=_t(v,l),m=xt(d,r);return{...d,fields:[...d.fields,...m]}}function kt(v,a,r){return v.map(s=>{const l=s.refId!==void 0?a.get(s.refId):void 0;return ca(s,l,r)})}function Ua(v){return v.length>0?Ia(v):[]}function Mr(v){const a={preferredVisualisationType:"graph"};return v.map(r=>_t(r,a))}function ua(v,a){const r=[],s=[],l=[];return v.forEach(d=>{Or(d)?d.refId!=null&&a.get(d.refId)?.queryType===b.U3.Instant?s.push(d):l.push(d):r.push(d)}),{streamsFrames:r,metricInstantFrames:s,metricRangeFrames:l}}function zt(v,a){if(v===void 0)return v;const{refId:r,message:s}=v;if(r===void 0||s===void 0)return v;const l=a.get(r);return l===void 0?v:s.includes("escape")&&l.expr.includes("\\")?{...v,message:`${s}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:v}function ot(v,a,r){const{data:s,error:l,...d}=v,m=s.map(K=>{if(!(0,Ct.ci)(K))throw new Error("transformation only supports dataframe responses");return K}),x=new Map(a.map(K=>[K.refId,K])),{streamsFrames:P,metricInstantFrames:M,metricRangeFrames:H}=ua(m,x);return{...d,error:zt(l,x),data:[...Mr(H),...Ua(M),...kt(P,x,r)]}}var ft=c(9e4),lt=c(81580),st=c(67061),yr=c(60016),Ht=c(95881);const Kt=(0,Ye.memo)(function(a){const{annotation:r,onAnnotationChange:s,history:l}=a;if(r===void 0||s===void 0)return null;const d=x=>{const P=(0,B.vV)(x).queryType===b.U3.Instant;s({...r,expr:x.expr,maxLines:x.maxLines,instant:P})},m={refId:"",expr:r.expr,maxLines:r.maxLines,instant:r.instant,queryType:r.queryType};return(0,Ce.jsxs)(st.B,{gap:5,direction:"column",children:[(0,Ce.jsx)(st.B,{gap:0,direction:"column",children:(0,Ce.jsx)(Ht.W,{datasource:a.datasource,query:m,onChange:d,onRunQuery:()=>{},history:l,ExtraFieldElement:(0,Ce.jsx)(yr.kl,{lineLimitValue:m?.maxLines?.toString()||"",resolution:m.resolution||1,query:m,onRunQuery:()=>{},onChange:d})})}),(0,Ce.jsxs)(ft.U,{children:[(0,Ce.jsx)(lt.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,Ce.jsx)(St.p,{type:"text",placeholder:"alertname",value:r.titleFormat,onChange:x=>{s({...r,titleFormat:x.currentTarget.value})}})}),(0,Ce.jsx)(lt.c,{label:"Tags",children:(0,Ce.jsx)(St.p,{type:"text",placeholder:"label1,label2",value:r.tagKeys,onChange:x=>{s({...r,tagKeys:x.currentTarget.value})}})}),(0,Ce.jsx)(lt.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,Ce.jsx)(St.p,{type:"text",placeholder:"instance",value:r.textFormat,onChange:x=>{s({...r,textFormat:x.currentTarget.value})}})})]})]})});var Ut=c(20065);function Ba(v,a){if(a.length===0)return[];const r=[],{queryWithParser:s,parserCount:l}=(0,B.MX)(v);if(!s){const{hasLogfmt:x,hasJSON:P,hasPack:M}=(0,g.YB)(a[0]);P&&(M?r.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:v}}}):r.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:v}}})),x&&r.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:v}}})}if(s){if(l===1){const P=(0,B.d_)(v);(0,g.db)(a[0])&&!P&&r.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:v}}})}(0,B.pS)(v)||r.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:v}}})}if(!(0,B._i)(v)){const x=(0,g.Ac)(a[0]),P=(0,g.sz)(a[0]);!x&&P&&r.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${P}" label.`,fix:{title:"add label level format",label:`If ${P} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:v,options:{renameTo:"level",originalLabel:P}}}})}return(0,B.Rn)(v)||r.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:v}}}),r}var Ir=c(62938),sr=c(33948),Xa=c(52622),ir=c(70416),da=c(80822);function Wa(v,a,r){if(a-v<=r)return[[v,a]];const s=[];for(let l=a;l>v;l-=r){const d=Math.max(l-r,v);s.push([d,l])}return s.reverse(),s}function Va(v,a,r,s){if(s<r)return[[v,a]];const l=Math.trunc(s/r)*r,d=v-v%r,m=[];for(let x=d;x<a;x+=l){const P=Math.min(x+l-r,a);m.push([x,P])}return m}var fa=c(79007);function pa(v,a,r,s){const l=a.from.toDate().getTime(),d=a.to.toDate().getTime();return(v?Wa(l,d,s):Va(l,d,r,s)).map(([x,P])=>{const M=(0,Je.KQ)(x),H=(0,Je.KQ)(P);return{from:M,to:H,raw:{from:M,to:H}}})}function _a(v,a){return a?v.map(r=>{if(!r.maxLines||!(0,B.sI)(r.expr))return r;const s=a.data.find(d=>d.refId===r.refId);if(!s)return r;const l=r.maxLines-s.length;return{...r,maxLines:l<0?0:l}}).filter(r=>r.maxLines===void 0||r.maxLines>0):v}function ka(v,a){const r=a.length?a[0].request.queryGroupId:(0,Ir.A)();let s={data:[],state:de.Gu.Streaming,key:r};const l=Math.max(...a.map(({partition:H})=>H.length)),d=a.filter(({partition:H})=>H.length===l)[0].partition;let m=!1,x=null;const P=(H,K,J)=>{if(m){H.complete();return}const q=()=>{s.state=de.Gu.Done,H.next(s),H.complete()},Te=()=>{const{nextRequestN:Ke,nextRequestGroup:ke}=ma(a,J,K);if(Ke>0&&ke>=0){P(H,Ke,ke);return}q()},Se=a[J],We=Se.partition[K-1],Qe=_a(Se.request.targets,s);if(!Qe.length){Te();return}const ze={...a[J].request,range:We,targets:Qe};Se.request.requestId&&(ze.requestId=`${Se.request.requestId}_${K}`),x=v.runQuery(ze).subscribe({next:Ke=>{s=(0,da.Wn)(s,Ke),s=ga(s,ze,d,K),((s.errors??[]).length>0||s.error!=null)&&(m=!0)},complete:()=>{H.next(s),Te()},error:Ke=>{H.error(Ke)}})};return new mt.c(H=>(P(H,l,0),()=>{m=!0,x?.unsubscribe()}))}const ha="loki-splitting-progress";function ga(v,a,r,s){if((0,B.sI)(a.targets[0].expr)||(v.data=v.data.filter(d=>d.name!==ha),s<=1))return v;const l=(0,sr.I)([{time:r[0].from.valueOf(),timeEnd:r[s-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return l.name=ha,l.meta={dataTopic:Xa.QR.Annotations},v.data.push(l),v}function ma(v,a,r){for(let s=a+1;s<v.length;s++)if(v[s].partition[r-1])return{nextRequestGroup:s,nextRequestN:r};return{nextRequestGroup:v.findIndex(s=>s?.partition[r-1]!==void 0),nextRequestN:r-1}}function za(v){return v.queryType!==b.U3.Instant&&!(0,B.Cg)(v.expr)}function va(v,a){const r=a.targets.filter(J=>!J.hide).filter(J=>J.expr),[s,l]=(0,R.partition)(r,J=>!za(J)),[d,m]=(0,R.partition)(l,J=>(0,B.sI)(J.expr));a.queryGroupId=(0,Ir.A)();const x=24*60*60*1e3,P=(0,R.groupBy)(d,J=>J.splitDuration?(0,ir.WT)((0,ir.E9)(J.splitDuration)):x),M=(0,R.groupBy)(m,J=>J.splitDuration?(0,ir.WT)((0,ir.E9)(J.splitDuration)):x),H=[];for(const[J,q]of Object.entries(P)){const Te=(0,R.groupBy)(q,Se=>Se.resolution||1);for(const Se in Te)H.push({request:{...a,targets:Te[Se]},partition:pa(!0,a.range,a.intervalMs,Number(J))})}for(const[J,q]of Object.entries(M)){const Te=(0,R.groupBy)(q,Se=>Oa(a.intervalMs,a.range,Se.resolution||1,Se.step));for(const Se in Te){const We=Te[Se].map(Qe=>{const{maxLines:ze,...Ke}=Qe;return Ke});H.push({request:{...a,targets:We},partition:pa(!1,a.range,Number(Se),Number(J))})}}s.length&&H.push({request:{...a,targets:s},partition:[a.range]});const K=new Date;return ka(v,H).pipe((0,ue.M)(J=>{J.state===de.Gu.Done&&(0,fa.uJ)(J,H,a,K,{predefinedOperations:v.predefinedOperations})}))}function Oa(v,a,r,s){const l=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(s?.match(l))return ee.intervalToMs(s)*r;const d=v*r,m=Math.round((a.to.valueOf()-a.from.valueOf())/11e3);return Math.max(d,m)}var ya=c(56245),Ha=c(72316),ba=c(9631),Nr=c(55004),Ka=c(78731);async function Ga(v){const a=JSON.stringify({expr:v.expr}),r=new TextEncoder().encode(a),s=await crypto.subtle.digest("SHA-1",r);return Array.from(new Uint8Array(s.slice(0,8))).map(d=>d.toString(16).padStart(2,"0")).join("")}function or(v,a,r){const s=r.range,l=s.to.valueOf()-s.from.valueOf()+1e3;let d=r.maxDataPoints??1e3;d>100&&(d*=2);let m;const x=P=>{if(P?.message){const M=P.message;m?m.push(M):m=ba.k9.fromDataFrameJSON(M,{maxLength:d,maxDelta:l,displayNameFormat:v.legendFormat})}return m};return(0,Ha.v)(()=>Ga(v)).pipe((0,ae.Z)(P=>(0,Ka.oF)().getStream({scope:Nr.qD.DataSource,namespace:a.uid,path:`tail/${P}`,data:{...v,timeRange:{from:s.from.valueOf().toString(),to:s.to.valueOf().toString()}}}).pipe((0,ne.T)(M=>{const H=x(M);return{data:H?[H]:[],state:de.Gu.Streaming}}))))}const xa=v=>{let r=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${be.$.appSubUrl}`;return r.endsWith("/")&&(r=r.slice(0,-1)),`${r}${v}`},Ea=1e3,pt=10,Gt="/loki/api/v1",Zt="loki-data-samples",Ur="annotation-",Br="log-row-context-query-",Pa="log-volume-",La="log-sample-",Za="log-stats-",Xr=1e6;function br(v,a,r,s,l){const d=ee.calculateInterval(a,1);return{targets:[v],requestId:s,interval:d.interval,intervalMs:d.intervalMs,range:a,scopedVars:{},timezone:"UTC",app:r,startTime:Date.now(),hideFromInspector:l}}class Ya extends je.iy{constructor(a,r=(0,Oe.w)()){super(a),this.instanceSettings=a,this.templateSrv=r,this.streams=new It,this.runLiveQuery=(l,d)=>{const m=this.createLiveTarget(l,d);return this.streams.getStream(m).pipe((0,ne.T)(x=>({data:x||[],key:`loki-${m.refId}`,state:de.Gu.Streaming})),(0,i.W)(x=>(0,Pe.$)(()=>`Live tailing was stopped due to following error: ${x.reason}`)))},this.getLogRowContext=async(l,d,m)=>await this.logContextProvider.getLogRowContext(l,d,(0,B.sc)(m)),this.getLogRowContextQuery=async(l,d,m,x)=>await this.logContextProvider.getLogRowContextQuery(l,d,(0,B.sc)(m),x),this.languageProvider=new U(this);const s=a.jsonData||{};this.maxLines=parseInt(s.maxLines??"0",10)||Ea,this.predefinedOperations=s.predefinedOperations??"",this.annotations={QueryEditor:Kt},this.variables=new bt(this),this.logContextProvider=new dt(this)}getSupplementaryRequest(a,r,s){switch(a){case $.cF.LogsVolume:const l=s?.type===$.cF.LogsVolume?s:{type:a};return this.getLogsVolumeDataProvider(r,l);case $.cF.LogsSample:const d=s?.type===$.cF.LogsSample?s:{type:a};return this.getLogsSampleDataProvider(r,d);default:return}}getSupportedSupplementaryQueryTypes(){return[$.cF.LogsVolume,$.cF.LogsSample]}getSupplementaryQuery(a,r){const s=(0,B.vV)(r);let l=(0,_e.Lv)(s.expr),d=!1;switch(a.type){case $.cF.LogsVolume:if(d=!!(l&&(0,B.sI)(l)&&s.queryType===b.U3.Range),!d)return;const m=`${l} | drop __error__`,x=a.field||"level";return(0,B.FV)(this.interpolateString(m,Ut.a))===!1&&(l=m),{...s,refId:`${Pa}${s.refId}`,queryType:b.U3.Range,supportingQueryType:b.Q$.LogsVolume,expr:`sum by (${x}) (count_over_time(${l}[$__auto]))`,legendFormat:`{{ ${x} }}`};case $.cF.LogsSample:return d=!!(l&&!(0,B.sI)(l)),d?{...s,queryType:b.U3.Range,refId:`${La}${s.refId}`,expr:(0,B.OT)(l),maxLines:Number.isNaN(Number(a.limit))?this.maxLines:Number(a.limit)}:void 0;default:return}}getLogsVolumeDataProvider(a,r){const s=(0,R.cloneDeep)(a),l=s.targets.map(d=>this.getSupplementaryQuery(r,d)).filter(d=>!!d);if(l.length)return{...s,targets:l}}getLogsSampleDataProvider(a,r){const s=(0,R.cloneDeep)(a),l=s.targets.map(d=>this.getSupplementaryQuery({type:$.cF.LogsSample,limit:100},d)).filter(d=>!!d);if(l.length)return{...s,targets:l}}query(a){const r=a.targets.map(B.vV).map(m=>({...m,maxLines:m.maxLines??this.maxLines})),s={...a,targets:r},l=s.targets.filter(m=>m.queryType===b.U3.Stream);if(be.$.featureToggles.lokiExperimentalStreaming&&l.length>0&&s.rangeRaw?.to==="now"){const m={...s,targets:l};return(0,I.h)(...l.map(x=>or(this.applyTemplateVariables(x,a.scopedVars,a.filters),this,m)))}if(s.liveStreaming)return this.runLiveQueryThroughBackend(s);if(be.$.featureToggles.lokiQuerySplitting&&(0,B.gy)(s.targets))return va(this,s);const d=new Date;return this.runQuery(s).pipe((0,ue.M)(m=>(0,fa.Ex)(m,s,d,{predefinedOperations:this.predefinedOperations})))}runQuery(a){return super.query(a).pipe((0,ne.T)(r=>ot(r,a.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(a){const r=a.targets.filter(l=>l.expr!==""&&(0,B.sI)(l.expr));if(r.length===0)return(0,o.of)({data:[],state:de.Gu.Done});const s=r.map(l=>{const d=this.applyTemplateVariables(l,a.scopedVars,a.filters),m=d.maxLines||this.maxLines;return this.runLiveQuery(d,m)});return(0,I.h)(...s)}createLiveTarget(a,r){const s=a.expr,l=this.instanceSettings.url,d=ve.kM.serializeParams({query:s});return{query:s,url:xa(`${l}/loki/api/v1/tail?${d}`),refId:a.refId,size:r}}interpolateVariablesInQueries(a,r,s){let l=a;return a&&a.length&&(l=a.map(d=>({...d,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(d.expr,r,this.interpolateQueryExpr),s)}))),l}getQueryDisplayText(a){return a.expr}getTimeRangeParams(a){return{start:a.from.valueOf()*Xr,end:a.to.valueOf()*Xr}}async importFromAbstractQueries(a){await this.languageProvider.start();const r=this.languageProvider.labelKeys;return r&&r.length&&(a=a.map(s=>(s.labelMatchers=s.labelMatchers.filter(l=>r.includes(l.name)),s))),a.map(s=>this.languageProvider.importFromAbstractQuery(s))}async exportToAbstractQueries(a){return a.map(r=>this.languageProvider.exportToAbstractQuery(r))}async metadataRequest(a,r,s){if(a.startsWith("/"))throw new Error(`invalid metadata request url: ${a}`);return(await this.getResource(a,r,s)).data||[]}async statsMetadataRequest(a,r,s){if(a.startsWith("/"))throw new Error(`invalid metadata request url: ${a}`);return await this.getResource(a,r,s)}async getQueryStats(a,r){if((0,B.FV)(this.interpolateString(a.expr,Ut.a)))return;const s=(0,B.pk)(a.expr);let l={streams:0,chunks:0,bytes:0,entries:0};for(const d in s){const{start:m,end:x}=this.getStatsTimeRange(a,Number(d),r);if(m===void 0||x===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const P=await this.statsMetadataRequest("index/stats",{query:s[d],start:m,end:x},{showErrorAlert:!1,requestId:`${Za}${a.refId}`});l={streams:l.streams+P.streams,chunks:l.chunks+P.chunks,bytes:l.bytes+P.bytes,entries:l.entries+P.entries}}catch{break}}return l}getStatsTimeRange(a,r,s){let l,d;const P=(0,B.QH)(a.expr,[pe.dw]).map(M=>a.expr.substring(M.from,M.to));return(0,B.sI)(a.expr)?a.queryType===b.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(s):a.queryType===b.U3.Instant?P[r]?(d=this.getTimeRangeParams(s).end,l=d-ee.intervalToMs(P[r])*1e6,{start:l,end:d}):/(\$__auto|\$__range)/.test(a.expr)?this.getTimeRangeParams(s):{start:void 0,end:void 0}:this.getTimeRangeParams(s)}async getStats(a,r){if(!a.expr)return null;const s=await this.getQueryStats(a,r);return s?Object.values(s).every(l=>l===0)?null:s:null}async metricFindQuery(a,r){if(!a)return Promise.resolve([]);let s;return typeof a=="string"?s=this.parseStringToVariableQuery(this.interpolateString(a,r?.scopedVars)):s={...a,label:this.interpolateString(a.label||"",r?.scopedVars),stream:this.interpolateString(a.stream||"",r?.scopedVars)},s?await this.processMetricFindQuery(s,r?.range):Promise.resolve([])}async processMetricFindQuery(a,r){return a.type===b.ie.LabelNames?(await this.languageProvider.fetchLabels({timeRange:r})).map(d=>({text:d})):a.label?(await this.languageProvider.fetchLabelValues(a.label,{streamSelector:a.stream,timeRange:r})).map(l=>({text:l})):[]}parseStringToVariableQuery(a){const r="LokiVariableQueryEditor-VariableQuery";if(a.match(gr))return{type:b.ie.LabelNames,refId:r};const l=a.match(mr);if(l)return{type:b.ie.LabelValues,label:l[2],stream:l[1],refId:r}}async getDataSamples(a,r){if(!(0,B.sI)(a.expr)||(0,B.FV)(this.interpolateString(a.expr,Ut.a)))return[];const s={expr:a.expr,queryType:b.U3.Range,refId:Zt,maxLines:a.maxLines||pt,supportingQueryType:b.Q$.DataSample},l=br(s,r,we.Jk.Unknown,Zt,!0);return await(0,h.s)(this.query(l).pipe((0,j.n)(d=>(0,o.of)(d.data))))}async getTagKeys(a){let r="{}";for(const l of a?.filters??[])r=(0,_e.tE)(r,l.key,l.operator,l.value);return(await this.languageProvider.fetchLabels({timeRange:a?.timeRange,streamSelector:r})).map(l=>({text:l}))}async getTagValues(a){let r="{}";for(const l of a?.filters??[])r=(0,_e.tE)(r,l.key,l.operator,l.value);return(await this.languageProvider.fetchLabelValues(a.key,{timeRange:a.timeRange,streamSelector:r})).map(l=>({text:l}))}interpolateQueryExpr(a,r){return!r.multi&&!r.includeAll?vt(a):typeof a=="string"?Wr(a):(0,R.map)(a,Wr).join("|")}toggleQueryFilter(a,r){let s=a.expr??"";const l=(0,_.Ed)(r.options.key,r.frame,0);switch(r.type){case"FILTER_FOR":{if(r.options?.key&&r.options?.value){const d=(0,_.Bb)(r.options.value);s=(0,_e.je)(s,r.options.key,"=",d)?(0,_e.FN)(s,r.options.key,"=",d):(0,_e.tE)(s,r.options.key,"=",d,l)}break}case"FILTER_OUT":{if(r.options?.key&&r.options?.value){const d=(0,_.Bb)(r.options.value);(0,_e.je)(s,r.options.key,"=",d)&&(s=(0,_e.FN)(s,r.options.key,"=",d)),s=(0,_e.tE)(s,r.options.key,"!=",d,l)}break}default:break}return{...a,expr:s}}queryHasFilter(a,r){let s=a.expr??"";return(0,_e.je)(s,r.key,"=",r.value)}modifyQuery(a,r){let s=a.expr??"";switch(r.type){case"ADD_FILTER":{if(r.options?.key&&r.options?.value){const l=(0,_.Ed)(r.options.key,r.frame,0),d=(0,_.Bb)(r.options.value);s=(0,_e.tE)(s,r.options.key,"=",d,l)}break}case"ADD_FILTER_OUT":{if(r.options?.key&&r.options?.value){const l=(0,_.Ed)(r.options.key,r.frame,0),d=(0,_.Bb)(r.options.value);s=(0,_e.tE)(s,r.options.key,"!=",d,l)}break}case"ADD_LOGFMT_PARSER":{s=(0,_e.aH)(s,"logfmt");break}case"ADD_JSON_PARSER":{s=(0,_e.aH)(s,"json");break}case"ADD_UNPACK_PARSER":{s=(0,_e.aH)(s,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{s=(0,_e.yI)(s);break}case"ADD_LEVEL_LABEL_FORMAT":{r.options?.originalLabel&&r.options?.renameTo&&(s=(0,_e.o9)(s,{renameTo:r.options.renameTo,originalLabel:r.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const l=(0,_e.cH)(a.expr),d=(0,_e.lN)(a.expr),m=(0,_e.lq)([...l,...d]),x=(0,_e.i6)("","","=");s=(0,_e.cQ)(s,[m],x);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{s=(0,_e.OS)(s,r.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{s=(0,_e.OS)(s,r.options?.value,"!=");break}default:break}return{...a,expr:s}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(a,r,s){return this.logContextProvider.getLogRowContextUi(a,r,(0,B.sc)(s))}async annotationQuery(a){const{expr:r,maxLines:s,instant:l,tagKeys:d="",titleFormat:m="",textFormat:x=""}=a.annotation;if(!r)return[];const P=`${Ur}${a.annotation.name}`,M={refId:P,expr:r,maxLines:s,instant:l,queryType:l?b.U3.Instant:b.U3.Range},H=br(M,a.range,we.Jk.Dashboard,P),{data:K}=await(0,h.s)(this.query(H)),J=[],q=d.split(",").filter(Te=>Te!=="");for(const Te of K)new w.R(Te).forEach(We=>{const{labels:Qe}=We,ze=Object.entries(Qe).map(([ke,et])=>[ke,et.trim()]).filter(([ke,et])=>!(et===""||q.length&&!q.includes(ke))).map(([ke,et])=>et),Ke=Array.from(new Set(ze));J.push({time:new Date(We.Time).valueOf(),title:(0,Le.j)(m,Qe),text:(0,Le.j)(x,Qe)||We.Line,tags:Ke})});return J}addAdHocFilters(a,r){if(!r?.length)return a;let s=(0,ya.qk)(a);return s=r.reduce((l,d)=>{const{key:m,operator:x}=d;let{value:P}=d;return(0,_.N4)(x)?P=vt(P):P=(0,_.Bb)(P,x),(0,_e.tE)(l,m,x,P)},s),(0,ya.If)(s)}filterQuery(a){return!(a.hide||a.expr==="")}applyTemplateVariables(a,r,s){const{__auto:l,__interval:d,__interval_ms:m,__range:x,__range_s:P,__range_ms:M,...H}=r||{},K={...H,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}},J=this.addAdHocFilters(this.templateSrv.replace(a.expr,K,this.interpolateQueryExpr),s),q=this.templateSrv.replace(a.step,K),Te=this.templateSrv.replace(a.legendFormat,K);return{...a,expr:J,step:q,legendFormat:Te}}interpolateString(a,r){return this.templateSrv.replace(a,r,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(a=>`$${a.name}`)}getQueryHints(a,r){return Ba(a.expr,r)}getDefaultQuery(a){const r={refId:"A",expr:""};return a===we.Jk.UnifiedAlerting?{...r,queryType:b.U3.Instant}:{...r,queryType:b.U3.Range}}}function vt(v){return typeof v=="string"?v.replace(/'/g,"\\\\'"):v}function Wr(v){return typeof v=="string"?vt(v.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):v}},97535:(qe,De,c)=>{"use strict";c.d(De,{Bb:()=>ve,Cs:()=>$,Ed:()=>Le,N4:()=>we,P7:()=>be,Qn:()=>ee,WV:()=>i,qv:()=>de,sM:()=>je,tY:()=>w,tt:()=>Oe});var R=c(2543),Pe=c.n(R),I=c(73372),o=c(13137);function h(oe){return ne(oe/1e3)}function ne(oe){return Math.floor(oe/60)}function i(oe,xe){if(oe&&xe){const ye=h(oe.from.valueOf())===h(xe.from.valueOf()),V=h(oe.to.valueOf())===h(xe.to.valueOf());return!(ye&&V)}return!1}const ue=/[*+?()|\\.\[\]{}^$]/g;function j(oe){return oe.replace(ue,"\\$&")}function ee(oe){return oe.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function de(oe){return oe.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function $(oe){return ee(j(oe))}function ve(oe,xe){return we(xe)?$(oe):ee(oe)}function we(oe){return!!(oe&&(oe.includes("=~")||oe.includes("!~")))}function w(oe){const xe=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],ye=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${xe.join("|")})$`);return!!oe.match(ye)}function Le(oe,xe,ye){if(!xe||ye===void 0)return null;const V=xe.fields.find($e=>$e.name==="labelTypes")?.values[ye];if(!V)return null;switch(V[oe]){case"I":return o.HD.Indexed;case"S":return o.HD.StructuredMetadata;case"P":return o.HD.Parsed;default:return null}}const pe={[I.D_.Equal]:"=",[I.D_.NotEqual]:"!=",[I.D_.EqualRegEx]:"=~",[I.D_.NotEqualRegEx]:"!~"},je=(0,R.invert)(pe);function Oe(oe){const xe=oe.labelMatchers.map(ye=>{const V=pe[ye.operator];return V?`${ye.name}${V}"${ye.value}"`:""}).filter(ye=>ye!=="").join(", ");return xe?`{${xe}}`:""}function be(oe){const xe={};oe.forEach(V=>{Object.keys(V).forEach($e=>{xe[$e]||(xe[$e]=new Set),xe[$e].has(V[$e])||xe[$e].add(V[$e])})});const ye={};return he(Object.keys(xe)).forEach(V=>{ye[V]=he(Array.from(xe[V]))}),{values:ye,keys:Object.keys(ye)}}const ce=1e4;function he(oe){return oe.slice(0,ce)}},12798:(qe,De,c)=>{"use strict";c.d(De,{Ch:()=>j,FN:()=>de,Lv:()=>be,OS:()=>N,aH:()=>pe,cH:()=>he,cQ:()=>Fe,i6:()=>V,je:()=>ee,lN:()=>oe,lq:()=>Q,o9:()=>Oe,tE:()=>w,yB:()=>ce,yI:()=>je});var R=c(2543),Pe=c.n(R),I=c(36195),o=c(97535),h=c(56587),ne=c(43548),i=c(60706),ue=c(13137);class j{constructor(b,S,T){this.from=b,this.to=S,this.type=T}static fromNode(b){return new j(b.from,b.to,b.type)}contains(b){return this.from<=b.from&&this.to>=b.to}getExpression(b){return b.substring(this.from,this.to)}}function ee(g,b,S,T){return we(g,b,S,T).length>0}function de(g,b,S,T){const U=we(g,b,S,T);for(const G of U)g=G.parent?.type.id===I.bY?$(g,G):ve(g,G);return g}function $(g,b){const S=b.parent?.parent;return!S||S.type.id!==I.t3?g:(g.substring(0,S.from)+g.substring(S.to)).trim()}function ve(g,b){let S=b;do S=S.parent;while(S&&S.type.id!==I.MD);const T=b.getChild(I.gw);if(!S||!T)return g;const U=g.substring(T.from,T.to),G=g.substring(0,S.from),fe=g.substring(S.to),ae=(0,i.u_)(g.substring(S.from,S.to));return ae.query.labels=ae.query.labels.filter(Ie=>Ie.label!==U),G+ne.y.renderQuery(ae.query)+fe}function we(g,b,S,T){const U=I.K3.parse(g),G=[];return U.iterate({enter:({type:fe,node:ae})=>{fe.id===I.g$&&G.push(ae)}}),G.filter(fe=>{const ae=fe.getChild(I.gw),Ie=ae?.nextSibling,Ue=fe.getChild(I.Qf);if(!ae||!Ie||!Ue||g.substring(ae.from,ae.to)!==b)return!1;const Ot=g.substring(Ue.from,Ue.to);return!((0,i.w4)(Ot)!==(0,o.qv)(T)||g.substring(Ie.from,Ie.to)!==S)})}function w(g,b,S,T,U){if(!b||!T)throw new Error("Need label to add to query.");const G=ce(g);if(!G.length)return g;const fe=he(g),ae=oe(g),Ie=B(g),Ue=(0,h.TQ)(g,[I.J_]);U||Me(g).map(Rt=>Rt.getExpression(g)).includes(b)&&(U=ue.HD.Indexed);const tt=G.every(mt=>Ie.some(qt=>qt.from>=mt.from&&qt.to<=mt.to)),Ot=V(b,T,S);if(U===ue.HD.Parsed||U===ue.HD.StructuredMetadata){const mt=Le(g,[...G,...ae,...fe,...Ue]);return Fe(g,mt,Ot)}else{if(U===ue.HD.Indexed)return $e(g,G,Ot);if(fe.length===0||tt===!1)return $e(g,G,Ot);{const mt=Le(g,[...fe,...ae,...Ue]);return Fe(g,mt,Ot)}}}function Le(g,b){const S=F((0,h.TQ)(g,[I.GN])),T=[...b];return S.map(G=>Q(T.filter(fe=>G.contains(fe))))}function pe(g,b){const S=xe(g);if(S.length)return Ve(g,S,b);{const T=ce(g);return T.length?Ve(g,T,b):g}}function je(g){const b=he(g);if(!b.length)return g;const S=V("__error__","","=");return Fe(g,b,S)}function Oe(g,b){const S=ye(g);return A(g,S,b)}function be(g){const b=te(g);if(!b.length)return g;let S="",T=0;for(let U of b)S=S+g.substring(T,U.from),T=U.to;return S=S+g.substring(T),S}function ce(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({type:T,node:U})=>{if(T.id===I.MD)return S.push(j.fromNode(U)),!1}}),S}function he(g){const b=I.K3.parse(g),S=[],T=[I.iT,I.eF,I.Zj,I.Tz];return b.iterate({enter:({type:U,node:G})=>{if(T.includes(U.id))return S.push(j.fromNode(G)),!1}}),S}function oe(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({type:T,node:U})=>{if(T.id===I.bY)return S.push(j.fromNode(U)),!1}}),S}function xe(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({type:T,node:U})=>{if(T.id===I.CX)return S.push(j.fromNode(U)),!1}}),S}function ye(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({type:T,node:U})=>{if(T.id===I.UK)return S.push(j.fromNode(U)),!1;if(T.id===I.xo){const G=[],fe=U.getChild(I.MD);fe&&G.push(j.fromNode(fe));const ae=U.getChild(I.AL);ae&&G.push(j.fromNode(ae));const Ie=U.getChild(I.HV);Ie&&G.push(j.fromNode(Ie));const Ue=(0,R.sortBy)(G,tt=>tt.to);return S.push(new j(Ue[0].from,Ue[Ue.length-1].to)),!1}}}),S}function V(g,b,S){return{label:g,op:S,value:b}}function $e(g,b,S){let T="",U=0;for(let G=0;G<b.length;G++){const fe=b[G],ae=G===b.length-1,Ie=g.substring(U,fe.from),Ue=ae?g.substring(fe.to):"",tt=(0,i.u_)(g.substring(fe.from,fe.to));se(tt.query.labels,S)||tt.query.labels.push(S);const Ot=ne.y.renderQuery(tt.query);T+=Ie+Ot+Ue,U=fe.to}return T}function Fe(g,b,S){let T="",U=0;for(let G=0;G<b.length;G++){const fe=b[G],ae=G===b.length-1,Ie=g.substring(U,fe.to),Ue=ae?g.substring(fe.to):"";let tt="";!Number.isNaN(Number(S.value))&&(S.op==="<"||S.op===">")?tt=` | ${S.label}${S.op}${Number(S.value)}`:tt=` | ${S.label}${S.op}\`${(0,o.qv)(S.value)}\``,T+=Ie+tt+Ue,U=fe.to}return T}function Ve(g,b,S){let T="",U=0;for(let G=0;G<b.length;G++){const fe=b[G],ae=G===b.length-1,Ie=g.substring(U,fe.to),Ue=ae?g.substring(fe.to):"";T+=Ie+` | ${S}`+Ue,U=fe.to}return T}function A(g,b,S){let T="",U=0;for(let G=0;G<b.length;G++){const fe=b[G],ae=G===b.length-1,Ie=g.substring(U,fe.to),Ue=ae?g.substring(fe.to):"",tt=` | label_format ${S.renameTo}=${S.originalLabel}`;T+=Ie+tt+Ue,U=fe.to}return T}function N(g,b="",S="|="){const T=ce(g);if(!T.length)return g;const U=T[0].to;return g.slice(0,U)+` ${S} \`${b}\``+g.slice(U)}function te(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({type:T,from:U,to:G})=>{if(T.id===I.uk)return S.push(new j(U,G,T)),!1}}),S}function se(g,b){return g.find(S=>S.label===b.label&&S.value===b.value)}function Q(g){return g.length?g.reduce((b,S)=>b.to>S.to?b:S):new j(0,0)}function F(g){return g.filter(b=>g.every(S=>b.contains(S)===!1||b===S))}function _(g,b){if(g.type.id===b)return[j.fromNode(g)];const S=[];let T=0,U=g.childAfter(T);for(;U;)S.push(..._(U,b)),T=U.to,U=g.childAfter(T);return S}function B(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({node:T})=>{T.type.id===I.MD&&S.push(..._(T,I.g$))}}),S}function Me(g){const b=I.K3.parse(g),S=[];return b.iterate({enter:({node:T})=>{T.type.id===I.MD&&S.push(..._(T,I.gw))}}),S}},27049:(qe,De,c)=>{"use strict";c.r(De),c.d(De,{plugin:()=>wo});var R=c(40187),Pe=c(69129),I=c(3591),o=c(74848),h=c(32196),ne=c(2543),i=c(96540),ue=c(14110),j=c(40845),ee=c(97535);const de=['{job="default/prometheus"}'],$=["job","app","k8s_app"],ve=5,we=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class w extends i.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const n=t.getLabelKeys()||[],u=$.find(f=>n.includes(f));if(u){const f=await t.fetchLabelValues(u),p=(0,ne.shuffle)(f).slice(0,ve).map(E=>`{${u}="${(0,ee.Qn)(E)}"}`);this.setState({userExamples:p})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,ue.rR)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:n,theme:u}=this.props,f=pe(u),p=E=>{n(E),(0,ue.rR)("grafana_loki_cheatsheet_example_clicked",{})};return(0,o.jsx)("button",{type:"button",className:f.cheatSheetExample,onClick:()=>p({refId:"A",expr:t}),children:(0,o.jsx)("code",{children:t})},t)}render(){const{userExamples:t}=this.state,{theme:n}=this.props,u=t.length>0,f=pe(n);return(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{children:"Loki Cheat Sheet"}),(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:"See your logs"}),"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field.",u?(0,o.jsxs)("div",{children:["Here are some example streams from your logs:",t.map(p=>this.renderExpression(p))]}):(0,o.jsxs)("div",{children:["Here is an example of a log stream:",this.renderExpression(de[0])]})]}),(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:"Combine stream selectors"}),this.renderExpression('{app="cassandra",namespace="prod"}'),"Returns all log lines from streams that have both labels."]}),(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:"Filtering for search terms."}),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),(0,o.jsx)("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql",children:"LogQL"})," ","supports exact and regular expression filters."]}),we.map(p=>(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:p.title}),this.renderExpression(p.expression),p.label]},p.expression))]})}}const Le=(0,j.cV)(w),pe=e=>({cheatSheetItem:(0,h.css)({margin:e.spacing(3,0)}),cheatSheetItemTitle:(0,h.css)({fontSize:e.typography.h3.fontSize}),cheatSheetExample:(0,h.css)({margin:e.spacing(.5,0),textAlign:"left",border:"none",background:"transparent",display:"block"})});var je=c(41987),Oe=c(84596),be=c(39070),ce=c(13544),he=c(42952),oe=c(6191),xe=c(15292),ye=c(46819),V=Object.defineProperty,$e=Object.defineProperties,Fe=Object.getOwnPropertyDescriptors,Ve=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,te=(e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,se=(e,t)=>{for(var n in t||(t={}))A.call(t,n)&&te(e,n,t[n]);if(Ve)for(var n of Ve(t))N.call(t,n)&&te(e,n,t[n]);return e},Q=(e,t)=>$e(e,Fe(t)),F=(e,t)=>{var n={};for(var u in e)A.call(e,u)&&t.indexOf(u)<0&&(n[u]=e[u]);if(e!=null&&Ve)for(var u of Ve(e))t.indexOf(u)<0&&N.call(e,u)&&(n[u]=e[u]);return n};function _(e){var t=e,{label:n}=t,u=F(t,["label"]);const f=n.replace(" ","-"),p=(0,i.useRef)((0,ne.uniqueId)(`switch-${f}`)),E=(0,j.of)(B);return i.createElement(ye.B,{gap:1},i.createElement("label",{htmlFor:p.current,className:E.switchLabel},n),i.createElement(xe.d,Q(se({},u),{id:p.current})))}const B=e=>({switchLabel:(0,h.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}})});var Me=c(31347),g=c(94354);const b=[{label:"Builder",value:he.f.Builder},{label:"Code",value:he.f.Code}];function S({mode:e,onChange:t}){return i.createElement("div",{"data-testid":"QueryEditorModeToggle"},i.createElement(g.z,{options:b,size:"sm",value:e,onChange:t}))}var T=c(71087),U=c(32264),G=c(96374),fe=c(67061),ae=c(55852),Ie=c(68402),Ue=c(7144),tt=c(37390),Ot=c(39558),mt=c(91793),qt=c(9830),Rt=c(60029),dr=c(54438),Dt=c(10354);const $r=1e3,Qr=1e4,$a=4,rt="{}";function wt(e){const t=[];for(const n of e)if(n.selected&&n.values&&n.values.length>0){const u=n.values.filter(f=>f.selected).map(f=>f.name);u.length>1?t.push(`${n.name}=~"${u.map(ee.Cs).join("|")}"`):u.length===1&&t.push(`${n.name}="${(0,ee.Qn)(u[0])}"`)}return["{",t.join(","),"}"].join("")}function Qa(e,t,n){return e.map(u=>{const f=t[u.name];if(f){let p;if(u.name===n&&u.values)p=u.values;else{const E=new Set(u.values?.filter(y=>y.selected).map(y=>y.name)||[]);p=f.map(y=>({name:y,selected:E.has(y)}))}return{...u,loading:!1,values:p,facets:p.length}}return{...u,loading:!1,hidden:!f,values:void 0,facets:0}})}const Gr=e=>({wrapper:(0,h.css)`
    background-color: ${e.colors.background.secondary};
    width: 100%;
  `,wrapperPadding:(0,h.css)`
    padding: ${e.spacing(2)};
  `,list:(0,h.css)`
    margin-top: ${e.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:(0,h.css)`
    & + & {
      margin: ${e.spacing(2,0)};
    }

    position: relative;
  `,footerSectionStyles:(0,h.css)`
    padding: ${e.spacing(1)};
    background-color: ${e.colors.background.primary};
    position: sticky;
    bottom: -${e.spacing(3)}; /* offset the padding on modal */
    left: 0;
  `,selector:(0,h.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    margin-bottom: ${e.spacing(1)};
    width: 100%;
  `,status:(0,h.css)`
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
    font-size: ${e.typography.bodySmall.fontSize};
    height: calc(${e.typography.bodySmall.fontSize} + 10px);
  `,statusShowing:(0,h.css)`
    opacity: 1;
  `,error:(0,h.css)`
    color: ${e.colors.error.main};
  `,valueList:(0,h.css)`
    margin-right: ${e.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:(0,h.css)`
    border-left: 1px solid ${e.colors.border.medium};
    margin: ${e.spacing(1,0)};
    padding: ${e.spacing(1,0,1,1)};
  `,valueListArea:(0,h.css)`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${e.spacing(1)};
  `,valueTitle:(0,h.css)`
    margin-left: -${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
  `,validationStatus:(0,h.css)`
    padding: ${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class Zr extends i.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,ue.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=wt(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,ue.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const n=`rate(${wt(this.state.labels)}[$__auto])`;this.props.onChange(n)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(u=>({...u,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,n,u)=>{const f=this.state.labels.find(y=>y.name===t);if(!f)return;const p=!f.selected;let E={selected:p};if(f.values&&!p){const y=f.values.map(O=>({...O,selected:!1}));E={...E,facets:0,values:y}}this.setState({searchTerm:""}),this.updateLabelState(t,E,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,n,u)=>{const f=this.state.labels.find(E=>E.name===t);if(!f||!f.values)return;this.setState({searchTerm:""});const p=f.values.map(E=>({...E,selected:E.name===n?!E.selected:E.selected}));this.updateLabelState(t,{values:p},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=wt(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const n=wt(this.state.labels);if(n===rt){const u=this.state.labels.map(f=>({...f,facets:0,values:void 0,hidden:!1}));this.setState({labels:u},()=>{this.state.labels.forEach(f=>f.selected&&this.fetchValues(f.name,n))})}else this.fetchSeries(n,t)}}updateLabelState(t,n,u="",f){this.setState(p=>{const E=p.labels.map(O=>O.name===t?{...O,...n}:O),y=u?"":p.error;return{labels:E,status:u,error:y,validationStatus:""}},f)}componentDidMount(){const{languageProvider:t,autoSelect:n=$a,lastUsedLabels:u,timeRange:f}=this.props;if(t){const p=u;t.start(f).then(()=>{let E=t.getLabelKeys();if(E.length>$r){const O=`Too many labels found (showing only ${$r} of ${E.length})`;E=E.slice(0,$r),this.setState({error:O})}const y=E.map((O,L,D)=>({name:O,selected:D.length<=n&&p.length===0||p.includes(O),loading:!1}));this.setState({labels:y},()=>{this.state.labels.forEach(O=>{O.selected&&this.fetchValues(O.name,rt)})})})}}doFacettingForLabel(t){const n=this.state.labels.find(f=>f.name===t);if(!n)return;const u=this.state.labels.filter(f=>f.selected).map(f=>f.name);this.props.storeLastUsedLabels(u),n.selected?n.values||this.fetchValues(t,wt(this.state.labels)):this.doFacetting()}async fetchValues(t,n){const{languageProvider:u,timeRange:f}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let p=await u.fetchLabelValues(t,{timeRange:f});if(n!==wt(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(p.length>Qr){const y=`Too many values for ${t} (showing only ${Qr} of ${p.length})`;p=p.slice(0,Qr),this.setState({error:y})}const E=p.map(y=>({name:y}));this.updateLabelState(t,{values:E,loading:!1})}catch(p){console.error(p)}}async fetchSeries(t,n){const{languageProvider:u,timeRange:f}=this.props;n&&this.updateLabelState(n,{loading:!0},`Loading labels for ${t}`);try{const p=await u.fetchSeriesLabels(t,{timeRange:f});if(t!==wt(this.state.labels)){n&&this.updateLabelState(n,{loading:!1});return}if(Object.keys(p).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const E=Qa(this.state.labels,p,n);this.setState({labels:E,error:""}),n&&this.updateLabelState(n,{loading:!1})}catch(p){console.error(p)}}async validateSelector(t){const{languageProvider:n,timeRange:u}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const f=await n.fetchSeries(t,{timeRange:u});this.setState({validationStatus:`Selector is valid (${f.length} streams found)`})}render(){const{theme:t}=this.props,{labels:n,searchTerm:u,status:f,error:p,validationStatus:E}=this.state;if(n.length===0)return(0,o.jsx)(Ot._,{text:"Loading labels..."});const y=Gr(t),O=wt(this.state.labels),L=O===rt;let D=n.filter(C=>C.selected&&C.values);return u?D=D.map(C=>{const k=C.values.filter(X=>{if(X.selected)return X.highlightParts=void 0,!0;const me=(0,qt.I)(X.name.toLowerCase(),u.toLowerCase());return me.found?(X.highlightParts=me.ranges,X.order=me.distance,!0):!1});return{...C,values:(0,ne.sortBy)(k,X=>X.selected?-1/0:X.order)}}):D=this.state.labels.filter(C=>C.selected&&C.values).map(C=>({...C,values:C?.values?C.values.map(k=>({...k,highlightParts:void 0})):[]})),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:y.wrapper,children:[(0,o.jsxs)("div",{className:(0,h.cx)(y.section,y.wrapperPadding),children:[(0,o.jsx)(Rt.J,{description:"Which labels would you like to consider for your search?",children:"1. Select labels to search in"}),(0,o.jsx)("div",{className:y.list,children:n.map(C=>(0,o.jsx)(dr.J,{name:C.name,loading:C.loading,active:C.selected,hidden:C.hidden,facets:C.facets,onClick:this.onClickLabel},C.name))})]}),(0,o.jsxs)("div",{className:(0,h.cx)(y.section,y.wrapperPadding),children:[(0,o.jsx)(Rt.J,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels.",children:"2. Find values for the selected labels"}),(0,o.jsx)("div",{children:(0,o.jsx)(Dt.p,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:u,placeholder:"Enter a label value"})}),(0,o.jsx)("div",{className:y.valueListArea,children:D.map(C=>(0,o.jsxs)("div",{role:"list",className:y.valueListWrapper,children:[(0,o.jsx)("div",{className:y.valueTitle,"aria-label":`Values for ${C.name}`,children:(0,o.jsx)(dr.J,{name:C.name,loading:C.loading,active:C.selected,hidden:C.hidden,facets:C.facets||C.values?.length,onClick:this.onClickLabel})}),(0,o.jsx)(mt.Y1,{height:200,itemCount:C.values?.length||0,itemSize:28,itemKey:k=>C.values?.[k].name??k,width:200,className:y.valueList,children:({index:k,style:X})=>{const me=C.values?.[k];return me?(0,o.jsx)("div",{style:X,children:(0,o.jsx)(dr.J,{name:C.name,value:me?.name,active:me?.selected,highlightParts:me?.highlightParts,onClick:this.onClickValue,searchTerm:u})}):null}})]},C.name))})]})]}),(0,o.jsxs)("div",{className:y.footerSectionStyles,children:[(0,o.jsx)(Rt.J,{children:"3. Resulting selector"}),(0,o.jsx)("pre",{"aria-label":"selector",className:y.selector,children:O}),E&&(0,o.jsx)("div",{className:y.validationStatus,children:E}),(0,o.jsx)("div",{className:(0,h.cx)(y.status,(f||p)&&y.statusShowing),children:(0,o.jsx)("span",{className:p?y.error:"",children:p||f})}),(0,o.jsxs)(fe.B,{gap:1,children:[(0,o.jsx)(ae.$n,{"aria-label":"Use selector as logs button",disabled:L,onClick:this.onClickRunLogsQuery,children:"Show logs"}),(0,o.jsx)(ae.$n,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:L,onClick:this.onClickRunMetricsQuery,children:"Show logs rate"}),(0,o.jsx)(ae.$n,{"aria-label":"Validate submit button",variant:"secondary",disabled:L,onClick:this.onClickValidate,children:"Validate selector"}),(0,o.jsx)(ae.$n,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear,children:"Clear"})]})]})]})}}const Yr=(0,j.cV)(Zr),Jr=e=>{const{isOpen:t,onClose:n,datasource:u,app:f,timeRange:p}=e,[E,y]=(0,i.useState)(!1),[O,L]=(0,i.useState)(!1),D="grafana.datasources.loki.browser.labels",C=(0,j.of)(Ra);(0,i.useEffect)(()=>{t&&u.languageProvider.fetchLabels({timeRange:p}).then(z=>{y(!0),L(z.length>0)})},[u,t,p]);const k=z=>{const{query:Z,onChange:ge,onRunQuery:re}=e,le={...Z,expr:z};ge(le),re()},X=z=>{k(z),n()},me=()=>{(0,ue.rR)("grafana_loki_label_browser_closed",{app:f,closeType:"modalClose"}),n()};return(0,o.jsxs)(tt.a,{isOpen:t,title:"Label browser",onDismiss:me,className:C.modal,children:[!E&&(0,o.jsx)(Ot._,{text:"Loading labels..."}),E&&!O&&(0,o.jsx)("p",{children:"No labels found."}),E&&O&&(0,o.jsx)(Ue.b,{storageKey:D,defaultValue:[],children:(z,Z,ge)=>(0,o.jsx)(Yr,{languageProvider:u.languageProvider,onChange:X,lastUsedLabels:z,storeLastUsedLabels:Z,deleteLastUsedLabels:ge,app:f,timeRange:p})})]})},Ra=e=>({modal:(0,h.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var wa=c(65307),ct=c(43548),Pt=c(60706),Ta=c(43127),qr=c(9e4),jt=c(81580),ea=c(97801),Fa=c(85269),ta=c(44600),Mt=c(50877),It=c(14186),Je=c(90182),ra=c(81392),Ce=c(3721),ut=Object.defineProperty,Ye=Object.defineProperties,aa=Object.getOwnPropertyDescriptors,Rr=Object.getOwnPropertySymbols,na=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable,wr=(e,t,n)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,er=(e,t)=>{for(var n in t||(t={}))na.call(t,n)&&wr(e,n,t[n]);if(Rr)for(var n of Rr(t))Lt.call(t,n)&&wr(e,n,t[n]);return e},Wt=(e,t)=>Ye(e,aa(t));const Ca="You have conflicting label filters";function sa({item:e,items:t,defaultOp:n,onChange:u,onDelete:f,onGetLabelNames:p,onGetLabelValues:E,invalidLabel:y,invalidValue:O,multiValueSeparator:L="|"}){var D;const[C,k]=(0,i.useState)({}),[X,me]=(0,i.useState)(!1),[z,Z]=(0,i.useState)(!1),ge=(Y=e.op)=>{var Re;return(Re=Tr.find(ie=>ie.label===Y))==null?void 0:Re.isMultiValue},re=Y=>Y?Y.indexOf(L)>0?Y.split(L):[Y]:[],le=()=>{const Y=C.labelValues?[...C.labelValues]:[],Re=re(e?.value).map(Mt.z);return(0,ne.uniqBy)([...Re,...Y],"value")},W=ia(e,t),{current:Ee}=(0,i.useRef)((0,ta.A)());return i.createElement("div",{"data-testid":"visual-query-builder-dimensions-filter-item"},i.createElement(It.I,{error:Ca,invalid:W?!0:void 0},i.createElement(ra.M,null,i.createElement(Je.l6,{placeholder:"Select label","data-testid":ce.Tp.components.QueryBuilder.labelSelect,inputId:`visual-query-builder-dimensions-filter-item-key-${Ee}`,width:"auto",value:e.label?(0,Mt.z)(e.label):null,allowCustomValue:!0,onOpenMenu:async()=>{k({isLoadingLabelNames:!0});const Y=await p(e);me(!0),k({labelNames:Y,isLoadingLabelNames:void 0})},onCloseMenu:()=>{me(!1)},isOpen:X,isLoading:C.isLoadingLabelNames,options:C.labelNames,onChange:Y=>{var Re;Y.value&&u(Wt(er({},e),{op:(Re=e.op)!=null?Re:n,label:Y.value}))},invalid:W||y}),i.createElement(Je.l6,{"data-testid":ce.Tp.components.QueryBuilder.matchOperatorSelect,value:(0,Mt.z)((D=e.op)!=null?D:n),options:Tr,width:"auto",onChange:Y=>{Y.value&&u(Wt(er({},e),{op:Y.value,value:ge(Y.value)?e.value:re(e?.value)[0]}))},invalid:W}),i.createElement(Je.l6,{placeholder:"Select value","data-testid":ce.Tp.components.QueryBuilder.valueSelect,inputId:`visual-query-builder-dimensions-filter-item-value-${Ee}`,width:"auto",value:ge()?re(e?.value).map(Mt.z):re(e?.value).map(Mt.z)[0],allowCustomValue:!0,onOpenMenu:async()=>{k({isLoadingLabelValues:!0});const Y=await E(e);k(Wt(er({},C),{labelValues:Y,isLoadingLabelValues:void 0})),Z(!0)},onCloseMenu:()=>{Z(!1)},isOpen:z,isMulti:ge(),isLoading:C.isLoadingLabelValues,options:le(),onChange:Y=>{var Re,ie;if(Y.value)u(Wt(er({},e),{value:Y.value,op:(Re=e.op)!=null?Re:n}));else{const Ne=Y.map(Be=>{if(Be.value)return Be.value}).filter(Be=>Be!==void 0).join(L);u(Wt(er({},e),{value:Ne,op:(ie=e.op)!=null?ie:n}))}},invalid:W||O}),i.createElement(Ce.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:f}))))}const Tr=[{label:"=",value:"=",description:"Equals",isMultiValue:!1},{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0}];function ia(e,t){if(!e.label||!e.op||!e.value||t.length<2)return!1;const n=e.op.toString().startsWith("!");return t.filter(p=>p.label===e.label&&p.value===e.value&&p.op!==e.op).some(p=>{var E,y;return!!(n&&((E=p?.op)==null?void 0:E.toString().startsWith("!"))===!1||n===!1&&((y=p?.op)!=null&&y.toString().startsWith("!")))})}const Fr="Select at least 1 label filter (label and value)";function tr({labelsFilters:e,onChange:t,onGetLabelNames:n,onGetLabelValues:u,labelFilterRequired:f,multiValueSeparator:p}){const E="=",[y,O]=(0,i.useState)([{op:E}]);(0,i.useEffect)(()=>{e.length>0?O(e):O([{op:E}])},[e]);const L=C=>{O(C);const k=C.filter(X=>X.label!==void 0&&X.value!==void 0);(0,ne.isEqual)(k,e)||t(k)},D=y.some(C=>C.label&&C.value);return i.createElement(ea.B,null,i.createElement(jt.c,{label:"Label filters",error:Fr,invalid:f&&!D},i.createElement(Fa.o,{items:y,onChange:L,renderItem:(C,k,X)=>i.createElement(sa,{item:C,items:y,defaultOp:E,onChange:k,onDelete:X,onGetLabelNames:n,onGetLabelValues:u,invalidLabel:f&&!C.label,invalidValue:f&&!C.value,multiValueSeparator:p})})))}var rr=c(36663);function Nt({title:e,stepNumber:t,markdown:n,children:u}){const f=(0,j.of)(Aa);return i.createElement("div",{className:f.box},t!==void 0&&i.createElement("div",{className:f.stepNumber},t),i.createElement("div",{className:f.boxInner},e&&i.createElement("div",{className:f.header},i.createElement("span",null,e)),i.createElement("div",{className:f.body},n&&i.createElement("div",{dangerouslySetInnerHTML:{__html:(0,rr.G)(n)}}),u)))}const Aa=e=>({box:(0,h.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.radius.default,position:"relative"}),boxInner:(0,h.css)({marginLeft:e.spacing(4)}),stepNumber:(0,h.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:e.shape.radius.circle,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,h.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,h.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})});var ar=c(92762),oa=c(21103),fr=c(91076),Cr=c(1604),Da=c(3988),_e=c(56034),pr=c(14578),la=c(98587),Tt=c(58168),Ar=c(40961);function nt(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function yt(e){var t=nt(e).Element;return e instanceof t||e instanceof Element}function dt(e){var t=nt(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function hr(e){if(typeof ShadowRoot>"u")return!1;var t=nt(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var Ft=Math.max,nr=Math.min,St=Math.round;function gr(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function mr(){return!/^((?!chrome|android).)*safari/i.test(gr())}function Vt(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var u=e.getBoundingClientRect(),f=1,p=1;t&&dt(e)&&(f=e.offsetWidth>0&&St(u.width)/e.offsetWidth||1,p=e.offsetHeight>0&&St(u.height)/e.offsetHeight||1);var E=yt(e)?nt(e):window,y=E.visualViewport,O=!mr()&&n,L=(u.left+(O&&y?y.offsetLeft:0))/f,D=(u.top+(O&&y?y.offsetTop:0))/p,C=u.width/f,k=u.height/p;return{width:C,height:k,top:D,right:L+C,bottom:D+k,left:L,x:L,y:D}}function Dr(e){var t=nt(e),n=t.pageXOffset,u=t.pageYOffset;return{scrollLeft:n,scrollTop:u}}function ja(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Ma(e){return e===nt(e)||!dt(e)?Dr(e):ja(e)}function bt(e){return e?(e.nodeName||"").toLowerCase():null}function Ct(e){return((yt(e)?e.ownerDocument:e.document)||window.document).documentElement}function jr(e){return Vt(Ct(e)).left+Dr(e).scrollLeft}function xt(e){return nt(e).getComputedStyle(e)}function vr(e){var t=xt(e),n=t.overflow,u=t.overflowX,f=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+f+u)}function Ia(e){var t=e.getBoundingClientRect(),n=St(t.width)/e.offsetWidth||1,u=St(t.height)/e.offsetHeight||1;return n!==1||u!==1}function Na(e,t,n){n===void 0&&(n=!1);var u=dt(t),f=dt(t)&&Ia(t),p=Ct(t),E=Vt(e,f,n),y={scrollLeft:0,scrollTop:0},O={x:0,y:0};return(u||!u&&!n)&&((bt(t)!=="body"||vr(p))&&(y=Ma(t)),dt(t)?(O=Vt(t,!0),O.x+=t.clientLeft,O.y+=t.clientTop):p&&(O.x=jr(p))),{x:E.left+y.scrollLeft-O.x,y:E.top+y.scrollTop-O.y,width:E.width,height:E.height}}function Or(e){var t=Vt(e),n=e.offsetWidth,u=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-u)<=1&&(u=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:u}}function _t(e){return bt(e)==="html"?e:e.assignedSlot||e.parentNode||(hr(e)?e.host:null)||Ct(e)}function ca(e){return["html","body","#document"].indexOf(bt(e))>=0?e.ownerDocument.body:dt(e)&&vr(e)?e:ca(_t(e))}function kt(e,t){var n;t===void 0&&(t=[]);var u=ca(e),f=u===((n=e.ownerDocument)==null?void 0:n.body),p=nt(u),E=f?[p].concat(p.visualViewport||[],vr(u)?u:[]):u,y=t.concat(E);return f?y:y.concat(kt(_t(E)))}function Ua(e){return["table","td","th"].indexOf(bt(e))>=0}function Mr(e){return!dt(e)||xt(e).position==="fixed"?null:e.offsetParent}function ua(e){var t=/firefox/i.test(gr()),n=/Trident/i.test(gr());if(n&&dt(e)){var u=xt(e);if(u.position==="fixed")return null}var f=_t(e);for(hr(f)&&(f=f.host);dt(f)&&["html","body"].indexOf(bt(f))<0;){var p=xt(f);if(p.transform!=="none"||p.perspective!=="none"||p.contain==="paint"||["transform","perspective"].indexOf(p.willChange)!==-1||t&&p.willChange==="filter"||t&&p.filter&&p.filter!=="none")return f;f=f.parentNode}return null}function zt(e){for(var t=nt(e),n=Mr(e);n&&Ua(n)&&xt(n).position==="static";)n=Mr(n);return n&&(bt(n)==="html"||bt(n)==="body"&&xt(n).position==="static")?t:n||ua(e)||t}var ot="top",ft="bottom",lt="right",st="left",yr="auto",Ht=[ot,ft,lt,st],Kt="start",Ut="end",Ba="clippingParents",Ir="viewport",sr="popper",Xa="reference",ir=Ht.reduce(function(e,t){return e.concat([t+"-"+Kt,t+"-"+Ut])},[]),da=[].concat(Ht,[yr]).reduce(function(e,t){return e.concat([t,t+"-"+Kt,t+"-"+Ut])},[]),Wa="beforeRead",Va="read",fa="afterRead",pa="beforeMain",_a="main",ka="afterMain",ha="beforeWrite",ga="write",ma="afterWrite",za=[Wa,Va,fa,pa,_a,ka,ha,ga,ma];function va(e){var t=new Map,n=new Set,u=[];e.forEach(function(p){t.set(p.name,p)});function f(p){n.add(p.name);var E=[].concat(p.requires||[],p.requiresIfExists||[]);E.forEach(function(y){if(!n.has(y)){var O=t.get(y);O&&f(O)}}),u.push(p)}return e.forEach(function(p){n.has(p.name)||f(p)}),u}function Oa(e){var t=va(e);return za.reduce(function(n,u){return n.concat(t.filter(function(f){return f.phase===u}))},[])}function ya(e){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})})),t}}function Ha(e){var t=e.reduce(function(n,u){var f=n[u.name];return n[u.name]=f?Object.assign({},f,u,{options:Object.assign({},f.options,u.options),data:Object.assign({},f.data,u.data)}):u,n},{});return Object.keys(t).map(function(n){return t[n]})}var ba={placement:"bottom",modifiers:[],strategy:"absolute"};function Nr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(u){return!(u&&typeof u.getBoundingClientRect=="function")})}function Ka(e){e===void 0&&(e={});var t=e,n=t.defaultModifiers,u=n===void 0?[]:n,f=t.defaultOptions,p=f===void 0?ba:f;return function(y,O,L){L===void 0&&(L=p);var D={placement:"bottom",orderedModifiers:[],options:Object.assign({},ba,p),modifiersData:{},elements:{reference:y,popper:O},attributes:{},styles:{}},C=[],k=!1,X={state:D,setOptions:function(ge){var re=typeof ge=="function"?ge(D.options):ge;z(),D.options=Object.assign({},p,D.options,re),D.scrollParents={reference:yt(y)?kt(y):y.contextElement?kt(y.contextElement):[],popper:kt(O)};var le=Oa(Ha([].concat(u,D.options.modifiers)));return D.orderedModifiers=le.filter(function(W){return W.enabled}),me(),X.update()},forceUpdate:function(){if(!k){var ge=D.elements,re=ge.reference,le=ge.popper;if(Nr(re,le)){D.rects={reference:Na(re,zt(le),D.options.strategy==="fixed"),popper:Or(le)},D.reset=!1,D.placement=D.options.placement,D.orderedModifiers.forEach(function(Be){return D.modifiersData[Be.name]=Object.assign({},Be.data)});for(var W=0;W<D.orderedModifiers.length;W++){if(D.reset===!0){D.reset=!1,W=-1;continue}var Ee=D.orderedModifiers[W],Y=Ee.fn,Re=Ee.options,ie=Re===void 0?{}:Re,Ne=Ee.name;typeof Y=="function"&&(D=Y({state:D,options:ie,name:Ne,instance:X})||D)}}}},update:ya(function(){return new Promise(function(Z){X.forceUpdate(),Z(D)})}),destroy:function(){z(),k=!0}};if(!Nr(y,O))return X;X.setOptions(L).then(function(Z){!k&&L.onFirstUpdate&&L.onFirstUpdate(Z)});function me(){D.orderedModifiers.forEach(function(Z){var ge=Z.name,re=Z.options,le=re===void 0?{}:re,W=Z.effect;if(typeof W=="function"){var Ee=W({state:D,name:ge,instance:X,options:le}),Y=function(){};C.push(Ee||Y)}})}function z(){C.forEach(function(Z){return Z()}),C=[]}return X}}var Ga=null,or={passive:!0};function xa(e){var t=e.state,n=e.instance,u=e.options,f=u.scroll,p=f===void 0?!0:f,E=u.resize,y=E===void 0?!0:E,O=nt(t.elements.popper),L=[].concat(t.scrollParents.reference,t.scrollParents.popper);return p&&L.forEach(function(D){D.addEventListener("scroll",n.update,or)}),y&&O.addEventListener("resize",n.update,or),function(){p&&L.forEach(function(D){D.removeEventListener("scroll",n.update,or)}),y&&O.removeEventListener("resize",n.update,or)}}const Ea={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:xa,data:{}};function pt(e){return e.split("-")[0]}function Gt(e){return e.split("-")[1]}function Zt(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Ur(e){var t=e.reference,n=e.element,u=e.placement,f=u?pt(u):null,p=u?Gt(u):null,E=t.x+t.width/2-n.width/2,y=t.y+t.height/2-n.height/2,O;switch(f){case ot:O={x:E,y:t.y-n.height};break;case ft:O={x:E,y:t.y+t.height};break;case lt:O={x:t.x+t.width,y};break;case st:O={x:t.x-n.width,y};break;default:O={x:t.x,y:t.y}}var L=f?Zt(f):null;if(L!=null){var D=L==="y"?"height":"width";switch(p){case Kt:O[L]=O[L]-(t[D]/2-n[D]/2);break;case Ut:O[L]=O[L]+(t[D]/2-n[D]/2);break;default:}}return O}function Br(e){var t=e.state,n=e.name;t.modifiersData[n]=Ur({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Pa={name:"popperOffsets",enabled:!0,phase:"read",fn:Br,data:{}};var La={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Za(e,t){var n=e.x,u=e.y,f=t.devicePixelRatio||1;return{x:St(n*f)/f||0,y:St(u*f)/f||0}}function Xr(e){var t,n=e.popper,u=e.popperRect,f=e.placement,p=e.variation,E=e.offsets,y=e.position,O=e.gpuAcceleration,L=e.adaptive,D=e.roundOffsets,C=e.isFixed,k=E.x,X=k===void 0?0:k,me=E.y,z=me===void 0?0:me,Z=typeof D=="function"?D({x:X,y:z}):{x:X,y:z};X=Z.x,z=Z.y;var ge=E.hasOwnProperty("x"),re=E.hasOwnProperty("y"),le=st,W=ot,Ee=window;if(L){var Y=zt(n),Re="clientHeight",ie="clientWidth";if(Y===nt(n)&&(Y=Ct(n),xt(Y).position!=="static"&&y==="absolute"&&(Re="scrollHeight",ie="scrollWidth")),Y=Y,f===ot||(f===st||f===lt)&&p===Ut){W=ft;var Ne=C&&Y===Ee&&Ee.visualViewport?Ee.visualViewport.height:Y[Re];z-=Ne-u.height,z*=O?1:-1}if(f===st||(f===ot||f===ft)&&p===Ut){le=lt;var Be=C&&Y===Ee&&Ee.visualViewport?Ee.visualViewport.width:Y[ie];X-=Be-u.width,X*=O?1:-1}}var Ge=Object.assign({position:y},L&&La),gt=D===!0?Za({x:X,y:z},nt(n)):{x:X,y:z};if(X=gt.x,z=gt.y,O){var it;return Object.assign({},Ge,(it={},it[W]=re?"0":"",it[le]=ge?"0":"",it.transform=(Ee.devicePixelRatio||1)<=1?"translate("+X+"px, "+z+"px)":"translate3d("+X+"px, "+z+"px, 0)",it))}return Object.assign({},Ge,(t={},t[W]=re?z+"px":"",t[le]=ge?X+"px":"",t.transform="",t))}function br(e){var t=e.state,n=e.options,u=n.gpuAcceleration,f=u===void 0?!0:u,p=n.adaptive,E=p===void 0?!0:p,y=n.roundOffsets,O=y===void 0?!0:y,L={placement:pt(t.placement),variation:Gt(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:f,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Xr(Object.assign({},L,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:E,roundOffsets:O})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Xr(Object.assign({},L,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:O})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const Ya={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:br,data:{}};function vt(e){var t=e.state;Object.keys(t.elements).forEach(function(n){var u=t.styles[n]||{},f=t.attributes[n]||{},p=t.elements[n];!dt(p)||!bt(p)||(Object.assign(p.style,u),Object.keys(f).forEach(function(E){var y=f[E];y===!1?p.removeAttribute(E):p.setAttribute(E,y===!0?"":y)}))})}function Wr(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(u){var f=t.elements[u],p=t.attributes[u]||{},E=Object.keys(t.styles.hasOwnProperty(u)?t.styles[u]:n[u]),y=E.reduce(function(O,L){return O[L]="",O},{});!dt(f)||!bt(f)||(Object.assign(f.style,y),Object.keys(p).forEach(function(O){f.removeAttribute(O)}))})}}const v={name:"applyStyles",enabled:!0,phase:"write",fn:vt,effect:Wr,requires:["computeStyles"]};function a(e,t,n){var u=pt(e),f=[st,ot].indexOf(u)>=0?-1:1,p=typeof n=="function"?n(Object.assign({},t,{placement:e})):n,E=p[0],y=p[1];return E=E||0,y=(y||0)*f,[st,lt].indexOf(u)>=0?{x:y,y:E}:{x:E,y}}function r(e){var t=e.state,n=e.options,u=e.name,f=n.offset,p=f===void 0?[0,0]:f,E=da.reduce(function(D,C){return D[C]=a(C,t.rects,p),D},{}),y=E[t.placement],O=y.x,L=y.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=O,t.modifiersData.popperOffsets.y+=L),t.modifiersData[u]=E}const s={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:r};var l={left:"right",right:"left",bottom:"top",top:"bottom"};function d(e){return e.replace(/left|right|bottom|top/g,function(t){return l[t]})}var m={start:"end",end:"start"};function x(e){return e.replace(/start|end/g,function(t){return m[t]})}function P(e,t){var n=nt(e),u=Ct(e),f=n.visualViewport,p=u.clientWidth,E=u.clientHeight,y=0,O=0;if(f){p=f.width,E=f.height;var L=mr();(L||!L&&t==="fixed")&&(y=f.offsetLeft,O=f.offsetTop)}return{width:p,height:E,x:y+jr(e),y:O}}function M(e){var t,n=Ct(e),u=Dr(e),f=(t=e.ownerDocument)==null?void 0:t.body,p=Ft(n.scrollWidth,n.clientWidth,f?f.scrollWidth:0,f?f.clientWidth:0),E=Ft(n.scrollHeight,n.clientHeight,f?f.scrollHeight:0,f?f.clientHeight:0),y=-u.scrollLeft+jr(e),O=-u.scrollTop;return xt(f||n).direction==="rtl"&&(y+=Ft(n.clientWidth,f?f.clientWidth:0)-p),{width:p,height:E,x:y,y:O}}function H(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&hr(n)){var u=t;do{if(u&&e.isSameNode(u))return!0;u=u.parentNode||u.host}while(u)}return!1}function K(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function J(e,t){var n=Vt(e,!1,t==="fixed");return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}function q(e,t,n){return t===Ir?K(P(e,n)):yt(t)?J(t,n):K(M(Ct(e)))}function Te(e){var t=kt(_t(e)),n=["absolute","fixed"].indexOf(xt(e).position)>=0,u=n&&dt(e)?zt(e):e;return yt(u)?t.filter(function(f){return yt(f)&&H(f,u)&&bt(f)!=="body"}):[]}function Se(e,t,n,u){var f=t==="clippingParents"?Te(e):[].concat(t),p=[].concat(f,[n]),E=p[0],y=p.reduce(function(O,L){var D=q(e,L,u);return O.top=Ft(D.top,O.top),O.right=nr(D.right,O.right),O.bottom=nr(D.bottom,O.bottom),O.left=Ft(D.left,O.left),O},q(e,E,u));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function We(){return{top:0,right:0,bottom:0,left:0}}function Qe(e){return Object.assign({},We(),e)}function ze(e,t){return t.reduce(function(n,u){return n[u]=e,n},{})}function Ke(e,t){t===void 0&&(t={});var n=t,u=n.placement,f=u===void 0?e.placement:u,p=n.strategy,E=p===void 0?e.strategy:p,y=n.boundary,O=y===void 0?Ba:y,L=n.rootBoundary,D=L===void 0?Ir:L,C=n.elementContext,k=C===void 0?sr:C,X=n.altBoundary,me=X===void 0?!1:X,z=n.padding,Z=z===void 0?0:z,ge=Qe(typeof Z!="number"?Z:ze(Z,Ht)),re=k===sr?Xa:sr,le=e.rects.popper,W=e.elements[me?re:k],Ee=Se(yt(W)?W:W.contextElement||Ct(e.elements.popper),O,D,E),Y=Vt(e.elements.reference),Re=Ur({reference:Y,element:le,strategy:"absolute",placement:f}),ie=K(Object.assign({},le,Re)),Ne=k===sr?ie:Y,Be={top:Ee.top-Ne.top+ge.top,bottom:Ne.bottom-Ee.bottom+ge.bottom,left:Ee.left-Ne.left+ge.left,right:Ne.right-Ee.right+ge.right},Ge=e.modifiersData.offset;if(k===sr&&Ge){var gt=Ge[f];Object.keys(Be).forEach(function(it){var Et=[lt,ft].indexOf(it)>=0?1:-1,He=[ot,ft].indexOf(it)>=0?"y":"x";Be[it]+=gt[He]*Et})}return Be}function ke(e,t){t===void 0&&(t={});var n=t,u=n.placement,f=n.boundary,p=n.rootBoundary,E=n.padding,y=n.flipVariations,O=n.allowedAutoPlacements,L=O===void 0?da:O,D=Gt(u),C=D?y?ir:ir.filter(function(me){return Gt(me)===D}):Ht,k=C.filter(function(me){return L.indexOf(me)>=0});k.length===0&&(k=C);var X=k.reduce(function(me,z){return me[z]=Ke(e,{placement:z,boundary:f,rootBoundary:p,padding:E})[pt(z)],me},{});return Object.keys(X).sort(function(me,z){return X[me]-X[z]})}function et(e){if(pt(e)===yr)return[];var t=d(e);return[x(e),t,x(t)]}function $t(e){var t=e.state,n=e.options,u=e.name;if(!t.modifiersData[u]._skip){for(var f=n.mainAxis,p=f===void 0?!0:f,E=n.altAxis,y=E===void 0?!0:E,O=n.fallbackPlacements,L=n.padding,D=n.boundary,C=n.rootBoundary,k=n.altBoundary,X=n.flipVariations,me=X===void 0?!0:X,z=n.allowedAutoPlacements,Z=t.options.placement,ge=pt(Z),re=ge===Z,le=O||(re||!me?[d(Z)]:et(Z)),W=[Z].concat(le).reduce(function(Kr,ur){return Kr.concat(pt(ur)===yr?ke(t,{placement:ur,boundary:D,rootBoundary:C,padding:L,flipVariations:me,allowedAutoPlacements:z}):ur)},[]),Ee=t.rects.reference,Y=t.rects.popper,Re=new Map,ie=!0,Ne=W[0],Be=0;Be<W.length;Be++){var Ge=W[Be],gt=pt(Ge),it=Gt(Ge)===Kt,Et=[ot,ft].indexOf(gt)>=0,He=Et?"width":"height",Ae=Ke(t,{placement:Ge,boundary:D,rootBoundary:C,altBoundary:k,padding:L}),Ze=Et?it?lt:st:it?ft:ot;Ee[He]>Y[He]&&(Ze=d(Ze));var At=d(Ze),Xt=[];if(p&&Xt.push(Ae[gt]<=0),y&&Xt.push(Ae[Ze]<=0,Ae[At]<=0),Xt.every(function(Kr){return Kr})){Ne=Ge,ie=!1;break}Re.set(Ge,Xt)}if(ie)for(var Pr=me?3:1,Hr=function(ur){var Sa=W.find(function(sn){var Lr=Re.get(sn);if(Lr)return Lr.slice(0,ur).every(function(xn){return xn})});if(Sa)return Ne=Sa,"break"},Jt=Pr;Jt>0;Jt--){var nn=Hr(Jt);if(nn==="break")break}t.placement!==Ne&&(t.modifiersData[u]._skip=!0,t.placement=Ne,t.reset=!0)}}const Qt={name:"flip",enabled:!0,phase:"main",fn:$t,requiresIfExists:["offset"],data:{_skip:!1}};function Vr(e){return e==="x"?"y":"x"}function Bt(e,t,n){return Ft(e,nr(t,n))}function lr(e,t,n){var u=Bt(e,t,n);return u>n?n:u}function ln(e){var t=e.state,n=e.options,u=e.name,f=n.mainAxis,p=f===void 0?!0:f,E=n.altAxis,y=E===void 0?!1:E,O=n.boundary,L=n.rootBoundary,D=n.altBoundary,C=n.padding,k=n.tether,X=k===void 0?!0:k,me=n.tetherOffset,z=me===void 0?0:me,Z=Ke(t,{boundary:O,rootBoundary:L,padding:C,altBoundary:D}),ge=pt(t.placement),re=Gt(t.placement),le=!re,W=Zt(ge),Ee=Vr(W),Y=t.modifiersData.popperOffsets,Re=t.rects.reference,ie=t.rects.popper,Ne=typeof z=="function"?z(Object.assign({},t.rects,{placement:t.placement})):z,Be=typeof Ne=="number"?{mainAxis:Ne,altAxis:Ne}:Object.assign({mainAxis:0,altAxis:0},Ne),Ge=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,gt={x:0,y:0};if(Y){if(p){var it,Et=W==="y"?ot:st,He=W==="y"?ft:lt,Ae=W==="y"?"height":"width",Ze=Y[W],At=Ze+Z[Et],Xt=Ze-Z[He],Pr=X?-ie[Ae]/2:0,Hr=re===Kt?Re[Ae]:ie[Ae],Jt=re===Kt?-ie[Ae]:-Re[Ae],nn=t.elements.arrow,Kr=X&&nn?Or(nn):{width:0,height:0},ur=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:We(),Sa=ur[Et],sn=ur[He],Lr=Bt(0,Re[Ae],Kr[Ae]),xn=le?Re[Ae]/2-Pr-Lr-Sa-Be.mainAxis:Hr-Lr-Sa-Be.mainAxis,To=le?-Re[Ae]/2+Pr+Lr+sn+Be.mainAxis:Jt+Lr+sn+Be.mainAxis,En=t.elements.arrow&&zt(t.elements.arrow),Fo=En?W==="y"?En.clientTop||0:En.clientLeft||0:0,as=(it=Ge?.[W])!=null?it:0,Co=Ze+xn-as-Fo,Ao=Ze+To-as,ns=Bt(X?nr(At,Co):At,Ze,X?Ft(Xt,Ao):Xt);Y[W]=ns,gt[W]=ns-Ze}if(y){var ss,Do=W==="x"?ot:st,jo=W==="x"?ft:lt,Sr=Y[Ee],on=Ee==="y"?"height":"width",is=Sr+Z[Do],os=Sr-Z[jo],Pn=[ot,st].indexOf(ge)!==-1,ls=(ss=Ge?.[Ee])!=null?ss:0,cs=Pn?is:Sr-Re[on]-ie[on]-ls+Be.altAxis,us=Pn?Sr+Re[on]+ie[on]-ls-Be.altAxis:os,ds=X&&Pn?lr(cs,Sr,us):Bt(X?cs:is,Sr,X?us:os);Y[Ee]=ds,gt[Ee]=ds-Sr}t.modifiersData[u]=gt}}const _r={name:"preventOverflow",enabled:!0,phase:"main",fn:ln,requiresIfExists:["offset"]};var cn=function(t,n){return t=typeof t=="function"?t(Object.assign({},n.rects,{placement:n.placement})):t,Qe(typeof t!="number"?t:ze(t,Ht))};function un(e){var t,n=e.state,u=e.name,f=e.options,p=n.elements.arrow,E=n.modifiersData.popperOffsets,y=pt(n.placement),O=Zt(y),L=[st,lt].indexOf(y)>=0,D=L?"height":"width";if(!(!p||!E)){var C=cn(f.padding,n),k=Or(p),X=O==="y"?ot:st,me=O==="y"?ft:lt,z=n.rects.reference[D]+n.rects.reference[O]-E[O]-n.rects.popper[D],Z=E[O]-n.rects.reference[O],ge=zt(p),re=ge?O==="y"?ge.clientHeight||0:ge.clientWidth||0:0,le=z/2-Z/2,W=C[X],Ee=re-k[D]-C[me],Y=re/2-k[D]/2+le,Re=Bt(W,Y,Ee),ie=O;n.modifiersData[u]=(t={},t[ie]=Re,t.centerOffset=Re-Y,t)}}function Xe(e){var t=e.state,n=e.options,u=n.element,f=u===void 0?"[data-popper-arrow]":u;f!=null&&(typeof f=="string"&&(f=t.elements.popper.querySelector(f),!f)||H(t.elements.popper,f)&&(t.elements.arrow=f))}const ht={name:"arrow",enabled:!0,phase:"main",fn:un,effect:Xe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function at(e,t,n){return n===void 0&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Yt(e){return[ot,lt,ft,st].some(function(t){return e[t]>=0})}function fs(e){var t=e.state,n=e.name,u=t.rects.reference,f=t.rects.popper,p=t.modifiersData.preventOverflow,E=Ke(t,{elementContext:"reference"}),y=Ke(t,{altBoundary:!0}),O=at(E,u),L=at(y,f,p),D=Yt(O),C=Yt(L);t.modifiersData[n]={referenceClippingOffsets:O,popperEscapeOffsets:L,isReferenceHidden:D,hasPopperEscaped:C},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":D,"data-popper-escaped":C})}var ps=[Ea,Pa,Ya,v,s,Qt,_r,ht,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:fs}],hs=Ka({defaultModifiers:ps}),gs=c(30115),ms=c.n(gs),Io=function(t){return Array.isArray(t)?t[0]:t},vs=function(t){if(typeof t=="function"){for(var n=arguments.length,u=new Array(n>1?n-1:0),f=1;f<n;f++)u[f-1]=arguments[f];return t.apply(void 0,u)}},No=function(t,n){if(typeof t=="function")return vs(t,n);t!=null&&(t.current=n)},Ln=function(t){return t.reduce(function(n,u){var f=u[0],p=u[1];return n[f]=p,n},{})},Sn=typeof window<"u"&&window.document&&window.document.createElement?i.useLayoutEffect:i.useEffect,Os=[],ys=function(t,n,u){u===void 0&&(u={});var f=i.useRef(null),p={onFirstUpdate:u.onFirstUpdate,placement:u.placement||"bottom",strategy:u.strategy||"absolute",modifiers:u.modifiers||Os},E=i.useState({styles:{popper:{position:p.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),y=E[0],O=E[1],L=i.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(X){var me=X.state,z=Object.keys(me.elements);Ar.flushSync(function(){O({styles:Ln(z.map(function(Z){return[Z,me.styles[Z]||{}]})),attributes:Ln(z.map(function(Z){return[Z,me.attributes[Z]]}))})})},requires:["computeStyles"]}},[]),D=i.useMemo(function(){var k={onFirstUpdate:p.onFirstUpdate,placement:p.placement,strategy:p.strategy,modifiers:[].concat(p.modifiers,[L,{name:"applyStyles",enabled:!1}])};return ms()(f.current,k)?f.current||k:(f.current=k,k)},[p.onFirstUpdate,p.placement,p.strategy,p.modifiers,L]),C=i.useRef();return Sn(function(){C.current&&C.current.setOptions(D)},[D]),Sn(function(){if(!(t==null||n==null)){var k=u.createPopper||hs,X=k(t,n,D);return C.current=X,function(){X.destroy(),C.current=null}}},[t,n,u.createPopper]),{state:C.current?C.current.state:null,styles:y.styles,attributes:y.attributes,update:C.current?C.current.update:null,forceUpdate:C.current?C.current.forceUpdate:null}};function $n(e){var t=i.useRef(e);return t.current=e,i.useCallback(function(){return t.current},[])}var bs=function(){};function xs(e){var t=e.initial,n=e.value,u=e.onChange,f=u===void 0?bs:u;if(t===void 0&&n===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var p=i.useState(t),E=p[0],y=p[1],O=$n(E),L=i.useCallback(function(C){var k=O(),X=typeof C=="function"?C(k):C;typeof X.persist=="function"&&X.persist(),y(X),typeof f=="function"&&f(X)},[O,f]),D=n!==void 0;return[D?n:E,D?f:L]}function Qn(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),function(){return{width:0,height:0,top:t,right:e,bottom:t,left:e,x:0,y:0,toJSON:function(){return null}}}}var Es=["styles","attributes"],Rn={getBoundingClientRect:Qn()},wn={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function Ps(e,t){var n,u,f;e===void 0&&(e={}),t===void 0&&(t={});var p=Object.keys(wn).reduce(function(He,Ae){var Ze;return(0,Tt.A)({},He,(Ze={},Ze[Ae]=He[Ae]!==void 0?He[Ae]:wn[Ae],Ze))},e),E=i.useMemo(function(){return[{name:"offset",options:{offset:p.offset}}]},Array.isArray(p.offset)?p.offset:[]),y=(0,Tt.A)({},t,{placement:t.placement||p.placement,modifiers:t.modifiers||E}),O=i.useState(null),L=O[0],D=O[1],C=i.useState(null),k=C[0],X=C[1],me=xs({initial:p.defaultVisible,value:p.visible,onChange:p.onVisibleChange}),z=me[0],Z=me[1],ge=i.useRef();i.useEffect(function(){return function(){return clearTimeout(ge.current)}},[]);var re=ys(p.followCursor?Rn:L,k,y),le=re.styles,W=re.attributes,Ee=(0,la.A)(re,Es),Y=Ee.update,Re=$n({visible:z,triggerRef:L,tooltipRef:k,finalConfig:p}),ie=i.useCallback(function(He){return Array.isArray(p.trigger)?p.trigger.includes(He):p.trigger===He},Array.isArray(p.trigger)?p.trigger:[p.trigger]),Ne=i.useCallback(function(){clearTimeout(ge.current),ge.current=window.setTimeout(function(){return Z(!1)},p.delayHide)},[p.delayHide,Z]),Be=i.useCallback(function(){clearTimeout(ge.current),ge.current=window.setTimeout(function(){return Z(!0)},p.delayShow)},[p.delayShow,Z]),Ge=i.useCallback(function(){Re().visible?Ne():Be()},[Re,Ne,Be]);i.useEffect(function(){if(Re().finalConfig.closeOnOutsideClick){var He=function(Ze){var At,Xt=Re(),Pr=Xt.tooltipRef,Hr=Xt.triggerRef,Jt=(Ze.composedPath==null||(At=Ze.composedPath())==null?void 0:At[0])||Ze.target;Jt instanceof Node&&Pr!=null&&Hr!=null&&!Pr.contains(Jt)&&!Hr.contains(Jt)&&Ne()};return document.addEventListener("mousedown",He),function(){return document.removeEventListener("mousedown",He)}}},[Re,Ne]),i.useEffect(function(){if(!(L==null||!ie("click")))return L.addEventListener("click",Ge),function(){return L.removeEventListener("click",Ge)}},[L,ie,Ge]),i.useEffect(function(){if(!(L==null||!ie("double-click")))return L.addEventListener("dblclick",Ge),function(){return L.removeEventListener("dblclick",Ge)}},[L,ie,Ge]),i.useEffect(function(){if(!(L==null||!ie("right-click"))){var He=function(Ze){Ze.preventDefault(),Ge()};return L.addEventListener("contextmenu",He),function(){return L.removeEventListener("contextmenu",He)}}},[L,ie,Ge]),i.useEffect(function(){if(!(L==null||!ie("focus")))return L.addEventListener("focus",Be),L.addEventListener("blur",Ne),function(){L.removeEventListener("focus",Be),L.removeEventListener("blur",Ne)}},[L,ie,Be,Ne]),i.useEffect(function(){if(!(L==null||!ie("hover")))return L.addEventListener("mouseenter",Be),L.addEventListener("mouseleave",Ne),function(){L.removeEventListener("mouseenter",Be),L.removeEventListener("mouseleave",Ne)}},[L,ie,Be,Ne]),i.useEffect(function(){if(!(k==null||!ie("hover")||!Re().finalConfig.interactive))return k.addEventListener("mouseenter",Be),k.addEventListener("mouseleave",Ne),function(){k.removeEventListener("mouseenter",Be),k.removeEventListener("mouseleave",Ne)}},[k,ie,Be,Ne,Re]);var gt=Ee==null||(n=Ee.state)==null||(u=n.modifiersData)==null||(f=u.hide)==null?void 0:f.isReferenceHidden;i.useEffect(function(){p.closeOnTriggerHidden&&gt&&Ne()},[p.closeOnTriggerHidden,Ne,gt]),i.useEffect(function(){if(!p.followCursor||L==null)return;function He(Ae){var Ze=Ae.clientX,At=Ae.clientY;Rn.getBoundingClientRect=Qn(Ze,At),Y?.()}return L.addEventListener("mousemove",He),function(){return L.removeEventListener("mousemove",He)}},[p.followCursor,L,Y]),i.useEffect(function(){if(!(k==null||Y==null||p.mutationObserverOptions==null)){var He=new MutationObserver(Y);return He.observe(k,p.mutationObserverOptions),function(){return He.disconnect()}}},[p.mutationObserverOptions,k,Y]);var it=function(Ae){return Ae===void 0&&(Ae={}),(0,Tt.A)({},Ae,{style:(0,Tt.A)({},Ae.style,le.popper)},W.popper,{"data-popper-interactive":p.interactive})},Et=function(Ae){return Ae===void 0&&(Ae={}),(0,Tt.A)({},Ae,W.arrow,{style:(0,Tt.A)({},Ae.style,le.arrow),"data-popper-arrow":!0})};return(0,Tt.A)({getArrowProps:Et,getTooltipProps:it,setTooltipRef:X,setTriggerRef:D,tooltipRef:k,triggerRef:L,visible:z},Ee)}var Ls=c(17464),Ss=Object.defineProperty,$s=Object.defineProperties,Qs=Object.getOwnPropertyDescriptors,Tn=Object.getOwnPropertySymbols,Rs=Object.prototype.hasOwnProperty,ws=Object.prototype.propertyIsEnumerable,Fn=(e,t,n)=>t in e?Ss(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ts=(e,t)=>{for(var n in t||(t={}))Rs.call(t,n)&&Fn(e,n,t[n]);if(Tn)for(var n of Tn(t))ws.call(t,n)&&Fn(e,n,t[n]);return e},Fs=(e,t)=>$s(e,Qs(t));const Cn=i.memo(({definition:e,operation:t,innerQueryPlaceholder:n})=>{const u=(0,j.of)(Cs),[f,p]=(0,i.useState)(!1),{getTooltipProps:E,setTooltipRef:y,setTriggerRef:O,visible:L}=Ps({placement:"top",visible:f,offset:[0,16],onVisibleChange:p,interactive:!0,trigger:["click"]});return i.createElement(i.Fragment,null,i.createElement(ae.$n,{title:"Click to show description",ref:O,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),L&&i.createElement(Ls.ZL,null,i.createElement("div",Fs(Ts({ref:y},E()),{className:u.docBox}),i.createElement("div",{className:u.docBoxHeader},i.createElement("span",null,e.renderer(t,e,n)),i.createElement(Me.Z,{grow:1}),i.createElement(ae.$n,{icon:"times",onClick:()=>p(!1),fill:"text",variant:"secondary",title:"Remove operation"})),i.createElement("div",{className:u.docBoxBody,dangerouslySetInnerHTML:{__html:As(e,t)}}))))});Cn.displayName="OperationDocs";const Cs=e=>({docBox:(0,h.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,h.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,h.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,h.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,h.css)({opacity:0,color:e.colors.text.secondary})});function As(e,t){var n;return(0,rr.G)(e.explainHandler?e.explainHandler(t,e):(n=e.documentation)!=null?n:"no docs")}var Ds=Object.defineProperty,js=Object.defineProperties,Ms=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,Is=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable,Dn=(e,t,n)=>t in e?Ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dn=(e,t)=>{for(var n in t||(t={}))Is.call(t,n)&&Dn(e,n,t[n]);if(An)for(var n of An(t))Ns.call(t,n)&&Dn(e,n,t[n]);return e},jn=(e,t)=>js(e,Ms(t));const Mn=i.memo(({operation:e,definition:t,index:n,onChange:u,onRemove:f,queryModeller:p,dragHandleProps:E})=>{var y;const O=(0,j.of)(Us),[L,D]=(0,i.useState)({}),C=()=>{if(L.isOpen)D(jn(dn({},L),{isOpen:!1}));else{const k=p.getAlternativeOperations(t.alternativesKey).map(X=>({label:X.name,value:X}));D({isOpen:!0,alternatives:k})}};return i.createElement("div",{className:O.header},!L.isOpen&&i.createElement(i.Fragment,null,i.createElement("div",dn({},E),(y=t.name)!=null?y:t.id),i.createElement(Me.Z,{grow:1}),i.createElement("div",{className:`${O.operationHeaderButtons} operation-header-show-on-hover`},i.createElement(ae.$n,{icon:"angle-down",size:"sm",onClick:C,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),i.createElement(Cn,{definition:t,operation:e,innerQueryPlaceholder:p.innerQueryPlaceholder}),i.createElement(ae.$n,{icon:"times",size:"sm",onClick:()=>f(n),fill:"text",variant:"secondary",title:"Remove operation"}))),L.isOpen&&i.createElement("div",{className:O.selectWrapper},i.createElement(Je.l6,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:L.alternatives,isOpen:!0,onCloseMenu:C,onChange:k=>{if(k.value){const X=p.getOperationDefinition(k.value.id),me=[...X.defaultParams];for(let Z=0;Z<Math.min(e.params.length,me.length);Z++)X.params[Z].type===t.params[Z].type&&(me[Z]=e.params[Z]);const z=jn(dn({},e),{params:me,id:k.value.id});u(n,t.changeTypeHandler?t.changeTypeHandler(z,X):z)}}})))});Mn.displayName="OperationHeader";const Us=e=>({header:(0,h.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,h.css)({opacity:1}),selectWrapper:(0,h.css)({paddingRight:e.spacing(2)})});var kr=c(51440),Bs=c(10880);function Xs(e){if(e.editor)return e.editor;if(e.options)return _s;switch(e.type){case"boolean":return Vs;case"number":case"string":default:return Ws}}function Ws(e){var t;return i.createElement(kr.D,{id:Ja(e.operationId,e.index),defaultValue:(t=e.value)==null?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:n=>{e.onChange(e.index,n.currentTarget.value),e.paramDef.runQueryOnEnter&&n.type==="keydown"&&e.onRunQuery()}})}function Vs(e){return i.createElement(Bs.S,{id:Ja(e.operationId,e.index),value:!!e.value,onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function _s({paramDef:e,value:t,index:n,operationId:u,onChange:f}){var p,E;const y=(0,j.of)(ks);let O=e.options;(p=O[0])!=null&&p.label||(O=e.options.map(D=>({label:D.toString(),value:D})));let L=(E=O.find(D=>D.value===t))!=null?E:(0,Mt.z)(t);return!t&&e.optional?i.createElement("div",{className:y.optionalParam},i.createElement(ae.$n,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>f(n,O[0].value)},e.name)):i.createElement(ye.B,{gap:.5,direction:"row",alignItems:"center"},i.createElement(Je.l6,{id:Ja(u,n),value:L,options:O,placeholder:e.placeholder,allowCustomValue:!0,onChange:D=>f(n,D.value),width:e.minWidth||"auto"}),e.optional&&i.createElement(ae.$n,{"data-testid":`operations.${n}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>f(n,"")}))}const ks=e=>({optionalParam:(0,h.css)({marginTop:e.spacing(1)})});function Ja(e,t){return`operations.${e}.param.${t}`}var zs=Object.defineProperty,Hs=Object.defineProperties,Ks=Object.getOwnPropertyDescriptors,In=Object.getOwnPropertySymbols,Gs=Object.prototype.hasOwnProperty,Zs=Object.prototype.propertyIsEnumerable,Nn=(e,t,n)=>t in e?zs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qa=(e,t)=>{for(var n in t||(t={}))Gs.call(t,n)&&Nn(e,n,t[n]);if(In)for(var n of In(t))Zs.call(t,n)&&Nn(e,n,t[n]);return e},en=(e,t)=>Hs(e,Ks(t));function Ys({provided:e,flash:t,isConflicting:n,highlight:u,index:f,queryModeller:p,onChange:E,onRemove:y,operation:O,definition:L,query:D,timeRange:C,onRunQuery:k,datasource:X}){const me=(0,j.$j)(),z=Js(me,n),Z=qs(t),{current:ge}=(0,i.useRef)((0,ta.A)()),re=(Y,Re)=>{const ie=en(qa({},O),{params:[...O.params]});ie.params[Y]=Re,fn(L,ie,f,Y,E)},le=()=>{const Y=en(qa({},O),{params:[...O.params,""]});fn(L,Y,f,O.params.length,E)},W=Y=>{const Re=en(qa({},O),{params:[...O.params.slice(0,Y),...O.params.slice(Y+1)]});fn(L,Re,f,Y,E)};let Ee;if(L.params.length>0){const Y=L.params[L.params.length-1];Y.restParam&&(Ee=ei(Y,le,f,O.params.length,z))}return i.createElement("div",en(qa({className:(0,h.cx)(z.card,(Z||u)&&z.cardHighlight,n&&z.cardError),ref:e.innerRef},e.draggableProps),{"data-testid":`operations.${f}.wrapper`}),i.createElement(Mn,{operation:O,dragHandleProps:e.dragHandleProps,definition:L,index:f,onChange:E,onRemove:y,queryModeller:p}),i.createElement("div",{className:z.body},O.params.map((Y,Re)=>{const ie=L.params[Math.min(L.params.length-1,Re)],Ne=Xs(ie);return i.createElement("div",{className:z.paramRow,key:`${Re}-1`},!ie.hideName&&i.createElement("div",{className:z.paramName},i.createElement("label",{htmlFor:Ja(ge,Re)},ie.name),ie.description&&i.createElement(_e.m,{placement:"top",content:ie.description,theme:"info"},i.createElement(pr.I,{name:"info-circle",size:"sm",className:z.infoIcon}))),i.createElement("div",{className:z.paramValue},i.createElement(ye.B,{gap:.5,direction:"row",alignItems:"center",wrap:!1},i.createElement(Ne,{index:Re,paramDef:ie,value:O.params[Re],operation:O,operationId:ge,onChange:re,onRunQuery:k,query:D,datasource:X,timeRange:C,queryModeller:p}),ie.restParam&&(O.params.length>L.params.length||ie.optional)&&i.createElement(ae.$n,{"data-testid":`operations.${f}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${ie.name}`,onClick:()=>W(Re)}))))})),Ee,f<D.operations.length-1&&i.createElement("div",{className:z.arrow},i.createElement("div",{className:z.arrowLine}),i.createElement("div",{className:z.arrowArrow})))}const Js=(e,t)=>({cardWrapper:(0,h.css)({alignItems:"stretch"}),error:(0,h.css)({marginBottom:e.spacing(1)}),card:(0,h.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:t?"auto":"100%"}),cardError:(0,h.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,h.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,h.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,h.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,h.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,h.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,h.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,h.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,h.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,h.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,h.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function qs(e){const[t,n]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let u;return e?u=setTimeout(()=>{n(!1)},1e3):n(!0),()=>clearTimeout(u)},[e]),t&&e}function fn(e,t,n,u,f){e.paramChangedHandler?f(n,e.paramChangedHandler(u,t,e)):f(n,t)}function ei(e,t,n,u,f){return i.createElement("div",{className:f.restParam,key:`${u}-2`},i.createElement(ae.$n,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:t,"data-testid":`operations.${n}.add-rest-param`},e.name))}function ti({operation:e,index:t,onRemove:n,onChange:u,onRunQuery:f,queryModeller:p,query:E,datasource:y,flash:O,highlight:L,timeRange:D,isConflictingOperation:C}){const k=p.getOperationDefinition(e.id),X=(0,j.$j)(),me=C?C(e,E.operations):!1,z=ri(X);if(!k)return i.createElement("span",null,"Operation ",e.id," not found");const Z=ge=>{if(!ge)return me?!0:void 0};return i.createElement(fr.sx,{draggableId:`operation-${t}`,index:t},(ge,re)=>i.createElement(It.I,{error:"You have conflicting label filters",invalid:Z(re.isDragging),className:(0,h.cx)(z.error,z.cardWrapper)},i.createElement(Ys,{provided:ge,flash:O,highlight:L,isConflicting:me,index:t,operation:e,definition:k,onChange:u,onRemove:n,queryModeller:p,query:E,timeRange:D,onRunQuery:f,datasource:y})))}const ri=(e,t)=>({cardWrapper:(0,h.css)({alignItems:"stretch"}),error:(0,h.css)({marginBottom:e.spacing(1)})});var ai=Object.defineProperty,ni=Object.defineProperties,si=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,ii=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable,Bn=(e,t,n)=>t in e?ai(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tn=(e,t)=>{for(var n in t||(t={}))ii.call(t,n)&&Bn(e,n,t[n]);if(Un)for(var n of Un(t))oi.call(t,n)&&Bn(e,n,t[n]);return e},pn=(e,t)=>ni(e,si(t));function li({query:e,datasource:t,queryModeller:n,onChange:u,onRunQuery:f,highlightedOp:p,timeRange:E,isConflictingOperation:y}){const O=(0,j.of)(di),{operations:L}=e,D=ci(L),[C,k]=(0,i.useState)(!1),X=(le,W)=>{const Ee=[...L];Ee.splice(le,1,W),u(pn(tn({},e),{operations:Ee}))},me=le=>{const W=[...L.slice(0,le),...L.slice(le+1)];u(pn(tn({},e),{operations:W}))},z=n.getCategories().map(le=>({value:le,label:le,items:n.getOperationsForCategory(le).map(W=>({value:W.id,label:W.name,isLeaf:!0}))})),Z=le=>{const W=n.getOperationDefinition(le);W&&(u(W.addOperationHandler(W,e,n)),k(!1))},ge=le=>{if(!le.destination)return;const W=[...L],Ee=W[le.source.index];W.splice(le.source.index,1),W.splice(le.destination.index,0,Ee),u(pn(tn({},e),{operations:W}))},re=()=>{k(!1)};return i.createElement(ye.B,{gap:1,direction:"column"},i.createElement(ye.B,{gap:1},L.length>0&&i.createElement(fr.JY,{onDragEnd:ge},i.createElement(fr.gL,{droppableId:"sortable-field-mappings",direction:"horizontal"},le=>i.createElement("div",tn({className:O.operationList,ref:le.innerRef},le.droppableProps),L.map((W,Ee)=>i.createElement(ti,{key:W.id+JSON.stringify(W.params)+Ee,queryModeller:n,index:Ee,operation:W,query:e,datasource:t,onChange:X,onRemove:me,onRunQuery:f,flash:D[Ee],highlight:p===W,timeRange:E,isConflictingOperation:y})),le.placeholder))),i.createElement("div",{className:O.addButton},C?i.createElement(Da.v,{options:z,onSelect:Z,onBlur:re,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):i.createElement(ae.$n,{icon:"plus",variant:"secondary",onClick:()=>k(!0),title:"Add operation"},"Operations"))))}function ci(e){const t=(0,Cr.A)(),n=(0,Oe.A)(e);if(!t())return e.map(()=>!1);if(!n)return e.map(()=>!0);let u=[];if(n.length-1===e.length&&e.every(f=>n.includes(f)))return e.map(()=>!1);if(n.length+1===e.length&&n.every(f=>e.includes(f))){const f=e.find(p=>!n.includes(p));u=e.map(p=>p===f)}else u=e.map((f,p)=>{var E;return!ui(f.id,(E=n[p])==null?void 0:E.id)});return u}function ui(e,t){return e===t||`__${e}_by`===t||e===`__${t}_by`}const di=e=>({heading:(0,h.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,h.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,h.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})}),Xn=({datasource:e,query:t,onChange:n,data:u,queryModeller:f,buildVisualQueryFromString:p,buildDataQueryFromQueryString:E,buildQueryStringFromDataQuery:y})=>{const[O,L]=(0,i.useState)([]),D=(0,j.of)(fi);return(0,i.useEffect)(()=>{var C;const k=E(f.renderQuery(t)),X=(C=e.getQueryHints)==null?void 0:C.call(e,k,u?.series||[]).filter(me=>{var z;return(z=me.fix)==null?void 0:z.action});L(X??[])},[e,t,u,f,E]),i.createElement(i.Fragment,null,O.length>0&&i.createElement("div",{className:D.container},O.map(C=>{var k,X,me,z;return i.createElement(_e.m,{content:`${C.label} ${(k=C.fix)==null?void 0:k.label}`,key:C.type},i.createElement(ae.$n,{onClick:()=>{var Z,ge,re;if((0,ue.rR)("grafana_query_builder_hints_clicked",{hint:C.type,datasourceType:e.type}),(Z=C?.fix)!=null&&Z.action){const le=E(f.renderQuery(t)),W=(ge=e.modifyQuery)==null?void 0:ge.call(e,le,C.fix.action);if(W){const Ee=p((re=y(W))!=null?re:"");return n(Ee.query)}}},fill:"outline",size:"sm",className:D.hint},"hint: ",((X=C.fix)==null?void 0:X.title)||((z=(me=C.fix)==null?void 0:me.action)==null?void 0:z.type.toLowerCase().replace("_"," "))))})))};Xn.displayName="QueryBuilderHints";const fi=e=>({container:(0,h.css)`
      display: flex;
      align-items: start;
    `,hint:(0,h.css)`
      margin-right: ${e.spacing(1)};
    `});function Wn({query:e,queryModeller:t,stepNumber:n,language:u,onMouseEnter:f,onMouseLeave:p}){return i.createElement(i.Fragment,null,e.operations.map((E,y)=>{var O;const L=t.getOperationDefinition(E.id);if(!L)return`Operation ${E.id} not found`;const D=L.renderer(E,L,t.innerQueryPlaceholder),C=L.explainHandler?L.explainHandler(E,L):(O=L.documentation)!=null?O:"no docs";return i.createElement("div",{key:y,onMouseEnter:()=>f?.(E,y),onMouseLeave:()=>p?.(E,y)},i.createElement(Nt,{stepNumber:y+n,title:i.createElement(ar.Z,{query:D,language:u}),markdown:C}))}))}var rn=c(71713),pi=c(11216),xr=c(54623);const Vn="Fetch all log lines matching label filters.",_n=(0,i.memo)(({query:e})=>{const t=(0,Pt.u_)(e||"").query,n={grammar:rn.vB,name:"lokiql"};return(0,o.jsxs)(fe.B,{gap:0,direction:"column",children:[(0,o.jsx)(Nt,{stepNumber:1,title:(0,o.jsx)(ar.Z,{query:`${ct.y.renderLabels(t.labels)}`,language:n}),children:Vn}),(0,o.jsx)(Wn,{stepNumber:2,queryModeller:ct.y,query:t,language:n})]})});_n.displayName="LokiQueryBuilderExplained";var hi=c(29158),gi=c(58592);const kn=(0,i.memo)(({nestedQuery:e,index:t,datasource:n,onChange:u,onRemove:f,onRunQuery:p,showExplain:E})=>{const y=(0,j.of)(vi);return(0,o.jsxs)("div",{className:y.card,children:[(0,o.jsxs)("div",{className:y.header,children:[(0,o.jsx)("div",{className:y.name,children:"Operator"}),(0,o.jsx)(Je.l6,{"aria-label":"Select operator",width:"auto",options:mi,value:(0,Mt.z)(e.operator),onChange:O=>{u(t,{...e,operator:O.value})}}),(0,o.jsx)("div",{className:y.name,children:"Vector matches"}),(0,o.jsxs)("div",{className:y.vectorMatchWrapper,children:[(0,o.jsx)(Je.l6,{width:"auto",value:e.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:O=>{u(t,{...e,vectorMatchesType:O.value})}}),(0,o.jsx)(kr.D,{className:y.vectorMatchInput,minWidth:20,defaultValue:e.vectorMatches,onCommitChange:O=>{u(t,{...e,vectorMatches:O.currentTarget.value,vectorMatchesType:e.vectorMatchesType||"on"})}})]}),(0,o.jsx)(Me.Z,{grow:1}),(0,o.jsx)(hi.K,{name:"times",size:"sm",onClick:()=>f(t),tooltip:"Remove nested query"})]}),(0,o.jsx)("div",{className:y.body,children:(0,o.jsx)(T.D,{children:(0,o.jsx)(hn,{showExplain:E,query:e.query,datasource:n,onRunQuery:p,onChange:O=>{u(t,{...e,query:O})}})})})]})}),mi=gi.C.map(e=>({label:e.sign,value:e.sign}));kn.displayName="NestedQuery";const vi=e=>({card:(0,h.css)({label:"card",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),header:(0,h.css)({label:"header",padding:e.spacing(.5,.5,.5,1),gap:e.spacing(1),display:"flex",alignItems:"center"}),name:(0,h.css)({label:"name",whiteSpace:"nowrap"}),body:(0,h.css)({label:"body",paddingLeft:e.spacing(2)}),vectorMatchInput:(0,h.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,h.css)({label:"vectorMatchWrapper",display:"flex"})});function Oi({query:e,datasource:t,onChange:n,onRunQuery:u,showExplain:f}){const p=e.binaryQueries??[],E=(O,L)=>{const D=[...p];D.splice(O,1,L),n({...e,binaryQueries:D})},y=O=>{const L=[...p.slice(0,O),...p.slice(O+1)];n({...e,binaryQueries:L})};return(0,o.jsx)(fe.B,{direction:"column",gap:1,children:p.map((O,L)=>(0,o.jsx)(kn,{nestedQuery:O,index:L,onChange:E,datasource:t,onRemove:y,onRunQuery:u,showExplain:f},L.toString()))})}const zn=5*60*1e3,hn=(0,i.memo)(({datasource:e,query:t,onChange:n,onRunQuery:u,showExplain:f,timeRange:p})=>{const[E,y]=(0,i.useState)(),[O,L]=(0,i.useState)(void 0),D=(0,Oe.A)(t),C=(0,Oe.A)(p),k=re=>{n({...t,labels:re})},X=async re=>{const le=await re;return[...e.getVariables(),...le].map(W=>({label:W,value:W}))},me=async re=>{const le=t.labels.filter(ie=>ie!==re),W=le.find(ie=>ie.op==="="||ie.op==="=~"&&new RegExp(ie.value).test("")===!1);if(le.length===0||!W)return await e.languageProvider.fetchLabels({timeRange:p});const Ee=ct.y.renderLabels(le),Y=await e.languageProvider.fetchLabels({streamSelector:Ee,timeRange:p}),Re=le.map(ie=>ie.label);return Y.filter(ie=>!Re.includes(ie)).sort()},z=async re=>{if(!re.label)return[];let le;const W=t.labels.filter(Y=>Y!==re),Ee=W.find(Y=>Y.op==="="||Y.op==="=~"&&new RegExp(Y.value).test("")===!1);if(W.length===0||!Ee)le=await e.languageProvider.fetchLabelValues(re.label,{timeRange:p});else{const Y=ct.y.renderLabels(W);le=await e.languageProvider.fetchLabelValues(re.label,{streamSelector:Y,timeRange:p})}return le?le.map(Y=>(0,ee.Bb)(Y,re.op)):[]},Z=(0,i.useMemo)(()=>{const{labels:re,operations:le}=t;return!re.length&&le.length?!(le.length===1&&le[0].id===xr.EF.LineContains&&le[0].params[0]===""):!1},[t]);(0,i.useEffect)(()=>{const re=async()=>{const Ee={expr:ct.y.renderQuery(t),refId:"data-samples"},Y=p??(0,Ta.E2)(),ie={series:await e.getDataSamples(Ee,Y),state:be.Gu.Done,timeRange:Y};y(ie)},le=C&&p&&(Math.abs(p.to.valueOf()-C.to.valueOf())>zn||Math.abs(p.from.valueOf()-C.from.valueOf())>zn),W=!(0,ne.isEqual)(D,t);U.$.featureToggles.lokiQueryHints&&(le||W)&&re().catch(console.error)},[e,t,p,D,C]);const ge={grammar:rn.Ay,name:"logql"};return(0,o.jsxs)("div",{"data-testid":mn.editor,children:[(0,o.jsx)(qr.U,{children:(0,o.jsx)(tr,{onGetLabelNames:re=>X(me(re)),onGetLabelValues:re=>X(z(re)),labelsFilters:t.labels,onChange:k,labelFilterRequired:Z})}),f&&(0,o.jsx)(Nt,{stepNumber:1,title:(0,o.jsx)(ar.Z,{query:`${ct.y.renderLabels(t.labels)}`,language:ge}),children:Vn}),(0,o.jsxs)(oa.i,{children:[(0,o.jsx)(li,{queryModeller:ct.y,query:t,onChange:n,onRunQuery:u,datasource:e,highlightedOp:O,isConflictingOperation:(re,le)=>re.id===xr.EF.LabelFilter&&(0,pi.hh)(re,le)}),(0,o.jsx)(Xn,{datasource:e,query:t,onChange:n,data:E,queryModeller:ct.y,buildVisualQueryFromString:Pt.u_,buildDataQueryFromQueryString:re=>({expr:re,refId:"hints"}),buildQueryStringFromDataQuery:re=>re.expr})]}),f&&(0,o.jsx)(Wn,{stepNumber:2,queryModeller:ct.y,query:t,language:ge,onMouseEnter:re=>{L(re)},onMouseLeave:()=>{L(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&(0,o.jsx)(Oi,{query:t,datasource:e,onChange:n,onRunQuery:u,showExplain:f})]})});hn.displayName="LokiQueryBuilder";function yi({query:e}){return(0,o.jsx)(qr.U,{children:(0,o.jsx)(ea.B,{children:(0,o.jsx)(ar.Z,{query:e,language:{grammar:rn.vB,name:"lokiql"}})})})}function bi(e){const{query:t,onChange:n,onRunQuery:u,datasource:f,showExplain:p,timeRange:E}=e,[y,O]=(0,i.useReducer)(Hn.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,i.useEffect)(()=>{O(Pi(t.expr))},[t.expr]);const L=D=>{const C=ct.y.renderQuery(D);O(Ei({visQuery:D,expr:C})),n({...e.query,expr:C})};return y.visQuery?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(hn,{query:y.visQuery,datasource:f,onChange:L,onRunQuery:u,showExplain:p,"data-testid":mn.editor,timeRange:E}),t.expr!==""&&(0,o.jsx)(yi,{query:t.expr})]}):null}const xi={expr:""},Hn=(0,wa.Z0)({name:"loki-builder-container",initialState:xi,reducers:{visualQueryChange:(e,t)=>{e.expr=t.payload.expr,e.visQuery=t.payload.visQuery},exprChanged:(e,t)=>{if(!e.visQuery||e.expr!==t.payload){e.expr=t.payload;const n=(0,Pt.u_)(t.payload);e.visQuery=n.query}}}}),{visualQueryChange:Ei,exprChanged:Pi}=Hn.actions;var Kn=c(70416),Li=c(42941),Si=c(83195),Gn=c(82762);function $i({title:e,children:t,collapsedInfo:n,queryStats:u}){const[f,p]=(0,Li.A)(!1),E=(0,j.of)(Qi);return i.createElement("div",{className:E.wrapper},i.createElement(Gn.S,{className:E.collapse,collapsible:!0,isOpen:f,onToggle:p,label:i.createElement(ye.B,{gap:0},i.createElement("h6",{className:E.title},e),!f&&i.createElement("div",{className:E.description},n.map((y,O)=>i.createElement("span",{key:O},y))))},i.createElement("div",{className:E.body},t)),u&&U.$.featureToggles.lokiQuerySplitting&&i.createElement(_e.m,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},i.createElement(pr.I,{tabIndex:0,name:"info-circle",className:E.tooltip,size:"sm"})),u&&i.createElement("p",{className:E.stats},Ri(u)))}const Qi=e=>({collapse:(0,h.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,h.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,h.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,h.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,h.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,h.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,h.css)({marginRight:e.spacing(.25)})}),Ri=e=>e.message?e.message:`This query will process approximately ${wi(e)}.`,wi=e=>{const{text:t,suffix:n}=(0,Si.j_)("bytes")(e.bytes,1);return t+n};var Ti=c(42418),Er=c(60016),Zn=c(56587),zr=c(13137);const Yn=i.memo(({app:e,query:t,onChange:n,onRunQuery:u,maxLines:f,queryStats:p})=>{const[E,y]=(0,i.useState)(!0),O=W=>{n({...t,queryType:W}),u()},L=W=>{n({...t,direction:W}),u()},D=W=>{(0,ue.rR)("grafana_loki_resolution_clicked",{app:e,resolution:W.value}),n({...t,resolution:W.value}),u()},C=W=>{const Ee=W.currentTarget.value;if(!(0,Kn.di)(Ee)){y(!1);return}y(!0),n({...t,splitDuration:Ee}),u()},k=W=>{n({...t,legendFormat:W.currentTarget.value}),u()};function X(W){const Ee=(0,Er.wU)(W.currentTarget.value);t.maxLines!==Ee&&(n({...t,maxLines:Ee}),u())}function me(W){n({...t,step:(0,ne.trim)(W.currentTarget.value)}),u()}let z=(0,Zn.Io)(t);const Z=(0,Zn.sI)(t.expr),ge=Z?Er.TO.filter(W=>W.value!==zr.U3.Instant):Er.TO,re=t.direction??zr.ti.Backward;Z&&z===zr.U3.Instant&&(n({...t,queryType:zr.U3.Range}),z=zr.U3.Range);const le=(0,i.useMemo)(()=>!!(!t.step||(0,Kn.V3)(t.step)||!isNaN(Number(t.step))),[t.step]);return(0,o.jsx)(qr.U,{children:(0,o.jsxs)($i,{title:"Options",collapsedInfo:Fi(t,z,f,Z,le),queryStats:p,children:[(0,o.jsx)(jt.c,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname.",children:(0,o.jsx)(kr.D,{placeholder:"{{label}}",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:k})}),ge.length>1&&(0,o.jsx)(jt.c,{label:"Type",children:(0,o.jsx)(g.z,{options:ge,value:z,onChange:O})}),Z&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(jt.c,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query.",children:(0,o.jsx)(kr.D,{className:"width-4",placeholder:f.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:X})}),(0,o.jsx)(jt.c,{label:"Direction",tooltip:"Direction to search for logs.",children:(0,o.jsx)(g.z,{options:Er.BI,value:re,onChange:L})})]}),!Z&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(jt.c,{label:"Step",tooltip:"Use the step parameter when making metric queries to Loki. If not filled, Grafana's calculated interval will be used. Example valid values: 1s, 5m, 10h, 1d.",invalid:!le,error:"Invalid step. Example valid values: 1s, 5m, 10h, 1d.",children:(0,o.jsx)(kr.D,{className:"width-6",placeholder:"auto",type:"string",defaultValue:t.step??"",onCommitChange:me})}),t.resolution!==void 0&&t.resolution>1&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(jt.c,{label:"Resolution",tooltip:"Changes the step parameter of Loki metrics range queries. With a resolution of 1/1, each pixel corresponds to one data point. 1/10 retrieves one data point per 10 pixels. Lower resolutions perform better.",children:(0,o.jsx)(Je.l6,{isSearchable:!1,onChange:D,options:Er.iB,value:t.resolution||1,"aria-label":"Select resolution"})}),(0,o.jsx)(Ti.F,{severity:"warning",title:"The 'Resolution' is deprecated. Use 'Step' editor instead to change step parameter."})]})]}),U.$.featureToggles.lokiQuerySplittingConfig&&U.$.featureToggles.lokiQuerySplitting&&(0,o.jsx)(jt.c,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled.",children:(0,o.jsx)(kr.D,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:C,invalid:!E})})]})})});function Fi(e,t,n,u,f){const p=Er.TO.find(O=>O.value===t),E=Er.iB.find(O=>O.value===(e.resolution??1)),y=[];return e.legendFormat&&y.push(`Legend: ${e.legendFormat}`),y.push(`Type: ${p?.label}`),u&&y.push(`Line limit: ${e.maxLines??n}`),u||(e.step&&y.push(`Step: ${f?e.step:"Invalid value"}`),e.resolution&&y.push(`Resolution: ${E?.label}`)),y}Yn.displayName="LokiQueryBuilderOptions";var Jn=c(95881);function Ci({query:e,datasource:t,range:n,onRunQuery:u,onChange:f,data:p,app:E,showExplain:y,history:O}){const L=(0,j.of)(Ai);return(0,o.jsxs)("div",{className:L.wrapper,children:[(0,o.jsx)(Jn.W,{datasource:t,query:e,range:n,onRunQuery:u,onChange:f,history:O,data:p,app:E,"data-testid":mn.editor}),y&&(0,o.jsx)(_n,{query:e.expr})]})}const Ai=e=>({wrapper:(0,h.css)`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `,buttonGroup:(0,h.css)`
      border: 1px solid ${e.colors.border.medium};
      border-top: none;
      padding: ${e.spacing(.5,.5,.5,.5)};
      margin-bottom: ${e.spacing(.5)};
      display: flex;
      flex-grow: 1;
      justify-content: end;
      font-size: ${e.typography.bodySmall.fontSize};
    `,hint:(0,h.css)`
      color: ${e.colors.text.disabled};
      white-space: nowrap;
      cursor: help;
    `});var Di=c(77789),ji=c(83657),gn=c(10860);const Mi=e=>{const{pattern:t,onPatternSelect:n,hasNewQueryOption:u,hasPreviousQuery:f,selectedPatternName:p,setSelectedPatternName:E}=e,y=(0,j.of)(Ii),O={grammar:rn.Ay,name:"logql"};return(0,o.jsxs)(gn.Z,{className:y.card,children:[(0,o.jsx)(gn.Z.Heading,{children:t.name}),(0,o.jsx)("div",{className:y.rawQueryContainer,children:(0,o.jsx)(ar.Z,{query:ct.y.renderQuery({labels:[],operations:t.operations}),language:O,className:y.rawQuery})}),(0,o.jsx)(gn.Z.Actions,{children:p!==t.name?(0,o.jsx)(ae.$n,{size:"sm",onClick:()=>{f?E(t.name):n(t)},children:"Use this query"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:y.spacing,children:`If you would like to use this query, ${u?"you can either replace your current query or create a new query":"your current query will be replaced"}.`}),(0,o.jsx)(ae.$n,{size:"sm",fill:"outline",onClick:()=>E(null),children:"Back"}),(0,o.jsx)(ae.$n,{size:"sm",onClick:()=>{n(t)},children:"Apply to query"}),u&&(0,o.jsx)(ae.$n,{size:"sm",onClick:()=>{n(t,!0)},children:"Create new query"})]})})]})},Ii=e=>({card:(0,h.css)`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:(0,h.css)`
      flex-grow: 1;
    `,rawQuery:(0,h.css)`
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1)};
      margin-top: ${e.spacing(1)};
    `,spacing:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Ni=[xr.Ln.Formats,xr.Ln.LineFilters,xr.Ln.LabelFilters],Ui=[xr.EF.Unwrap],Bi=ji.sp.filter(e=>e.category&&Ni.includes(e.category)&&!Ui.includes(e.id)).map(e=>e.id),Xi=e=>{const{isOpen:t,onClose:n,onChange:u,onAddQuery:f,query:p,queries:E,app:y}=e,[O,L]=(0,i.useState)([]),[D,C]=(0,i.useState)(null),k=(0,j.of)(Wi),X=!!f,me=(0,i.useMemo)(()=>(0,Pt.u_)(p.expr).query.operations.length>0,[p.expr]),z=(Z,ge=!1)=>{const re=(0,Pt.u_)(ge?"":p.expr);(0,ue.rR)("grafana_loki_query_patterns_selected",{version:"v2",app:y??"",editorMode:p.editorMode,selectedPattern:Z.name,preSelectedOperationsCount:re.query.operations.length,preSelectedLabelsCount:re.query.labels.length,createNewQuery:X&&ge}),re.query.operations=re.query.operations.filter(W=>Bi.includes(W.id));const le=Z.operations.filter(W=>re.query.operations.findIndex(Ee=>Ee.id===W.id)<0);re.query.operations=[...re.query.operations,...le],X&&ge?f({...p,refId:(0,Di.M)(E??[p]),expr:ct.y.renderQuery(re.query)}):u({...p,expr:ct.y.renderQuery(re.query)}),C(null),n()};return(0,o.jsxs)(tt.a,{isOpen:t,title:"Kick start your query",onDismiss:n,className:k.modal,children:[(0,o.jsx)("div",{className:k.spacing,children:"Kick start your query by selecting one of these queries. You can then continue to complete your query."}),Object.values(xr.IQ).map(Z=>(0,o.jsx)(Gn.S,{label:`${(0,ne.capitalize)(Z)} query starters`,isOpen:O.includes(Z),collapsible:!0,onToggle:()=>L(ge=>ge.includes(Z)?ge.filter(re=>re!==Z):[...ge,Z]),children:(0,o.jsx)("div",{className:k.cardsContainer,children:ct.y.getQueryPatterns().filter(ge=>ge.type===Z).map(ge=>(0,o.jsx)(Mi,{pattern:ge,hasNewQueryOption:X,hasPreviousQuery:me,onPatternSelect:z,selectedPatternName:D,setSelectedPatternName:C},ge.name))})},Z)),(0,o.jsx)(ae.$n,{variant:"secondary",onClick:n,children:"Close"})]})},Wi=e=>({cardsContainer:(0,h.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `,modal:(0,h.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `}),qn="LokiQueryEditorModeDefault";function Vi(e,t,n){e.expr===""&&window.localStorage.setItem(qn,t),n({...e,editorMode:t})}function _i(e){if(e!=null&&e!=="")return he.f.Code;switch(window.localStorage.getItem(qn)){case"code":return he.f.Code;case"builder":default:return he.f.Builder}}function ki(e){let t=e;return e.editorMode||(t={...e,editorMode:_i(e.expr)}),e.expr==null&&(t={...t,expr:""}),e.queryType==null&&(t={...t,queryType:zr.U3.Range}),t}var zi=c(47232);function es(e,t){return!e||!t?!1:(0,zi.Ar)(e)?e.isSame(t):e===t}function Hi(e,t,n,u,f,p){return t===void 0||e.trim()!==t.trim()||f!==p?!0:!(es(n?.raw.from,u?.raw.from)&&es(n?.raw.to,u?.raw.to))}const mn={editor:"loki-editor"},ts="LokiQueryEditorExplainDefault",rs=(0,i.memo)(e=>{const t=(0,i.useId)(),{onChange:n,onRunQuery:u,onAddQuery:f,data:p,app:E,queries:y,datasource:O,range:L}=e,[D,C]=(0,i.useState)(!1),[k,X]=(0,i.useState)(!1),[me,z]=(0,i.useState)(!1),[Z,ge]=(0,i.useState)(!1),[re,le]=(0,i.useState)(null),[W,Ee]=(0,i.useState)(window.localStorage.getItem(ts)==="true"),Y=O.predefinedOperations,Re=(0,Oe.A)(L),ie=ki(e.query);U.$.featureToggles.lokiPredefinedOperations&&!ie.expr&&Y&&(ie.expr=`{} ${Y}`);const Ne=(0,Oe.A)(ie.expr),Be=(0,Oe.A)(ie.queryType),Ge=ie.editorMode,gt=Ae=>{window.localStorage.setItem(ts,Ae.currentTarget.checked?"true":"false"),Ee(Ae.currentTarget.checked)},it=(0,i.useCallback)(Ae=>{if((0,ue.rR)("grafana_loki_editor_mode_clicked",{newEditor:Ae,previousEditor:ie.editorMode??"",newQuery:!ie.expr,app:E??""}),Ae===he.f.Builder&&(0,Pt.u_)(ie.expr||"").errors.length){C(!0);return}Vi(ie,Ae,n)},[n,ie,E]);(0,i.useEffect)(()=>{z(!1)},[p]);const Et=Ae=>{(0,ne.isEqual)(Ae,e.query)||z(!0),n(Ae)},He=()=>{(0,ue.rR)("grafana_loki_label_browser_opened",{app:E}),ge(Ae=>!Ae)};return(0,i.useEffect)(()=>{Hi(ie.expr,Ne,L,Re,ie.queryType,Be)&&L&&(async()=>{const At=await O.getStats({...ie,refId:`${t}_${ie.refId}`},L);le(At)})()},[O,L,Re,ie,Ne,Be,le,t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(G.u,{isOpen:D,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{n({...ie,editorMode:he.f.Builder}),C(!1)},onDismiss:()=>C(!1)}),(0,o.jsx)(Xi,{isOpen:k,onClose:()=>X(!1),query:ie,queries:y,app:E,onChange:n,onAddQuery:f}),(0,o.jsx)(Jr,{isOpen:Z,datasource:O,query:ie,app:E,onClose:()=>ge(!1),onChange:Et,onRunQuery:u,timeRange:L}),(0,o.jsxs)(oe.X,{children:[(0,o.jsxs)(fe.B,{gap:1,children:[(0,o.jsx)(ae.$n,{"data-testid":ce.Tp.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{X(Ze=>!Ze);const Ae=(0,Pt.u_)(ie.expr||"");(0,ue.rR)("grafana_loki_query_patterns_opened",{version:"v2",app:E??"",editorMode:ie.editorMode,preSelectedOperationsCount:Ae.query.operations.length,preSelectedLabelsCount:Ae.query.labels.length})},children:"Kick start your query"}),(0,o.jsx)(ae.$n,{variant:"secondary",size:"sm",onClick:He,"data-testid":"label-browser-button",children:"Label browser"})]}),(0,o.jsx)(_,{label:"Explain query",value:W,onChange:gt}),(0,o.jsx)(Me.Z,{grow:1}),E!==je.Jk.Explore&&E!==je.Jk.Correlations&&(0,o.jsx)(ae.$n,{variant:me?"primary":"secondary",size:"sm",onClick:u,icon:p?.state===be.Gu.Loading?"spinner":void 0,disabled:p?.state===be.Gu.Loading,children:y&&y.length>1?"Run queries":"Run query"}),(0,o.jsx)(S,{mode:Ge,onChange:it})]}),(0,o.jsx)(Ie.$,{v:.5}),(0,o.jsxs)(T.D,{children:[Ge===he.f.Code&&(0,o.jsx)(Ci,{...e,query:ie,onChange:Et,showExplain:W}),Ge===he.f.Builder&&(0,o.jsx)(bi,{datasource:e.datasource,query:ie,onChange:Et,onRunQuery:e.onRunQuery,showExplain:W,timeRange:L}),(0,o.jsx)(Yn,{query:ie,onChange:n,onRunQuery:u,app:E,maxLines:O.maxLines,queryStats:re})]})]})});rs.displayName="LokiQueryEditor";function Ki(e){const{query:t,data:n,datasource:u,onChange:f,onRunQuery:p,history:E}=e;return(0,o.jsx)(Jn.W,{datasource:u,query:t,onChange:f,onRunQuery:p,history:E,data:n,placeholder:"Enter a Loki query","data-testid":Gi.editor})}const Gi={editor:"loki-editor-cloud-alerting"};function Zi(e){const{app:t}=e;switch(t){case je.Jk.CloudAlerting:return(0,o.jsx)(Ki,{...e});default:return(0,o.jsx)(rs,{...e})}}const Yi=(0,i.memo)(Zi),Uo={editor:"loki-editor"};var Ji=c(68704),qi=c(77657),eo=c(39748),to=c(66025),ro=c(91062),ao=c(32346),vn=c(25994),no=c(17081),On=c(29020),yn=c(35931);function so({options:e,onOptionsChange:t}){return(0,o.jsx)(On.I,{title:"Alerting",description:(0,o.jsx)(yn.H,{description:"Manage alert rules for the Loki data source.",suffix:"loki/configure-loki-data-source/#alerting",feature:"alerting"}),children:(0,o.jsx)(It.I,{labelWidth:29,label:"Manage alert rules in Alerting UI",disabled:e.readOnly,tooltip:"Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager data source.",children:(0,o.jsx)(xe.K,{value:e.jsonData.manageAlerts!==!1,onChange:n=>t({...e,jsonData:{...e.jsonData,manageAlerts:n.currentTarget.checked}})})})})}var io=c(6709),oo=c(91890),lo=c(72574),co=c(21744);const uo=e=>{const{derivedFields:t,className:n}=e,[u,f]=(0,i.useState)("");let p=[];return u&&t&&(p=po(t,u)),(0,o.jsxs)("div",{className:n,children:[(0,o.jsx)(It.I,{label:"Debug log message",labelWidth:24,grow:!0,children:(0,o.jsx)(co.f,{type:"text","aria-label":"Loki query",placeholder:"Paste an example log line here to test the regular expressions of your derived fields",value:u,onChange:E=>f(E.currentTarget.value)})}),!!p.length&&(0,o.jsx)(fo,{fields:p})]})},fo=({fields:e})=>(0,o.jsxs)("table",{className:"filter-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Name"}),(0,o.jsx)("th",{children:"Value"}),(0,o.jsx)("th",{children:"Url"})]})}),(0,o.jsx)("tbody",{children:e.map(t=>{let n=t.value;return t.error&&t.error instanceof Error?n=t.error.message:t.href&&(n=(0,o.jsx)("a",{href:t.href,children:n})),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:t.name}),(0,o.jsx)("td",{children:n}),(0,o.jsx)("td",{children:t.href?(0,o.jsx)("a",{href:t.href,children:t.href}):""})]},`${t.name}=${t.value}`)})})]});function po(e,t){return e.filter(n=>n.name&&n.matcherRegex).map(n=>{try{const u=t.match(n.matcherRegex);let f;const p=u&&u[1];return p&&(f=(0,lo.w)().replace(n.url,{__value:{value:{raw:p},text:"Raw value"}})),{name:n.name,value:p||"<no match>",href:f}}catch(u){return{name:n.name,error:u}}})}var ho=c(55882),cr=c(88575),go=c(64078);const mo=e=>({row:(0,h.css)`
    display: flex;
    align-items: baseline;
  `,nameField:(0,h.css)`
    flex: 2;
    margin-right: ${e.spacing(.5)};
  `,regexField:(0,h.css)`
    flex: 3;
    margin-right: ${e.spacing(.5)};
  `,urlField:(0,h.css)`
    flex: 1;
    margin-right: ${e.spacing(.5)};
  `,urlDisplayLabelField:(0,h.css)`
    flex: 1;
  `,internalLink:(0,h.css)`
    margin-right: ${e.spacing(1)};
  `,dataSource:(0,h.css)``,nameMatcherField:(0,h.css)({width:e.spacing(20),marginRight:e.spacing(.5)})}),vo=e=>{const{value:t,onChange:n,onDelete:u,suggestions:f,className:p,validateName:E}=e,y=(0,j.of)(mo),[O,L]=(0,i.useState)(!!t.datasourceUid),D=(0,Oe.A)(t.datasourceUid),[C,k]=(0,i.useState)(t.matcherType??"regex");(0,i.useEffect)(()=>{!D&&t.datasourceUid&&!O&&L(!0),D&&!t.datasourceUid&&O&&L(!1)},[D,t.datasourceUid,O]);const X=z=>Z=>{n({...t,[z]:Z.currentTarget.value})},me=!E(t.name);return(0,o.jsxs)("div",{className:p,"data-testid":"derived-field",children:[(0,o.jsxs)("div",{className:"gf-form",children:[(0,o.jsx)(cr.D,{className:y.nameField,label:"Name",invalid:me,error:"The name is already in use",children:(0,o.jsx)(Dt.p,{value:t.name,onChange:X("name"),placeholder:"Field name",invalid:me})}),(0,o.jsx)(cr.D,{className:y.nameMatcherField,label:(0,o.jsx)(an,{label:"Type",content:"Derived fields can be created from labels or by applying a regular expression to the log message."}),children:(0,o.jsx)(Je.l6,{options:[{label:"Regex in log line",value:"regex"},{label:"Label",value:"label"}],value:C,onChange:z=>{(z.value==="label"||z.value==="regex")&&(k(z.value),n({...t,matcherType:z.value}))}})}),(0,o.jsx)(cr.D,{className:y.regexField,label:(0,o.jsxs)(o.Fragment,{children:[C==="regex"&&(0,o.jsx)(an,{label:"Regex",content:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),C==="label"&&(0,o.jsx)(an,{label:"Label",content:"Use to derive the field from a label."})]}),children:(0,o.jsx)(Dt.p,{value:t.matcherRegex,onChange:X("matcherRegex")})}),(0,o.jsx)(cr.D,{label:"",children:(0,o.jsx)(ae.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:z=>{z.preventDefault(),u()}})})]}),(0,o.jsxs)("div",{className:"gf-form",children:[(0,o.jsx)(cr.D,{label:O?"Query":"URL",className:y.urlField,children:(0,o.jsx)(go.l,{placeholder:O?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:z=>n({...t,url:z}),suggestions:f})}),(0,o.jsx)(cr.D,{className:y.urlDisplayLabelField,label:(0,o.jsx)(an,{label:"URL Label",content:"Use to override the button label when this derived field is found in a log."}),children:(0,o.jsx)(Dt.p,{value:t.urlDisplayLabel,onChange:X("urlDisplayLabel")})})]}),(0,o.jsxs)("div",{className:"gf-form",children:[(0,o.jsx)(cr.D,{label:"Internal link",className:y.internalLink,children:(0,o.jsx)(xe.d,{value:O,onChange:z=>{const{checked:Z}=z.currentTarget;Z||n({...t,datasourceUid:void 0}),L(Z)}})}),O&&(0,o.jsx)(cr.D,{label:"",className:y.dataSource,children:(0,o.jsx)(ho.s,{tracing:!0,onChange:z=>n({...t,datasourceUid:z.uid}),current:t.datasourceUid,noDefault:!0})})]})]})},an=({content:e,label:t})=>(0,o.jsxs)(Rt.J,{children:[t,(0,o.jsx)(_e.m,{placement:"top",content:e,theme:"info",children:(0,o.jsx)(pr.I,{tabIndex:0,name:"info-circle",size:"sm",style:{marginLeft:"10px"}})})]}),Oo=e=>({addButton:(0,h.css)`
    margin-right: 10px;
  `,derivedField:(0,h.css)`
    margin-bottom: ${e.spacing(1)};
  `,container:(0,h.css)`
    margin-bottom: ${e.spacing(4)};
  `,debugSection:(0,h.css)`
    margin-top: ${e.spacing(4)};
  `}),yo=({fields:e=[],onChange:t})=>{const n=(0,j.$j)(),u=Oo(n),[f,p]=(0,i.useState)(!1),E=(0,i.useCallback)(y=>e.filter(O=>O.name&&O.name===y).length<=1,[e]);return(0,o.jsx)(On.I,{title:"Derived fields",description:(0,o.jsx)(yn.H,{description:"Derived fields can be used to extract new fields from a log message and create a link from its value.",suffix:"loki/configure-loki-data-source/#derived-fields",feature:"derived fields"}),children:(0,o.jsxs)("div",{className:u.container,children:[e.map((y,O)=>(0,o.jsx)(vo,{className:u.derivedField,value:y,onChange:L=>{const D=[...e];D.splice(O,1,L),t(D)},onDelete:()=>{const L=[...e];L.splice(O,1),t(L)},validateName:E,suggestions:[{value:io.c.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:oo.$0.Value}]},O)),(0,o.jsxs)("div",{children:[(0,o.jsx)(ae.$n,{variant:"secondary",className:u.addButton,icon:"plus",onClick:y=>{y.preventDefault();const O={name:"",matcherRegex:"",urlDisplayLabel:"",url:"",matcherType:"regex"},L=[...e,O];t(L)},children:"Add"}),e.length>0&&(0,o.jsx)(ae.$n,{variant:"secondary",type:"button",onClick:()=>p(!f),children:f?"Hide example log message":"Show example log message"})]}),f&&(0,o.jsx)("div",{className:u.debugSection,children:(0,o.jsx)(uo,{className:(0,h.css)`
                margin-bottom: 10px;
              `,derivedFields:e})})]})})};var bo=c(39268),xo=c(39938);const Eo=e=>{const{maxLines:t,onMaxLinedChange:n,predefinedOperations:u,onPredefinedOperationsChange:f}=e;return(0,o.jsxs)(On.I,{title:"Queries",description:(0,o.jsx)(yn.H,{description:"Additional options to customize your querying experience.",suffix:"loki/configure-loki-data-source/#queries",feature:"query settings"}),children:[(0,o.jsx)(It.I,{label:"Maximum lines",htmlFor:"loki_config_maxLines",labelWidth:22,tooltip:(0,o.jsx)(o.Fragment,{children:"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results."}),children:(0,o.jsx)(Dt.p,{type:"number",id:"loki_config_maxLines",value:t,onChange:p=>n(p.currentTarget.value),width:16,placeholder:"1000",spellCheck:!1})}),U.$.featureToggles.lokiPredefinedOperations&&(0,o.jsxs)(bo.C,{children:[(0,o.jsx)(It.I,{label:"Predefined operations",htmlFor:"loki_config_predefinedOperations",labelWidth:22,tooltip:(0,o.jsx)(o.Fragment,{children:'Predefined operations are used as an initial state for your queries. They are useful, if you want to unpack, parse or format all log lines. Currently we support only log operations starting with |. For example: | unpack | line_format "{{.message}}".'}),children:(0,o.jsx)(Dt.p,{type:"string",id:"loki_config_predefinedOperations",value:u,onChange:p=>f(p.currentTarget.value),width:40,placeholder:"| unpack | line_format",spellCheck:!1})}),(0,o.jsx)(It.I,{children:(0,o.jsx)(xo.E,{text:"Experimental",color:"orange",icon:"exclamation-triangle",tooltip:"Predefined operations is an experimental feature that may change in the future."})})]})]})},bn=e=>(t,n)=>({...t,jsonData:{...t.jsonData,[e]:n}}),Po=bn("maxLines"),Lo=bn("predefinedOperations"),So=bn("derivedFields"),$o=e=>{const{options:t,onOptionsChange:n}=e,u=(0,i.useCallback)(f=>{(0,ue.rR)("grafana_loki_predefined_operations_changed",{value:f}),n(Lo(t,f))},[t,n]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ji.I,{dataSourceName:"Loki",docsLink:"https://grafana.com/docs/grafana/latest/datasources/loki/configure-loki-data-source/",hasRequiredFields:!1}),(0,o.jsx)(vn.c,{spacing:4}),(0,o.jsx)(qi.u,{config:t,onChange:n,urlPlaceholder:"http://localhost:3100"}),(0,o.jsx)(vn.c,{spacing:4}),(0,o.jsx)(eo.N,{...(0,to.pe)({config:t,onChange:n})}),(0,o.jsx)(vn.c,{spacing:4}),(0,o.jsx)(ro.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0,children:(0,o.jsxs)(fe.B,{gap:5,direction:"column",children:[(0,o.jsx)(ao.g,{config:t,onChange:n}),U.$.secureSocksDSProxyEnabled&&(0,o.jsx)(no.Y,{options:t,onOptionsChange:n}),(0,o.jsx)(so,{options:t,onOptionsChange:n}),(0,o.jsx)(Eo,{maxLines:t.jsonData.maxLines||"",onMaxLinedChange:f=>n(Po(t,f)),predefinedOperations:t.jsonData.predefinedOperations||"",onPredefinedOperationsChange:u}),(0,o.jsx)(yo,{fields:t.jsonData.derivedFields,onChange:f=>n(So(t,f))})]})})]})};var Qo=c(27724),Ro=c(79007);const wo=new R.tD(Qo.VQ).setQueryEditor(Yi).setConfigEditor($o).setQueryEditorHelp(Le);(0,I.J7)().subscribe(Pe.gc,Ro.jg)},56587:(qe,De,c)=>{"use strict";c.d(De,{$F:()=>ve,Cg:()=>Ve,FV:()=>Oe,H0:()=>i,Io:()=>ee,MX:()=>ce,OT:()=>ye,QH:()=>Le,Rn:()=>Fe,TQ:()=>pe,_i:()=>xe,aw:()=>he,d_:()=>oe,g5:()=>V,gy:()=>N,pS:()=>$e,pk:()=>A,sI:()=>be,sc:()=>se,vV:()=>j});var R=c(2543),Pe=c.n(R),I=c(36195),o=c(12798),h=c(56245),ne=c(13137);function i(Q=""){const F=[],_=Le(Q,[I.PN]);for(const B of _){const Me=B.getChild(I.dJ)?.getChild(I.Sg),g=B.getChild(I.dJ)?.getChild(I.q5),b=ue(B);if(!(!Me&&!g||!b.length))for(const S of b){const T=Q.substring(S.from,S.to).trim(),U=T[0]==="`",G=T.substring(1,T.length-1);if(!G)continue;let fe="";g?fe=U?G:G.replace(/\\\\/g,"\\"):fe=(0,R.escapeRegExp)(G),fe&&F.push(fe)}}return F}function ue(Q){const F=[];let _=Q;do{const B=_.getChild(I.Qf);B&&!_.getChild(I.w7)&&F.push(B),_=_.getChild(I.ih)}while(_!=null);return F}function j(Q){let F=ee(Q);const{instant:_,range:B,...Me}=Q;try{be(Q.expr)&&F===ne.U3.Instant&&(F=ne.U3.Range)}catch{}return{...Me,queryType:F}}function ee(Q){const{queryType:F}=Q;return F===ne.U3.Range||F===ne.U3.Instant||F===ne.U3.Stream?F:Q.instant===!0?ne.U3.Instant:ne.U3.Range}const de=["String","Identifier","LineComment","Number"],$=["__error__","__interval","__interval_ms","__auto"];function ve(Q){let F=Q;return I.K3.parse(Q).iterate({enter:({name:B,from:Me,to:g})=>{const b=Q.substring(Me,g);de.includes(B)&&!$.includes(b)&&(F=F.replace(b,B))}}),F}function we(Q){const F=[];return parser.parse(Q).iterate({enter:({name:B})=>{F.push(B)}}),F}function w(Q,F){let _=!1;return I.K3.parse(Q).iterate({enter:({type:Me})=>{if(Me.id===F)return _=!0,!1}}),_}function Le(Q,F){const _=[];return I.K3.parse(Q).iterate({enter:Me=>{(F===void 0||F.includes(Me.type.id))&&_.push(Me.node)}}),_}function pe(Q,F){const _=[];return I.K3.parse(Q).iterate({enter:Me=>{(F===void 0||F.includes(Me.type.id))&&_.push(o.Ch.fromNode(Me.node))}}),_}function je(Q,F){const _=Le(Q,[F]);return _.length>0?_[0]:void 0}function Oe(Q){return w(Q,h.Ql)}function be(Q){return Q.trim().length>2&&!w(Q,I.Yw)}function ce(Q){const _=Le(Q,[I.iT,I.eF,I.c$]).length;return{queryWithParser:_>0,parserCount:_}}function he(Q){const F=Le(Q,[I.iT,I.LM,I.c$]);return F.length>0?Q.substring(F[0].from,F[0].to).trim():void 0}function oe(Q){const F=Le(Q,[I.bY]);for(const _ of F){const B=_.getChild(I.g$)?.getChild(I.gw);if(B&&Q.substring(B.from,B.to)==="__error__")return!0}return!1}function xe(Q){return w(Q,I.J_)}function ye(Q){if(be(Q))return Q;const F=je(Q,I.MD);if(!F)return"";const _=Q.substring(F.from,F.to),B=je(Q,I.AL),Me=B?Q.substring(B.from,B.to):"";return`${_} ${Me}`.trim()}function V(Q,F){if(be(Q))return Q;const _=Le(Q,[I.Yw]).reverse().find(B=>B.from<=F&&B.to>=F);return _?ye(Q.substring(_.from,_.to)):""}function $e(Q){return w(Q,I.bY)}function Fe(Q){return w(Q,I.PN)}function Ve(Q){const F=Le(Q,[I.Q6]);for(const _ of F)if(Q.substring(_.from,_.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function A(Q){return(0,o.yB)(Q).map(B=>Q.slice(B.from,B.to))}function N(Q){return Q.filter(_=>!_.hide).filter(_=>!_.refId.includes("do-not-chunk")).filter(_=>_.expr).length>0}const te=Q=>Q?"expr"in Q&&Q.expr!==void 0:!1,se=Q=>{if(!(!Q||!te(Q)))return Q}},43548:(qe,De,c)=>{"use strict";c.d(De,{y:()=>i});var R=c(83077),Pe=c(42952);class I{constructor(j,ee){this.categories=[],this.operationsRegistry=new R.O(()=>j),this.innerQueryPlaceholder=ee||"<query>"}setOperationCategories(j){this.categories=j}getOperationsForCategory(j){return this.operationsRegistry.list().filter(ee=>ee.category===j&&!ee.hideFromList)}getAlternativeOperations(j){return this.operationsRegistry.list().filter(ee=>ee.alternativesKey&&ee.alternativesKey===j)}getCategories(){return this.categories}getOperationDefinition(j){return this.operationsRegistry.getIfExists(j)}hasBinaryOp(j){return j.operations.find(ee=>{const de=this.getOperationDefinition(ee.id);return de?.category===Pe.T})!==void 0}}var o=c(83657),h=c(54623);class ne extends I{constructor(){super(o.sp,"<expr>"),this.setOperationCategories([h.Ln.Aggregations,h.Ln.RangeFunctions,h.Ln.Formats,h.Ln.BinaryOps,h.Ln.LabelFilters,h.Ln.LineFilters])}renderOperations(j,ee){for(const de of ee){const $=this.operationsRegistry.getIfExists(de.id);if(!$){console.error(`Could not find operation ${de.id} in the registry`);continue}j=$.renderer(de,$,j)}return j}renderBinaryQueries(j,ee){if(ee)for(const de of ee)j=`${this.renderBinaryQuery(j,de)}`;return j}renderBinaryQuery(j,ee){let de=j+` ${ee.operator} `;return ee.vectorMatches&&(de+=`${ee.vectorMatchesType}(${ee.vectorMatches}) `),de+this.renderQuery(ee.query,!0)}renderLabels(j){if(j.length===0)return"{}";let ee="{";for(const de of j)ee!=="{"&&(ee+=", "),ee+=`${de.label}${de.op}"${de.value}"`;return ee+"}"}renderQuery(j,ee){let de=this.renderLabels(j.labels);return de=this.renderOperations(de,j.operations),!ee&&this.hasBinaryOp(j)&&j.binaryQueries?.length&&(de=`(${de})`),de=this.renderBinaryQueries(de,j.binaryQueries),de}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:h.IQ.Log,operations:[{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:[""]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.SumOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]},{id:h.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:["latency"]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.QuantileOverTime,params:["$__auto",.5]},{id:h.EF.Sum,params:[]}]}]}}const i=new ne},58592:(qe,De,c)=>{"use strict";c.d(De,{C:()=>I,I:()=>o});var R=c(11216),Pe=c(54623);const I=[{id:Pe.EF.Addition,name:"Add scalar",sign:"+"},{id:Pe.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:Pe.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:Pe.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:Pe.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:Pe.EF.Exponent,name:"Exponent",sign:"^"},{id:Pe.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:Pe.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:Pe.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:Pe.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:Pe.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:Pe.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],o=I.map(ne=>{const i=[{name:"Value",type:"number"}];let ue=[2];return ne.comparison&&(i.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),ue=[2,!1]),{id:ne.id,name:ne.name,params:i,defaultParams:ue,alternativesKey:"binary scalar operations",category:Pe.Ln.BinaryOps,renderer:h(ne.sign),addOperationHandler:R.iZ}});function h(ne){return function(ue,j,ee){let de=ue.params[0],$="";return ue.params.length===2&&($=ue.params[1]?" bool":""),`${ee} ${ne}${$} ${de}`}}},11216:(qe,De,c)=>{"use strict";c.d(De,{af:()=>he,VR:()=>oe,G3:()=>te,jC:()=>B,fu:()=>ve,yD:()=>we,iZ:()=>N,UF:()=>xe,OS:()=>V,hh:()=>je,sn:()=>pe,EP:()=>Oe});var R=c(2543),Pe=c(55127),I=c.n(Pe),o=c(97535),h=c(71713),ne=c(74848),i=c(96540),ue=c(90182);const j=({onChange:g,index:b,operationId:S,value:T,query:U,datasource:G,queryModeller:fe})=>{const[ae,Ie]=(0,i.useState)({});return(0,ne.jsx)(ue.l6,{inputId:V(S,b),autoFocus:T==="",openMenuOnFocus:!0,onOpenMenu:async()=>{Ie({isLoading:!0});const Ue=await ee(U,G,fe);Ie({options:Ue,isLoading:void 0})},isLoading:ae.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:ae.options,value:de(T),onChange:Ue=>g(b,Ue.value)})};async function ee(g,b,S){let T=g.labels;const U=S.renderLabels(T);return(await b.languageProvider.fetchLabels({streamSelector:U})).map(fe=>({label:fe,value:fe}))}const de=g=>({label:g?.toString(),value:g});var $=c(54623);function ve(g,b){const S=[ye()],T=["$__auto"];let U;return g===$.EF.QuantileOverTime&&(T.push("0.95"),S.push({name:"Quantile",type:"number"})),b&&(S.push({name:"By label",type:"string",restParam:!0,optional:!0}),U=$e(`__${g}_by`)),{id:g,name:A(g),params:S,defaultParams:T,alternativesKey:"range function",category:$.Ln.RangeFunctions,orderRank:$.h5.RangeVectorFunction,renderer:Le,addOperationHandler:he,paramChangedHandler:U,explainHandler:(G,fe)=>{let ae=h.AW.find(Ie=>Ie.insertText===G.id)?.documentation??"";return G.params[0]==="$__auto"?`${ae} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${ae} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${G.params[0]}\`.`}}}function we(g){const b=ve(g,!0),S=b.params.slice(0,-1);return[b,{id:`__${g}_by`,name:`${A(g)} by`,params:[...S,{name:"Label",type:"string",restParam:!0,optional:!0,editor:j}],defaultParams:[...b.defaultParams,""],alternativesKey:"range function with grouping",category:$.Ln.RangeFunctions,renderer:w(g,"by"),paramChangedHandler:Ve(g),explainHandler:Fe(g,"by"),addOperationHandler:he,hideFromList:!0},{id:`__${g}_without`,name:`${A(g)} without`,params:[...S,{name:"Label",type:"string",restParam:!0,optional:!0,editor:j}],defaultParams:[...b.defaultParams,""],alternativesKey:"range function with grouping",category:$.Ln.RangeFunctions,renderer:w(g,"without"),paramChangedHandler:Ve(g),explainHandler:Fe(g,"without"),addOperationHandler:he,hideFromList:!0}]}function w(g,b){return function(T,U,G){const fe=U.params.findIndex(Ue=>Ue.restParam),ae=T.params.slice(0,fe),Ie=T.params.slice(fe);return ae.length===2&&g===$.EF.QuantileOverTime?`${g}(${ae[1]}, ${G} [${ae[0]}]) ${b} (${Ie.join(", ")})`:`${g}(${G} [${ae[0]}]) ${b} (${Ie.join(", ")})`}}function Le(g,b,S){const T=g.params??[],U=T[0]??"$__auto";if(T.length===2&&g.id===$.EF.QuantileOverTime){const G=T[1];return`${g.id}(${G}, ${S} [${U}])`}return`${g.id}(${S} [${T[0]??"$__auto"}])`}function pe(g,b,S){return["<","<=",">",">="].includes(String(g.params[1]))?`${S} | ${g.params[0]} ${g.params[1]} ${g.params[2]}`:`${S} | ${g.params[0]} ${g.params[1]} \`${g.params[2]}\``}function je(g,b){if(!g)return!1;const S=g.params[1].toString().startsWith("!");return b.filter(G=>G.id===$.EF.LabelFilter&&G.params[0]===g.params[0]&&G.params[2]===g.params[2]).some(G=>!!(S&&G.params[1].toString().startsWith("!")===!1||S===!1&&G.params[1].toString().startsWith("!")))}function Oe(g,b,S){switch(g.id){case $.EF.Logfmt:const[T=!1,U=!1,...G]=g.params;return`${S} | logfmt${T?" --strict":""}${U?" --keep-empty":""} ${G.filter(fe=>fe).join(", ")}`.trim();case $.EF.Json:return`${S} | json ${g.params.filter(fe=>fe).join(", ")}`.trim();case $.EF.Drop:return`${S} | drop ${g.params.filter(fe=>fe).join(", ")}`.trim();case $.EF.Keep:return`${S} | keep ${g.params.filter(fe=>fe).join(", ")}`.trim();default:return`${S} | ${g.id}`}}function be(g){return g.category===$.Ln.RangeFunctions}function ce(g,b,S){const T=g.findIndex(U=>{const G=b.getOperationDefinition(U.id);return G?S(G):!1});return T===-1?g.length:T}function he(g,b,S){const T={id:g.id,params:g.defaultParams},U=[...b.operations],G=U.find(fe=>{const ae=S.getOperationDefinition(fe.id);return ae?be(ae):!1});switch(g.category){case $.Ln.Aggregations:case $.Ln.Functions:if(!G){const ae=ce(U,S,Ie=>Ie.category===$.Ln.Functions);U.splice(ae,0,{id:$.EF.Rate,params:["$__auto"]})}U.push(T);break;case $.Ln.RangeFunctions:if(G){const ae=U.indexOf(G);U[ae]=T;break}default:const fe=ce(U,S,ae=>(g.orderRank??100)<(ae.orderRank??100));U.splice(fe,0,T);break}return{...b,operations:U}}function oe(g,b){return{...b,binaryQueries:[...b.binaryQueries??[],{operator:"/",query:b}]}}function xe(g,b){return function(T,U,G){const fe=T.params.some(Ue=>typeof Ue=="string"&&Ue.includes("`")),ae=fe?'"':"`";let Ie;return fe?Ie=T.params.map(Ue=>typeof Ue=="string"?(0,o.Qn)(Ue):Ue):Ie=T.params,b?`${G} ${g} ${ae}(?i)${Ie.join(`${ae} or ${ae}(?i)`)}${ae}`:`${G} ${g} ${ae}${Ie.join(`${ae} or ${ae}`)}${ae}`}}function ye(){return{name:"Range",type:"string",options:["$__auto","1m","5m","10m","1h","24h"]}}function V(g,b){return`operations.${g}.param.${b}`}function $e(g){return function(S,T,U){return T.params.length===U.params.length?{...T,id:g}:T}}function Fe(g,b){return function(T){const U=T.params.map(fe=>`\`${fe}\``).join(" and "),G=I()("label",T.params.length);switch(b){case"by":return`Calculates ${g} over dimensions while preserving ${G} ${U}.`;case"without":return`Calculates ${g} over the dimensions ${U}. All other labels are preserved.`;default:return`Calculates ${g} over the dimensions.`}}}function Ve(g){return function(S,T,U){return T.params.length<U.params.length?{...T,id:g}:T}}function A(g){return(0,R.capitalize)(g.replace(/_/g," "))}function N(g,b){const S={id:g.id,params:g.defaultParams};return{...b,operations:[...b.operations,S]}}function te(g,b={}){return[{id:g,name:A(g),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],alternativesKey:"plain aggregations",category:$.Ln.Aggregations,renderer:Q,paramChangedHandler:$e(`__${g}_by`),explainHandler:Fe(g,""),addOperationHandler:N,...b},{id:`__${g}_by`,name:`${A(g)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:j}],defaultParams:[""],alternativesKey:"aggregations by",category:$.Ln.Aggregations,renderer:_(g),paramChangedHandler:Ve(g),explainHandler:Fe(g,"by"),addOperationHandler:N,hideFromList:!0,...b},{id:`__${g}_without`,name:`${A(g)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:j}],defaultParams:[""],alternativesKey:"aggregations by",category:$.Ln.Aggregations,renderer:se(g),paramChangedHandler:Ve(g),explainHandler:Fe(g,"without"),addOperationHandler:N,hideFromList:!0,...b}]}function se(g){return function(S,T,U){return`${g} without(${S.params.join(", ")}) (${U})`}}function Q(g,b,S){const T=F(g,b,S),U=g.id+"(";return S&&T.push(S),U+T.join(", ")+")"}function F(g,b,S){return(g.params??[]).map((T,U)=>b.params[U].type==="string"?'"'+T+'"':T)}function _(g){return function(S,T,U){return`${g} by(${S.params.join(", ")}) (${U})`}}function B(g,b,S={}){const T=te(g,S);return T[0].params.unshift(...b.params),T[1].params.unshift(...b.params),T[2].params.unshift(...b.params),T[0].defaultParams=b.defaultParams,T[1].defaultParams=[...b.defaultParams,""],T[2].defaultParams=[...b.defaultParams,""],T[1].renderer=Me(g),T[2].renderer=Me(g),T}function Me(g){return function(S,T,U){const G=T.params.findIndex(Ie=>Ie.restParam),fe=S.params.slice(0,G),ae=S.params.slice(G);return`${g} by(${ae.join(", ")}) (${fe.map((Ie,Ue)=>T.params[Ue].type==="string"?`"${Ie}"`:Ie).join(", ")}, ${U})`}}},83657:(qe,De,c)=>{"use strict";c.d(De,{VI:()=>be,y6:()=>je,mD:()=>Oe,sp:()=>pe});var R=c(58592),Pe=c(74848),I=c(96540),o=c(50877),h=c(43127),ne=c(32264),i=c(90182),ue=c(20065),j=c(27724),ee=c(56587),de=c(75723),$=c(11216);function ve({onChange:ce,index:he,operationId:oe,value:xe,query:ye,datasource:V,timeRange:$e,queryModeller:Fe}){const[Ve,A]=(0,I.useState)({});return(0,Pe.jsx)(i.l6,{inputId:(0,$.OS)(oe,he),onOpenMenu:async()=>{if(V instanceof j.VQ&&ne.$.featureToggles.lokiQueryHints){A({isLoading:!0});const N=await we(ye,V,Fe,$e);A({options:N,isLoading:void 0})}},isLoading:Ve.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:Ve.options,value:xe?(0,o.z)(xe.toString()):null,onChange:N=>{N.value&&ce(he,N.value)}})}async function we(ce,he,oe,xe=(0,h.E2)()){const ye=oe.renderQuery(ce),V=(0,ee.OT)(ye);if((0,ee.FV)(he.interpolateString(V,ue.a)))return[];const $e=await he.getDataSamples({expr:V,refId:"unwrap_samples"},xe);return(0,de.aN)($e[0]).map(A=>({label:A,value:A}))}var w=c(54623);function Le(){const ce=[w.EF.Sum,w.EF.Min,w.EF.Max,w.EF.Avg,w.EF.Stddev,w.EF.Stdvar,w.EF.Count].flatMap(V=>(0,$.G3)(V,{addOperationHandler:$.af,orderRank:w.h5.Last})),he=[w.EF.TopK,w.EF.BottomK].flatMap(V=>(0,$.jC)(V,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:$.af,orderRank:w.h5.Last})),oe=[(0,$.fu)(w.EF.Rate),(0,$.fu)(w.EF.RateCounter),(0,$.fu)(w.EF.CountOverTime),(0,$.fu)(w.EF.SumOverTime),(0,$.fu)(w.EF.BytesRate),(0,$.fu)(w.EF.BytesOverTime),(0,$.fu)(w.EF.AbsentOverTime)],xe=[...(0,$.yD)(w.EF.AvgOverTime),...(0,$.yD)(w.EF.MaxOverTime),...(0,$.yD)(w.EF.MinOverTime),...(0,$.yD)(w.EF.FirstOverTime),...(0,$.yD)(w.EF.LastOverTime),...(0,$.yD)(w.EF.StdvarOverTime),...(0,$.yD)(w.EF.StddevOverTime),...(0,$.yD)(w.EF.QuantileOverTime)];return[...ce,...he,...oe,...xe,{id:w.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.Parsers,renderer:$.EP,addOperationHandler:$.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:w.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.Parsers,renderer:$.EP,addOperationHandler:$.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:w.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.Parsers,renderer:(V,$e,Fe)=>`${Fe} | regexp \`${V.params[0]}\``,addOperationHandler:$.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:w.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.Parsers,renderer:(V,$e,Fe)=>`${Fe} | pattern \`${V.params[0]}\``,addOperationHandler:$.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:w.EF.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.Parsers,renderer:$.EP,addOperationHandler:$.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:w.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.PipeOperations,renderer:(V,$e,Fe)=>`${Fe} | line_format \`${V.params[0]}\``,addOperationHandler:$.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:w.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.PipeOperations,renderer:(V,$e,Fe)=>`${Fe} | label_format ${V.params[1]}=${V.params[0]}`,addOperationHandler:$.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:w.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(0,$.UF)("|="),addOperationHandler:$.af,explainHandler:V=>`Return log lines that contain string \`${V.params?.join("`, or `")}\`.`},{id:w.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(0,$.UF)("!="),addOperationHandler:$.af,explainHandler:V=>`Return log lines that does not contain string \`${V.params?.join("`, or `")}\`.`},{id:w.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(0,$.UF)("|~",!0),addOperationHandler:$.af,explainHandler:V=>`Return log lines that match regex \`(?i)${V.params?.join("`, or `(?i)")}\`.`},{id:w.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(0,$.UF)("!~",!0),addOperationHandler:$.af,explainHandler:V=>`Return log lines that does not match regex \`(?i)${V.params?.join("`, or `(?i)")}\`.`},{id:w.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(0,$.UF)("|~"),addOperationHandler:$.af,explainHandler:V=>`Return log lines that match a \`RE2\` regex pattern. \`${V.params?.join("`, or `")}\`.`},{id:w.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(0,$.UF)("!~"),addOperationHandler:$.af,explainHandler:V=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${V.params?.join("`, or `")}\`.`},{id:w.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[w.NS.contains,w.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:w.Ln.LineFilters,orderRank:w.h5.LineFilters,renderer:(V,$e,Fe)=>`${Fe} ${V.params[0]} ip(\`${V.params[1]}\`)`,addOperationHandler:$.af,explainHandler:V=>`Return log lines using IP matching of \`${V.params[1]}\``},{id:w.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[w.NS.equals,w.NS.doesNotEqual,w.NS.matchesRegex,w.NS.doesNotMatchRegex,w.NS.greaterThan,w.NS.lessThan,w.NS.greaterThanOrEqual,w.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:w.Ln.LabelFilters,orderRank:w.h5.PipeOperations,renderer:$.sn,addOperationHandler:$.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:w.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[w.NS.equals,w.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:w.Ln.LabelFilters,orderRank:w.h5.PipeOperations,renderer:(V,$e,Fe)=>`${Fe} | ${V.params[0]} ${V.params[1]} ip(\`${V.params[2]}\`)`,addOperationHandler:$.af,explainHandler:V=>`Return log lines using IP matching of \`${V.params[2]}\` for \`${V.params[0]}\` label`},{id:w.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:w.Ln.LabelFilters,orderRank:w.h5.NoErrors,renderer:(V,$e,Fe)=>`${Fe} | __error__=\`\``,addOperationHandler:$.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:w.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:ve},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.Unwrap,renderer:(V,$e,Fe)=>`${Fe} | unwrap ${V.params[1]?`${V.params[1]}(${V.params[0]})`:V.params[0]}`,addOperationHandler:$.af,explainHandler:V=>{let $e=String(V.params[0]).length>0?V.params[0]:"<label>";return`Use the extracted label \`${$e}\` as sample values instead of log lines for the subsequent range aggregation.${V.params[1]?` Conversion function \`${V.params[1]}\` wrapping \`${$e}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:w.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.PipeOperations,renderer:(V,$e,Fe)=>`${Fe} | decolorize`,addOperationHandler:$.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:w.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.PipeOperations,renderer:$.EP,addOperationHandler:$.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:w.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],alternativesKey:"format",category:w.Ln.Formats,orderRank:w.h5.PipeOperations,renderer:$.EP,addOperationHandler:$.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...R.I,{id:w.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:w.Ln.BinaryOps,renderer:(V,$e,Fe)=>Fe,addOperationHandler:$.VR}]}const pe=Le();function je(ce){return(pe.find(xe=>xe.id===ce)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function Oe(ce){return pe.find(he=>he.id===ce)}function be(ce,he){return!(he.length<ce.params.filter(oe=>!oe.optional).length)}},60706:(qe,De,c)=>{"use strict";c.d(De,{u_:()=>ne,w4:()=>xe});var R=c(36195),Pe=c(58592),I=c(83657),o=c(56245),h=c(54623);function ne(A){const N=(0,o.qk)(A),se=R.K3.parse(N).topNode,F={query:{labels:[],operations:[]},errors:[]};try{i(N,se,F)}catch(_){console.error(_),_ instanceof Error&&F.errors.push({text:_.message})}return $e(F.query)&&(F.errors=[]),F}function i(A,N,te){const se=te.query;switch(N.type.id){case R.g$:{se.labels.push(ue(A,N));const Q=N.getChild(o.Ql);Q&&te.errors.push((0,o.xz)(A,Q));break}case R.PN:{const{operation:Q,error:F}=j(A,N);Q&&se.operations.push(Q),F&&te.errors.push(V(A,N,F));break}case R.iT:{se.operations.push(ee(A,N));break}case R.bY:{const{operation:Q,error:F}=ve(A,N);Q&&se.operations.push(Q),F&&te.errors.push(V(A,N,F));break}case R.eF:{se.operations.push(de(A,N));break}case R.Zj:case R.Tz:{const{operation:Q,error:F}=$(A,N);Q&&se.operations.push(Q),F&&te.errors.push(V(A,N,F));break}case R.pH:{se.operations.push(we(A,N));break}case R.e_:{se.operations.push(w(A,N));break}case R.HV:{const{operation:Q,error:F}=pe(A,N,te);Q&&se.operations.push(Q),F&&te.errors.push(V(A,N,F));break}case R.Zg:{se.operations.push(Le());break}case R.h1:{se.operations.push(je(A,N,te));break}case R.Rh:{se.operations.push(Oe(A,N,te));break}case R.MK:{ce(A,N,te);break}case o.Ql:{if(oe(N))break;te.errors.push((0,o.xz)(A,N));break}case R.i8:{se.operations.push(Fe(A,N,te));break}case R.UP:{se.operations.push(Ve(A,N,te));break}default:{let Q=N.firstChild;for(;Q;)i(A,Q,te),Q=Q.nextSibling}}}function ue(A,N){const te=N.getChild(R.gw),se=(0,o.AA)(A,te),Q=(0,o.AA)(A,te?.nextSibling);let F=(0,o.AA)(A,N.getChild(R.Qf));return F=F.substring(1,F.length-1),{label:se,op:Q,value:F}}function j(A,N){const te=(0,o.AA)(A,N.getChild(R.dJ)),se=xe((0,o.AA)(A,N.getChild(R.Qf)));if(N.getChild(R.w7)?.getChild(R.Ip))return{operation:{id:h.EF.LineFilterIpMatches,params:[te,se]}};const F=[se];let _=N.getChild(R.ih);for(;_;)F.push(xe((0,o.AA)(A,_.getChild(R.Qf)))),_=_.getChild(R.ih);return{operation:{id:{"|=":h.EF.LineContains,"!=":h.EF.LineContainsNot,"|~":h.EF.LineMatchesRegex,"!~":h.EF.LineMatchesRegexNot}[te],params:F}}}function ee(A,N){const te=N.firstChild,se=(0,o.AA)(A,te),Q=xe((0,o.AA)(A,N.getChild(R.Qf)));let F=Q?[Q]:[];const _=(0,I.mD)(se);return _&&!(0,I.VI)(_,F)&&(F=_?.defaultParams||[]),{id:se,params:F}}function de(A,N){const te=N.getChild(R.LM),se=(0,o.AA)(A,te),Q=[...(0,o.R1)(A,N,R.Gn)];return{id:se,params:Q}}function $(A,N){const te=[],se=[];let Q;const F=N.from;return N.toTree().iterate({enter:B=>{B.type.id===R.ov?te.push(A.substring(B.from+F,B.to+F)):B.type.id===R.Gn?se.push(A.substring(B.from+F,B.to+F)):B.type.id===o.Ql&&(Q=`Unexpected string "${A.substring(B.from+F,B.to+F)}"`)}}),{operation:{id:h.EF.Logfmt,params:[te.includes("--strict"),te.includes("--keep-empty"),...se]},error:Q}}function ve(A,N){if(N.getChild(R.Or)||N.getChild(R.KD)||N.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(N.firstChild.type.id===R.GA){const Me=N.firstChild,g=Me?.getChild(R.gw),b=g?.nextSibling,S=Me?.getChild(R.Qf),T=xe((0,o.AA)(A,S));return{operation:{id:h.EF.LabelFilterIpMatches,params:[(0,o.AA)(A,g),(0,o.AA)(A,b),T]}}}const te=h.EF.LabelFilter;if(N.firstChild.type.id===R.Jq){const g=N.firstChild.firstChild.firstChild,b=g.nextSibling,S=b.nextSibling,T=xe((0,o.AA)(A,S));return{operation:{id:te,params:[(0,o.AA)(A,g),(0,o.AA)(A,b),T]}}}const Q=N.firstChild.firstChild,F=Q.nextSibling,_=F.nextSibling,B=[(0,o.AA)(A,Q),(0,o.AA)(A,F),xe((0,o.AA)(A,_))];return B.join("")==="__error__="?{operation:{id:h.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:te,params:B}}}function we(A,N){const te=h.EF.LineFormat,se=xe((0,o.AA)(A,N.getChild(R.Qf)));return{id:te,params:[se]}}function w(A,N){const te=h.EF.LabelFormat,se=N.getChild(R.gw),F=se.nextSibling.nextSibling;return{id:te,params:[(0,o.AA)(A,F),xe((0,o.AA)(A,se))]}}function Le(){return{id:h.EF.Decolorize,params:[]}}function pe(A,N,te){const se=N.getChild(R.HV),Q=N.getChild(R.bY),F=N.getChild(R.sK);if(se&&i(A,se,te),Q&&i(A,Q,te),F){if(F.nextSibling?.type.id===R.yW){const _=F.nextSibling,B=_.nextSibling;return{operation:{id:h.EF.Unwrap,params:[(0,o.AA)(A,B),(0,o.AA)(A,_)]}}}return{operation:{id:h.EF.Unwrap,params:[(0,o.AA)(A,F?.nextSibling),""]}}}return{}}function je(A,N,te){const se=N.getChild(R.lo),Q=(0,o.AA)(A,se),F=N.getChild(R.wN),_=N.getChild(R.xo),B=F!=null?[(0,o.AA)(A,F)]:[],Me=_?.getChild(R.Q6),g=Me?(0,o.AA)(A,Me):null,b=N.getChild(R.aU);g&&B.unshift(g.substring(1,g.length-1)),b&&B.push(...(0,o.R1)(A,b,R.gw));const S={id:Q,params:B};return _&&i(A,_,te),S}function Oe(A,N,te){const se=N.getChild(R.ZQ);let Q=(0,o.AA)(A,se);const F=N.getChild(R.aU),_=[],B=N.getChild(R.wN);B&&_.push(Number((0,o.AA)(A,B))),F&&(F.getChild(R.By)&&Q&&(Q=`__${Q}_by`),F.getChild(R.xB)&&(Q=`__${Q}_without`),_.push(...(0,o.R1)(A,F,R.gw)));const Me=N.getChild(R.Yw),g={id:Q,params:_};return Me&&(Me.firstChild?.type.id===R.MK&&te.errors.push({text:"Query parsing is ambiguous.",from:Me.firstChild.from,to:Me.firstChild?.to}),i(A,Me,te)),g}const be=Pe.C.reduce((A,N)=>(A[N.sign]={id:N.id,comparison:N.comparison},A),{});function ce(A,N,te){const se=te.query,Q=N.firstChild,F=(0,o.AA)(A,Q.nextSibling),_=he(A,N.getChild(R.o5)),B=N.lastChild,Me=be[F],g=ye(Q,"MetricExpr.LiteralExpr.Number"),b=ye(B,"MetricExpr.LiteralExpr.Number"),S=B.getChild(R.MK);if(g||i(A,Q,te),b)se.operations.push((0,o.rq)(Me,A,B,!!_?.isBool));else if(S){const T=(0,o.z9)(B);T?.type.id===R.wN&&se.operations.push((0,o.rq)(Me,A,T,!!_?.isBool)),i(A,B,te)}else{se.binaryQueries=se.binaryQueries||[];const T={operator:F,query:{labels:[],operations:[]}};_?.isMatcher&&(T.vectorMatchesType=_.matchType,T.vectorMatches=_.matches),se.binaryQueries.push(T),i(A,B,{query:T.query,errors:te.errors})}}function he(A,N){if(!N)return;const te=N.getChild(R.wT),se=N.getChild(R.x);if(!te&&se)return{isBool:!0,isMatcher:!1};{if(!te)return;const Q=(0,o.AA)(A,te.getChild(R.x$)?.getChild(R.qJ));return{isMatcher:!0,isBool:!!se,matches:Q,matchType:te.getChild(R.On)?"on":"ignoring"}}}function oe(A){return A?.parent?.type.id===R.Q6}function xe(A){return A[0]==='"'&&A[A.length-1]==='"'?A.substring(1,A.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):A.replace(/`/g,"")}function ye(A,N){let te=A;const se=N.split(".");for(const Q of se)if(te=te.getChild(Q),!te)return null;return te}function V(A,N,te){const se=(0,o.xz)(A,N);return se.text=`${te}: ${se.text}`,se}function $e(A){return A.labels.length===0&&A.operations.length===0}function Fe(A,N,te){const se=[];let Q=N.getChild(R.LQ);for(;Q;){const F=(0,o.AA)(A,Q.getChild(R.yj));F&&se.push(F),Q=Q?.getChild(R.LQ)}return se.reverse(),{id:h.EF.Drop,params:se}}function Ve(A,N,te){const se=[];let Q=N.getChild(R.J3);for(;Q;){const F=(0,o.AA)(A,Q.getChild(R.UM));F&&se.push(F),Q=Q?.getChild(R.J3)}return se.reverse(),{id:h.EF.Keep,params:se}}},56245:(qe,De,c)=>{"use strict";c.d(De,{AA:()=>ue,If:()=>i,Ql:()=>R,R1:()=>ee,SY:()=>o,qk:()=>h,rq:()=>j,xz:()=>I,z9:()=>Pe});const R=0;function Pe($){return $.firstChild?Pe($.firstChild):$}function I($,ve){return{text:ue($,ve),from:ve.from,to:ve.to,parentType:ve.parent?.name}}const o=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function h($){return $.replace(o,(ve,we,w,Le,pe,je,Oe)=>{const be=Le||Oe;let ce=we,he="0";return w&&(ce=w,he="1"),pe&&(ce=pe,he="2"),`__V_${he}__`+ce+"__V__"+(be?"__F__"+be+"__F__":"")})}const ne=[($,ve)=>`$${$}`,($,ve)=>`[[${$}${ve?`:${ve}`:""}]]`,($,ve)=>`\${${$}${ve?`:${ve}`:""}}`];function i($){return $.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(ve,we,w,Le)=>ne[parseInt(we,10)](w,Le))}function ue($,ve){return ve?i($.substring(ve.from,ve.to)):""}function j($,ve,we,w){const Le=[parseFloat(ue(ve,we))];return $.comparison&&Le.push(w),{id:$.id,params:Le}}function ee($,ve,we){if(ve.type.id===we||ve.name===we)return[ue($,ve)];const w=[];let Le=0,pe=ve.childAfter(Le);for(;pe;)w.push(...ee($,pe,we)),Le=pe.to,pe=ve.childAfter(Le);return w}const de=$=>$.split(" ").map(we=>`${we}.*`).join("")},54623:(qe,De,c)=>{"use strict";c.d(De,{EF:()=>o,IQ:()=>Pe,Ln:()=>I,NS:()=>ne,h5:()=>h});var R=c(42952),Pe=(i=>(i.Log="log",i.Metric="metric",i))(Pe||{}),I=(i=>(i.Aggregations="Aggregations",i.RangeFunctions="Range functions",i.Functions="Functions",i.Formats="Formats",i.LineFilters="Line filters",i.LabelFilters="Label filters",i[i.BinaryOps=R.T]="BinaryOps",i))(I||{}),o=(i=>(i.Json="json",i.Logfmt="logfmt",i.Regexp="regexp",i.Pattern="pattern",i.Unpack="unpack",i.LineFormat="line_format",i.LabelFormat="label_format",i.Decolorize="decolorize",i.Drop="drop",i.Keep="keep",i.Rate="rate",i.RateCounter="rate_counter",i.CountOverTime="count_over_time",i.SumOverTime="sum_over_time",i.AvgOverTime="avg_over_time",i.MaxOverTime="max_over_time",i.MinOverTime="min_over_time",i.FirstOverTime="first_over_time",i.LastOverTime="last_over_time",i.StdvarOverTime="stdvar_over_time",i.StddevOverTime="stddev_over_time",i.QuantileOverTime="quantile_over_time",i.BytesRate="bytes_rate",i.BytesOverTime="bytes_over_time",i.AbsentOverTime="absent_over_time",i.Sum="sum",i.Avg="avg",i.Min="min",i.Max="max",i.Stddev="stddev",i.Stdvar="stdvar",i.Count="count",i.TopK="topk",i.BottomK="bottomk",i.LineContains="__line_contains",i.LineContainsNot="__line_contains_not",i.LineContainsCaseInsensitive="__line_contains_case_insensitive",i.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",i.LineMatchesRegex="__line_matches_regex",i.LineMatchesRegexNot="__line_matches_regex_not",i.LineFilterIpMatches="__line_filter_ip_matches",i.LabelFilter="__label_filter",i.LabelFilterNoErrors="__label_filter_no_errors",i.LabelFilterIpMatches="__label_filter_ip_marches",i.Unwrap="unwrap",i.SumBy="__sum_by",i.SumWithout="__sum_without",i.Addition="__addition",i.Subtraction="__subtraction",i.MultiplyBy="__multiply_by",i.DivideBy="__divide_by",i.Modulo="__modulo",i.Exponent="__exponent",i.NestedQuery="__nested_query",i.EqualTo="__equal_to",i.NotEqualTo="__not_equal_to",i.GreaterThan="__greater_than",i.LessThan="__less_than",i.GreaterOrEqual="__greater_or_equal",i.LessOrEqual="__less_or_equal",i))(o||{}),h=(i=>(i[i.LineFilters=1]="LineFilters",i[i.Parsers=2]="Parsers",i[i.PipeOperations=3]="PipeOperations",i[i.Unwrap=4]="Unwrap",i[i.NoErrors=5]="NoErrors",i[i.RangeVectorFunction=5]="RangeVectorFunction",i[i.Last=6]="Last",i))(h||{});const ne={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},75723:(qe,De,c)=>{"use strict";c.d(De,{Ac:()=>ee,nE:()=>j,db:()=>we,fV:()=>$,sz:()=>w,YB:()=>de,aN:()=>ve});var R=c(11261),Pe=c(70416),I=c(97535);function o(Le){let pe;try{pe=JSON.parse(Le)}catch{}return typeof pe=="object"}const h=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function ne(Le){return h.test(Le)}function i(Le){let pe;try{return pe=JSON.parse(Le),pe.hasOwnProperty("_entry")}catch{return!1}}var ue=c(13137);function j(Le){return(Le.fields.find(je=>je.name==="labels")?.values??[]).some(je=>je.__error__!==void 0)}function ee(Le){return(Le.fields.find(je=>je.name==="labels")?.values??[]).some(je=>je.level!==void 0)}function de(Le){const pe=Le.fields.find(he=>he.type===R.PU.string);if(pe==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const je=pe.values;let Oe=!1,be=!1,ce=!1;return je.forEach(he=>{o(he)&&(Oe=!0,ce=i(he)),ne(he)&&(be=!0)}),{hasLogfmt:be,hasJSON:Oe,hasPack:ce}}function $(Le,pe=ue.HD.Indexed){const je=Le?.fields?.find(ce=>ce.name==="labels")?.values??[],Oe=Le?.fields?.find(ce=>ce.name==="labelTypes")?.values??[];if(!je?.length)return[];if(!Oe?.length){if(pe===ue.HD.Indexed){const{keys:ce}=(0,I.P7)(je);return ce}return[]}let be=new Set;for(let ce=0;ce<je.length;ce++){const he=je[ce],oe=Oe[ce],xe=Object.keys(he).filter(ye=>oe[ye]===pe);be=new Set([...be,...xe])}return Array.from(be)}function ve(Le){const pe=Le?.fields?.find(Oe=>Oe.name==="labels")?.values??[];return pe?.length?Object.keys(pe[0]).filter(Oe=>{const be=pe[0][Oe];return be?!isNaN(Number(be))||(0,Pe.pp)(be)||(0,I.tY)(be):!1}).filter(Oe=>pe.every(be=>be[Oe])):[]}function we(Le){const pe=Le.fields.find(Oe=>Oe.name==="labels"&&Oe.type===R.PU.other);return pe==null?!1:pe.values.some(Oe=>Oe.__error__)}function w(Le){const pe=Le.fields.find(be=>be.name==="labels"&&be.type===R.PU.other);if(pe==null)return null;const je=pe.values.slice(0,2);let Oe=null;for(let be of je){const ce=Object.keys(be).find(he=>he==="lvl"||he.includes("level"));if(ce){Oe=ce;break}}return Oe}},79007:(qe,De,c)=>{"use strict";c.d(De,{Ex:()=>pe,jg:()=>ee,uJ:()=>je});var R=c(41987),Pe=c(42952),I=c(14110),o=c(32264),h=c(27724),ne=c(51814),i=c(56587),ue=c(56245),j=c(13137);const ee=({payload:{dashboardId:Oe,orgId:be,grafanaVersion:ce,queries:he}})=>{try{const oe=he[ne.id]?.filter(F=>!F.hide)?.map(F=>(0,i.vV)(F));if(!oe?.length)return;const xe=oe.filter(F=>(0,i.sI)(F.expr)),ye=oe.filter(F=>!(0,i.sI)(F.expr)),V=oe.filter(F=>F.queryType===j.U3.Instant),$e=oe.filter(F=>F.queryType===j.U3.Range),Fe=oe.filter(F=>F.editorMode===Pe.f.Builder),Ve=oe.filter(F=>F.editorMode===Pe.f.Code),A=oe.filter(de),N=oe.filter($),te=oe.filter(ve),se=oe.filter(we),Q={grafana_version:ce,dashboard_id:Oe,org_id:be,queries_count:oe.length,logs_queries_count:xe.length,metric_queries_count:ye.length,instant_queries_count:V.length,range_queries_count:$e.length,builder_mode_queries_count:Fe.length,code_mode_queries_count:Ve.length,queries_with_template_variables_count:A.length,queries_with_changed_resolution_count:N.length,queries_with_changed_line_limit_count:te.length,queries_with_changed_legend_count:se.length};(0,I.rR)("grafana_loki_dashboard_loaded",Q)}catch(oe){console.error("error in loki tracking handler",oe)}},de=Oe=>ue.SY.test(Oe.expr),$=Oe=>Oe.resolution?Oe.resolution!==1:!1,ve=Oe=>Oe.maxLines!==null&&Oe.maxLines!==void 0,we=Oe=>Oe.legendFormat?Oe.legendFormat!=="":!1,w=Oe=>!![h.Gf,h.M1,h.mL,h.ow,h.lb].some(ce=>Oe.startsWith(ce)),Le=Oe=>{let be=0;for(const ce of Oe.data){const he=ce.meta?.custom?.lokiQueryStatKey;he&&(be+=ce.meta?.stats?.find(oe=>oe.displayName===he)?.value??0)}return be};function pe(Oe,be,ce,he={},oe={}){const{app:xe,targets:ye}=be;if(xe!==R.Jk.Explore)return;let V=Le(Oe);for(const $e of ye){if(w($e.refId))return;(0,I.rR)("grafana_explore_loki_query_executed",{grafana_version:o.$.buildInfo.version,editor_mode:$e.editorMode,has_data:Oe.data.some(Fe=>Fe.length>0),has_error:Oe.error!==void 0,legend:$e.legendFormat,line_limit:$e.maxLines,obfuscated_query:(0,i.$F)($e.expr),query_type:(0,i.sI)($e.expr)?"logs":"metric",query_vector_type:$e.queryType,resolution:$e.resolution,simultaneously_executed_query_count:ye.filter(Fe=>!Fe.hide).length,simultaneously_hidden_query_count:ye.filter(Fe=>Fe.hide).length,time_range_from:be?.range?.from?.toISOString(),time_range_to:be?.range?.to?.toISOString(),time_taken:Date.now()-ce.getTime(),bytes_processed:V,is_split:!1,predefined_operations_applied:he.predefinedOperations?$e.expr.includes(he.predefinedOperations):"n/a",...oe})}}function je(Oe,be,ce,he,oe={}){const xe={split_query_group_count:be.length,split_query_largest_partition_size:Math.max(...be.map(({partition:ye})=>ye.length)),split_query_total_request_count:be.reduce((ye,{partition:V})=>ye+V.length,0),is_split:!0,simultaneously_executed_query_count:ce.targets.filter(ye=>!ye.hide).length,simultaneously_hidden_query_count:ce.targets.filter(ye=>ye.hide).length};for(const ye of be){const V=ye.partition.length;pe(Oe,ye.request,he,oe,{...xe,split_query_partition_size:V})}}},30115:qe=>{var De=typeof Element<"u",c=typeof Map=="function",R=typeof Set=="function",Pe=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function I(o,h){if(o===h)return!0;if(o&&h&&typeof o=="object"&&typeof h=="object"){if(o.constructor!==h.constructor)return!1;var ne,i,ue;if(Array.isArray(o)){if(ne=o.length,ne!=h.length)return!1;for(i=ne;i--!==0;)if(!I(o[i],h[i]))return!1;return!0}var j;if(c&&o instanceof Map&&h instanceof Map){if(o.size!==h.size)return!1;for(j=o.entries();!(i=j.next()).done;)if(!h.has(i.value[0]))return!1;for(j=o.entries();!(i=j.next()).done;)if(!I(i.value[1],h.get(i.value[0])))return!1;return!0}if(R&&o instanceof Set&&h instanceof Set){if(o.size!==h.size)return!1;for(j=o.entries();!(i=j.next()).done;)if(!h.has(i.value[0]))return!1;return!0}if(Pe&&ArrayBuffer.isView(o)&&ArrayBuffer.isView(h)){if(ne=o.length,ne!=h.length)return!1;for(i=ne;i--!==0;)if(o[i]!==h[i])return!1;return!0}if(o.constructor===RegExp)return o.source===h.source&&o.flags===h.flags;if(o.valueOf!==Object.prototype.valueOf)return o.valueOf()===h.valueOf();if(o.toString!==Object.prototype.toString)return o.toString()===h.toString();if(ue=Object.keys(o),ne=ue.length,ne!==Object.keys(h).length)return!1;for(i=ne;i--!==0;)if(!Object.prototype.hasOwnProperty.call(h,ue[i]))return!1;if(De&&o instanceof Element)return!1;for(i=ne;i--!==0;)if(!((ue[i]==="_owner"||ue[i]==="__v"||ue[i]==="__o")&&o.$$typeof)&&!I(o[ue[i]],h[ue[i]]))return!1;return!0}return o!==o&&h!==h}qe.exports=function(h,ne){try{return I(h,ne)}catch(i){if((i.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw i}}},8227:(qe,De,c)=>{"use strict";c.d(De,{A:()=>I});const R=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Pe(o){return typeof o=="string"&&R.test(o)}const I=Pe},36195:(qe,De,c)=>{"use strict";c.d(De,{AL:()=>sa,By:()=>Gr,CX:()=>ia,GA:()=>Ft,GN:()=>Ce,Gn:()=>yt,HV:()=>va,I4:()=>nt,Ip:()=>fr,J3:()=>ft,J_:()=>_t,Jq:()=>nr,K0:()=>ra,K3:()=>T,KD:()=>Yr,LM:()=>U,LQ:()=>ua,MD:()=>Ye,MK:()=>xa,Nl:()=>xt,On:()=>Dt,Or:()=>Jr,PN:()=>Fr,Q6:()=>ma,Qf:()=>wr,Rh:()=>Ga,Sg:()=>rr,Tz:()=>dt,UK:()=>ut,UM:()=>lt,UP:()=>ot,Yw:()=>st,ZQ:()=>or,Zg:()=>rt,Zj:()=>_e,aU:()=>Nr,bY:()=>hr,c$:()=>G,dJ:()=>tr,dw:()=>mr,eF:()=>Ar,e_:()=>kt,g$:()=>Rr,gw:()=>na,h1:()=>yr,i8:()=>Mr,iT:()=>Tt,ih:()=>Cr,lo:()=>Ht,o5:()=>Ea,ov:()=>la,pH:()=>Or,q5:()=>Nt,qJ:()=>Zt,sK:()=>Ue,sq:()=>aa,t3:()=>Tr,uk:()=>Je,w7:()=>oa,wN:()=>vr,wT:()=>pt,x:()=>dr,x$:()=>Gt,xB:()=>Zr,xo:()=>ga,yW:()=>Oa,yj:()=>zt});var R=c(48820);const Pe=1,I=2,o=3,h=4,ne=5,i=6,ue=7,j=8,ee=9,de=10,$=11,ve=12,we=13,w=14,Le=15,pe=16,je=17,Oe=18,be=19,ce=20,he=21,oe=22,xe=23,ye=24,V=25,$e=26,Fe=27,Ve=28,A=29,N=30,te=31,se=32,Q=33,F=34,_=35,B={json:Pe,logfmt:I,unpack:o,pattern:h,regexp:ne,label_format:ue,line_format:j,label_replace:ee,vector:de,offset:$,bool:ve,on:we,ignoring:w,group_left:Le,group_right:pe,unwrap:i,decolorize:je,drop:Oe,keep:be},Me=vt=>B[vt.toLowerCase()]||-1,g={by:ce,without:he,and:oe,or:xe,unless:ye,sum:V,avg:$e,count:Fe,max:Ve,min:A,stddev:N,stdvar:te,bottomk:se,topk:Q,sort:F,sort_desc:_},b=vt=>g[vt.toLowerCase()]||-1,S={__proto__:null,ip:295,count_over_time:301,rate:303,rate_counter:305,bytes_over_time:307,bytes_rate:309,avg_over_time:311,sum_over_time:313,min_over_time:315,max_over_time:317,stddev_over_time:319,stdvar_over_time:321,quantile_over_time:323,first_over_time:325,last_over_time:327,absent_over_time:329,bytes:335,duration:337,duration_seconds:339},T=R.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#ER'#ERO#hQPO'#ERO$}QPO'#DTOYQPO'#DTOOQO'#Ed'#EdO%[QPO'#EcOOQO'#FP'#FPO%aQPO'#FOQ%lQPOOO&mQPO'#F]O&rQPO'#F^OOQO'#Eb'#EbOOQO'#DS'#DSOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsO&wQPO'#DWOOQO'#DV'#DVO'VQPO,59pOOQO,5:m,5:mOOQO'#Dc'#DcO'_QPO'#DbO'gQPO'#DaO)lQPO'#D`O*{QPO'#D`OOQO'#D_'#D_O+sQPO,59oO-}QPO,59oO.UQPO,5:|O.]QPO,5:}O.hQPO'#E|O0sQPO,5;jO0zQPO,5;jO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lOYQPO,5;wO3cQPO,5;xO3hQPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Dh'#DhO3mQPO,59|O5^QPO,59|OOQO'#Di'#DiO5cQPO,59{OOQO,59{,59{O5kQPO'#DWO6YQPO'#DlO8PQPO'#DoO9sQPO'#DoOOQO'#Do'#DoOOQO'#Dv'#DvOOQO'#Dt'#DtO+kQPO'#DtO9xQPO,59zO;iQPO'#EVO;nQPO'#EWOOQO'#EZ'#EZO;sQPO'#E[O;xQPO'#E_OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0h1G0hO;}QPO'#EtO.`QPO'#EtO<XQPO1G0iO<^QPO1G0iO<cQPO,5;hO=oQPO1G1UO=vQPO1G1UO=}QPO1G1UO>UQPO'#FSO@dQPO'#FRO@nQPO'#FROYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO@xQPO1G1cOAPQPO1G1dOOQO1G/^1G/^OOQO1G/]1G/]O5cQPO1G/hOAUQPO1G/hOAZQPO'#DjOBzQPO'#DjOOQO1G/g1G/gOCbQPO,59rOCPQPO,5:cOOQO'#Dm'#DmOClQPO,5:WOEcQPO'#DrOOQO'#Dq'#DqOGVQPO,5:_OHvQPO,5:[OOQO,5:Z,5:ZOJgQPO,5:`O+kQPO,5:`O+kQPO,5:`OOQO,5:q,5:qOJuQPO'#EYOOQO'#EX'#EXOJzQPO,5:rOLkQPO'#E^OOQO'#E^'#E^OOQO'#E]'#E]ONbQPO,5:vO!!RQPO'#EaOOQO'#Ea'#EaOOQO'#E`'#E`O!#xQPO,5:yO!%iQPO'#D`O;}QPO,5;`O!%pQPO'#EuO!%uQPO,5;`O!%}QPO,5;`O!&[QPO,5;`O!&iQPO,5;`O!&nQPO7+&TO.`QPO7+&TOOQO'#E}'#E}O!(OQPO1G1SOOQO1G1S1G1SOYQPO7+&pO!(WQPO7+&pO!)hQPO7+&pO!)oQPO7+&pO!)vQQO'#FTOOQO,5;n,5;nO!,UQPO,5;mO!,]QPO,5;mO!-nQPO7+&rO!-uQPO7+&rOOQO7+&r7+&rO!.SQPO7+&rO!.ZQPO7+&rO!/`QPO7+&rO!/pQPO7+&}OOQO7+'O7+'OOOQO7+%S7+%SO!/uQPO7+%SO5cQPO,5:UO!/zQPO,5:UO!0PQPO1G/{OOQO1G/}1G/}OOQO1G0U1G0UOOQO1G0W1G0WOOQO,5:X,5:XO!0UQPO1G/yO!1uQPO,5:^O!1zQPO,5:]OOQO1G/z1G/zO!2PQPO1G/zO!3pQPO,5:tO;nQPO,5:sO;sQPO,5:wO;xQPO,5:zO!3xQPO,5;cO!%uQPO1G0zO!4WQPO1G0zO!4`QPO,5;aO+kQPO,5;cO!4eQPO1G0zO!4oQPO'#EvO!4tQPO1G0zO!4eQPO1G0zO!4|QPO1G0zO!5ZQPO1G0zO!%xQPO1G0zOOQO1G0z1G0zOOQO<<Io<<IoO!5fQPO<<IoO!5kQPO,5;iOOQO7+&n7+&nO!5pQPO<<J[OOQO<<J[<<J[OYQPO<<J[OOQO'#FV'#FVO!5wQPO,5;oOOQO'#FU'#FUOOQO,5;o,5;oOOQO1G1X1G1XO!6PQPO1G1XO!8YQPO<<JiOOQO<<Hn<<HnOOQO1G/p1G/pO!8_QPO1G/pO!8dQPO7+%gOOQO1G/x1G/xOOQO1G/w1G/wOOQO1G0`1G0`OOQO1G0_1G0_OOQO1G0c1G0cOOQO1G0f1G0fOOQO'#Ex'#ExOOQO1G0}1G0}O!8iQPO1G0}OOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO7+&f7+&fOOQO1G0{1G0{O!8nQPO1G0}O!9SQPO7+&fOOQO,5;b,5;bO!9[QPO7+&fO!%xQPO7+&fO!9fQPO7+&fO!9qQPOAN?ZOOQO1G1T1G1TO!;RQPOAN?vO!<cQPOAN?vO!<jQQO1G1ZOOQO1G1Z1G1ZOOQO7+&s7+&sO!<rQPOAN@TOOQO7+%[7+%[O!<wQPO<<IRO!<|QPO7+&iO!=RQPO<<JQO!=ZQPO<<JQO!=cQPO'#EwO!=hQPO<<JQOOQOG24uG24uOOQOG25bG25bOOQO1G1[1G1[OOQO7+&u7+&uO!=pQPOG25oOOQOAN>mAN>mO!=uQPO<<JTOOQOAN?lAN?lO!=zQPOAN?lO!>SQPOLD+ZOOQOAN?oAN?oOOQO,5:r,5:rO!>XQPO!$'NuO!>^QPO!)9DaO!>cQPO!.K9{OOQO!4//g!4//gO;nQPO'#EWO!>hQPO'#D`O!?`QPO,59oO!@fQPO'#DTOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO!AqQPO7+&rO!AxQPO7+&rO!BVQPO7+&rO!C_QPO7+&rO!CfQPO7+&rO!B^QPO'#FQ",stateData:"!Cs~O$TOStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!vQO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O{nO~O!vqO~O!OrO!QrO!WrO!XrO!YrO!ZrOfwXgwXhwX!lwX!nwX!owX!pwX!qwX!wwX!xwX#{wX#|wX#}wX$OwX~O!_vO$RwX$ZwX~P#mO$Y{O~Od|Oe|O$Y}O~Of!QOg!POh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{!SO#|!SO#}!SO$O!TO~O$Y!VO~O$Y!WO~O|!XO!O!XO!P!XO!Q!XO~O$V!YO$W!ZO~O}!]O$X!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!Y!TX!Z!TX!_!TX!l!TX!n!TX!o!TX!p!TX!q!TX!w!TX!x!TX#{!TX#|!TX#}!TX$O!TX$R!TX$Z!TX$k!TX$V!TX~O!OrO!QrO!WrO!XrO!YrO!ZrO~Of!SXg!SXh!SX!_!SX!l!SX!n!SX!o!SX!p!SX!q!SX!w!SX!x!SX#{!SX#|!SX#}!SX$O!SX$R!SX$Z!SX$k!SX$V!SX~P)WOP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_vOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Rwa$Zwa~P)WOfvXgvXhvX!OvX!lvX!nvX!ovX!pvX!qvX!wvX!xvX#{vX#|vX#}vX$OvX~O$Z!rO~P,|O$Z!sO~P,|O!v!wO$UPO$Y!uO~O$Y!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O!v!yO~P.mO$Y!{O~O[#OO]!|O^!|OX#uPY#uPi#uPj#uPk#uPl#uPm#uPn#uPo#uPp#uPq#uPr#uPs#uP!v#uP!w#uP!x#uP$U#uP$Y#uP$[#uP$]#uP$^#uP$_#uP$`#uP$a#uP$b#uP$c#uP$d#uP$e#uP$f#uP$g#uP$h#uP$i#uP$j#uP~O!v#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!Y!Ua!Z!Ua!_!Ua!l!Ua!n!Ua!o!Ua!p!Ua!q!Ua!w!Ua!x!Ua#{!Ua#|!Ua#}!Ua$O!Ua$R!Ua$Z!Ua$k!Ua$V!Ua~O$Y#[O~O}#]O$X!_O~O|#`O!O#`O!P!XO!Q!XO!l#aO!n#aO!o#aO!p#aO!q#aO~O{#dO!b#bOf!`Xg!`Xh!`X!O!`X!Q!`X!W!`X!X!`X!Y!`X!Z!`X!_!`X!l!`X!n!`X!o!`X!p!`X!q!`X!w!`X!x!`X#{!`X#|!`X#}!`X$O!`X$R!`X$Z!`X$k!`X$V!`X~O{#dOf!cXg!cXh!cX!O!cX!Q!cX!W!cX!X!cX!Y!cX!Z!cX!_!cX!l!cX!n!cX!o!cX!p!cX!q!cX!w!cX!x!cX#{!cX#|!cX#}!cX$O!cX$R!cX$Z!cX$k!cX$V!cX~O}#hO~Of#jOg#kO$V#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!Y!Sa!Z!Sa!_!Sa!l!Sa!n!Sa!o!Sa!p!Sa!q!Sa!w!Sa!x!Sa#{!Sa#|!Sa#}!Sa$O!Sa$R!Sa$Z!Sa$k!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!_#xO$k#zO~P)WO$Z$PO~O$V$QO~O{$RO$Z$TO~Of!uXg!uXh!uX!O!uX!l!uX!n!uX!o!uX!p!uX!q!uX!w!uX!x!uX#{!uX#|!uX#}!uX$O!uX$Z!uX~O$V$UO~P<kO$Z$VO~P,|O!v$WO~P.mO$Y$YO~OX#uXY#uXi#uXj#uXk#uXl#uXm#uXn#uXo#uXp#uXq#uXr#uXs#uX!v#uX!w#uX!x#uX$U#uX$Y#uX$[#uX$]#uX$^#uX$_#uX$`#uX$a#uX$b#uX$c#uX$d#uX$e#uX$f#uX$g#uX$h#uX$i#uX$j#uX~O_$[O`$[O~P>ZO]!|O^!|O~P>ZO$V$dO~P,|O$Z$eO~O}$gO~Og$hOf!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!Y!^X!Z!^X!_!^X!l!^X!n!^X!o!^X!p!^X!q!^X!w!^X!x!^X#{!^X#|!^X#}!^X$O!^X$R!^X$Z!^X$k!^X$V!^X~O$Y$iO~O!m$kO!s$lO!vQO!wRO!xRO~O}#XO$X!_O~PCPO{#dO!b$nOf!`ag!`ah!`a!O!`a!Q!`a!W!`a!X!`a!Y!`a!Z!`a!_!`a!l!`a!n!`a!o!`a!p!`a!q!`a!w!`a!x!`a#{!`a#|!`a#}!`a$O!`a$R!`a$Z!`a$k!`a$V!`a~O|$pOf!fXg!fXh!fX!O!fX!Q!fX!W!fX!X!fX!Y!fX!Z!fX!_!fX!l!fX!n!fX!o!fX!p!fX!q!fX!w!fX!x!fX#{!fX#|!fX#}!fX$O!fX$R!fX$V!fX$Z!fX$k!fX~O$V$qOf!gag!gah!ga!O!ga!Q!ga!W!ga!X!ga!Y!ga!Z!ga!_!ga!l!ga!n!ga!o!ga!p!ga!q!ga!w!ga!x!ga#{!ga#|!ga#}!ga$O!ga$R!ga$Z!ga$k!ga~O$V$qOf!dag!dah!da!O!da!Q!da!W!da!X!da!Y!da!Z!da!_!da!l!da!n!da!o!da!p!da!q!da!w!da!x!da#{!da#|!da#}!da$O!da$R!da$Z!da$k!da~Of#jOg#kO$V#jO$Z$rO~O|$tO~O$V$uOf!zag!zah!za!O!za!Q!za!W!za!X!za!Y!za!Z!za!_!za!l!za!n!za!o!za!p!za!q!za!w!za!x!za#{!za#|!za#}!za$O!za$R!za$Z!za$k!za~O|!XO!O!XO!P!XO!Q!XOf#QXg#QXh#QX!W#QX!X#QX!Y#QX!Z#QX!_#QX!l#QX!n#QX!o#QX!p#QX!q#QX!w#QX!x#QX#{#QX#|#QX#}#QX$O#QX$R#QX$V#QX$Z#QX$k#QX~O$V$vOf#Oag#Oah#Oa!O#Oa!Q#Oa!W#Oa!X#Oa!Y#Oa!Z#Oa!_#Oa!l#Oa!n#Oa!o#Oa!p#Oa!q#Oa!w#Oa!x#Oa#{#Oa#|#Oa#}#Oa$O#Oa$R#Oa$Z#Oa$k#Oa~O|!XO!O!XO!P!XO!Q!XOf#TXg#TXh#TX!W#TX!X#TX!Y#TX!Z#TX!_#TX!l#TX!n#TX!o#TX!p#TX!q#TX!w#TX!x#TX#{#TX#|#TX#}#TX$O#TX$R#TX$V#TX$Z#TX$k#TX~O$V$wOf#Rag#Rah#Ra!O#Ra!Q#Ra!W#Ra!X#Ra!Y#Ra!Z#Ra!_#Ra!l#Ra!n#Ra!o#Ra!p#Ra!q#Ra!w#Ra!x#Ra#{#Ra#|#Ra#}#Ra$O#Ra$R#Ra$Z#Ra$k#Ra~OU$xO~P*{O!m${O~O!_$|O$k#zO~OZ%OO!_#xO$Z#ha~P)WO!_#xO$Z%TO$k#zO~P)WO$Z%UO~Od|Oe|Of#Vqg#Vqh#Vq!O#Vq!l#Vq!n#Vq!o#Vq!p#Vq!q#Vq!w#Vq!x#Vq#{#Vq#|#Vq#}#Vq$O#Vq$R#Vq$Z#Vq$V#Vq~O$V%XO$Z%YO~Od|Oe|Of#rqg#rqh#rq!O#rq!l#rq!n#rq!o#rq!p#rq!q#rq!w#rq!x#rq#{#rq#|#rq#}#rq$O#rq$R#rq$Z#rq$V#rq~O$V%]O~P<kO$Z%[O~P,|O#z%^O$Z%aO~OX#uaY#uai#uaj#uak#ual#uam#uan#uao#uap#uaq#uar#uas#ua!v#ua!w#ua!x#ua$U#ua$[#ua$]#ua$^#ua$_#ua$`#ua$a#ua$b#ua$c#ua$d#ua$e#ua$f#ua$g#ua$h#ua$i#ua$j#ua~O$Y$YO~P!*OO_%cO`%cO$Y#ua~P!*OOf!QOh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{#tq#|#tq#}#tq$O#tq$R#tq$Z#tq~Og#tq~P!,jOf#tqg#tqh#tq~P!,pOg!PO~P!,jO$R#tq$Z#tq~P%lOf#tqg#tqh#tq!O#tq!l#tq!n#tq!o#tq!p#tq!q#tq#{#tq#|#tq#}#tq$O#tq~O!w!RO!x!RO$R#tq$Z#tq~P!.eO}%dO~O$Z%eO~O}%gO~O$Y%hO~O$V$qOf!gig!gih!gi!O!gi!Q!gi!W!gi!X!gi!Y!gi!Z!gi!_!gi!l!gi!n!gi!o!gi!p!gi!q!gi!w!gi!x!gi#{!gi#|!gi#}!gi$O!gi$R!gi$Z!gi$k!gi~O}%iO~O{#dO~Of#jO$V#jOg!hih!hi!O!hi!Q!hi!W!hi!X!hi!Y!hi!Z!hi!_!hi!l!hi!n!hi!o!hi!p!hi!q!hi!w!hi!x!hi#{!hi#|!hi#}!hi$O!hi$R!hi$Z!hi$k!hi~O{%kO}%kO~O{%pO$m%rO$n%sO$o%tO~OZ%OO$Z#hi~O$l%vO~O!_#xO$Z#hi~P)WO!m%yO~O!_$|O$Z#hi~O!_#xO$Z%{O$k#zO~P)WO!_$|O$Z%{O$k#zO~O$Z%}O~O{&OO~O$Z&PO~P,|O$V&RO$Z&SO~O$Y$YOX#uiY#uii#uij#uik#uil#uim#uin#uio#uip#uiq#uir#uis#ui!v#ui!w#ui!x#ui$U#ui$[#ui$]#ui$^#ui$_#ui$`#ui$a#ui$b#ui$c#ui$d#ui$e#ui$f#ui$g#ui$h#ui$i#ui$j#ui~O$V&UO~O$Z&VO~O}&WO~O$Y&XO~Of#jOg#kO$V#jO!_#ki$k#ki$Z#ki~O!_$|O$Z#hq~O!_#xO$Z#hq~P)WOZ%OO!_&[O$Z#hq~Od|Oe|Of#V!Rg#V!Rh#V!R!O#V!R!l#V!R!n#V!R!o#V!R!p#V!R!q#V!R!w#V!R!x#V!R#{#V!R#|#V!R#}#V!R$O#V!R$R#V!R$Z#V!R$V#V!R~Od|Oe|Of#r!Rg#r!Rh#r!R!O#r!R!l#r!R!n#r!R!o#r!R!p#r!R!q#r!R!w#r!R!x#r!R#{#r!R#|#r!R#}#r!R$O#r!R$R#r!R$Z#r!R$V#r!R~O$Z&_O~P,|O#z%^O$Z&aO~O}&bO~O$Z&cO~O{&dO~O!_$|O$Z#hy~OZ%OO$Z#hy~OU$xO~O!_&[O$Z#hy~O$V&gO~O$Z&hO~O!_$|O$Z#h!R~O}&jO~O$V&kO~O}&lO~O$Z&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_&oOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Vwa~P)WO!_&oO$VwX~P#mOf&yOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{#tq#|#tq#}#tq$O#tq$V#tq~Og#tq~P!@pOf#tqg#tqh#tq~P!@vOg&xO~P!@pOf&yOg&xOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{&{O#|&{O#}&{O$O&|O~O$V#tq~P!B^O!w&zO!x&zO$V#tq~P!.eO",goto:"1l$RPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$S%R%j&Y&]PPPPPP&t'W'h'v(XPPPP(h(p(yP)S)XP)S)S)[)e)S)m*O*O*XPPPPPP*XP*O*bPPP)S)S*{+R)S)S+Y+])S+c+f+l,_,t-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-p-y.^.j/S/V/V/V/Y/i,_/l,_0R0w1Y1c1fPPPPP,_,_[YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch PipePattern Npa FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:169,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"5r~RvX^#ipq#iqr$^rs$yst%kuv%vxy%{yz&Qz{&V{|&[|}&a}!O&f!O!P(t!P!Q)t!Q!R)y!R![+a![!]2a!^!_2u!_!`3S!`!a3i!c!}3v!}#O4^#P#Q4c#Q#R4h#R#S3v#S#T4m#T#o3v#o#p4y#p#q5O#q#r5m#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$T~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aR!_!`$j!`!a$o#r#s$t~$oO!O~~$tO!Z~~$yO!Q~~$|UOY$yZr$yrs%`s#O$y#O#P%e#P~$y~%eO}~~%hPO~$y~%pQt~OY%kZ~%k~%{O#}~~&QO$Y~~&VO$Z~~&[O#{~~&aO!w~~&fO$V~~&kP!x~}!O&n~&qQ#_#`&w#g#h(U~&zP#X#Y&}~'QP#X#Y'T~'WP#d#e'Z~'^P}!O'a~'dP#X#Y'g~'jP#a#b'm~'pP#d#e's~'vP#h#i'y~'|P#m#n(P~(UO!b~~(XP#h#i([~(_P#f#g(b~(eP#]#^(h~(kP#V#W(n~(qP#h#i(P~(wP!Q![(z~)PR!v~!Q![(z!g!h)Y#X#Y)Y~)]R{|)f}!O)f!Q![)l~)iP!Q![)l~)qP!v~!Q![)l~)yO#|~~*Oe!v~!O!P(z!Q![+a!g!h,t!i!j-c!m!n-c!o!p-c!r!s-c!v!w-c#U#V-W#W#X-l#X#Y/n#Z#[0Q#[#].T#_#`0Q#a#b0Z#d#e0Q#g#h/]#h#i0Q#k#l0l#l#m1u#m#n1W~+fd!v~!O!P(z!Q![+a!g!h,t!i!j-c!m!n-c!o!p-c!r!s-c!v!w-c#U#V-W#W#X-l#X#Y/n#Z#[0Q#[#].T#_#`0Q#a#b0Z#d#e0Q#g#h/]#h#i0Q#k#l0l#m#n1W~,wT{|)f}!O)f!Q![)l!d!e-W#]#^-]~-]O!s~~-`P#U#V-W~-fQ!d!e-W#]#^-]~-qP!m~!Q![-t~-wS!Q![-t#[#].T#a#b.i#g#h/]~.YP!m~!Q![.]~.`R!Q![.]#a#b.i#g#h/]~.nQ!m~!Q![.t#g#h/W~.wR!Q![.t#a#b/Q#g#h/]~/TP#g#h/W~/]O!m~~/bP!m~!Q![/e~/hQ!Q![/e#a#b/Q~/qT{|)f}!O)f!Q![)l#U#V-W#]#^-]~0TQ#U#V-W#]#^-]~0`S!m~!Q![.t#U#V-W#]#^-]#g#h/W~0qP!m~!Q![0t~0wT!Q![0t#W#X-l#[#].T#a#b.i#g#h/]~1]P!m~!Q![1`~1cU!Q![1`#W#X-l#[#].T#a#b.i#g#h/]#k#l0l~1xR!Q![2R!c!i2R#T#Z2R~2WR!v~!Q![2R!c!i2R#T#Z2RP2fT{P!Q![2a![!]2a!c!}2a#R#S2a#T#o2a~2zP!o~!_!`2}~3SO!p~~3XQ|~!_!`3_#r#s3d~3dO!q~~3iO!P~~3nP!l~!_!`3q~3vO!n~R3}T{P#zQ!Q![3v![!]2a!c!}3v#R#S3v#T#o3v~4cO$k~~4hO$l~~4mO$O~~4pRO#S4m#S#T%`#T~4m~5OO$U~~5TR!_~!_!`5^!`!a5c#r#s5h~5cO!W~~5hO!Y~~5mO!X~~5rO$W~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(vt,Wr)=>Me(vt)<<1},{term:43,get:(vt,Wr)=>b(vt)<<1|1},{term:43,get:vt=>S[vt]||-1}],tokenPrec:0}),U=1,G=2,fe=3,ae=4,Ie=5,Ue=6,tt=7,Ot=8,mt=9,qt=10,Rt=11,dr=12,Dt=13,$r=14,Qr=15,$a=16,rt=17,wt=18,Qa=19,Gr=20,Zr=21,Yr=22,Jr=23,Ra=24,wa=25,ct=26,Pt=27,Ta=28,qr=29,jt=30,ea=31,Fa=32,ta=33,Mt=34,It=35,Je=36,ra=37,Ce=38,ut=39,Ye=40,aa=41,Rr=42,na=43,Lt=44,wr=45,er=46,Wt=47,Ca=48,sa=49,Tr=50,ia=51,Fr=52,tr=53,rr=54,Nt=55,Aa=56,ar=57,oa=58,fr=59,Cr=60,Da=61,_e=62,pr=63,la=64,Tt=65,Ar=66,nt=67,yt=68,dt=69,hr=70,Ft=71,nr=72,St=73,gr=74,mr=75,Vt=76,Dr=77,ja=78,Ma=79,bt=80,Ct=81,jr=82,xt=83,vr=84,Ia=85,Na=86,Or=87,_t=88,ca=89,kt=90,Ua=91,Mr=92,ua=93,zt=94,ot=95,ft=96,lt=97,st=98,yr=99,Ht=100,Kt=101,Ut=102,Ba=103,Ir=104,sr=105,Xa=106,ir=107,da=108,Wa=109,Va=110,fa=111,pa=112,_a=113,ka=114,ha=115,ga=116,ma=117,za=118,va=119,Oa=120,ya=121,Ha=122,ba=123,Nr=124,Ka=125,Ga=126,or=127,xa=128,Ea=129,pt=130,Gt=131,Zt=132,Ur=133,Br=134,Pa=135,La=136,Za=137,Xr=138,br=139,Ya=140}}]);

//# sourceMappingURL=9430.19cb3874215c47142002.js.map