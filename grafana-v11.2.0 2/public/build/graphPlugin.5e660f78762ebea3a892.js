"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8068],{229:(Gt,q,p)=>{p.r(q),p.d(q,{GraphCtrl:()=>ve,plugin:()=>xe});var $t=p(54087),Kt=p(80851),Zt=p(32176),Qt=p(31221),Jt=p(91520),qt=p(92275),_t=p(82013),es=p(2341),Ce=p(34796),b=p.n(Ce),f=p(2543),be=p(66899),_=p.n(be),ee=p(81634);const te=(n,e,t)=>{const s=(0,ee.C)(),i=document.createElement("div");i.innerHTML='<annotation-tooltip event="event" on-edit="onEdit()"></annotation-tooltip>',s.invoke(["$compile","$rootScope",(r,o)=>{const l=t.getOptions().events.manager,a=o.$new(!0);a.event=e,a.onEdit=()=>{l.editEvent(e)},r(i)(a),a.$digest(),a.$destroy();const h=new(_())({target:n[0],content:i,position:"bottom center",classes:"drop-popover drop-popover--annotation",openOn:"hover",hoverCloseDelay:200,tetherOptions:{constraints:[{to:"window",pin:!0,attachment:"both"}]}});h.open(),h.on("close",()=>{setTimeout(()=>{h.destroy()})})}])};let X=null;const se=(n,e,t)=>{const s=t.getOptions().events.manager;if(s.editorOpen){X=n;return}s.editorOpened(),X=n,setTimeout(()=>{const i=(0,ee.C)(),r=document.createElement("div");r.innerHTML='<event-editor panel-ctrl="panelCtrl" event="event" close="close()"></event-editor>',i.invoke(["$compile","$rootScope",(o,l)=>{const a=l.$new(!0);let h;a.event=e,a.panelCtrl=s.panelCtrl,a.close=()=>{h.close()},o(r)(a),a.$digest(),h=new(_())({target:X[0],content:r,position:"bottom center",classes:"drop-popover drop-popover--form",openOn:"click",tetherOptions:{constraints:[{to:"window",pin:!0,attachment:"both"}]}}),h.open(),s.editorOpened(),h.on("close",()=>{setTimeout(()=>{s.editorClosed(),a.$destroy(),h.destroy()})})}])},100)};class ie{constructor(e,t,s,i,r,o,l,a){this._object=e,this._drawFunc=t,this._clearFunc=s,this._moveFunc=i,this._position={left:r,top:o},this._width=l,this._height=a}width(){return this._width}height(){return this._height}position(){return this._position}draw(){this._drawFunc(this._object)}clear(){this._clearFunc(this._object)}getObject(){return this._object}moveTo(e){this._position=e,this._moveFunc(this._object,this._position)}}class ne{constructor(e,t){this._options=e,this._drawableEvent=t,this._hidden=!1}visual(){return this._drawableEvent}getOptions(){return this._options}getParent(){return this._parent}isHidden(){return this._hidden}hide(){this._hidden=!0}unhide(){this._hidden=!1}}class ye{constructor(e){this._events=[],this._types=[],this._plot=e,this.eventsEnabled=!1}getEvents(){return this._events}setTypes(e){return this._types=e}setupEvents(e){const t=(0,f.partition)(e,"isRegion"),s=t[0];e=t[1],b().each(e,(i,r)=>{const o=new ne(r,this._buildDiv(r));this._events.push(o)}),b().each(s,(i,r)=>{const o=new ne(r,this._buildRegDiv(r));this._events.push(o)}),this._events.sort((i,r)=>{const o=i.getOptions(),l=r.getOptions();return o.min>l.min?1:o.min<l.min?-1:0})}drawEvents(){b().each(this._events,(e,t)=>{const s=t.getOptions(),i=this._insidePlot(s.min)||this._insidePlot(s.timeEnd),r=this._overlapPlot(s.min,s.timeEnd);(i||r)&&!t.isHidden()?t.visual().draw():t.visual().getObject().hide()})}updateEvents(){const e=this._plot.getPlotOffset();let t,s;const i=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];b().each(this._events,(r,o)=>{s=e.top+this._plot.height()-o.visual().height(),t=i.p2c(o.getOptions().min)+e.left-o.visual().width()/2,o.visual().moveTo({top:s,left:t})})}_clearEvents(){b().each(this._events,(e,t)=>{t.visual().clear()}),this._events=[]}_buildDiv(e){const t=this,s=this._plot.getPlaceholder(),i=this._plot.getPlotOffset(),r=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];let o,l,a,h,d,c,u,g;const m=e.eventType;this._types===null||!this._types[m]||!this._types[m].color?a="#666":a=this._types[m].color,this._types===null||!this._types[m]||!this._types[m].markerSize?h=8:h=this._types[m].markerSize,this._types===null||!this._types[m]||this._types[m].markerShow===void 0?d=!0:d=this._types[m].markerShow,this._types===null||!this._types[m]||this._types[m].markerTooltip===void 0?g=!0:g=this._types[m].markerTooltip,this._types==null||!this._types[m]||!this._types[m].lineStyle?c="dashed":c=this._types[m].lineStyle.toLowerCase(),this._types==null||!this._types[m]||this._types[m].lineWidth===void 0?u=1:u=this._types[m].lineWidth;let x=r.options.eventSectionHeight||0;x=x/3,o=i.top+this._plot.height()+x,l=r.p2c(e.min)+i.left;const S=b()('<div class="events_line flot-temp-elem"></div>').css({position:"absolute",opacity:.8,left:l+"px",top:8,width:u+"px",height:this._plot.height()+x*.8,"border-left-width":u+"px","border-left-style":c,"border-left-color":a,color:a}).appendTo(s);if(d){const v=b()('<div class="events_marker"></div>').css({position:"absolute",left:-h-Math.round(u/2)+"px","font-size":0,"line-height":0,width:0,height:0,"border-left":h+"px solid transparent","border-right":h+"px solid transparent"});v.appendTo(S),this._types[m]&&this._types[m].position&&this._types[m].position.toUpperCase()==="BOTTOM"?v.css({top:o-h-8+"px","border-top":"none","border-bottom":h+"px solid "+a}):v.css({top:"0px","border-top":h+"px solid "+a,"border-bottom":"none"}),v.data({event:e});const y=function(){te(v,b()(this).data("event"),t._plot)};e.editModel&&se(v,e.editModel,t._plot);const T=()=>{t._plot.clearSelection()};g&&(v.css({cursor:"help"}),v.hover(y,T))}return new ie(S,function(y){y.show()},v=>{v.remove()},(v,y)=>{v.css({top:y.top,left:y.left})},l,o,S.width()??1,S.height()??1)}_buildRegDiv(e){const t=this,s=this._plot.getPlaceholder(),i=this._plot.getPlotOffset(),r=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];let o,l,a,h,d,c,u;const g=e.eventType;this._types===null||!this._types[g]||!this._types[g].color?c="#666":c=this._types[g].color,this._types===null||!this._types[g]||this._types[g].markerTooltip===void 0?u=!0:u=this._types[g].markerTooltip,this._types==null||!this._types[g]||this._types[g].lineWidth===void 0?a=1:a=this._types[g].lineWidth,this._types==null||!this._types[g]||!this._types[g].lineStyle?d="dashed":d=this._types[g].lineStyle.toLowerCase();const m=2;o=i.top+this._plot.height()+m;const x=Math.min(e.min,e.timeEnd),S=Math.max(e.min,e.timeEnd);l=r.p2c(x)+i.left;const M=r.p2c(S)+i.left,[v,y]=[i.left,i.left+this._plot.width()],T=Math.max(l,v),L=Math.min(M,y),N=M>y?0:a;h=L-T+N,(0,f.each)([l,M],k=>{v<=k&&k<y&&b()('<div class="events_line flot-temp-elem"></div>').css({position:"absolute",opacity:.8,left:k+"px",top:8,width:a+"px",height:this._plot.height()+m,"border-left-width":a+"px","border-left-style":d,"border-left-color":c,color:c}).appendTo(s)});const O=b()('<div class="events_marker region_marker flot-temp-elem"></div>').css({position:"absolute",opacity:.5,left:T+"px",top:o,width:h+"px",height:"0.5rem","border-left-color":c,color:c,"background-color":c});O.appendTo(s),O.data({event:e});const j=function(){te(O,b()(this).data("event"),t._plot)};e.editModel&&se(O,e.editModel,t._plot);const E=()=>{t._plot.clearSelection()};return u&&(O.css({cursor:"help"}),O.hover(j,E)),new ie(O,function(H){H.show()},k=>{k.remove()},(k,H)=>{k.css({top:H.top,left:H.left})},l,o,O.width()??1,O.height()??1)}_insidePlot(e){const t=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1],s=t.p2c(e);return s>0&&s<t.p2c(t.max)}_overlapPlot(e,t){const s=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1],[i,r]=[s.p2c(e),s.p2c(t)],[o,l]=[0,s.p2c(s.max)];return o<i&&r<l}}function Te(n){const e=this,t=new ye(n);n.getEvents=()=>t._events,n.hideEvents=()=>{b().each(t._events,(s,i)=>{i.visual().getObject().hide()})},n.showEvents=()=>{n.hideEvents(),b().each(t._events,(s,i)=>{i.hide()}),e.eventMarkers.drawEvents()},n.setEvents=s=>{t.eventsEnabled&&t.setupEvents(s)},n.hooks.processOptions.push((s,i)=>{i.events.data!=null&&(t.eventsEnabled=!0)}),n.hooks.draw.push(s=>{const i=s.getOptions();t.eventsEnabled&&(t.getEvents().length<1?(t.setTypes(i.events.types),t.setupEvents(i.events.data)):t.updateEvents()),t.drawEvents()})}const Se={events:{data:null,types:null,xaxis:1,position:"BOTTOM"}};b().plot.plugins.push({init:Te,options:Se,name:"events",version:"0.2.5"});var I=p(96540),Me=p(5338),w=p(26272),Y=p(69129),z=p(47232),Oe=p(56323),Ee=p(57875),G=p(11261),Ae=p(78368),$=p(14236),ke=p(39306),oe=p(83195),V=p(67982),A=p(2913),K=p(10096),we=p(96378),Z=p(92247),Le=p(32349),C=p(74848),De=p(14578),Pe=p(40276),Ie=p(46942),Fe=p.n(Ie),re=p(13544),Ne=p(83598),je=p(94536);const ae=["min","max","avg","current","total"];class le extends I.PureComponent{constructor(e){super(e),this.onLabelClick=t=>this.props.onLabelClick(this.props.series,t),this.onToggleAxis=()=>{const t=this.state.yaxis===2?1:2,s={alias:this.props.series.alias,yaxis:t};this.setState({yaxis:t}),this.props.onToggleAxis(s)},this.onColorChange=t=>{this.props.onColorChange(this.props.series,t),this.forceUpdate()},this.state={yaxis:this.props.series.yaxis}}static{this.defaultProps={asTable:!1,hidden:!1,onLabelClick:()=>{},onColorChange:()=>{},onToggleAxis:()=>{}}}renderLegendValues(){const{series:e,asTable:t}=this.props,s=[];for(const i of ae)if(this.props[i]){const r=e.formatValue(e.stats[i]);s.push((0,C.jsx)(ze,{valueName:i,value:r,asTable:t,onValueClick:this.onLabelClick},i))}return s}render(){const{series:e,values:t,asTable:s,hidden:i}=this.props,r=Fe()({"graph-legend-series-hidden":i,"graph-legend-series--right-y":e.yaxis===2}),o=t?this.renderLegendValues():[],l=(0,C.jsx)(Re,{label:e.alias,color:e.color,yaxis:this.state.yaxis,onLabelClick:this.onLabelClick,onColorChange:this.onColorChange,onToggleAxis:this.onToggleAxis});return s?(0,C.jsxs)("tr",{className:`graph-legend-series ${r}`,children:[(0,C.jsx)("td",{role:"gridcell",children:(0,C.jsx)("div",{className:"graph-legend-series__table-name",children:l})}),o]}):(0,C.jsxs)("div",{className:`graph-legend-series ${r}`,children:[l,o]})}}class Re extends I.PureComponent{static{this.defaultProps={yaxis:void 0,onLabelClick:()=>{}}}render(){const{label:e,color:t,yaxis:s}=this.props,{onColorChange:i,onToggleAxis:r}=this.props,o=this.props.onLabelClick?this.props.onLabelClick:()=>{};return[(0,C.jsx)(He,{color:t,yaxis:s,onColorChange:i,onToggleAxis:r},"icon"),(0,C.jsx)("button",{type:"button",className:"graph-legend-alias pointer",title:e,onClick:o,"aria-label":re.Tp.components.Panels.Visualization.Graph.Legend.legendItemAlias(e),children:e},"label")]}}class He extends I.PureComponent{constructor(){super(...arguments),this.onColorChange=e=>{const{onColorChange:t}=this.props;t&&t(e)}}static{this.defaultProps={yaxis:void 0,onColorChange:()=>{},onToggleAxis:()=>{}}}render(){return(0,C.jsx)(Ne.Dp,{yaxis:this.props.yaxis,color:this.props.color,onChange:this.onColorChange,onToggleAxis:this.props.onToggleAxis,enableNamedColors:!0,children:({ref:e,showColorPicker:t,hideColorPicker:s})=>(0,C.jsx)(je.p,{color:this.props.color,ref:e,onClick:t,onMouseLeave:s,className:"graph-legend-icon"})})}}function ze({value:n,valueName:e,asTable:t,onValueClick:s}){return t?(0,C.jsx)("td",{role:"gridcell",className:`graph-legend-value ${e}`,children:n}):(0,C.jsx)("div",{className:`graph-legend-value ${e}`,children:n})}class Ve extends I.PureComponent{constructor(e){super(e),this.onToggleSeries=(t,s)=>{if(!this.props.onToggleSeries)return;let i={...this.state.hiddenSeries};s.ctrlKey||s.metaKey||s.shiftKey?i[t.alias]?delete i[t.alias]:i[t.alias]=!0:i=this.toggleSeriesExclusiveMode(t),this.setState({hiddenSeries:i}),this.props.onToggleSeries(i)},this.state={hiddenSeries:this.props.hiddenSeries}}static{this.defaultProps={values:!1,min:!1,max:!1,avg:!1,current:!1,total:!1,alignAsTable:!1,rightSide:!1,sort:void 0,sortDesc:!1,optionalClass:"",onToggleSeries:()=>{},onToggleSort:()=>{},onToggleAxis:()=>{},onColorChange:()=>{}}}sortLegend(){let e=[...this.props.seriesList];const t=this.props.sort;return t&&this.props[t]&&this.props.alignAsTable&&(e=(0,f.sortBy)(e,s=>{let i=s.stats[t];return i===null&&(i=-1/0),i}),this.props.sortDesc&&(e=e.reverse())),e}toggleSeriesExclusiveMode(e){const t={...this.state.hiddenSeries};return t[e.alias]&&delete t[e.alias],this.props.seriesList.every(i=>i.alias===e.alias?!0:t[i.alias])?this.props.seriesList.forEach(i=>{delete t[i.alias]}):this.props.seriesList.forEach(i=>{i.alias!==e.alias&&(t[i.alias]=!0)}),t}render(){const{optionalClass:e,rightSide:t,sideWidth:s,sort:i,sortDesc:r,hideEmpty:o,hideZero:l,values:a,min:h,max:d,avg:c,current:u,total:g,renderCallback:m}=this.props,x={values:a,min:h,max:d,avg:c,current:u,total:g},S=this.state.hiddenSeries,M={hideEmpty:o,hideZero:l},v={sort:i,sortDesc:r},y=this.sortLegend().filter(E=>!E.hideFromLegend(M)),T=`${this.props.alignAsTable?"graph-legend-table":""} ${e}`,L=t&&s?s:void 0,N=t&&s?s-1:void 0,O={minWidth:L,width:N},j={seriesList:y,hiddenSeries:S,onToggleSeries:this.onToggleSeries,onToggleAxis:this.props.onToggleAxis,onToggleSort:this.props.onToggleSort,onColorChange:this.props.onColorChange,...x,...v};return(0,C.jsx)("div",{className:`graph-legend-content ${T}`,ref:m,style:O,children:this.props.alignAsTable?(0,C.jsx)(We,{...j}):(0,C.jsx)(Be,{...j})})}}class Be extends I.PureComponent{render(){const{seriesList:e,hiddenSeries:t,values:s,min:i,max:r,avg:o,current:l,total:a}=this.props,h={values:s,min:i,max:r,avg:o,current:l,total:a};return e.map((d,c)=>(0,C.jsx)(le,{series:d,hidden:t[d.alias],...h,onLabelClick:this.props.onToggleSeries,onColorChange:this.props.onColorChange,onToggleAxis:this.props.onToggleAxis},`${d.id}-${c}`))}}class We extends I.PureComponent{constructor(){super(...arguments),this.onToggleSort=e=>{if(!this.props.onToggleSort)return;let t=this.props.sortDesc,s=this.props.sort;e!==s&&(t=void 0),t===!1?(s=void 0,t=void 0):(t=!t,s=e),this.props.onToggleSort(s,t)}}render(){const e=this.props.seriesList,{values:t,min:s,max:i,avg:r,current:o,total:l,sort:a,sortDesc:h,hiddenSeries:d}=this.props,c={values:t,min:s,max:i,avg:r,current:o,total:l};return e?(0,C.jsxs)("table",{role:"grid",children:[(0,C.jsx)("colgroup",{children:(0,C.jsx)("col",{style:{width:"100%"}})}),(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{style:{textAlign:"left"}}),ae.map(u=>c[u]&&(0,C.jsx)(Ue,{statName:u,sort:a,sortDesc:h,onClick:this.onToggleSort},u))]})}),(0,C.jsx)("tbody",{children:e&&e.map((u,g)=>(0,C.jsx)(le,{asTable:!0,series:u,hidden:d[u.alias],onLabelClick:this.props.onToggleSeries,onColorChange:this.props.onColorChange,onToggleAxis:this.props.onToggleAxis,...c},`${u.id}-${g}`))})]}):null}}class Ue extends I.PureComponent{constructor(){super(...arguments),this.onClick=()=>{this.props.onClick&&this.props.onClick(this.props.statName)}}render(){const{statName:e,sort:t,sortDesc:s}=this.props;return(0,C.jsxs)("th",{className:"pointer",onClick:this.onClick,children:[e,t===e&&(0,C.jsx)(De.I,{name:s?"angle-down":"angle-up"})]})}}class Xe extends I.PureComponent{render(){return(0,C.jsx)(Pe.E,{hideHorizontalTrack:!0,children:(0,C.jsx)(Ve,{...this.props})})}}const ts=null;function Ye(n,e){if(isNaN(e)||!Ze(n))return;const[t,s]=n;$e(t,s,e),Ge(t,s);const i=t.min===0||s.min===0||t.max===0||s.max===0,r=de(t,s);if(i&&r)t.min=t.max>0?0:t.min,t.max=t.max>0?t.max:0,s.min=s.max>0?0:s.min,s.max=s.max>0?s.max:0;else if(Qe(t,s))t.min>=0?(t.min=-t.max,s.max=-s.min):(t.max=-t.min,s.min=-s.max);else{const o=Je(t,s);r?t.min>0?(t.min=t.max/o,s.min=s.max/o):(t.max=t.min/o,s.max=s.min/o):ce(t,s)?(t.min=s.min?s.min*o:t.min,s.min=t.min?t.min/o:s.min,t.max=s.max?s.max*o:t.max,s.max=t.max?t.max/o:s.max):(t.min=t.min>0?s.min*o:t.min,s.min=s.min>0?t.min/o:s.min,t.max=t.max<0?s.max*o:t.max,s.max=s.max<0?t.max/o:s.max)}Ke(t,s,e)}function Ge(n,e){n.max===n.min&&(n.min-=.25,n.max+=.25),e.max===e.min&&(e.min-=.25,e.max+=.25)}function $e(n,e,t){t!==0&&(n.min-=t,n.max-=t,e.min-=t,e.max-=t)}function Ke(n,e,t){t!==0&&(n.min+=t,n.max+=t,e.min+=t,e.max+=t)}function Ze(n){return n.length===2&&he(n[0])&&he(n[1])}function he(n){return"min"in n&&"max"in n}function de(n,e){return n.min>=0&&e.min>=0||n.max<=0&&e.max<=0}function ce(n,e){return n.min<=0&&n.max>=0&&e.min<=0&&e.max>=0}function Qe(n,e){return n.min>=0&&e.max<=0||n.max<=0&&e.min>=0}function Je(n,e){if(ce(n,e)){const t=e.min?n.min/e.min:0,s=e.max?n.max/e.max:0;return t>s?t:s}if(de(n,e)){const t=Math.abs(n.min),s=Math.abs(n.max),i=Math.abs(e.min),r=Math.abs(e.max),o=Math.max(t,s),l=Math.min(t,s),a=Math.max(i,r),h=Math.min(i,r),d=l!==0?o/l:o,c=h!==0?a/h:a;return d>c?d:c}return n.min>0||e.min>0?n.max/e.max:n.min/e.min}var Q=p(84140),F=p(24284);class qe{constructor(e){this.panelCtrl=e,this.event=null,this.editorOpen=!1}editorClosed(){this.event=null,this.editorOpen=!1,this.panelCtrl.render()}editorOpened(){this.editorOpen=!0}updateTime(e){this.event||(this.event={},this.event.dashboardUID=this.panelCtrl.dashboard.uid,this.event.panelId=this.panelCtrl.panel.id),this.event.time=e.from,this.event.isRegion=!1,e.to&&(this.event.timeEnd=e.to,this.event.isRegion=!0),this.panelCtrl.render()}editEvent(e,t){this.event=e,this.panelCtrl.render()}addFlotEvents(e,t){if(!this.event&&e.length===0)return;const s={$__alerting:{color:F.xj,position:"BOTTOM",markerSize:5},$__ok:{color:F.Xw,position:"BOTTOM",markerSize:5},$__no_data:{color:F.nO,position:"BOTTOM",markerSize:5},$__pending:{color:F.ct,position:"BOTTOM",markerSize:5},$__editing:{color:F.Mk,position:"BOTTOM",markerSize:5}};if(this.event)this.event.isRegion?e=[{isRegion:!0,min:this.event.time,timeEnd:this.event.timeEnd,text:this.event.text,eventType:"$__editing",editModel:this.event}]:e=[{min:this.event.time,text:this.event.text,editModel:this.event,eventType:"$__editing"}];else for(let l=0;l<e.length;l++){const a=e[l];if(a.min=a.time,a.max=a.time,a.eventType=a.type,a.newState){a.eventType="$__"+a.newState;continue}s[a.type]||(s[a.type]={color:a.color,position:"BOTTOM",markerSize:5})}const i=_e(e);et(i,t);const r=20,o=7;t.grid.eventSectionHeight=o,t.xaxis.eventSectionHeight=r,t.events={levels:(0,f.keys)(s).length+1,data:e,types:s,manager:this}}}function _e(n){return(0,f.filter)(n,"isRegion")}function et(n,e){const t=e.grid.markings,s=F.Mk;let i;(0,f.each)(n,r=>{r.source?i=r.color||s:i=s,i=tt(i,F.UJ),t.push({xaxis:{from:r.min,to:r.timeEnd},color:i})})}function tt(n,e){const t=(0,Q.A)(n);return t.isValid()?(t.setAlpha(e),t.toRgbString()):n}var D=p(42994),B=p(80997),pe=p(31678);function st(n,e,t,s){const i=this,o=t.ctrl.panel,l=new w.kb({pos:{},point:{},panel:this.panel}),a=b()('<div class="graph-tooltip">');this.destroy=()=>{a.remove()},this.findHoverIndexFromDataPoints=(h,d,c)=>{const u=d.datapoints.pointsize,g=c*u,m=d.datapoints.points.length;let x;for(x=g;x<m;x+=u)if(!d.lines.steps&&d.datapoints.points[g]!=null&&d.datapoints.points[x]==null||d.datapoints.points[x]>h)return Math.max(x-u,0)/u;return x/u-1},this.findHoverIndexFromData=(h,d)=>{let c=0,u=d.data.length-1,g;for(;;){if(c>u)return Math.max(u,0);if(g=Math.floor((c+u)/2),d.data[g][0]===h)return g;d.data[g][0]<h?c=g+1:u=g-1}},this.renderAndShow=(h,d,c,u)=>{u==="time"&&(d='<div class="graph-tooltip-time">'+h+"</div>"+d),a.html(d).place_tt(c.pageX,c.pageY,{offset:10})},this.getMultiSeriesPlotHoverInfo=function(h,d){let c,u,g,m,x,S,M,v=[[],[],[]],y=0,T,L;for(u=0;u<h.length;u++){if(g=h[u],!g.data.length||o.legend.hideEmpty&&g.allIsNull){v[0].push({hidden:!0,value:0});continue}if(!g.data.length||o.legend.hideZero&&g.allIsZero){v[0].push({hidden:!0,value:0});continue}if(g.hideTooltip){v[0].push({hidden:!0,value:0});continue}m=this.findHoverIndexFromData(d.x,g),x=d.x-g.data[m][0],S=g.data[m][0],(!T||x>=0&&(x<T||T<0)||x<0&&x>T)&&(T=x,L=S),c=g.data[m][1],g.stack&&c!==null&&o.tooltip.value_type!=="individual"&&(y+=c,c=y),(g.lines.steps||g.stack)&&(m=this.findHoverIndexFromDataPoints(d.x,g,m)),M=0,g.yaxis&&(M=g.yaxis.n),v[M].push({value:c,hoverIndex:m,color:g.color,label:g.aliasEscaped,time:S,distance:x,index:u})}return v=v[0].concat(v[1],v[2]),v.time=L,v},n.mouseleave(()=>{if(o.tooltip?.shared){const h=n.data().plot;h&&(a.detach(),h.unhighlight())}e.events.publish(new w.Tq),e.events.publish(new Y.ql)}),n.bind("plothover",(h,d,c)=>{i.show(d,c),e.panelInEdit||(d.panelRelY=(d.pageY-n.offset().top)/n.height(),l.payload.pos=d,l.payload.panel=o,l.payload.point.time=d.x,e.events.publish(l))}),n.bind("plotclick",(h,d,c)=>{K.lE.emit(pe.CoreEvents.Yn,{pos:d,panel:o,item:c})}),n.bind("plotleave",()=>{if(!o.tooltip.shared)return;const h=n.data().plot;h&&(a.detach(),h.unhighlight())}),this.clear=h=>{a.detach(),h.clearCrosshair(),h.unhighlight()},this.show=(h,d)=>{const c=n.data().plot,u=c.getData(),m=c.getXAxes()[0].options.mode,x=s();let S=o.tooltip.shared,M,v,y,T,L,N,O,j;if(h.panelRelY){const E=c.pointOffset({x:h.x});if(Number.isNaN(E.left)||E.left<0||E.left>n.width()){i.clear(c);return}h.pageX=n.offset().left+E.left,h.pageY=n.offset().top+n.height()*h.panelRelY;const P=b()(window).scrollTop()??0;if(!(h.pageY>=P&&h.pageY<=b()(window).innerHeight()+P)){i.clear(c);return}if(c.setCrosshair(h),S=!0,e.sharedCrosshairModeOnly())return}if(x.length!==0)if(x[0].hasMsResolution?j=D.WC.fullDateMS:j=D.WC.fullDate,S){c.unhighlight();const E=i.getMultiSeriesPlotHoverInfo(u,h);for(O="",y=e.formatDate(E.time,j),o.tooltip.sort===2?E.sort((P,k)=>k.value-P.value):o.tooltip.sort===1&&E.sort((P,k)=>P.value-k.value),L=0;L<E.length;L++){if(T=E[L],T.hidden)continue;let P="";d&&T.index===d.seriesIndex&&(P="graph-tooltip-list-item--highlight"),N=x[T.index],v=B.sQ.sanitize(N.formatValue(T.value));const k=B.sQ.sanitize(T.color),H=B.sQ.sanitize(T.label);O+='<div class="graph-tooltip-list-item '+P+'"><div class="graph-tooltip-series-name">',O+='<i class="fa fa-minus" style="color:'+k+';"></i> '+H+":</div>",O+='<div class="graph-tooltip-value">'+v+"</div></div>",c.highlight(T.index,T.hoverIndex)}i.renderAndShow(y,O,h,m)}else if(d){const E=B.sQ.sanitize(d.series.color);N=x[d.seriesIndex],M='<div class="graph-tooltip-list-item"><div class="graph-tooltip-series-name">',M+='<i class="fa fa-minus" style="color:'+E+';"></i> '+N.aliasEscaped+":</div>",o.stack&&o.tooltip.value_type==="individual"?v=d.datapoint[1]-d.datapoint[2]:v=d.datapoint[1],v=B.sQ.sanitize(N.formatValue(v)),y=e.formatDate(d.datapoint[0],j),M+='<div class="graph-tooltip-value">'+v+"</div>",i.renderAndShow(y,M,h,m)}else a.detach()}}var it=p(21313);function nt(n){const t=[];for(let s=0;s<n.length;s++){const r=n[s].datapoints;for(let o=0;o<r.length;o++)r[o][0]!==null&&t.push(r[o][0])}return t}function ot(n,e,t,s){const i=ue(t,e),r=ue(s,e);return(0,it.histogram)().domain([i,r]).thresholds(Math.round(s-t)/e)(n).map(l=>[l.x0,l.length])}function rt(n,e,t,s,i){return n.map(r=>{const o=nt([r]);if(r.histogram=!0,t[r.alias])r.data=[];else{const l=ot(o,e,s,i);r.data=l}return r})}function ue(n,e){return Math.floor(n/e)*e}class at{constructor(e){this.panelCtrl=e,this.needsCleanup=!1}getHandleHtml(e,t,s){let i=t.colorMode;return t.colorMode==="custom"&&(i="critical"),`
    <div class="alert-handle-wrapper alert-handle-wrapper--T${e}">
      <div class="alert-handle-line alert-handle-line--${i}">
      </div>
      <div class="alert-handle" data-handle-index="${e}">
        <i class="icon-gf icon-gf-${i} alert-state-${i}"></i>
        <span class="alert-handle-value">${s}<i class="alert-handle-grip"></i></span>
      </div>
    </div>`}initDragging(e){const t=b()(e.currentTarget).parents(".alert-handle-wrapper"),s=b()(e.currentTarget).data("handleIndex");let i=null,r;const o=this.plot,l=this.panelCtrl,a=this.thresholds[s];function h(c){if(i===null)i=c.clientY;else{const u=c.clientY-i;r=r+u,i=c.clientY,t.css({top:r+u})}}function d(){let c=o.c2p({left:0,top:r}).y;c=parseInt(c.toFixed(0),10),a.value=c,t.off("mousemove",h),document.removeEventListener("mouseup",d),l.$scope.$apply(()=>{l.render(),l.events.emit(pe.CoreEvents.u4,{threshold:a,handleIndex:s})})}i=null,r=t.position().top,t.on("mousemove",h),document.addEventListener("mouseup",d)}cleanUp(){this.placeholder.find(".alert-handle-wrapper").remove(),this.needsCleanup=!1}renderHandle(e,t){const s=this.thresholds[e];if(!s.visible&&this.panelCtrl.alert)return;const i=s.value;let r=i,o=0;if(!(0,f.isNumber)(i))r="",o=t;else{const a=this.plot.p2c({x:0,y:i});o=Math.round(Math.min(Math.max(a.top,0),this.height)-6)}const l=b()(this.getHandleHtml(e,s,r));this.placeholder.append(l),l.toggleClass("alert-handle-wrapper--no-value",r===""),l.css({top:o})}shouldDrawHandles(){return!this.hasSecondYAxis&&this.panelCtrl.editingThresholds&&this.panelCtrl.panel.thresholds.length>0}prepare(e,t){this.hasSecondYAxis=!1;for(let s=0;s<t.length;s++)if(t[s].yaxis>1){this.hasSecondYAxis=!0;break}if(this.shouldDrawHandles()){const s=this.panelCtrl.panel.thresholds.length>1?"220px":"110px";e.css("margin-right",s)}else this.needsCleanup&&e.css("margin-right","0")}draw(e){this.thresholds=this.panelCtrl.panel.thresholds,this.plot=e,this.placeholder=e.getPlaceholder(),this.needsCleanup&&this.cleanUp(),this.shouldDrawHandles()&&(this.height=e.height(),this.thresholds.length>0&&this.renderHandle(0,10),this.thresholds.length>1&&this.renderHandle(1,this.height-30),this.placeholder.off("mousedown",".alert-handle"),this.placeholder.on("mousedown",".alert-handle",this.initDragging.bind(this)),this.needsCleanup=!0)}addFlotOptions(e,t){if(!t.thresholds||t.thresholds.length===0)return;let s=1/0,i=-1/0,r,o,l;for(r=0;r<t.thresholds.length;r++){if(o=t.thresholds[r],!(0,f.isNumber)(o.value))continue;let a;switch(o.op){case"gt":{a=s,t.thresholds.length>r+1&&(l=t.thresholds[r+1],l.value>o.value&&(a=l.value,i=a));break}case"lt":{a=i,t.thresholds.length>r+1&&(l=t.thresholds[r+1],l.value<o.value&&(a=l.value,s=a));break}}let h,d;switch(o.colorMode){case"critical":{h="rgba(234, 112, 112, 0.12)",d="rgba(237, 46, 24, 0.60)";break}case"warning":{h="rgba(235, 138, 14, 0.12)",d="rgba(247, 149, 32, 0.60)";break}case"ok":{h="rgba(11, 237, 50, 0.090)",d="rgba(6,163,69, 0.60)";break}case"custom":{h=o.fillColor,d=o.lineColor;break}}o.fill&&(o.yaxis==="right"&&this.hasSecondYAxis?e.grid.markings.push({y2axis:{from:o.value,to:a},color:A.config.theme2.visualization.getColorByName(h)}):e.grid.markings.push({yaxis:{from:o.value,to:a},color:A.config.theme2.visualization.getColorByName(h)})),o.line&&(o.yaxis==="right"&&this.hasSecondYAxis?e.grid.markings.push({y2axis:{from:o.value,to:o.value},color:A.config.theme2.visualization.getColorByName(d)}):e.grid.markings.push({yaxis:{from:o.value,to:o.value},color:A.config.theme2.visualization.getColorByName(d)}))}}}var lt=p(94515);const U={gray:{themeDependent:!0,title:"Gray",darkColor:{fill:"rgba(255, 255, 255, 0.09)",line:"rgba(255, 255, 255, 0.2)"},lightColor:{fill:"rgba(0, 0, 0, 0.09)",line:"rgba(0, 0, 0, 0.2)"}},red:{title:"Red",color:{fill:"rgba(234, 112, 112, 0.12)",line:"rgba(237, 46, 24, 0.60)"}},green:{title:"Green",color:{fill:"rgba(11, 237, 50, 0.090)",line:"rgba(6,163,69, 0.60)"}},blue:{title:"Blue",color:{fill:"rgba(11, 125, 238, 0.12)",line:"rgba(11, 125, 238, 0.60)"}},yellow:{title:"Yellow",color:{fill:"rgba(235, 138, 14, 0.12)",line:"rgba(247, 149, 32, 0.60)"}},custom:{title:"Custom"}};function ht(){return(0,f.map)(Object.keys(U),n=>({key:n,value:U[n].title}))}function dt(n,e){if(Object.keys(U).indexOf(n.colorMode)===-1&&(n.colorMode="red"),n.colorMode==="custom")return{fill:n.fill&&n.fillColor?e.visualization.getColorByName(n.fillColor):null,line:n.line&&n.lineColor?e.visualization.getColorByName(n.lineColor):null};const t=U[n.colorMode];return t.themeDependent===!0?e.isLight?t.lightColor:t.darkColor:{fill:n.fill?e.visualization.getColorByName(t.color.fill):null,line:n.fill?e.visualization.getColorByName(t.color.line):null}}class ct{constructor(e){this.panelCtrl=e}draw(e){this.timeRegions=this.panelCtrl.panel.timeRegions,this.plot=e}addFlotOptions(e,t){if(!t.timeRegions?.length)return;const s={from:(0,z.KQ)(this.panelCtrl.range.from).utc(),to:(0,z.KQ)(this.panelCtrl.range.to).utc(),raw:{from:"",to:""}};for(const i of t.timeRegions){const r=i,o=(0,lt.iU)(i,s);if(o.length){const l=dt(r,A.config.theme2);for(let a=0;a<o.length;a++){const h=o[a];r.fill&&e.grid.markings.push({xaxis:{from:h.from,to:h.to},color:l.fill}),r.line&&(e.grid.markings.push({xaxis:{from:h.from,to:h.from},color:l.line}),e.grid.markings.push({xaxis:{from:h.to,to:h.to},color:l.line}))}}}}}var W=p(75059),pt=p(72724);function ut(n){const e={from:Number.MAX_SAFE_INTEGER,to:Number.MIN_SAFE_INTEGER};let t=!1;const s=[W.gy.min,W.gy.max];for(const i of n)for(const r of i.fields)if(r.type===G.PU.time){const o=(0,W.Nw)({field:r,reducers:s});e.from=Math.min(e.from,o[W.gy.min]),e.to=Math.max(e.to,o[W.gy.max]),t=!0}return t?e:void 0}function gt(n){return!!(n&&typeof n=="object"&&n.hasOwnProperty("pos"))}const mt=(n,e)=>(0,pt.LE)(n,{format:e?.options?.timeformat,timeZone:e?.options?.timezone}),ft=(n,e,t)=>{if(e&&t&&n){const s=t-e,i=s/n/1e3,r=86400010,o=31536e6;return i<=10?D.WC.interval.millisecond:i<=45?D.WC.interval.second:s<=r?D.WC.interval.minute:i<=8e4?D.WC.interval.hour:s<=o?D.WC.interval.day:i<=31536e3?D.WC.interval.month:D.WC.interval.year}return D.WC.interval.minute},vt=(0,we.e)(Xe,A.Ay.theme2);class xt{constructor(e,t,s){this.scope=e,this.elem=t,this.timeSrv=s,this.data=[],this.getContextMenuItemsSupplier=(i,r)=>()=>{const o=this.dashboard.canAddAnnotations()?[{items:[{label:"Add annotation",ariaLabel:"Add annotation",icon:"comment-alt",onClick:()=>this.eventManager.updateTime({from:i.x,to:null})}]}]:[];if(!r)return o;const l=[{items:r.getLinks(this.panel.replaceVariables).map(a=>({label:a.title,ariaLabel:a.title,url:a.href,target:a.target,icon:a.target==="_self"?"link":"external-link-alt",onClick:a.onClick}))}];return[...o,...l]},this.ctrl=e.ctrl,this.contextMenu=e.ctrl.contextMenuCtrl,this.dashboard=this.ctrl.dashboard,this.panel=this.ctrl.panel,this.annotations=[],this.panelWidth=0,this.eventManager=new qe(this.ctrl),this.thresholdManager=new at(this.ctrl),this.timeRegionManager=new ct(this.ctrl),this.tooltip=new st(this.elem,this.ctrl.dashboard,this.scope,()=>this.sortedSeries),this.ctrl.events.on(w.ee.panelTeardown,this.onPanelTeardown.bind(this)),this.ctrl.events.on(w.ee.render,this.onRender.bind(this)),this.ctrl.dashboard.events.on(w.kb.type,this.onGraphHover.bind(this),this.scope),this.ctrl.dashboard.events.on(w.Tq.type,this.onGraphHoverClear.bind(this),this.scope),this.ctrl.dashboard.events.on(Y.b_.type,this.onGraphHover.bind(this),this.scope),this.ctrl.dashboard.events.on(Y.ql.type,this.onGraphHoverClear.bind(this),this.scope),this.elem.bind("plotselected",this.onPlotSelected.bind(this)),this.elem.bind("plotclick",this.onPlotClick.bind(this)),this.elem&&this.elem.parent&&(this.legendElem=this.elem.parent().find(".graph-legend")[0],this.legendElemRoot=(0,Me.H)(this.legendElem))}onRender(e){if(this.data=e||this.data,!this.data)return;this.annotations=this.ctrl.annotations||[],this.buildFlotPairs(this.data);const t=this.ctrl.height;if((0,K.rO)(this.data,this.panel,t),!this.panel.legend.show){this.legendElem.hasChildNodes()&&this.legendElemRoot.render(null),setTimeout(()=>{this.renderPanel()});return}const{values:s,min:i,max:r,avg:o,current:l,total:a}=this.panel.legend,{alignAsTable:h,rightSide:d,sideWidth:c,sort:u,sortDesc:g,hideEmpty:m,hideZero:x}=this.panel.legend,S={alignAsTable:h,rightSide:d,sideWidth:c,sort:u,sortDesc:g,hideEmpty:m,hideZero:x},M={values:s,min:i,max:r,avg:o,current:l,total:a},v={seriesList:this.data,hiddenSeries:this.ctrl.hiddenSeries,...S,...M,onToggleSeries:this.ctrl.onToggleSeries,onToggleSort:this.ctrl.onToggleSort,onColorChange:this.ctrl.onColorChange,onToggleAxis:this.ctrl.onToggleAxis,renderCallback:this.renderPanel.bind(this)},y=(0,I.createElement)(vt,v);this.legendElemRoot.render(y)}onGraphHover(e){if(this.dashboard.sharedTooltipModeEnabled()){if(gt(e)){if(!this.plot||e.panel?.id===this.panel.id||this.ctrl.otherPanelInFullscreenMode())return;this.tooltip.show(e.pos)}e.point?.time&&this.tooltip.show({x:e.point.time,panelRelY:e.point.panelRelY??1})}}onPanelTeardown(){this.plot&&(this.plot.destroy(),this.plot=null),this.tooltip.destroy(),this.elem.off(),this.elem.remove(),this.legendElemRoot.unmount()}onGraphHoverClear(e){this.plot&&this.tooltip.clear(this.plot)}onPlotSelected(e,t){if(this.panel.xaxis.mode!=="time"){this.plot.clearSelection();return}(t.ctrlKey||t.metaKey)&&this.dashboard.canAddAnnotations()?setTimeout(()=>{this.eventManager.updateTime(t.xaxis)},100):this.scope.$apply(()=>{this.timeSrv.setTime({from:(0,z.yT)(t.xaxis.from),to:(0,z.yT)(t.xaxis.to)})})}onPlotClick(e,t,s){const i=this.elem.closest(".view")?this.elem.closest(".view").get()[0]:null,r=s;if(this.panel.xaxis.mode==="time")if(t.ctrlKey||t.metaKey){if(t.x!==t.x1||!this.dashboard.id||!this.dashboard.canAddAnnotations())return;setTimeout(()=>{this.eventManager.updateTime({from:t.x,to:null})},100);return}else{this.tooltip.clear(this.plot);let o;if(s){const l=this.panel.yaxes[s.series.yaxis.n===2?1:0],a=this.ctrl.dataList[s.series.dataFrameIndex],h=a.fields[s.series.fieldIndex],d=this.getDataIndexWithNullValuesCorrection(s,a);let c=this.panel.options.dataLinks||[];const u=(0,Oe.eG)(h);u&&(c=[...c,...h.config.links]);const g={decimals:l.decimals,links:c},m=(0,Ee.J)({field:{config:g,type:G.PU.number},theme:A.Ay.theme2,timeZone:this.dashboard.getTimezone()})(h.values[d]);o=c.length?(0,Le.EO)({display:m,name:h.name,view:new Ae.R(a),rowIndex:d,colIndex:s.series.fieldIndex,field:g,hasLinks:u}):void 0}this.scope.$apply(()=>{this.contextMenu.setScrollContextElement(i),this.contextMenu.setSource(r),this.contextMenu.setMenuItemsSupplier(this.getContextMenuItemsSupplier(t,o)),this.contextMenu.toggleMenu(t)})}}getDataIndexWithNullValuesCorrection(e,t){const{datapoint:s,dataIndex:i}=e;if(!Array.isArray(s)||s.length===0)return i;const r=s[0],{timeField:o}=(0,$.KR)(t);if(!o||!o.values||o.values[i]===r)return i;const a=o.values.findIndex(h=>h===r);return a>-1?a:i}shouldAbortRender(){return!this.data||this.panelWidth===0}drawHook(e){this.panel.yaxes[0].label&&this.panel.yaxes[0].show&&b()("<div class='axisLabel left-yaxis-label flot-temp-elem'></div>").text(this.panel.yaxes[0].label).appendTo(this.elem),this.panel.yaxes[1].label&&this.panel.yaxes[1].show&&b()("<div class='axisLabel right-yaxis-label flot-temp-elem'></div>").text(this.panel.yaxes[1].label).appendTo(this.elem);const{dataWarning:t}=this.ctrl;if(t){const s=b()(`<div class="datapoints-warning flot-temp-elem">${t.title}</div>`);t.action&&b()(`<button class="btn btn-secondary">${t.actionText}</button>`).click(t.action).appendTo(s),s.appendTo(this.elem)}this.thresholdManager.draw(e),this.timeRegionManager.draw(e)}processOffsetHook(e,t){const s=this.panel.yaxes[0],i=this.panel.yaxes[1];s.show&&s.label&&(t.left=20),i.show&&i.label&&(t.right=20);const r=e.getYAxes();for(let o=0;o<r.length;o++){const l=r[o],a=this.panel.yaxes[o];l.options.max=l.options.max!==null?l.options.max:a.max,l.options.min=l.options.min!==null?l.options.min:a.min}}processRangeHook(e){const t=e.getYAxes(),s=this.panel.yaxis.align||!1;if(t.length>1&&s===!0){const i=this.panel.yaxis.alignLevel||0;Ye(t,parseFloat(i))}}getMinTimeStepOfSeries(e){let t=Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(e[s].stats.timeStep){if(this.panel.bars){if(e[s].bars&&e[s].bars.show===!1)continue}else if(typeof e[s].bars>"u"||typeof e[s].bars.show>"u"||!e[s].bars.show)continue;e[s].stats.timeStep<t&&(t=e[s].stats.timeStep)}return t}renderPanel(){if(this.panelWidth=this.elem.width()??0,this.shouldAbortRender())return;this.thresholdManager.prepare(this.elem,this.data),this.panel.dashes=this.panel.lines?this.panel.dashes:!1;const e=this.buildFlotOptions(this.panel);this.prepareXAxis(e,this.panel),this.configureYAxisOptions(this.data,e),this.thresholdManager.addFlotOptions(e,this.panel),this.timeRegionManager.addFlotOptions(e,this.panel),this.eventManager.addFlotEvents(this.annotations,e),this.sortedSeries=this.sortSeries(this.data,this.panel),this.callPlot(e,!0)}buildFlotPairs(e){for(let t=0;t<e.length;t++){const s=e[t];s.data=s.getFlotPairs(s.nullPointMode||this.panel.nullPointMode),s.transform==="constant"&&(s.data=(0,ke.r)(s.data,this.ctrl.range)),this.ctrl.hiddenSeries[s.alias]&&(s.data=[],s.stack=!1)}}prepareXAxis(e,t){switch(t.xaxis.mode){case"series":{e.series.bars.barWidth=.7,e.series.bars.align="center";for(let s=0;s<this.data.length;s++){const i=this.data[s];i.data=[[s+1,i.stats[t.xaxis.values[0]]]]}this.addXSeriesAxis(e);break}case"histogram":{let s;if(this.data.length){let i=(0,f.min)((0,f.map)(this.data,l=>l.stats.min)),r=(0,f.max)((0,f.map)(this.data,l=>l.stats.max));const o=t.xaxis.buckets||this.panelWidth/50;t.xaxis.min!=null&&(i=(0,Z.tickStep)(t.xaxis.min,r,o)<=0?i:t.xaxis.min),t.xaxis.max!=null&&(r=(0,Z.tickStep)(i,t.xaxis.max,o)<=0?r:t.xaxis.max),s=(0,Z.tickStep)(i,r,o),e.series.bars.barWidth=s*.8,this.data=rt(this.data,s,this.ctrl.hiddenSeries,i,r)}else s=0;this.addXHistogramAxis(e,s);break}case"table":{e.series.bars.barWidth=.7,e.series.bars.align="center",this.addXTableAxis(e);break}default:{e.series.bars.barWidth=this.getMinTimeStepOfSeries(this.data)/1.5,this.addTimeAxis(e);break}}}callPlot(e,t){try{this.plot=b().plot(this.elem,this.sortedSeries,e),this.ctrl.renderError&&delete this.ctrl.error}catch(s){console.error("flotcharts error",s),this.ctrl.error=s instanceof Error?s.message:"Render Error",this.ctrl.renderError=!0}t&&this.ctrl.renderingCompleted()}buildFlotOptions(e){let t="#c8c8c8";A.Ay.bootData.user.lightTheme===!0&&(t="#a1a1a1");const s=e.stack?!0:null;return{hooks:{draw:[this.drawHook.bind(this)],processOffset:[this.processOffsetHook.bind(this)],processRange:[this.processRangeHook.bind(this)]},legend:{show:!1},series:{stackpercent:e.stack?e.percentage:!1,stack:e.percentage?null:s,lines:{show:e.lines,zero:!1,fill:this.translateFillOption(e.fill),fillColor:this.getFillGradient(e.fillGradient),lineWidth:e.dashes?0:e.linewidth,steps:e.steppedLine},dashes:{show:e.dashes,lineWidth:e.linewidth,dashLength:[e.dashLength,e.spaceLength]},bars:{show:e.bars,fill:1,barWidth:1,zero:!1,lineWidth:0},points:{show:e.points,fill:1,fillColor:!1,radius:e.points?e.pointradius:2},shadowSize:0},yaxes:[],xaxis:{},grid:{minBorderMargin:0,markings:[],backgroundColor:null,borderWidth:0,hoverable:!0,clickable:!0,color:t,margin:{left:0,right:0},labelMarginX:0,mouseActiveRadius:30},selection:{mode:"x",color:"#666"},crosshair:{mode:"x"}}}sortSeries(e,t){const s=t.legend.sort,i=t.legend.sortDesc,r=s!=null&&t.legend[s],o=i!=null,l=t.stack&&r&&o&&t.legend.alignAsTable,a=t.legend.sortDesc===!0?-1:1;return l?(0,f.sortBy)(e,h=>h.stats[s]*a):(0,f.sortBy)(e,h=>h.zindex)}getFillGradient(e){return e?{colors:[{opacity:0},{opacity:e/10}]}:null}translateFillOption(e){return this.panel.percentage&&this.panel.stack&&e===0?.001:e/10}addTimeAxis(e){const t=this.panelWidth/100,s=(0,f.isUndefined)(this.ctrl.range.from)?null:this.ctrl.range.from.valueOf(),i=(0,f.isUndefined)(this.ctrl.range.to)?null:this.ctrl.range.to.valueOf();e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:"time",min:s,max:i,label:"Datetime",ticks:t,timeformat:ft(t,s,i),tickFormatter:mt}}addXSeriesAxis(e){const t=(0,f.map)(this.data,(s,i)=>[i+1,s.alias]);e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:null,min:0,max:t.length+1,label:"Datetime",ticks:t}}addXHistogramAxis(e,t){let s,i,r;const o=this.panelWidth/50;if(this.data.length&&t){const l=[];for(const d of this.data)for(const c of d.data)l[c[0]]=!0;s=Object.keys(l).map(d=>Number(d)),i=(0,f.min)(s),r=(0,f.max)(s);let a=t,h=Math.floor((r-i)/a);for(;h>o;)a=a*2,h=Math.ceil((r-i)/a);i=Math.floor(i/a)*a,r=Math.ceil(r*1.01/a)*a,s=[];for(let d=i;d<=r;d+=a)s.push(d)}else s=o/2,i=0,r=1;e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:null,min:i,max:r,label:"Histogram",ticks:s},this.configureAxisMode(e.xaxis,"short",null)}addXTableAxis(e){let t=(0,f.map)(this.data,(s,i)=>(0,f.map)(s.datapoints,(r,o)=>[i*s.datapoints.length+o+1,r[1]]));t=(0,f.flatten)(t,!0),e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:null,min:0,max:t.length+1,label:"Datetime",ticks:t}}configureYAxisOptions(e,t){const s={position:"left",show:this.panel.yaxes[0].show,index:1,logBase:this.panel.yaxes[0].logBase||1,min:this.parseNumber(this.panel.yaxes[0].min),max:this.parseNumber(this.panel.yaxes[0].max),tickDecimals:this.panel.yaxes[0].decimals};if(t.yaxes.push(s),(0,f.find)(e,{yaxis:2})){const i=(0,f.clone)(s);i.index=2,i.show=this.panel.yaxes[1].show,i.logBase=this.panel.yaxes[1].logBase||1,i.position="right",i.min=this.parseNumber(this.panel.yaxes[1].min),i.max=this.parseNumber(this.panel.yaxes[1].max),i.tickDecimals=this.panel.yaxes[1].decimals,t.yaxes.push(i),this.applyLogScale(t.yaxes[1],e),this.configureAxisMode(t.yaxes[1],this.panel.percentage&&this.panel.stack?"percent":this.panel.yaxes[1].format,this.panel.yaxes[1].decimals)}this.applyLogScale(t.yaxes[0],e),this.configureAxisMode(t.yaxes[0],this.panel.percentage&&this.panel.stack?"percent":this.panel.yaxes[0].format,this.panel.yaxes[0].decimals)}parseNumber(e){return e===null||typeof e>"u"?null:(0,f.toNumber)(e)}applyLogScale(e,t){if(e.logBase===1)return;const s=e.min===0;e.min<Number.MIN_VALUE&&(e.min=null),e.max<Number.MIN_VALUE&&(e.max=null);let i,r,o=e.max,l=e.min;for(r=0;r<t.length;r++)i=t[r],i.yaxis===e.index&&((!o||o<i.stats.max)&&(o=i.stats.max),(!l||l>i.stats.logmin)&&(l=i.stats.logmin));e.transform=a=>a<Number.MIN_VALUE?null:Math.log(a)/Math.log(e.logBase),e.inverseTransform=a=>Math.pow(e.logBase,a),!o&&!l?(o=e.inverseTransform(2),l=e.inverseTransform(-2)):o?l||(l=o*e.inverseTransform(-4)):o=l*e.inverseTransform(4),e.min?l=e.inverseTransform(Math.ceil(e.transform(e.min))):l=e.min=e.inverseTransform(Math.floor(e.transform(l))),e.max?o=e.inverseTransform(Math.floor(e.transform(e.max))):o=e.max=e.inverseTransform(Math.ceil(e.transform(o))),!(!l||l<Number.MIN_VALUE||!o||o<Number.MIN_VALUE)&&(Number.isFinite(l)&&Number.isFinite(o)?(s&&(e.min=.1,l=1),e.ticks=this.generateTicksForLogScaleYAxis(l,o,e.logBase),s&&e.ticks.unshift(.1),e.ticks[e.ticks.length-1]>e.max&&(e.max=e.ticks[e.ticks.length-1])):(e.ticks=[1,2],delete e.min,delete e.max))}generateTicksForLogScaleYAxis(e,t,s){let i=[],r;for(r=e;r<=t;r*=s)i.push(r);const o=Math.ceil(this.ctrl.height/25),l=i.length;if(l>o){const a=Math.ceil(l/o)*s;for(i=[],r=e;r<=t*a;r*=a)i.push(r)}return i}configureAxisMode(e,t,s){e.tickFormatter=(i,r)=>{const o=(0,oe.j_)(t);if(!o)throw new Error(`Unit '${t}' is not supported`);return(0,oe.cN)(o(i,s))}}}V.m7.directive("grafanaGraph",["timeSrv","popoverSrv","contextSrv",Ct]);function Ct(n,e,t){return{restrict:"A",template:"",link:(s,i)=>new xt(s,i,n)}}V.Ay.controller("SeriesOverridesCtrl",["$scope","$element","popoverSrv",bt]);function bt(n,e,t){n.overrideMenu=[],n.currentOverrides=[],n.override=n.override||{},n.colorPickerModel={},n.addOverrideOption=(s,i,r)=>{const o={text:s,propertyName:i,index:n.overrideMenu.length,values:r,submenu:(0,f.map)(r,l=>({text:String(l),value:l}))};n.overrideMenu.push(o)},n.setOverride=(s,i)=>{if(s.propertyName==="color"){n.openColorSelector(n.override.color);return}n.override[s.propertyName]=i.value,s.propertyName==="fillBelowTo"&&(n.override.lines=!1,n.ctrl.addSeriesOverride({alias:i.value,lines:!1})),n.updateCurrentOverrides(),n.ctrl.render()},n.colorSelected=s=>{n.override.color=s,n.updateCurrentOverrides(),n.ctrl.render(),n.colorPickerModel.series.color=s},n.openColorSelector=s=>{n.colorPickerModel={autoClose:!0,colorSelected:n.colorSelected,series:{color:s}},t.show({element:e.find(".dropdown")[0],position:"top center",openOn:"click",template:'<series-color-picker-popover color="series.color" onColorChange="colorSelected" />',classNames:"drop-popover drop-popover--transparent",model:n.colorPickerModel,onClose:()=>{n.ctrl.render()}})},n.removeOverride=s=>{delete n.override[s.propertyName],n.updateCurrentOverrides(),n.ctrl.refresh()},n.getSeriesNames=()=>(0,f.map)(n.ctrl.seriesList,s=>B.sQ.escapeHtml(s.alias)),n.updateCurrentOverrides=()=>{n.currentOverrides=[],(0,f.each)(n.overrideMenu,s=>{const i=n.override[s.propertyName];(0,f.isUndefined)(i)||n.currentOverrides.push({name:s.text,propertyName:s.propertyName,value:String(i)})})},n.addOverrideOption("Bars","bars",[!0,!1]),n.addOverrideOption("Lines","lines",[!0,!1]),n.addOverrideOption("Line fill","fill",[0,1,2,3,4,5,6,7,8,9,10]),n.addOverrideOption("Fill gradient","fillGradient",[0,1,2,3,4,5,6,7,8,9,10]),n.addOverrideOption("Line width","linewidth",[0,1,2,3,4,5,6,7,8,9,10]),n.addOverrideOption("Null point mode","nullPointMode",["connected","null","null as zero"]),n.addOverrideOption("Fill below to","fillBelowTo",n.getSeriesNames()),n.addOverrideOption("Staircase line","steppedLine",[!0,!1]),n.addOverrideOption("Dashes","dashes",[!0,!1]),n.addOverrideOption("Hidden Series","hiddenSeries",[!0,!1]),n.addOverrideOption("Dash Length","dashLength",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),n.addOverrideOption("Dash Space","spaceLength",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),n.addOverrideOption("Points","points",[!0,!1]),n.addOverrideOption("Points Radius","pointradius",[1,2,3,4,5]),n.addOverrideOption("Stack","stack",[!0,!1,"A","B","C","D"]),n.addOverrideOption("Color","color",["change"]),n.addOverrideOption("Y-axis","yaxis",[1,2]),n.addOverrideOption("Z-index","zindex",[-3,-2,-1,0,1,2,3]),n.addOverrideOption("Transform","transform",["constant","negative-Y"]),n.addOverrideOption("Legend","legend",[!0,!1]),n.addOverrideOption("Hide in tooltip","hideTooltip",[!0,!1]),n.updateCurrentOverrides()}class yt{constructor(e){this.$scope=e,this.disabled=!1}static{this.$inject=["$scope"]}$onInit(){this.panel=this.panelCtrl.panel,this.panel.alert&&!A.Ay.unifiedAlertingEnabled&&(this.disabled=!0);const e=this.$scope.$on("$destroy",()=>{this.panelCtrl.editingThresholds=!1,this.panelCtrl.render(),e()});this.panelCtrl.editingThresholds=!0}addThreshold(){this.panel.thresholds.push({value:void 0,colorMode:"critical",op:"gt",fill:!0,line:!0,yaxis:"left"}),this.panelCtrl.render()}removeThreshold(e){this.panel.thresholds.splice(e,1),this.panelCtrl.render()}render(){this.panelCtrl.render()}onFillColorChange(e){return t=>{this.panel.thresholds[e].fillColor=t,this.render()}}onLineColorChange(e){return t=>{this.panel.thresholds[e].lineColor=t,this.render()}}onThresholdTypeChange(e){this.panel.thresholds[e].colorMode==="custom"&&(this.panel.thresholds[e].fillColor=(0,Q.A)(A.Ay.theme2.v1.palette.blue85).setAlpha(.2).toRgbString(),this.panel.thresholds[e].lineColor=(0,Q.A)(A.Ay.theme2.v1.palette.blue77).setAlpha(.6).toRgbString()),this.panelCtrl.render()}}V.Ay.directive("graphThresholdForm",()=>({restrict:"E",templateUrl:"public/app/plugins/panel/graph/thresholds_form.html",controller:yt,bindToController:!0,controllerAs:"ctrl",scope:{panelCtrl:"="}}));class Tt{constructor(e){this.$scope=e,this.disabled=!1}static{this.$inject=["$scope"]}$onInit(){this.panel=this.panelCtrl.panel;const e=this.$scope.$on("$destroy",()=>{this.panelCtrl.editingTimeRegions=!1,this.panelCtrl.render(),e()});this.colorModes=ht(),this.panelCtrl.editingTimeRegions=!0}render(){this.panelCtrl.render()}addTimeRegion(){this.panel.timeRegions.push({op:"time",fromDayOfWeek:void 0,from:void 0,toDayOfWeek:void 0,to:void 0,colorMode:"background6",fill:!0,line:!1,fillColor:"rgba(234, 112, 112, 0.12)",lineColor:"rgba(237, 46, 24, 0.60)"}),this.panelCtrl.render()}removeTimeRegion(e){this.panel.timeRegions.splice(e,1),this.panelCtrl.render()}onFillColorChange(e){return t=>{this.panel.timeRegions[e].fillColor=t,this.render()}}onLineColorChange(e){return t=>{this.panel.timeRegions[e].lineColor=t,this.render()}}}V.Ay.directive("graphTimeRegionForm",()=>({restrict:"E",templateUrl:"public/app/plugins/panel/graph/time_regions_form.html",controller:Tt,bindToController:!0,controllerAs:"ctrl",scope:{panelCtrl:"="}}));var ge=p(55907);V.Ay.directive("annotationTooltip",["$sanitize","dashboardSrv","$compile",St]);function St(n,e,t){function s(i){try{return n(i)}catch{return console.log("Could not sanitize annotation string, html escaping instead"),(0,f.escape)(i)}}return{restrict:"E",scope:{event:"=",onEdit:"&"},link:(i,r)=>{const o=i.event;let l=o.title,a=o.text;const h=e.getCurrent();let d='<div class="graph-annotation">',c="";if(o.alertId!==void 0&&o.newState){const x=ge.A.getStateDisplayModel(o.newState);c=x.stateClass,l=`<i class="${x.iconClass}"></i> ${x.text}`,a=ge.A.getAlertAnnotationInfo(o),o.text&&(a=a+"<br />"+o.text)}else l&&(a=l+"<br />"+((0,f.isString)(a)?a:""),l="");let u='<div class="graph-annotation__header">';o.login&&o.avatarUrl&&(u+=`<div class="graph-annotation__user" bs-tooltip="'Created by ${o.login}'"><img src="${o.avatarUrl}" /></div>`),u+=`
          <span class="graph-annotation__title ${c}">${s(l)}</span>
          <span class="graph-annotation__time">${h?.formatDate(o.min)}</span>
      `,o.id&&h?.canEditAnnotations(o.dashboardId)&&(u+=`
          <span class="pointer graph-annotation__edit-icon" ng-click="onEdit()">
            <i class="fa fa-pencil-square"></i>
          </span>
        `),u+="</div>",d+=u,d+='<div class="graph-annotation__body">',a&&(d+="<div ng-non-bindable>"+s(a.replace(/\n/g,"<br>"))+"</div>");const g=o.tags;g&&g.length&&(i.tags=g,d+='<span class="label label-tag small" ng-repeat="tag in tags" tag-color-from-name="tag">{{tag}}</span><br/>'),d+="</div>",d+="</div>",b()(d).appendTo(r),t(r.contents())(i)}}}var J=p(10154),me=p(42972);class Mt{constructor(){}$onInit(){this.event.panelId=this.panelCtrl.panel.id,this.event.dashboardUID=this.panelCtrl.dashboard.uid,this.event.time=fe(this.event.time),this.event.isRegion&&(this.event.timeEnd=fe(this.event.timeEnd)),this.timeFormated=this.panelCtrl.dashboard.formatDate(this.event.time)}canDelete(){return this.event.source?.type==="dashboard"?!!this.panelCtrl.dashboard.meta.annotationsPermissions?.dashboard.canDelete:!!this.panelCtrl.dashboard.meta.annotationsPermissions?.organization.canDelete}async save(){if(!this.form.$valid)return;const e=(0,f.cloneDeep)(this.event);if(e.time=e.time.valueOf(),e.timeEnd=0,e.isRegion&&(e.timeEnd=this.event.timeEnd.valueOf(),e.timeEnd<e.time)){console.log("invalid time");return}let t=J.vJ;e.id&&(t=J.rJ);try{await t(e)}catch(s){console.log(s)}finally{this.close(),(0,me.Dh)().run({dashboard:this.panelCtrl.dashboard,range:this.panelCtrl.range})}}async delete(){try{await(0,J.Xm)(this.event)}catch(e){console.log(e)}finally{this.close(),(0,me.Dh)().run({dashboard:this.panelCtrl.dashboard,range:this.panelCtrl.range})}}}function fe(n){if(n&&(0,f.isNumber)(n)){const e=Number(n);return(0,z.KQ)(e)}else return n}function Ot(){return{restrict:"E",controller:Mt,bindToController:!0,controllerAs:"ctrl",templateUrl:"public/app/features/annotations/partials/event_editor.html",scope:{panelCtrl:"=",event:"=",close:"&"}}}V.m7.directive("eventEditor",Ot);var Et=p(65158),R=p(37055),At=p(39601),kt=p(75519);const wt=["percent_diff","percent_diff_abs"];class Lt{static alertToGraphThresholds(e){if(!e.alert||A.config.unifiedAlertingEnabled)return!1;for(let s=0;s<e.alert.conditions.length;s++){const i=e.alert.conditions[s];if(i.type!=="query")continue;const r=i.evaluator,o=e.thresholds=[],l=wt.indexOf(i.reducer?.type)===-1;switch(r.type){case"gt":{const a=r.params[0];o.push({value:a,op:"gt",visible:l});break}case"lt":{const a=r.params[0];o.push({value:a,op:"lt",visible:l});break}case"outside_range":{const a=r.params[0],h=r.params[1];a>h?(o.push({value:a,op:"gt",visible:l}),o.push({value:h,op:"lt",visible:l})):(o.push({value:a,op:"lt",visible:l}),o.push({value:h,op:"gt",visible:l}));break}case"within_range":{const a=r.params[0],h=r.params[1];a>h?(o.push({value:a,op:"lt",visible:l}),o.push({value:h,op:"gt",visible:l})):(o.push({value:a,op:"gt",visible:l}),o.push({value:h,op:"lt",visible:l}));break}}break}for(const s of e.thresholds)s.fill=e.options.alertThreshold,s.line=e.options.alertThreshold,s.colorMode="critical";return!0}}var Dt=p(96382),Pt=p(79971),It=p(99140),Ft=p(60444),Nt=p(7436),jt=p(28444);class Rt{constructor(e){this.scrollContextElement=null,this.position={x:0,y:0},this.onClose=()=>{this.scrollContextElement&&this.scrollContextElement.removeEventListener("scroll",this.onClose),this.scope.$apply(()=>{this.isVisible=!1})},this.toggleMenu=t=>{this.isVisible=!this.isVisible,this.isVisible&&this.scrollContextElement&&this.scrollContextElement.addEventListener("scroll",this.onClose),this.source?this.position={x:this.source.pageX,y:this.source.pageY}:this.position={x:t?t.pageX:0,y:t?t.pageY:0}},this.setScrollContextElement=t=>{this.scrollContextElement=t},this.setSource=t=>{this.source=t},this.getSource=()=>this.source,this.setMenuItemsSupplier=t=>{this.menuItemsSupplier=t},this.isVisible=!1,this.scope=e}}const Ht=n=>{const e=n.fieldConfig??{defaults:{},overrides:[]},t=n.options||{};return t.dataLinks&&(e.defaults.links=t.dataLinks,delete t.dataLinks),n.options=t,n.fieldConfig=e,t};class zt{constructor(e){this.$scope=e,this.panelCtrl=e.ctrl,this.panel=this.panelCtrl.panel,this.$scope.ctrl=this,this.logScales={linear:1,"log (base 2)":2,"log (base 10)":10,"log (base 32)":32,"log (base 1024)":1024},this.xAxisModes={Time:"time",Series:"series",Histogram:"histogram"},this.xAxisStatOptions=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Count",value:"count"},{text:"Current",value:"current"}],this.panel.xaxis.mode==="custom"&&(this.panel.xaxis.name||(this.panel.xaxis.name="specify field")),this.selectors=re.Tp.components.Panels.Visualization.Graph.VisualizationTab}static{this.$inject=["$scope"]}setUnitFormat(e){return t=>{e.format=t,this.panel.fieldConfig.defaults.unit?(this.panel.fieldConfig.defaults.unit=void 0,this.panelCtrl.refresh()):this.panelCtrl.render()}}render(){this.panelCtrl.render()}xAxisModeChanged(){this.panelCtrl.processor.setPanelDefaultsForNewXAxisMode(),this.panelCtrl.onDataFramesReceived(this.panelCtrl.dataList)}xAxisValueChanged(){this.panelCtrl.onDataFramesReceived(this.panelCtrl.dataList)}}function Vt(){"use strict";return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/graph/axes_editor.html",controller:zt}}var Bt=p(28240),Wt=p(46294),Ut=p(31140);class Xt{constructor(e){this.panel=e}getSeriesList(e){const t=[],{dataList:s,range:i}=e;if(!s||!s.length)return t;for(let r=0;r<s.length;r++){let o=s[r],{timeField:l}=(0,$.KR)(o);if(l){o=(0,Wt.M)({frame:o,refFieldName:l.name}),l=(0,$.KR)(o).timeField;for(let a=0;a<o.fields.length;a++){const h=o.fields[a];if(h.type!==G.PU.number)continue;const d=(0,Bt.Ct)(h,o,s),c=[];for(let u=0;u<o.length;u++)c.push([h.values[u],(0,z.KQ)(l.values[u]).valueOf()]);t.push(this.toTimeSeries(h,d,r,a,c,t.length,i))}}}if(this.panel.xaxis.mode==="histogram"&&!this.panel.stack&&t.length>1){const r=t[0];r.alias=r.aliasEscaped="Count";for(let o=1;o<t.length;o++)r.datapoints=r.datapoints.concat(t[o].datapoints);return[r]}return t}toTimeSeries(e,t,s,i,r,o,l){const a=o%F.Tj.length,h=this.panel.aliasColors[t]||F.Tj[a],d=new Ut.A({datapoints:r||[],alias:t,color:A.Ay.theme2.visualization.getColorByName(h),unit:e.config?e.config.unit:void 0,dataFrameIndex:s,fieldIndex:i});if(r&&r.length>0&&l){const c=r[r.length-1][1],u=l.from;c-u.valueOf()<-1e4&&r[0][1]-u.valueOf()<-1e4&&(d.isOutsideRange=!0)}return d}setPanelDefaultsForNewXAxisMode(){switch(this.panel.xaxis.mode){case"time":{this.panel.bars=!1,this.panel.lines=!0,this.panel.points=!1,this.panel.legend.show=!0,this.panel.tooltip.shared=!0,this.panel.xaxis.values=[];break}case"series":{this.panel.bars=!0,this.panel.lines=!1,this.panel.points=!1,this.panel.stack=!1,this.panel.legend.show=!1,this.panel.tooltip.shared=!1,this.panel.xaxis.values=["total"];break}case"histogram":{this.panel.bars=!0,this.panel.lines=!1,this.panel.points=!1,this.panel.stack=!1,this.panel.legend.show=!1,this.panel.tooltip.shared=!1;break}}}validateXAxisSeriesValue(){switch(this.panel.xaxis.mode){case"series":{if(this.panel.xaxis.values.length===0){this.panel.xaxis.values=["total"];return}const e=this.getXAxisValueOptions({});(0,f.find)(e,{value:this.panel.xaxis.values[0]})||(this.panel.xaxis.values=["total"]);return}}}getXAxisValueOptions(e){switch(this.panel.xaxis.mode){case"series":return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Count",value:"count"}]}return[]}pluckDeep(e,t){const s=t.split(".");let i=e;for(let r=0;r<s.length;++r)if(i[s[r]])i=i[s[r]];else return;return i}}const Yt=`
<div class="graph-panel" ng-class="{'graph-panel--legend-right': ctrl.panel.legend.rightSide}">
  <div class="graph-panel__chart" grafana-graph ng-dblclick="ctrl.zoomOut()">
  </div>

  <div class="graph-legend">
    <div class="graph-legend-content" graph-legend></div>
  </div>
  <div ng-if="ctrl.contextMenuCtrl.isVisible">
    <graph-context-menu
      itemsGroup="ctrl.contextMenuCtrl.menuItemsSupplier()"
      on-close="ctrl.onContextMenuClose"
      getContextMenuSource="ctrl.contextMenuCtrl.getSource"
      timeZone="ctrl.getTimeZone()"
      x="ctrl.contextMenuCtrl.position.x"
      y="ctrl.contextMenuCtrl.position.y"
    ></graph-context-menu>
  </div>
</div>
`;class ve extends kt.F{constructor(e,t){super(e,t),this.renderError=!1,this.hiddenSeries={},this.hiddenSeriesTainted=!1,this.seriesList=[],this.dataList=[],this.annotations=[],this.colors=[],this.subTabIndex=0,this.panelDefaults={datasource:null,renderer:"flot",yaxes:[{label:null,show:!0,logBase:1,min:null,max:null,format:"short"},{label:null,show:!0,logBase:1,min:null,max:null,format:"short"}],xaxis:{show:!0,mode:"time",name:null,values:[],buckets:null},yaxis:{align:!1,alignLevel:null},lines:!0,fill:1,fillGradient:0,linewidth:1,dashes:!1,hiddenSeries:!1,dashLength:10,spaceLength:10,points:!1,pointradius:2,bars:!1,stack:!1,percentage:!1,legend:{show:!0,values:!1,min:!1,max:!1,current:!1,total:!1,avg:!1},nullPointMode:"null",steppedLine:!1,tooltip:{value_type:"individual",shared:!0,sort:0},timeFrom:null,timeShift:null,targets:[{}],aliasColors:{},seriesOverrides:[],thresholds:[],timeRegions:[],options:{alertThreshold:!0}},this.onColorChange=(i,r)=>{i.setColor(A.Ay.theme2.visualization.getColorByName(r)),this.panel.aliasColors[i.alias]=r,this.render()},this.onToggleSeries=i=>{this.hiddenSeriesTainted=!0,this.hiddenSeries=i,this.render()},this.onToggleSort=(i,r)=>{this.panel.legend.sort=i,this.panel.legend.sortDesc=r,this.render()},this.onToggleAxis=i=>{let r=(0,f.find)(this.panel.seriesOverrides,{alias:i.alias});r||(r={alias:i.alias},this.panel.seriesOverrides.push(r)),r.yaxis=i.yaxis,this.render()},this.onContextMenuClose=()=>{this.contextMenuCtrl.toggleMenu()},this.getTimeZone=()=>this.dashboard.getTimezone(),this.getDataFrameByRefId=i=>this.dataList.filter(r=>r.refId===i)[0],(0,f.defaults)(this.panel,this.panelDefaults),(0,f.defaults)(this.panel.tooltip,this.panelDefaults.tooltip),(0,f.defaults)(this.panel.legend,this.panelDefaults.legend),(0,f.defaults)(this.panel.xaxis,this.panelDefaults.xaxis),(0,f.defaults)(this.panel.options,this.panelDefaults.options),this.useDataFrames=!0,this.processor=new Xt(this.panel),this.contextMenuCtrl=new Rt(e),this.events.on(w.ee.render,this.onRender.bind(this)),this.events.on(w.ee.dataFramesReceived,this.onDataFramesReceived.bind(this)),this.events.on(w.ee.dataSnapshotLoad,this.onDataSnapshotLoad.bind(this)),this.events.on(w.ee.editModeInitialized,this.onInitEditMode.bind(this)),this.events.on(w.ee.initPanelActions,this.onInitPanelActions.bind(this));const s=this.panel.fieldConfig.defaults.unit;s&&(this.panel.yaxes[0].format=s)}static{this.template=Yt}static{this.$inject=["$scope","$injector"]}onInitEditMode(){this.addEditorTab("Display","public/app/plugins/panel/graph/tab_display.html"),this.addEditorTab("Series overrides","public/app/plugins/panel/graph/tab_series_overrides.html"),this.addEditorTab("Axes",Vt),this.addEditorTab("Legend","public/app/plugins/panel/graph/tab_legend.html"),this.addEditorTab("Thresholds","public/app/plugins/panel/graph/tab_thresholds.html"),this.addEditorTab("Time regions","public/app/plugins/panel/graph/tab_time_regions.html"),this.subTabIndex=0,this.hiddenSeriesTainted=!1}onInitPanelActions(e){e.push({text:"Toggle legend",click:"ctrl.toggleLegend()",shortcut:"p l"})}zoomOut(e){K.lE.publish(new jt.U0({scale:2}))}onDataSnapshotLoad(e){const{series:t,annotations:s}=(0,Ft.d)(this.panel,this.dashboard);this.panelData.annotations=s,this.onDataFramesReceived(t)}onDataFramesReceived(e){this.dataList=e,this.seriesList=this.processor.getSeriesList({dataList:this.dataList,range:this.range}),this.dataWarning=this.getDataWarning(),this.alertState=void 0,this.seriesList.alertState=void 0,this.panelData.alertState&&(this.alertState=this.panelData.alertState,this.seriesList.alertState=this.alertState.state),this.annotations=[],this.panelData.annotations?.length&&(this.annotations=(0,Nt.H)(this.panelData.annotations)),this.loading=!1,this.render(this.seriesList)}getDataWarning(){if(this.seriesList.reduce((i,r)=>i+r.datapoints.length,0)===0){if(this.dataList){for(const i of this.dataList)if(i.length&&i.fields?.length)return{title:"Unable to graph data",tip:"Data exists, but is not timeseries",actionText:"Switch to table view",action:()=>{(0,It.JD)((0,Pt.gW)({panel:this.panel,pluginId:"table"}))}}}return{title:"No data",tip:"No data returned from query"}}for(const i of this.seriesList)if(!i.isOutsideRange)return;const t={title:"Data outside time range",tip:"Can be caused by timezone mismatch or missing time filter in query"},s=ut(this.dataList);return s&&(t.actionText="Zoom to data",t.action=()=>{At.Ny.partial({from:s.from,to:s.to})}),t}onRender(){if(this.seriesList){Lt.alertToGraphThresholds(this.panel);for(const e of this.seriesList)e.applySeriesOverrides(this.panel.seriesOverrides),e.unit&&(this.panel.yaxes[e.yaxis-1].format=e.unit),this.hiddenSeriesTainted===!1&&e.hiddenSeries===!0&&(this.hiddenSeries[e.alias]=!0)}}addSeriesOverride(e){this.panel.seriesOverrides.push(e||{})}removeSeriesOverride(e){this.panel.seriesOverrides=(0,f.without)(this.panel.seriesOverrides,e),this.render()}toggleLegend(){this.panel.legend.show=!this.panel.legend.show,this.render()}legendValuesOptionChanged(){const e=this.panel.legend;e.values=e.min||e.max||e.avg||e.current||e.total,this.render()}migrateToReact(){const e=(0,Dt.p)(this.panel,!0);this.onPluginTypeChange(A.Ay.panels[e])}}const xe=new Et.m(null).useFieldConfig({disableStandardOptions:[R.uo.NoValue,R.uo.Thresholds,R.uo.Max,R.uo.Min,R.uo.Decimals,R.uo.Color,R.uo.Mappings]}).setDataSupport({annotations:!0,alertStates:!0}).setMigrationHandler(Ht);xe.angularPanelCtrl=ve}}]);

//# sourceMappingURL=graphPlugin.5e660f78762ebea3a892.js.map