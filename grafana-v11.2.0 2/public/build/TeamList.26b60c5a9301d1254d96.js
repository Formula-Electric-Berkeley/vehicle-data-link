"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:(b,O,e)=>{e.d(O,{Y:()=>D});var a=e(74848),R=e(96540),l=e(41053),_=e(10096),A=e(31678),M=e(37425),f=e(85927);const D=({teamId:r,roleOptions:s,disabled:g,roles:m,onApplyRoles:P,pendingRoles:p,apply:I=!1,maxWidth:U,width:C,isLoading:S})=>{const[{loading:L,value:u=m||[]},E]=(0,l.A)(async()=>{try{if(m)return m;if(I&&p?.length)return p;if(_.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRolesList)&&r>0)return await(0,f.xN)(r)}catch(x){console.error("Error loading options",x)}return[]},[r,p,m]);(0,R.useEffect)(()=>{E()},[E]);const K=async x=>{I?P&&P(x):(await(0,f.G3)(x,r),await E())},h=_.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRolesAdd)&&_.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRolesRemove);return(0,a.jsx)(M.n,{apply:I,onRolesChange:K,roleOptions:s,appliedRoles:u,isLoading:L||S,disabled:g,basicRoleDisabled:!0,canUpdateRoles:h,maxWidth:U,width:C})}},52576:(b,O,e)=>{e.r(O),e.d(O,{TeamList:()=>t,default:()=>$});var a=e(74848),R=e(32196),l=e(96540),_=e(70255),A=e(71468),M=e(40845),f=e(12942),D=e(72109),r=e(67061),s=e(55852),g=e(91605),m=e(69529),P=e(14186),p=e(67647),I=e(48840),U=e(19384),C=e(69444),S=e(85927),L=e(8484),u=e(16233),E=e(31678),K=e(31084),h=e(33667);const x=new Array(3).fill(null).map((c,y)=>({id:y,memberCount:0,name:"",orgId:0,permission:0})),t=({teams:c,query:y,noTeams:N,hasFetched:T,loadTeams:B,deleteTeam:Q,changeQuery:X,totalPages:Z,page:w,rolesLoading:V,changePage:F,changeSort:k})=>{const[J,q]=(0,l.useState)([]),j=(0,M.of)(z);(0,l.useEffect)(()=>{B(!0)},[B]),(0,l.useEffect)(()=>{u.TP.licensedAccessControlEnabled()&&u.TP.hasPermission(E.AccessControlAction.ActionRolesList)&&(0,S.RL)().then(i=>q(i))},[]);const G=u.TP.hasPermission(E.AccessControlAction.ActionTeamsCreate),H=n(),ee=(0,l.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>T?i&&(0,a.jsx)(f.e,{src:i,alt:"User avatar"}):(0,a.jsx)(_.A,{containerClassName:j.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i},row:{original:v}})=>T?u.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRead,v)?(0,a.jsx)(D.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${v.id}`,title:"Edit team",children:i}):i:(0,a.jsx)(_.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>T?i:(0,a.jsx)(_.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>T?i:(0,a.jsx)(_.A,{width:40}),sortType:"number"},...H?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:v}})=>T?u.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRolesList,v)&&(0,a.jsx)(K.Y,{teamId:v.id,roles:v.roles||[],isLoading:V,roleOptions:J,width:40}):(0,a.jsx)(_.A,{width:320,height:32,containerClassName:j.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!T)return(0,a.jsxs)(r.B,{direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,a.jsx)(_.A,{containerClassName:j.blockSkeleton,width:16,height:16}),(0,a.jsx)(_.A,{containerClassName:j.blockSkeleton,width:22,height:24})]});const v=u.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRead,i),Y=u.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsDelete,i);return(0,a.jsxs)(r.B,{direction:"row",justifyContent:"flex-end",gap:2,children:[v&&(0,a.jsx)(s.z9,{href:`org/teams/edit/${i.id}`,"aria-label":`Edit team ${i.name}`,icon:"pen",size:"sm",variant:"secondary",tooltip:"Edit team"}),(0,a.jsx)(g.e,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!Y,onConfirm:()=>Q(i.id)})]})}}],[H,T,V,J,Q,j]);return(0,a.jsx)(C.Y,{navId:"teams",actions:N?void 0:(0,a.jsx)(s.z9,{href:G?"org/teams/new":"#",disabled:!G,children:"New Team"}),children:(0,a.jsx)(C.Y.Contents,{children:N?(0,a.jsx)(m.p,{variant:"call-to-action",button:(0,a.jsx)(s.z9,{disabled:!G,href:"org/teams/new",icon:"users-alt",size:"lg",children:(0,a.jsx)(L.x6,{i18nKey:"teams.empty-state.button-title",children:"New team"})}),message:(0,L.t)("teams.empty-state.title","You haven't created any teams yet"),children:(0,a.jsxs)(L.x6,{i18nKey:"teams.empty-state.pro-tip",children:["Assign folder and dashboard permissions to teams instead of users to ease administration."," ",(0,a.jsx)(D.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/team-management",children:"Learn more"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"page-action-bar",children:(0,a.jsx)(P.I,{grow:!0,children:(0,a.jsx)(p.Z,{placeholder:"Search teams",value:y,onChange:X})})}),T&&c.length===0?(0,a.jsx)(m.p,{variant:"not-found",message:(0,L.t)("teams.empty-state.message","No teams found")}):(0,a.jsxs)(r.B,{direction:"column",gap:2,children:[(0,a.jsx)(I.j,{columns:ee,data:T?c:x,getRowId:i=>String(i.id),fetchData:k}),(0,a.jsx)(r.B,{justifyContent:"flex-end",children:(0,a.jsx)(U.d,{hideWhenSinglePage:!0,currentPage:w,numberOfPages:Z,onNavigate:F})})]})]})})})};function n(){return u.TP.licensedAccessControlEnabled()&&u.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&u.TP.hasPermission(E.AccessControlAction.ActionRolesList)}function o(c){return{teams:c.teams.teams,query:c.teams.query,perPage:c.teams.perPage,page:c.teams.page,noTeams:c.teams.noTeams,totalPages:c.teams.totalPages,hasFetched:c.teams.hasFetched,rolesLoading:c.teams.rolesLoading}}const d={loadTeams:h.Bu,deleteTeam:h.To,changePage:h.yd,changeQuery:h.nM,changeSort:h.Vk},$=(0,A.connect)(o,d)(t),z=c=>({blockSkeleton:(0,R.css)({lineHeight:1,display:"flex"})})},33667:(b,O,e)=>{e.d(O,{Bu:()=>s,It:()=>K,To:()=>P,Vk:()=>U,aK:()=>E,eo:()=>m,n7:()=>u,nC:()=>h,nM:()=>p,yd:()=>I});var a=e(2543),R=e.n(a),l=e(17172),_=e(82467),A=e(10096),M=e(80714),f=e(31678),D=e(78319),r=e(34655);function s(t=!1){return async(n,o)=>{const{query:d,page:W,perPage:$,sort:z}=o().teams;if(!A.contextSrv.hasPermission(f.AccessControlAction.ActionTeamsRead)){n((0,r.Q9)({teams:[],totalCount:0,page:1,perPage:$,noTeams:!0}));return}const c=await(0,l.AI)().get("/api/teams/search",(0,M.F)({query:d,page:W,perpage:$,sort:z}));let y=!1;if(t&&(y=c.teams.length===0),A.contextSrv.licensedAccessControlEnabled()&&A.contextSrv.hasPermission(f.AccessControlAction.ActionTeamsRolesList)){n((0,r.dJ)());const N=c?.teams.map(B=>B.id),T=await(0,l.AI)().post("/api/access-control/teams/roles/search",{teamIds:N});c.teams.forEach(B=>{B.roles=T?T[B.id]||[]:[]}),n((0,r.jE)())}n((0,r.Q9)({noTeams:y,...c}))}}const g=(0,a.debounce)(t=>t(s()),500);function m(t){return async n=>{const o=await(0,l.AI)().get(`/api/teams/${t}`,(0,M.F)());n((0,r.$T)(o)),n((0,_.Vz)((0,D.R)(o)))}}function P(t){return async n=>{await(0,l.AI)().delete(`/api/teams/${t}`),await A.contextSrv.fetchUserPermissions(),n(s())}}function p(t){return async n=>{n((0,r.L5)(t)),g(n)}}function I(t){return async n=>{n((0,r.EC)(t)),n(s())}}function U({sortBy:t}){const n=t.length?`${t[0].id}-${t[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,r.$u)(n)),o(s())}}function C(){return async(t,n)=>{const o=n().team.team,d=await getBackendSrv().get(`/api/teams/${o.id}/members`);t(teamMembersLoaded(d))}}function S(t){return async(n,o)=>{const d=o().team.team;await getBackendSrv().post(`/api/teams/${d.id}/members`,{userId:t}),n(C())}}function L(t){return async(n,o)=>{const d=o().team.team;await getBackendSrv().delete(`/api/teams/${d.id}/members/${t}`),n(C())}}function u(t,n){return async(o,d)=>{const W=d().team.team;await(0,l.AI)().put(`/api/teams/${W.id}`,{name:t,email:n}),o(m(W.id))}}function E(){return async(t,n)=>{const o=n().team.team,d=await(0,l.AI)().get(`/api/teams/${o.id}/groups`);t((0,r.tC)(d))}}function K(t){return async(n,o)=>{const d=o().team.team;await(0,l.AI)().post(`/api/teams/${d.id}/groups`,{groupId:t}),n(E())}}function h(t){return async(n,o)=>{const d=o().team.team;await(0,l.AI)().delete(`/api/teams/${d.id}/groups?groupId=${encodeURIComponent(t)}`),n(E())}}function x(t){return async n=>{await getBackendSrv().put(`/api/teams/${t.teamId}/members/${t.userId}`,{permission:t.permission}),n(C())}}},78319:(b,O,e)=>{e.d(O,{R:()=>D,X:()=>r});var a=e(33378),R=e(76323),l=e(2913),_=e(16233),A=e(35538),M=e(31678);const f={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:M.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function D(s){const g={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===f||_.TP.hasPermissionInMetadata(M.AccessControlAction.ActionTeamsPermissionsRead,s))&&g.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const m={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},P=s===f;return(0,A.z5)()&&(m.tabSuffix=()=>(0,R.J)({experimentId:P?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,a.a)("teamsync")?(P||_.TP.hasPermissionInMetadata(M.AccessControlAction.ActionTeamsPermissionsRead,s))&&g.children.push(m):l.Ay.featureToggles.featureHighlights&&g.children.push({...m,tabSuffix:()=>(0,R.J)({experimentId:P?"":"feature-highlights-team-sync-badge"})}),g}function r(s){const g=D(f);let m;for(const P of g.children)if(P.id.indexOf(s)>0){P.active=!0,m=P;break}return{main:g,node:m}}}}]);

//# sourceMappingURL=TeamList.26b60c5a9301d1254d96.js.map